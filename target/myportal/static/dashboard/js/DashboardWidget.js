b$.module("bd.widgets",function(){var d=b$.require("portal.widget.Widget");var b=b$.require("portal.views.widget.Widget");var a=d.extend(function(g,f,i,e,h,j){d.call(this,g,f,i,e,h,j)});a.prototype.getTitle=function(){return this.getPreference("title")||""};var c=b.extend();c.prototype.createHTML=function(m){var k=this;var o=b.prototype.createHTML.call(this,m);var r=jQuery(o);var l=this.model.getPreference("name");if(l==null||l==""){l=this.model.id}var f=this.model.getPreference("htmlTemplate");var p=this.model.getTitle();r.addClass("bd-widget-"+l);var i=this.perspectiveProvider.getCurrentPerspective().getType().getName();var j='<div class="bd-widgetHeader"><div class="bd-widgetIcon"></div><div class="bd-widgetTitle">'+p+'</div></div><div class="bd-widgetContent"></div>';if(i!="Dashboard"&&f){var g={};if(bd.selectedPortalName){g.portalName=bd.selectedPortalName}if(bd.selectedPortalTitle){g.portalTitle=bd.selectedPortalTitle}g.widgetTitle=p;g.widgetName=l;f=f.replace("$(contextRoot)",bd.contextRoot);j=be.utils.processHTMLTemplateByUrl(f,g)}r.html(j);o.setAttribute("id","widget-"+l);if(bd.designMode!="null"){var q=r.position().top+5;var e=r.position().left+160;var h='<div class="bd-iconEditWidgetProperties">edit</div>';r.append(h)}this.widgetName=l;this.currentPerspective=i;this.$oWidgetBody=r;var n=this.model.getResources().every(function(t){return t.isReady()});if(bd.widgets[this.widgetName]!=null||n){this.render()}else{var s=this.model.getResources().tracker;this.model.getResources().each(function(t){if(!t.isReady()){t.addObserver("ready",k.resourceReady,k)}else{++s.counter;if(s.isComplete()){k.render()}}})}return r[0]};c.prototype.resourceReady=function(e){e.target.removeObserver("ready",this.resourceReady);var f=this.model.getResources().tracker;++f.counter;var g=this.model.getResources().every(function(h){return h.isReady()});if(g){++f.counter;if(f.isComplete()){this.render()}}};c.prototype.render=function(){var e=bd.widgets[this.widgetName];if(e&&e[this.currentPerspective]){e[this.currentPerspective].call(this,this.$oWidgetBody[0],bd.contextRoot+"/static/dashboard/widgets/"+this.widgetName)}};this.DashboardWidget=a;this.DashboardWidgetView=c});