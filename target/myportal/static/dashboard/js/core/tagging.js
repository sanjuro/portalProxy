bd.initTags=function(c){var b=jQuery(c),a={minChars:2,tokenValue:"name",preventDuplicates:true,onAdd:bd.updateTags,onDelete:bd.updateTags,onReady:function(){bd.initTagsHightlight(b);bd.initTagsStats()},classes:{dropdown:"token-input-dropdown token-input-dropdown-tags"}};b.each(function(l,h){var e=h.value.split(/(?:,\s+|,)/),k=[],i=[],g=jQuery(h),j=g.parent().find("input").data("tags")||"regular";for(var d=0,f=e.length;d<f;d++){if(e[d]){k[d]={id:e[d],name:e[d]};i.push(e[d])}}a.prePopulate=k;if(g.tokenInput){g.tokenInput(bd.contextRoot+"/json/tags.jsp?portalName="+(bd.selectedPortalName||"[BBHOST]")+"&type="+j+"&",a)}g.parent().find("input").data("initialValues",i.join(","))});jQuery("input",b).live("focus",function(){b.addClass("token-input-list-active")}).live("blur",function(){b.removeClass("token-input-list-active")})};bd.initTagsStats=function(){var a=false;var b=jQuery(".token-input-dropdown.token-input-dropdown-tags");jQuery(this).keydown(function(c){if(c.which==16||c.which==17||c.which==18){a=true}if(c.which==13&&a){b.remove()}}).keyup(function(c){if(c.which==16||c.which==17||c.which==18){a=false}});jQuery("form").submit(function(){if(b.is(":visible")){b.remove()}})};bd.getTagsDeltaModel=function(f,l){var p=$(f),j=p.data("initialValues")||"",h=j+",",o=p.data("tags")||"regular",c=p.data("manageable"),k=p.closest("ul").find("div[data-taglock]").data("taglock"),a=l||[],g=f.value.split(","),e="",m,b=function(n){if(typeof n==="string"){n=(n==="true")}if(n===undefined){n=true}return n};c=b(c);k=b(k);for(var d=0,i=g.length;d<i;d++){e=g[d].replace(/^\s+|\s+$/g,"");m=h;if(e){h=h.replace(e+",","")}if(e&&m===h||k!==undefined&&k!==c){a.push({manageable:k,type:o,value:e})}}g=h.replace(/,$/,"").split(",");for(var d=0,i=g.length;d<i;d++){if(g[d]){a.push({manageable:k,type:o,value:g[d],blacklist:true})}}return a};bd.updateTags=function(c){var a=this.attr("for")||this.data("for"),b=this,f=",",d=this.data().source,e;if(!d){this.data({source:jQuery(a)});d=this.data().source}e=this.tokenInput("get");if(d.length){$.each(e,function(h,g){g.name=be.utils.trimString(g.name);if(f.indexOf(","+g.name+",")<0){f+=g.name+","}if(g.name===""){b.tokenInput("remove",{id:g.id})}});f=f.replace(/,,+/ig,",");d.val(f.length>1?f.substring(1,f.length-1):"")}};bd.initTagsHightlight=function(b){var a=b.prev("ul");a.find("input").focus(function(){a.addClass("token-input-list-active")}).blur(function(){a.removeClass("token-input-list-active")})};bd.retrieveTags=function(b){var a=jQuery(b)};