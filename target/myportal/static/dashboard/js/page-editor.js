(function(k){var l=b$._private.htmlAPI,e,c,i,j,b,g=4000,a,h,d,f,p,m,o,n;b$.portal.editor={init:function(){var r,v,y,A,u,w,x,q,t,s,z;if(b$.portal.fnDelayStartup){b$.portal.fnDelayStartup()}window.parent.$(window.parent.document).trigger("iframeready");c=b$.portal.portalModel.getElementById(b$.portal.getCurrentPage().name);i=c.extendedItemName&&c.extendedItemName!=="";j=b$.portal.portalView.getElementById("VIEW-"+b$.portal.getCurrentPage().name);b=j.pageType!=="master";bd.contextRoot=b$.portal.config.serverRoot;bd.loggedInUserId=b$.portal.loggedInUserId;r=this;v=b$.portal.portalView;bd.selectedItem=null;y=false;A=function(B){window.location.reload()};u=function(E,C){var D=C.statusText,B=C.responseText.split("<message>")[1].split("</message>")[0];bc.component.notify({uid:"281269",icon:"attention",message:B,delay:2200})};w=function(B){window.location.reload()};k(document.body).on("click",".bd-icon-trash",function(D){var C=top.bd.PageMgmtTree.selectedLink.isMasterPage,B,E;r.currentItemVC=h(D.target);if(r.currentItemVC){B=r.currentItemVC.designTools.wasCreatedOnMasterPage;E=B&&!C?A:null;d(r.currentItemVC,E,u)}}).on("click",".bd-icon-edit",function(B){r.currentItemVC=h(B.target);p(B.target,1)}).on("click",".bd-icon-permissions",function(B){r.currentItemVC=h(B.target);p(B.target,2)}).on("mousedown",".bd-container-manageable, .bd-container-not-manageable, .bd-widget-manageable, .bd-widget-not-manageable, .bd-undefined-manageable",function(C){var B=this.className.indexOf("bd-container-")!==-1,D=k(this);r.currentItemVC=h(C.target);r.currentItemVC.model.manageable=r.currentItemVC.model.manageable=="true"?"false":"true";r.currentItemVC.model.save(function(E){if(B){D.toggleClass("bd-container-manageable bd-container-not-manageable")}else{D.toggleClass("bd-widget-manageable bd-widget-not-manageable")}r.currentItemVC.showDesignTools()})}).on("click",".bd-icon-revert",function(B){r.currentItemVC=h(B.target);be.utils.confirm({title:"Revert to default",message:"Are you sure you want to reset this item inherited from the master page to its original state? Any customizations will be removed.",okBtnText:"Ok",cancelBtnText:"Cancel",yesCallback:function(){if(r.currentItemVC){f(r.currentItemVC,w,null)}},closeIcon:false})});this.dmInit(r);if(i){x=b$.portal.portalView.getElementsByTagName("page")[0];q=false;t=x.ownerDocument.all;s=t.length;while(s--){if(t[s].getPreference("isManageableArea")){q=true}}if(!q&&x.pageType!=="master"){x.isPossibleDragTarget=false}}v.addEventListener("dragStart",function(E){var D=E.target.ownerDocument.dragManager,B=(E.target.getAttribute("src")||"").indexOf("CatalogBrowser")!==-1,C=B?b$(".pageDesignerWrapper",E.target.htmlNode)[0]:null;if(B){if(D.cancelDropTargets.indexOf(C)===-1){D.cancelDropTargets.push(C)}}});b$.portal.portalView.addEventListener("preferencesSaved",function(){if(bd&&bd.refreshPageTree){bd.refreshPageTree(500)}});bd.observer.addObserver(bd.notifications.publishing.PUBLISHED,function(){y=true});bd.observer.addObserver(bd.notifications.publishing.CHANGE,function(){if(y){y=false;window.location.reload()}});b$.portal.portalModel.addEventListener("DOMNodeRemovedFromDocument",function(B){if(bd&&bd.refreshPageTree){bd.refreshPageTree(500)}},true);this.enableHotkeys();z=b$.portal.portalView.documentElement;l.addClass(z.htmlNode,"designMode");z.enableDesignMode()},dmInit:function(y){var K=".bp-widget, .bp-container:not(.bp-tCont-selected)",F=k(window),J=k("body"),M=b$._private.simpleResponseCache_getData(b$.portal.config.serverRoot+"/static/portalclient/templates/dm_editbar.html"),H=function(N,P){if(k("> .bd-dm-edit-bar",N).length<1){var O=k(l.createElementFromString(Mustache.to_html(M,P)));O.prependTo(N)}};var t=function(T){if(T&&T.length===1){var U=T.find(".bd-dm-buttons"),S=T.width(),W;U.find("div").removeAttr("style");W=U.width();T.find(".bd-dm-item-name").css({width:S-W-10+"px"});T.removeClass("bd-dropdown");T.removeClass("bd-open-up");T.removeClass("bd-open-down");if(S-W<40){var Q=k(window),O=T.offset(),N=U.find("div").length*22+19,R=N+O.top-Q.scrollTop(),V=Q.height(),P;T.addClass("bd-dropdown");if(R>V){T.addClass("bd-open-up")}else{T.addClass("bd-open-down")}P=O.left+S-W;if(P<0){U.find("div").css({width:W+P+"px"})}}}};var u=function(Y){var V=Y.viewController,T=V&&V.model,W=T&&T.getPreference("title"),N=V&&V.parentNode&&V.parentNode.localName==="TCont"&&W==="Fall Back",S=V&&V.designTools,X;if(S&&!N){X=k(Y);if(S.hasFeatures){S.title=W;S.titleTag=S.title;H(X,S)}var Q=k(".pageContainer"),P=X.find(".bd-dm-edit-bar"),R=Q.length?Q.offset():k(document.body).offset(),O=R&&R.top||0,U=P.height();t(P.first());O=X.offset().top-O-U+Q.scrollTop();X.removeClass("bd-dm-nudged");if(O<20){X.addClass("bd-dm-nudged")}k(K).removeClass("bd-dm-hovered");if(!X.hasClass("bd-dm-clicked")){X.addClass("bd-dm-hovered")}}};var L=function(Q){var P=!this.viewController.designTools||this.viewController.designTools.hasFeatures,O=b$.getVC(Q.srcElement||Q.target),N=b$.getVC(Q.currentTarget);if(O===N&&P){u(this)}else{if(O.parentNode.localName=="TCont"&&N.localName=="TCont"){u(N.htmlNode)}}};var C=function(){bd.selectedItem=null;k(K).removeClass("bd-dm-clicked")};var w=function(P,N){P=k(P)[0];if(P&&(!P.viewController||P.viewController.isCatalog)){k(".bd-dm-item-name .parents").remove();return}C();k(P).addClass("bd-dm-clicked");k(P).find(".bd-dm-edit-bar").css({position:"",top:""});if(k("body").hasClass("bd-ckeditor-docked")&&k(P).offset().top<=k(".bd-ckeditor-container").height()){var O=P.viewController.parentNode;while(O){k(O.htmlNode).find(".bd-dm-edit-bar").css({position:"",top:""});k(O.htmlNode).removeClass("bd-dm-nudged");O=O.parentNode}k(P).find(".bd-dm-edit-bar").css({position:"relative",top:"0px"})}if(!N){bd.selectedItem=P}};var I=function(){var P=document.body,O={attributes:false,childList:true,characterData:false,subtree:true},N=new MutationObserver(function(Q){Q.forEach(function(S){if(S.addedNodes[0]&&S.addedNodes[0].nodeType===1){if(S.addedNodes[0].getAttribute("data-pid")){var R=b$.getVC(S.addedNodes[0]);w(R.htmlNode)}}})});N.observe(P,O)};I();var x=function(S,P){var R=k(".bc-dropdown-items"),T=R.find("a"),O=T.index(k(S).closest("a")),Q=P[O],N=null;if(Q){N=Q.htmlNode}return N};var G=function(Q,O,N){var R=null,P;k(".bc-selectbox").remove();if(O.length){R=bc.component.dropdown({target:Q,type:"action-icon-div",cssClass:"bd-ap-actionDD",staticLabel:true,options:O,wrapped:true,remove:true,beforeClose:function(S){k(".bc-selectbox").remove()}});P=R.view[0].dropdownOptions;k(P).on("click",function(T){var S=x(T.target,N);if(S){k(S).removeClass("bd-preselect-parent");w(S)}k(".bc-selectbox").remove()});k(P).on("mouseover",function(T){var S=x(T.target,N);if(S){k(S).addClass("bd-preselect-parent")}});k(P).on("mouseout",function(T){var S=x(T.target,N);if(S){k(S).removeClass("bd-preselect-parent")}})}return R};var E=function(R,T){var Q=[],S=R.htmlNode,P=k(".bd-dm-item-name",S),N=R.parentNode,O=[];if(!k(T).is(P)){return}while(N&&N.model.localName.toLowerCase()!=="page"){if(N.model.manageable!=="true"){Q.push(N);O.push({name:N,value:N._jxid,classname:""})}N=N.parentNode}G(T,O,Q)};var v=function(U){var S=b$.getVC(U.srcElement||U.target),Q=b$.getVC(U.currentTarget),T=S===Q,O=k(".parents:visible").length===0,P=top.bd.PageMgmtTree.selectedLink.isMasterPage===true,R=P&&S.getPreference&&S.getPreference("isManageableArea")===true,N=k(U.target);if((T&&O)){E(S,U.target);w(S.htmlNode,R)}else{if(S.parentNode.localName=="TCont"&&Q.localName=="TCont"){E(Q,U.target);w(Q.htmlNode)}else{if(R){C()}}}if(!U.emulatedClick&&N.hasClass("bd-dm-button")){U.emulatedClick=true;N.trigger("click")}};var B=function(Q){var P=b$.getVC(Q.srcElement||Q.target),O=b$.getVC(Q.currentTarget),N=k(".bd-dialog-container:visible");if((P===O)){if(!N){C()}}};var A=function(N){if(k(".parents:visible").length){k(".bd-dm-item-name .parents").remove()}if(this.viewController.designTools.hasFeatures&&!k(this).hasClass("bd-dm-clicked")){k(this).find(".bd-dm-edit-bar").css({position:"",top:""})}k(this).removeClass("bd-dm-hovered")};var s=function(N){var O;if(N.target===this){O=k("[data-pid] .bd-dm-clicked");if(O.length){bd.observer.notifyObserver("closeEditBar",O[0].viewController.model)}C();return false}};var r=function(N){if(this.viewController){w(this.viewController.htmlNode);u(this.viewController.htmlNode)}};var D={};J.on("mousedown.dm",s).on("mouseover.dm",K,L).on("mouseleave.dm",K,A).on("mousedown.dm",K,v).on("mousedown.dm",B).on("focus",".bp-widget",r).on("mouseover.dm",".bp-widget-head",function(){var N=k(this).closest("[data-pid]");if(N.length){u(N[0])}}).on("keydown",function(N){D[N.which]=true;if(D["71"]&&D["18"]){parent.$(".bd-show-grid-wrapper").find("div:not(.bc-view-active)").trigger("click")}}).on("keyup",function(N){delete D[N.which]});var q;var z=function(){var N=J.find(".bd-dm-hovered > .bd-dm-edit-bar, .bd-dm-clicked > .bd-dm-edit-bar");N.each(function(){t(k(this))})};F.on("resize",function(N){clearTimeout(q);q=setTimeout(z,100)});b$.portal.portalModel.addEventListener("PrefModified",function(O){var P,N,Q;if(!top.bd.PageMgmtTree.selectedLink.isMasterPage){P=b$.portal.portalView.getElementById("VIEW-"+O.target.name);if(P.designTools){P.designTools.isFromMasterPage=false}for(var N=P.model.preferences.array,Q=N.length;Q--;){if(N[Q].name==="isFromMasterPage"){N.splice(Q,1)}}P.showDesignTools();u(P.htmlNode)}});b$.portal.portalView.addEventListener("DOMNodeInserted",function(N){var O=N.target;if(O.nodeName!=="dragIndicator"){setTimeout(function(){u(O.htmlNode)},0)}if(bd&&bd.refreshPageTree&&O.nodeName!=="dragIndicator"&&O.model&&!O.model.getPreference("parentLinkUUID")){bd.refreshPageTree(500)}},false)},showForm:function(r,q){p(r,q)},enableHotkeys:function(){var v=this,r,s,q=true,x={w:function(z,y){t(y)},s:function(z,y){u(1,y)},a:function(z,y){u(2,y)},"alt+backspace":function(A,y){var C,B;if(bd.selectedItem){var z=b$.getVC(bd.selectedItem);if(z&&z.model&&z.model.manageable!=="false"){C=k(bd.selectedItem).data("state");B=C&&C.markForDeletion===true;if(!B){d()}}}else{w(y)}},enter:function(z,y){z.stopPropagation()},t:function(C,y){var A,B,D=k("#flip3DContainer"),z;if(k(".cke_dialog:visible").length){return}z=h();if(z&&z.localName==="Column_table"&&z.parentNode){if(z.parentNode.localName==="TCont"){z=z.parentNode}}if(!z||!z.designTools||!z.designTools.features.TCont){return}C.stopPropagation();if(D.length){B=D.find(".aa-tabLabel").eq(2).filter(":visible:not(.aa-activeTab)");if(B.length){B.click()}}else{v.showForm(z,3)}}};r=top.bd.pm.shortcuts.bindings||{};s=k.extend(true,{},r);top.bd.hotkeys.start(k.extend({},r,x),null,window);function w(y){q&&s[y]&&s[y].call(this)}function u(z,y){var B=k("#flip3DContainer");if(k(".cke_dialog:visible").length){return}if(bd.selectedItem){if(z==2&&!h(bd.selectedItem).designTools.features.Permission){z=1}if(B.length){if(B.filter(":visible").length){var A=B.find(".aa-tabLabel").eq(z-1).filter(":visible:not(.aa-activeTab)");if(A.length){A.click()}}else{B.remove();v.showForm(bd.selectedItem,z)}}else{v.showForm(bd.selectedItem,z)}}else{w(y)}}function t(y){if(be.animation.flipContainer.shown){be.animation.flipContainer.hide()}w(y)}}};a=function(q){return q.viewHint&&q.viewHint!==""&&(q.manageable===null||q.manageable===true)};h=function(r){var q;if(!r){return bd.selectedItem?h(bd.selectedItem):null}q=r.model?r:r.viewController;return q?q:r.parentNode?h(r.parentNode):h(bd.selectedItem)};d=function(s,w,r,u){var t,v,q;s=h(s);if(!s){return}t=s.getPreference&&s.getPreference("isManageableArea");q=t?s.getPreference("title"):s.model.localName;v="Are you sure you want to delete this "+q.toLowerCase()+"?";if(s.model.localName.toLowerCase()==="container"){v=t?"Manageable Areas allow the placement of elements within their regular pages.<br/>Are you sure you want to delete?<br/>This will also delete all elements on regular pages held within this Manageable Area.":"Are you sure you want to delete this layout, and all its contents?"}if(u){s.model.destroyAndSave(w,r);bd.selectedItem=null}else{k(bd.selectedItem).data("state",{markForDeletion:true});be.utils.confirm({title:"Delete "+q,message:v,okBtnText:"Delete",cancelBtnText:"Cancel",yesCallback:function(){s.model.destroyAndSave(w,r);bd.observer.notifyObserver("closeEditBar",s.model);bd.selectedItem=null},noCallback:function(){k(bd.selectedItem).data("state",{markForDeletion:false})},closeIcon:false})}};f=function(r,s,q){r=h(r);if(!r){return}r.model.revert(s,q)};p=function(y,q){var s,z=h(y),r,A,u,t,v,x,w;if(z&&z.localName==="Column_table"&&z.parentNode){if(z.parentNode.localName==="TCont"){z=z.parentNode}}if(!z||q===1&&z.designTools.features.Edit===false){return}s=z.designTools&&z.designTools.features||{TCont:true,Edit:false};q=q||1;r={showPermissionAndTargeting:true};A=z.model.preferences;u=A.getByName("TemplateName").value=="TCont";t=A.ownerElement.extendedItemName==="CXPNavigationWidget";v={permissions:s.Permission,targeting:s.TCont,css:u?{width:"750px"}:t?{width:"550px"}:{width:"600px"}};x=function(){var D,E=false,C=k(".aa-activeTab",e),B;e=jQuery("#flip3DContainer");B=function(F){e.css(v.css);be.animation.flipContainer.reposition(F)};e.find(".aa-tabLabels .aa-tab1").click(function(K){var J,I,F,G,L,H;C=C.length?C:k(".aa-activeTab",e);bc.component.addKeyboardAccess(C);if(E){return}E=true;I=z.model&&z.model.preferences&&z.model.preferences.array;H=function(){var P=k(this),M=z.model.preferences.getByName(P.data("id")),O=k(this).hasClass("bd-man-on")?true:false,R=O?"false":"true",N=O?"bd-man-off":"bd-man-on",Q=O?"Not editable on regular pages":"Editable on regular pages";if(M){M.setManageable(R);P.removeClass("bd-man-off bd-man-on").addClass(N+" bd-dm-mo-disabled").attr("title",Q).on("mouseout",function(){P.removeClass("bd-dm-mo-disabled")})}};if(I){for(J=0;J<I.length;J++){F=I[J];if(F.viewHint){G=k('.aa-PreferenceEditor input[name="'+F.name+'"]').closest("tr");if(b){G.toggle(a(F))}else{if(k("td",G).length<k(".aa-PreferenceEditor td[colspan]").attr("colspan")){G.append(k("<td></td>"))}L=a(F)?"Editable on regular pages":"Not editable on regular pages";G.append(k('<td><div data-id="'+F.name+'" title="'+L+'" class="bc-icn bd-man '+(a(F)?"bd-man-on":"bd-man-off")+'"></div></td>'))}}}if(!i&&G){k(".aa-PreferenceEditor td[colspan]").attr("colspan",k("td",G).length)}k(".bd-man",e).on("click",H)}});e.find(".aa-tabLabels .aa-tab2").toggle(s.Permission).click(function(F){if(s.Permission){if(!jQuery("#editWidgetTabs_Permissions .aa-permissionForm").length){m(z)}}});if(s.TCont&&!s.Edit){e.find(".aa-tabLabels .aa-tab1").hide()}e.find(".aa-tabLabels .aa-tab3").click(function(F){if(!k("#editWidgetTabs_Targeting .aa-targetingForm").length){if(k(".pageDesignerWrapper").hasClass("pageDesignerWrapper-open")){k(".tb-openClose").click()}bd.TargetingUI.loadTargeting(z)}});if(q){B();e.find(".aa-tabLabels .aa-tab"+q.toString()).trigger("click")}};w={context:z,permissions:true,params:v,callback:x};z.dispatchCustomEvent("preferences-form",true,true,w)};m=function(t){var s,r,q,u;if(!t.designTools.features.Permission){return}s=t.model.name;r=t.model.localName.toLowerCase();if(r!=="widget"&&r!=="container"){return}q="#editWidgetTabs_Permissions";u={portalName:b$.portal.portalName,itemName:s,itemType:r,context:b$.portal.config.serverRoot+"/portals/"+b$.portal.portalName+"/"+r+"s/"+s,domParent:q,closeCallback:function(){if(bd.portalName=="dashboard"){var v=jQuery("#editWidgetTabs_Permissions");if(v.length>0){be.closeCurrentDialog();v.hide();v.remove()}}else{be.animation.flipContainer.hide()}}};bd.Permission.loadPermissionsAndGroups(u)};o=function(r,q){while(r){if(r.nodeType===1&&k(r).hasClass(q)){return r}r=r.parentNode}};n=function(t,s){var q=jQuery(t).offset();return{x:q.left,y:q.top,left:q.left,top:q.top,w:t.offsetWidth,h:t.offsetHeight}}})(jQuery);var refreshTimeout=null;bd.refreshPageTree=function(a){try{if(a){clearTimeout(refreshTimeout);refreshTimeout=setTimeout(function(){if(top.bd&&top.bd.pm){top.bd.pm.view.refreshLinksAndDetails(top.bd.PageMgmtTree.selectedLink.uuid)}},a)}else{top.bd.pm.view.refreshLinksAndDetails(top.bd.PageMgmtTree.selectedLink.uuid)}}catch(b){console.log(b)}};bd.removeResize=function(){if(jQuery(".pageDesignerToolbar").hasClass("bd-ContentViewer-resizeHandle")){jQuery(".pageDesignerToolbar").removeClass("bd-ContentViewer-resizeHandle");jQuery(".pageDesignerToolbarWrapper").removeClass("bd-ContentViewer-resizeHandleWrapper")}};bd.previewPortal=function(c,a){var e=screen.width/2-1080/2,d=screen.height/2-600/2,b=window.open(bd.contextRoot+"/portals/"+c+"/pages/"+a+"?previewMode=true","preview","width=1080, height=600, status=yes, menubar=yes, scrollbars=yes, toolbar=no, resizable=yes,top="+d+", left="+e);if(window.focus){b.focus()}return false};bd.toggleWidgetCatalog=function(a){if(bd.WidgetCatalogDisplayed===true){bd.hideCatalog(a)}else{jQuery("body").addClass("pageDesignerWithCatalog");bd.removeResize();bd.WidgetCatalogDisplayed=true;bd.LayoutCatalogDisplayed=null;jQuery(".pageDesignerWrapper .tb-button").removeClass("tb-active");jQuery(a).addClass("tb-active");return bd.addCatalogItems("widget",a)}};bd.toggleLayoutCatalog=function(a){if(bd.LayoutCatalogDisplayed===true){bd.hideCatalog(a)}else{jQuery("body").addClass("pageDesignerWithCatalog");bd.removeResize();bd.LayoutCatalogDisplayed=true;bd.WidgetCatalogDisplayed=null;return bd.addCatalogItems("container",a)}};bd.toggleDrawer=function(){var a=jQuery(".pageDesignerCatalog");if(jQuery("body").hasClass("pageDesignerWithCatalog")){a.hide("fast");jQuery(".tb-button").removeClass("tb-active");jQuery("body").removeClass("pageDesignerWithCatalog");bd.LayoutCatalogDisplayed=null;bd.WidgetCatalogDisplayed=null}else{jQuery("body").addClass("pageDesignerWithCatalog");bd.removeResize();bd.LayoutCatalogDisplayed=true;bd.WidgetCatalogDisplayed=null;return bd.addCatalogItems("container",jQuery(".tb-layouts"))}};bd.hideCatalog=function(a){var c,b;bd.removeResize();c=function(){jQuery("body").removeClass("pageDesignerWithCatalog");jQuery(a).removeClass("tb-active");bd.LayoutCatalogDisplayed=null;bd.WidgetCatalogDisplayed=null;bd.pageDesignerCatalog=null};b=jQuery(".pageDesignerCatalog");b.hide("fast",c)};bd.addCatalogItems=function(c,e){var f,a,b,d;if(c!==null){bd.currentCatalogItems=c}else{c=bd.currentCatalogItems}bd.oCatalogView.clearItems();f=b$.require("portal.com.PortalCatalogDataSource");a=b$.require("portal.com.PortalClientDataRetrieveRequest");b=new f(bd.contextRoot+"/",bd.portalName);d=new a(bd.oPortal,function(){jQuery(".pageDesignerWrapper .tb-button").removeClass("tb-active");jQuery(e).addClass("tb-active");if(bd.pageDesignerCatalog===null){bd.pageDesignerCatalog=true;jQuery("body").addClass("pageDesignerWithCatalog")}bd.oCatalogView.addItems(this.responseObject.toArray())},function(){console.log("Error fetching catalog items",this.responseError)});jQuery(".pageDesignerCatalog").show();d.setParameter("f","type(eq)"+c.toUpperCase());d.setParameter("ps",bd.uiEditingOptions.catalog.itemsPerRequest);b.retrieve(d);return false};