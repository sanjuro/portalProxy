b$.module("b$.mvc",function(){var a=b$.require("b$.Class");var i=b$.require("b$.Interface");var y=b$.require("b$.Exception");var m=b$.require("b$.TypeConstraintOptional");var f=b$.require("b$.testArguments");var J=b$.require("b$.types.STRING");var b=b$.require("b$.types.FUNCTION");var c=b$.require("b$.types.ANY");var A=b$.require("b$.ArgumentException");var K=b$.require("b$.Iterator");var p=b$.require("b$.ArrayIterator");var r=b$.require("b$.ecma5.Array.prototype.indexOf");var D={};var B=Array.prototype,g=Object.prototype,q=Function.prototype;var n=B.slice,z=B.unshift,e=g.toString,h=g.hasOwnProperty;var Q=B.forEach;var I=function(W,V,U){if(W==null){return}if(Q&&W.forEach===Q){W.forEach(V,U)}else{if(P(W.length)){for(var T=0,R=W.length;T<R;T++){if(V.call(U,W[T],T,W)===D){return}}}else{for(var S in W){if(h.call(W,S)){if(V.call(U,W[S],S,W)===D){return}}}}}};var P=function(R){return !!(R===0||(R&&R.toExponential&&R.toFixed))};this.each=I;this.mixin=function(S,T,R){var U;if(S){for(U in T){if(R||S[U]===undefined){S[U]=config[T]}}}return S};var C=a.extend(function(R){a.call(this);this.array=[];this.keys=[];this.map={};if(R){this.keyFn=R}},{keyFn:function(R){return R.id},add:function(S,T){var U=this,R;if(arguments.length==1){T=S;S=U.keyFn(T)}if(typeof S!="undefined"&&S!==null){R=U.map[S];if(typeof R!="undefined"){return U.replace(S,T)}U.map[S]=T}U.array.push(T);U.keys.push(S);jQuery(U).triggerHandler("add",[U.array.length-1,T,S]);return T},addAll:function(W){var V=this,U=0,S,R,T;if(arguments.length>1||$.isArray(W)){S=arguments.length>1?arguments:W;for(R=S.length;U<R;U++){V.add(S[U])}}else{for(T in W){if(W.hasOwnProperty(T)){V.add(T,W[T])}}}},insertAt:function(R,S,T){var U=this;if(arguments.length==2){T=S;S=U.keyFn(T)}if(typeof U.map[S]!="undefined"){U.suspendEvents();U.removeByKey(S);U.resumeEvents()}if(R>=U.array.length){return U.add(S,T)}U.array.splice(R,0,T);if(typeof S!="undefined"&&S!==null){U.map[S]=T}U.keys.splice(R,0,S);return T},remove:function(R){return this.removeAt(this.array.indexOf(R))},removeByKey:function(R){return this.removeAt(this.keys.indexOf(R))},removeAll:function(R){},removeAt:function(R){var U=this,T,S;if(R<U.array.length&&R>=0){T=U.array[R];U.array.splice(R,1);S=U.keys[R];if(typeof S!="undefined"){delete U.map[S]}U.keys.splice(R,1);return T}return false},replace:function(T,U){var R,S;if(arguments.length==1){U=arguments[0];T=this.keyFn(R)}R=this.map[T];if(typeof T=="undefined"||T===null||typeof R=="undefined"){return this.add(T,U)}S=this.indexOfKey(T);this.array[S]=U;this.map[T]=U;return U},get:function(R){var S=this.map[R],S=S!==undefined?S:(typeof R=="number")?this.array[R]:undefined;return S},getAt:function(R){return this.array[R]},indexOf:function(R){return r.call(this.array,R)},indexOfKey:function(R){return r.call(this.keys,R)},each:function(U,T){var W=[].concat(this.array),S=0,R=W.length,V;for(;S<R;S++){V=W[S];if(U.call(T||V,V,S,R)===false){break}}},clear:function(){this.array=[];this.keys=[];this.map={}}});this.HashMap=C;var E=this.Event=a.extend(function(){this.bubbles=false;this.cancelable=false;this.currentTarget=null;this.eventPhase=E.CAPTURING_PHASE;this.target=null;this.timeStamp=(new Date()).getTime();this.type="";this.namespaceURI=null;this.defaultPrevented=false;this._captures=null;this._stopped=false;this._stoppedImmediate=false;this._stoppedHorizontal=false},{initEvent:function(T,S,R){this.type=T;this.bubbles=S;this.cancelable=R},initEventNS:function(S,U,T,R){this.initEvent(U,T,R);this.namespaceURI=S},preventDefault:function(){this.defaultPrevented=this.cancelable},stopPropagation:function(){this._stopped=true},stopImmediatePropagation:function(){this.stopPropagation();this.stopHorizontalPropagation();this._stoppedImmediate=true},stopHorizontalPropagation:function(){this._stoppedHorizontal=true},isPropagationStopped:function(){return this._stopped},isImmediatePropagationStopped:function(){return this._stoppedImmediate},isHorizontalPropagationStopped:function(){return this._stoppedHorizontal}});E.CAPTURING_PHASE=1;E.AT_TARGET=2;E.BUBBLING_PHASE=3;E.LISTENER_ENTRY=0;var L=this.CustomEvent=E.extend(function(){this.detail=0;E.call(this)},{initCustomEvent:function(U,T,R,S){this.initEvent(U,T,R);this.detail=S},initCustomEventNS:function(S,V,U,R,T){this.initCustomEvent(V,U,R);this.namespaceURI=S}});var k=this.MutationEvent=E.extend(function(){this.relatedNode=null;this.prevValue="";this.newValue="";this.attrName="";this.attrChange=0;E.call(this)});k.MODIFICATION=1;k.ADDITION=2;k.REMOVAL=3;k.prototype.initMutationEvent=function(Y,X,V,U,T,W,R,S){this.initEvent(Y,X,V);this.relatedNode=U;this.prevValue=T;this.newValue=W;this.attrName=R;this.attrChange=S};k.prototype.initMutationEventNS=function(Y,R,V,X,W,S,Z,T,U){this.initMutationEvent(R,V,X,W,S,Z,T,U);this.namespaceURI=Y};var G=this.ObservedEvent=a.extend(function(R,S){this.type=R;this.observable=S;this.observers=[]},{addObserver:function(U,T,S){var V=this,R;T=T||this.observable;if(!this.isObserving(U,T)){R=this.createObserver(U,T,S);this.observers.push(R)}return R},createObserver:function(U,T,S){S=S||{};T=T||this.observable;var R={oe:this,fn:U,fnenv:U,context:T,options:S};return R},findObserver:function(U,T){var V=this.observers,S=V.length,R,W;while(S--){R=V[S];if(R){W=R.context;if(R.fn==U&&(W==T||W==this.observable)){return S}}}return -1},isObserving:function(S,R){return this.findObserver(S,R)!==-1},removeObserver:function(W,V){var U=this,S,T,R;T=U.findObserver(W,V);if(T!=-1){U.observers.splice(T,1);return true}return false},clearObservers:function(){var S=this.observers,R=S.length;while(R--){this.removeObserver(S[R].fn,S[R].context)}},dispatch:function(){var V=this,W=V.observers.slice(0),U=W.length,T,S,R;if(U>0){V.dispatching=true;for(T=0;T<U;T++){R=W[T];S=arguments.length?n.call(arguments,0):[];if(R&&R.options){S.push(R.options)}if(R&&R.fnenv.apply(R.context||V.observable,S)===false){return(V.dispatching=false)}}}V.dispatching=false;return true}});var d=(this.Observable=a.extend(function(){this.events={}}));d.prototype.addObserver=function(V,U,T,S){f(arguments,[J,b]);var R=this.events[V];if(!R){R=new G(V,this);this.events[V]=R}return R.addObserver(U,T,S)};d.prototype.removeObserver=function(U,T,S){f(arguments,[J,b]);var R=this.events[U];if(R){R.removeObserver(T,S)}};d.prototype.removeAllObservers=function(S){var R=this.events,T,U;if(S){if(R[S]){R[S].clearObservers()}}else{for(U in R){if(R.hasOwnProperty(U)){R[U].clearObservers()}}}};d.prototype.notifyObservers=function(U){var W;var S=n.call(arguments,0);if(this.eventsMuted===true){if(this.eventQueue){this.eventQueue.push(S)}return false}if(U instanceof E){W=U;U=W.type;if(!W.target){W.target=this;W.currentTarget=this}}else{S.shift()}var X=this.events[U];if(X){S.push(X);X.target=this;X.currentTarget=this}var T=this.events["*"];if(W instanceof E&&W.bubbles){if(X&&X.dispatch.apply(X,S)===false){return false}if(T&&T.dispatch.apply(T,[U,this])===false){return false}var V=this.getBubbleParent&&this.getBubbleParent();if(V&&V.notifyObservers){W.currentTarget=V;V.notifyObservers.apply(V,S)}else{return true}}else{var R=(X)?X.dispatch.apply(X,S):true;if(R){return(T)?T.dispatch.apply(T,[U,this]):true}return false}};d.prototype.hasObservers=function(S){f(arguments,[J]);var R=this.events[S];return(R&&R.observers.length>0)===true};d.prototype.muteEvents=function(R){this.eventsMuted=true;if(R&&!this.eventQueue){this.eventQueue=[]}};d.prototype.unmuteEvents=function(){var S=this,R=this.eventQueue||[];this.eventsMuted=false;delete this.eventQueue;I(R,function(T){S.notifyObservers.apply(S,T)})};this.Observable=d;var H=d.extend(function(){d.call(this)},{});this.Model=H;var w=y.extend(function(S,R){f(arguments,[c,t]);y.call(this,"Can't find the view to instantiate for the model.");this.model=S;this.factory=R});var t=new i({createView:Function});var u=new i({getViewClass:Function});var x=new m(t);var j=new m(u);var M=a.extend(function(S,R){f(arguments,[c,x]);this.model=S;this.factory=R||null;this.html=null});M.prototype.getModel=function(){return this.model};M.prototype.getFactory=function(){return this.factory};M.prototype.registerObservers=function(){if(this.model instanceof H){this.model.addObserver("*",this.update,this)}};M.prototype.unregisterObservers=function(){if(this.model instanceof H){this.model.removeObserver("*",this.update,this)}};M.prototype.createHTML=function(R){throw new Error("Must implement createHTML().")};M.prototype.renderHTML=function(S,R){console&&console.log&&console.log("should implement renderHTML: ",this);S.replaceWith(this.getHTML(R))};M.prototype.getHTML=function(R){if(!this.html){this.html=this.createHTML(R);this.registerObservers()}else{if(this.html.ownerDocument!=R){throw new Error("HTML document mismatch with existing view.")}}return this.html};M.prototype.release=function(){if(jQuery(this.html).find("#"+(this.model.item&&this.model.item.id)).length==0){if(this.html&&this.html.id!==(this.model.item&&this.model.item.id)){this.unregisterObservers();if(this.html.parentNode){this.html.parentNode.removeChild(this.html)}this.html=null}}};M.prototype.update=function(S,R){if(!this.html){throw new Error("Unexpected call to update(), no HTML exists.")}var T=this.html;this.html=this.createHTML(T.ownerDocument);if(T.parentNode){T.parentNode.replaceChild(this.html,T)}};M.prototype.reflow=function(){};M.prototype.attachHandlerTo=function(R,U,T){var S=this;if(R.addEventListener){R.addEventListener(U,function(V){return T.call(S,V)},false)}else{R.attachEvent("on"+U,function(){return T.call(S,event)})}};var v=a.extend(function(R){f(arguments,[t]);this.factory=R;this.views=[]});v.prototype.getViews=function(){return new p(this.views)};v.prototype.updateViews=function(T){if(!(T instanceof K)){throw new A("Iterator expected. Did you mean to invoke updateView()?",arguments,0,null)}var S=0;var R=[];for(var U;U=T.next();S++){if(this.views[S]){if(this.views[S].getModel()==U){R.push(this.views[S])}else{if(this.views[S-1]&&this.views[S-1].getModel()==U){R.push(this.views[S-1])}else{if(this.views[S+1]&&this.views[S+1].getModel()==U){R.push(this.views[S+1])}else{this.views[S].release();R.push(this.factory.createView(U))}}}}else{R.push(this.factory.createView(U))}}for(;S<this.views.length;S++){this.views[S].release()}this.views=R};v.prototype.updateView=function(S){if(S instanceof K){throw new A("Model expected. Did you mean to invoke updateViews()?",arguments,0,null)}if(S){if(this.views[0]){if(this.views[0].getModel()!=S){this.views[0].release();this.views[0]=this.factory.createView(S)}}else{this.views[0]=this.factory.createView(S)}}for(var R=S?1:0;R<this.views.length;R++){this.views[R].release()}this.views.length=S?1:0;return this.views[0]||null};v.prototype.render=function(S,Z,R){var W=S.ownerDocument;var X=S.childNodes;var T=0;if(Z){while(X[T++]!=Z){if(!X[T-1]){throw new Error("The node to insert after is not a child of the element.")}}}for(var U,V=0;U=this.views[V];V++){var Y=U.getHTML(W);if(X[T]!=Y){if(X[T+1]==Y&&X[T]!=R){S.removeChild(X[T])}else{S.insertBefore(Y,X[T++]||null)}}else{T++}}while(X[T]!=R&&X[T]){S.removeChild(X[T])}if(R!=X[T]){throw new Error("The node to insert before is not a child of the element.")}};v.prototype.renderViews=function(T,R,S,U){this.updateViews(T);this.render(R,S,U)};v.prototype.getView=function(){return this.views[0]||null};v.prototype.clear=function(){for(var R=0;R<this.views.length;R++){this.views[R].release()}this.views=[]};v.prototype.toString=function(){return a.prototype.toString.call(this)+" ("+this.views.length+" views cached)"};var O=a.extend(function(R,T,S){f(arguments,[Function,Function,j]);this.modelClass=R;this.viewClass=T;this.parentViewClassProvider=S});O.prototype.getViewClass=function(R){return R instanceof this.modelClass?this.viewClass:(this.parentViewClassProvider?this.parentViewClassProvider.getViewClass(R):null)};O.prototype.createView=function(S){var R=this.getViewClass(S);if(R){return new R(S,this)}else{throw new w(S,this)}};t.implementedBy(O);u.implementedBy(O);var l=a.extend(function(R){f(arguments,[j]);this.views=[];this.parentViewClassProvider=R});l.prototype.registerView=function(R,S){this.views[R.getClassID()]=S};l.prototype.getViewClass=function(T){var R=T.constructor;do{var S=this.views[R.getClassID()];if(S){return S}}while(R=R.superClass);return this.parentViewClassProvider?this.parentViewClassProvider.getViewClass(T):null};l.prototype.createView=function(S){var R=this.getViewClass(S);if(!R){throw new w(S,this)}return new R(S,this)};u.implementedBy(l);t.implementedBy(l);var F=y.extend();var o=F.extend();var s=a.extend(function(T,S,R){this.namespace=T;this.localName=S;this.modelClass=R});s.prototype.getNamespace=function(){return this.namespace};s.prototype.getLocalName=function(){return this.localName};s.prototype.getModelClass=function(){return this.modelClass};s.prototype.createModel=function(S,T,R){throw new Error("Must implement ElementMapping::createModel().")};s.prototype.createElement=function(T,R,S){if(!this.namespace){return R.createElement(this.localName)}else{if(R.createElementNS){return R.createElementNS(this.namespace,this.localName)}else{return R.createNode(1,this.localName,this.namespace)}}};s.prototype.getChildren=function(T,U,S){var W=[];var X=T.childNodes;for(var R=0;R<X.length;R++){if(X[R].nodeType==1){var V=this.getChild(X[R],U,S);if(V){W.push(V)}}}return W};s.prototype.getChild=function(T,U,S){var R=U.getMappingByElement(T);return R?R.createModel(T,U,S):null};s.prototype.addChild=function(S,U,T){var R=T.getMappingByModel(U);if(R){S.appendChild(R.createElement(U,S.ownerDocument))}};s.prototype.addChildren=function(S,U,T){for(var R=0;R<U.length;R++){this.addChild(S,U[R],T)}};var N=a.extend(function(){this.mappings=[];this.namespaces=[]});N.prototype.addMapping=function(R){f(arguments,[s]);this.mappings[R.getModelClass().getClassID()]=R;var T=R.getNamespace()||"";var S=R.getLocalName();if(!this.namespaces[T]){this.namespaces[T]={}}this.namespaces[T][S]=R};N.prototype.getMappingByModel=function(T){var R=T.constructor;do{var S=this.mappings[R.getClassID()];if(S){return S}}while(R=R.superClass);return null};N.prototype.createElementByModel=function(T,S){var R=this.getMappingByModel(T);if(R){return R.createElement(T,S,this)}else{throw new o("Can't find the mapping for the provided model.")}};N.prototype.getMappingByElement=function(R){var S=this.namespaces[R.namespaceURI||""];return S&&S[R.localName||R.baseName]||null};N.prototype.createModelByElement=function(T,S){var R=this.getMappingByElement(T);if(R){return R.createModel(T,this,S)}else{throw new o("Can't find the mapping for the provided XML element.")}};this.View=M;this.ViewCache=v;this.ViewNotFoundError=w;this.IViewFactory=t;this.IViewClassProvider=u;this.SimpleViewFactory=O;this.ViewRegistry=l;this.MappingError=F;this.MappingNotFoundError=o;this.ElementMapping=s;this.XMLMappingRegistry=N});b$.module("b$.xmvc",function(){var c=b$.require("b$.mvc.Model");var a=c.extend(function(d){c.call(this);this.model=d},{registerObservers:function(){},unregisterObservers:function(){},releaseFromModel:function(){this.unregisterObservers()}});this.ModelView=a;var b=a.extend(function(d){a.call(this,d);this.dom=null},{registerObservers:function(){},unregisterObservers:function(){},createDOM:function(d){throw new Error("Must implement createDOM().")},getDOM:function(d){if(!this.dom){this.dom=this.createDOM(d);this.registerObservers()}else{if(this.dom.ownerDocument!=d){throw new Error("HTML document mismatch with existing view.")}}return this.dom},releaseFromModel:function(){if(this.dom){this.unregisterObservers();if(this.dom.parentNode){this.dom.parentNode.removeChild(this.dom)}this.dom=null}}});this.View=b});