bd.ItemManager=(function(){var h=null;var k=null;var c=function(w,p,q){try{var s=be.utils.getTemplateDataFromForm("#newWidgetForm");var u=[];if(s.widgetTags.length>0){var x=s.widgetTags.split(",");for(var v=0;v<x.length;v++){if(jQuery.type(x[v])=="string"){if(x[v].length>0){u.push({tag:x[v]})}}}}s.hasTags=u.length>0;s.tags=u;var p=s.widgetType;s.widgetId=new Date().getTime();var t=be.utils.processXMLTemplate("itemMngmt/CatalogWidget-"+p,s);var o=bd.contextRoot+"/catalog.xml";be.utils.ajax({url:o,data:t,type:"POST",success:function(){bc.component.notify({uid:"0292",icon:"checkbox",message:"Widget added successfully."});var y=jQuery(".bd-widget-ItemManagerContainer")[0];e();n(y,null,true)}})}catch(r){console.log("bd.ItemManagerClass.saveNewWidget"+r)}return false};var f=function(v){try{var r=be.utils.getTemplateDataFromForm("#editWidgetForm");var t=[];if(r.widgetTags.length>0){var w=r.widgetTags.split(",");for(var u=0;u<w.length;u++){if(jQuery.type(w[u])=="string"){if(w[u].length>0){t.push({tag:w[u].replace(/^\s+|\s+$/,"")})}}}}r.hasTags=t.length>0;r.tags=t;r.isEdit=true;r.modifiedProp=i(k.catalog.widget.properties,r);var o=r.widgetType;var s=be.utils.processXMLTemplate("itemMngmt/CatalogWidget-"+o,r);var p=bd.contextRoot+"/catalog.xml";be.utils.ajax({url:p,data:s,type:"PUT",success:function(){bc.component.notify({uid:"1209",icon:"checkbox",message:"Widget has been updated successfully"});var x=jQuery(".bd-widget-ItemManagerContainer")[0];n(x,null,true)}})}catch(q){console.log("bd.ItemManagerClass.saveNewWidget"+q)}return false};var m=function(o,p){be.utils.ajax({url:bd.contextRoot+"/catalog/"+p,dataType:"xml",success:function(v){try{jQuery(".bd-widgetItemHolder").removeClass("bd-widgetItemHolder-current");jQuery(o).addClass("bd-widgetItemHolder-current");var y=bd.xmlToJson({xml:v,dataFormatter:function(t){if(t.properties.thumbnailUrl!=null){t.properties.thumbnailUrl.value=be.utils.replaceParams(t.properties.thumbnailUrl.value,bd.oPortalClient.params);t.properties.thumbnailUrl=t.properties.thumbnailUrl}if(typeof t.tag==="object"){t.tag=""}}});k=y;var z=y.catalog.widget.propertiesArray;var w=[];for(var u in z){if(z[u].hasOwnProperty("name")&&z[u].hasOwnProperty("value")&&z[u].value!=null&&typeof z[u].value!=="object"){w.push(z[u])}}var x=y.catalog.widget.tagArray;var D=[];for(var u=0;u<x.length;u++){var C=x[u];if(jQuery.type(C)=="string"){D.push(C)}}var D=D.join(", ");var r={widgetData:y.catalog.widget,viewableProperties:w,tags:D};var s=be.utils.processHTMLTemplate("ItemManager/widgetDetails",r);var A=jQuery("#widgetDetailsContainer");A.html(s);A.show();var B=r.widgetData.properties.TemplateName.value;if(B=="Standard_Widget"){jQuery("#editWidgetDefUrl").attr("value",r.widgetData.properties.src.value)}else{if(B=="W3C_Widget"){jQuery("#editWidgetDefUrl").attr("value",r.widgetData.properties.defaultStartFile.value)}}g(r.widgetData);jQuery("#resetButton").click(function(){m(o,p)})}catch(q){k=null;console.log("bd.ItemManagerClass.showDetails"+q)}}})};var g=function(o){be.utils.domReady("#widgetTagsDetails",function(p){bd.initTags("#widgetTagsDetails")});d(o);be.utils.addCustomMethodToValidator(["validTitle"]);jQuery("#editWidgetForm").validate({rules:{widgetTitle:{validTitle:true}},submitHandler:f});return false};var d=function(p){var o="id"+new Date().getTime();jQuery("#icon-edit-button").click(function(){var r=jQuery("#iconImage").attr("src");var u='<div class="bd-inPlaceEditorPlus" id="'+o+'"><input size="200" value="'+((p.properties.thumbnailUrl!=null)?p.properties.thumbnailUrl.value:"")+'"/><button class="bd-button bd-roundcorner-3">Ok</button><button class="bd-buttonText">Cancel</button></div>';jQuery("#icon-edit-button").hide();jQuery("#icon-edit-button").before(u);var t=jQuery("#"+o);var q=jQuery("input",t).select();var s=jQuery(".bd-button",t);var v=jQuery(".bd-buttonText",t);s.bind("click",function(w){jQuery("#iconImage").attr("src",q.val());jQuery("#icon-edit-button").show();jQuery("#iconInput").attr("value",q.val());t.remove()});v.bind("click",function(w){jQuery("#icon-edit-button").show();jQuery("#iconImage").attr("src",r);jQuery("#iconInput").attr("value",q.val());t.remove()})})};var a=function(o,r,q){var p={widgetType:r};var s=be.utils.processHTMLTemplate("ItemManager/createWidget-"+r,p);be.openDialog({htmlContent:s,event:q,standAlone:true,height:"400",small:true});be.utils.addCustomMethodToValidator(["validTitle"]);jQuery("#newWidgetForm").validate({rules:{widgetTitle:{validTitle:true}},submitHandler:c});be.utils.domReady("#widgetTagsInput",function(t){bd.initTags("#widgetTagsInput")});return false};var b=function(o,p){h=p;bd.ItemManager.selectedWidget=h;m(o,p);return false};var e=function(o){be.closeCurrentDialog();return false};var j=function(o,p){deleteWidget=function(){var q=h;be.utils.ajax({url:bd.contextRoot+"/catalog/"+q+"?soft="+p,type:"DELETE",success:function(){bc.component.notify({uid:"9256",icon:"checkbox",message:"Widget has been removed successfully"});var r=jQuery(".bd-widget-ItemManagerContainer")[0];n(r,null,true)}})};if(h){be.utils.confirm({title:"REMOVE WIDGET",message:"This will remove the widget and cannot be undone. Are you sure you want to continue?",yesCallback:deleteWidget})}else{}};var l=function(){bd.portalExport.importItem("widget",function(){var o=jQuery(".bd-widget-ItemManagerContainer")[0];n(o,null,true)})};var n=function(r,p){var o=function(t){var v=bd.xmlToJson({xml:t,dataFormatter:function(x){if(bd.oPortalClient!=null&&bd.oPortalClient.params!=null&&x.properties.thumbnailUrl!=null){x.properties.thumbnailUrl.value=be.utils.replaceParams(x.properties.thumbnailUrl.value,bd.oPortalClient.params);x.properties.thumbnailUrl=x.properties.thumbnailUrl}}});if(v.catalog==null||v.catalog.widget==null||v.catalog.widget.length==null){v.catalog.widget=[]}var u={serverCatalogWidgets:v.catalog.widget,portalTitle:bd.selectedPortalTitle,contextRoot:bd.contextRoot};var s=be.utils.processHTMLTemplate("ItemManager/ItemManagerView",u);$(r).html(s);var w=bc.component.dropdown({target:$(".bd-itemMnt-header-buttons",r)[0],label:"Actions",uid:"4567",type:"action-icon",staticLabel:true,options:[{name:"Remove selected item from the server",classname:"bd-removeSelectedItem",onclick:"return bd.ItemManager.removeWidget(this, true)"},{name:"Export selected item",classname:"bd-exportSelectedItem",onclick:'return bd.portalExport.exportItem(bd.ItemManager.selectedWidget, "widget")'},{name:"Import item",classname:"bd-importItem",onclick:"return bd.ItemManager.importWidget()"}]});bc.component.dropdown({target:$(".bd-itemMnt-header-buttons",r)[0],type:"add-select",uid:"7282",staticLabel:true,options:[{name:"Add Backbase Widget",onclick:'return bd.ItemManager.addWidget(this, "backbase", event);'},{name:"Add W3C Widget",onclick:'return bd.ItemManager.addWidget(this, "w3c", event);'}]})};var q=bd.contextRoot+"/catalog.xml?ps=100&s=lastModifiedTimestamp(dsc)&f=type(eq)WIDGET";be.utils.ajax({url:q,dataType:"xml",cache:false,success:o});bd.ItemManager.selectedWidget=null};var i=function(u,p){var t="";var q=function(B,y){var z=["label","name","viewHint","manageable"];var A="",x="";for(var w=0;w<z.length;w++){var v="";if(B[z[w]]){v=z[w]+'="'+B[z[w]]+'"'}A+=v+" "}A=$.trim(A);x+="<property "+A+">";if(B.type){x+='<value type="'+B.type+'">'+B.value+"</value>"}else{x+="<value>"+y+"</value>"}x+="</property>";return x};var o={title:"widgetTitle",thumbnailUrl:"widgetThumbNailUrl",src:"widgetDefUrl",defaultStartFile:"widgetDefUrl"};for(var r in o){if(u[r]){var s=o[r];t+=q(u[r],p[s])}}t="<properties>"+t+"</properties>";return t};return{renderUI:n,removeWidget:j,addWidget:a,importWidget:l,selectWidget:b,cancelCreateForm:e,selectedWidget:null}}());b$.module("bd.widgets.ItemManager",function(){this.Maximized=bd.ItemManager.renderUI});