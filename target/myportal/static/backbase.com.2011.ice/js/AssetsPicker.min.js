(function(f){var c=false,a=false,d='<div id="bd-dragHelper" class="bd-bddrag-dragHelper" style="display:none; z-index:99999; position:absolute;"></div>',h=f(d),i='<div id="bd-iframeCover" style="display:none; position:fixed;"></div>',g=[],j=function(l){var k={helper:h[0]};return k},b=function(m,k,l){if(m[0].contentWindow&&m[0].contentWindow.jQuery){m[0].contentWindow.jQuery(k[0]).trigger(l)}},e={init:function(k){var l=f.extend({containment:f(document),delay:20,distance:20,scope:false,addClasses:"bd-bdDrag-helper",cursorAt:[5,5],helper:"clone",iframe:null,start:function(m,n){},drag:function(m,n){},stop:function(m,n){},jstreeSupport:false},k);e.initDocumentDrag(l);e.initTargetDrag(this,l);if(l.iframe){l.iframe=f(l.iframe);e.initIframeDrag(l)}return this},destroy:function(){return this.each(function(){f(this).unbind(".bdDrag")})},stop:function(){if(settings.containment){settings.containment.trigger("mouseup.bdDrag")}return this.each(function(){this.trigger("mouseup.bdDrag")})},_getFixedPositions:function(u,w,n){var v=u[0],r=v.ownerDocument.body,s=r.offsetWidth,q=r.offsetHeight,k=v.offsetWidth,l=v.offsetHeight,o=(w.clientX+n.cursorAt[0])+r.scrollLeft,p=(w.clientY+n.cursorAt[1])+r.scrollTop,m=(o+k>s?s-k:o),t=(p+l>q?q-l:p);if(f(".bp-widget:eq(0)",v.ownerDocument).hasClass("bd-dm-clicked")){t-=parseInt(f(".bd-dm-edit-bar:eq(0)",v.ownerDocument).css("height"),10)}return{left:m,top:t}},initDocumentDrag:function(k){h[0].isShow=false;h[0].bdDragData={};f("body").append(h);k.containment.bind("mouseup.bdDrag",function(l){k.containment.trigger("c_mouseup.bdDrag",l)}).bind("c_mousemove.bdDrag",function(q,m){if(c&&!a){q.originalEvent=m;!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();var p=j(m),o,n,l;n=h[0];var r=e._getFixedPositions(h,m,k);o=n.style;o.left=r.left+"px";o.top=r.top+"px";k.drag.call(this,q,p)}}).bind("c_mouseup.bdDrag",function(n,l){f("body").removeClass("bd-all-cur-grabbing bd-link-drag-start bd-link-drag-start-jstree");if(c){e.unbindContainmentEvent(k);e.unbindIframeEvent();n.originalEvent=l;c=false;h[0].isShow=c;var m=j(l);h.hide();e.toggleIframeCoverList("hide");k.stop.call(this,n,m)}})},unbindContainmentEvent:function(k){k.containment.unbind("mousemove.bdDrag").find("body").unbind("keydown.bdDrag").unbind("c_keydown.bdDrag")},initTargetDrag:function(l,k){l.each(function(){var o=f(this),p=false;o.addClass("bd-bdDrag").bind("mousedown.bdDrag",function(q){o.trigger("c_mousedown.bdDrag",q);return !!k.jstreeSupport}).bind("mouseup.bdDrag",function(q){o.trigger("c_mouseup.bdDrag",q)}).bind("c_mousedown.bdDrag",function(r,q){if(q.which===1&&!c){r.originalEvent=q;if(!c){p=setTimeout(function(){m(q,r)},k.delay)}k.containment.bind("mousemove.bdDrag",function(s){if(!c&&n(q,s)){clearTimeout(p);m(s,r)}k.containment.trigger("c_mousemove.bdDrag",s)}).find("body").bind("keydown.bdDrag",function(s){if(s.keyCode===27){s.preventDefault();s.stopPropagation();f(this).trigger("c_keydown.bdDrag",s);return false}}).bind("c_keydown.bdDrag",function(t,s){if(c){k.iframe.contents().trigger("c_mouseup.bdDrag",s);k.containment.trigger("c_mouseup.bdDrag",s)}})}}).bind("c_mouseup.bdDrag",function(r,q){e.unbindContainmentEvent(k);if(c){k.containment.trigger("c_mouseup.bdDrag")}clearTimeout(p);h.trigger("c_deactivate.bdDrop")})});var n=function(o,p){return(Math.max(Math.abs(o.pageX-p.pageX),Math.abs(o.pageY-p.pageY))>=k.distance)},m=function(o,r){c=true;h[0].isShow=c;var p="",s;if(k.helper==="clone"){p=$this.clone()}else{if(k.helper instanceof Function){p=k.helper(r)}else{p=$this}}s=e._getFixedPositions(h,o,k);h.html("").css({top:s.top,left:s.left}).addClass(k.addClasses).append(p).show();e.toggleIframeCoverList("show",k);var q=j(o);k.start.call(this,r,q);f("body").addClass("bd-all-cur-grabbing bd-link-drag-start"+(k.jstreeSupport?" bd-link-drag-start-jstree":""))}},initIframeDrag:function(n){if(n.iframe){var m,k,o;for(m=0,k=n.iframe.length;m<k;m++){o=f(n.iframe[m]);$iframeDocument=o.contents();if($iframeDocument[0].readyState==="complete"){e.createIframeCover(o,n)}}n.iframe.unbind("load.bdDrag").bind("load.bdDrag",function(p){var l=f(this);e.createIframeCover(l,n)})}},unbindIframeEvent:function(){var o,k,p,n,m;for(n=0,m=g.length;n<m;n++){p=g[n];o=p.iframe;k=o.contents();o.data("hasEvent",false);k.unbind("mouseenter.bdDrag").unbind("mouseup.bdDrag").unbind("mouseleave.bdDrag").unbind("mousemove.bdDrag").unbind("c_mouseenter.bdDrag").unbind("c_mouseup.bdDrag").unbind("c_mousemove.bdDrag").unbind("c_mouseleave.bdDrag").unbind("keydown.bdDrag").unbind("c_keydown.bdDrag")}},bindIframeEvent:function(n,l){var k=n.contents(),m=k.find("body");if(!m.find("#bd-dragHelper").length){$iframeHelper=f(d);$iframeHelper[0].isShow=false;$iframeHelper[0].bdDragData={};m.append($iframeHelper)}else{$iframeHelper=m.find("#bd-dragHelper")}k.bind("mouseenter.bdDrag",function(o){k.trigger("c_mouseenter.bdDrag",o)}).bind("mousemove.bdDrag",function(o){k.trigger("c_mousemove.bdDrag",o)}).bind("mouseup.bdDrag",function(o){k.trigger("c_mouseup.bdDrag",o)}).bind("mouseleave.bdDrag",function(o){k.trigger("c_mouseleave.bdDrag",o)}).bind("c_mouseenter.bdDrag",function(p,o){if(c&&a){b(n,$iframeHelper,"c_activate.bdDrop")}}).bind("c_mouseup.bdDrag",function(q,o){var p;if(c&&a){e.unbindContainmentEvent(l);e.unbindIframeEvent();q.originalEvent=o;c=false;a=false;h[0].isShow=c;if($iframeHelper.length){$iframeHelper[0].isShow=a;$iframeHelper.hide();b(n,$iframeHelper,"c_deactivate.bdDrop")}p=j(o);l.stop.call(this,q,p)}}).bind("c_mousemove.bdDrag",function(r,o){var q,s,p;if(c&&a){!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();r.originalEvent=o;q=j(o);if($iframeHelper.length){$iframeHelper[0].isShow=a;p=$iframeHelper[0].style;s=e._getFixedPositions($iframeHelper,o,l);p.left=s.left+"px";p.top=s.top+"px"}l.drag.call(this,r,q)}}).bind("c_mouseleave.bdDrag",function(q,o){var p,r;if(c&&a&&!o.relatedTarget){q.originalEvent=o;a=false;h[0].isShow=true;f("body").addClass("bd-all-cur-grabbing");if($iframeHelper.length){$iframeHelper.hide();$iframeHelper[0].isShow=a;p=$iframeHelper[0].style;r=e._getFixedPositions($iframeHelper,o,l);p.left=r.left+"px";p.top=r.top+"px"}b(n,$iframeHelper,"c_deactivate.bdDrop");e.toggleIframeCoverList("show")}}).bind("keydown.bdDrag",function(o){if(o.keyCode===27){k.trigger("c_keydown.bdDrag",o)}}).bind("c_keydown.bdDrag",function(p,o){if(c){if(a){o.preventDefault()}k.trigger("c_mouseup.bdDrag",o);l.containment.find("body").trigger("c_mouseup.bdDrag",o)}})},toggleIframeCoverList:function(o,n){var m,k,s,r,q,p;for(m=0,k=g.length;m<k;m++){s=g[m];r=s.iframe;q=s.iframeCover;if(o==="hide"){q.hide()}else{if(n&&!r.data("hasEvent")){r.data("hasEvent",true);e.bindIframeEvent(r,n)}p=r.offset();q.css({width:r.width(),height:r.height(),top:p.top,left:p.left}).show()}}},createIframeCover:function(p,l){p.data("hasEvent",false);if(p.attr("data-forIframeCover")){return}var o=f(i),n=p.offset(),m=f("body"),k=new Date().getTime()+Math.floor((Math.random()*1000)+1);o.css({width:p.width(),height:p.height(),top:n.top,left:n.left}).attr({id:"bd-iframeCover-"+k,"data-forIframe":k}).bind("mouseenter.bdDrag",function(x){var s=p.contents(),y=f(this).offset(),t=x.clientX-y.left,q=x.clientY-y.top,v=x.pageX-y.left,u=x.pageY-y.top,r,z,w;x.pageX=v;x.pageY=u;x.clientX=t;x.clientY=q;if(c&&!a){a=true;h[0].isShow=false;$iframeHelper=s.find("#bd-dragHelper");if($iframeHelper.length){$iframeHelper.html(h.html());$iframeHelper[0].bdDragData=h[0].bdDragData;$iframeHelper[0].isShow=a;z=$iframeHelper[0];r=z.style;fixedPositions=e._getFixedPositions($iframeHelper,x,l);r.left=fixedPositions.left+"px";r.top=fixedPositions.top+"px";r.display="block";f("body").removeClass("bd-all-cur-grabbing");h.hide()}}e.toggleIframeCoverList("hide")});p.attr("data-forIframeCover",k);p.after(o);g.push({iframeCover:o,iframe:p})},clearIframeList:function(){var l,k=true;while(k){l=g.pop();if(l&&l.iframeCover){l.iframeCover.remove()}else{k=false}}}};f.fn.bdDrag=function(k){if(e[k]){return e[k].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof k==="object"||!k){return e.init.apply(this,arguments)}else{f.error("Method "+k+" does not exist on jQuery.bdDrag")}}}})(jQuery);(function(c){var d,a=function(h,f){var g={helper:d,dropIndicator:f.dropIndicator};return g},b={init:function(e){var f=c.extend({scope:false,accpet:"bd-bdDrag",dropIndicator:null,activate:function(g,h){},deactivate:function(g,h){},enter:function(g,h){},leave:function(g,h){},drop:function(g,h){},over:function(g,h){},out:function(g,h){},move:function(g,h){}},e);if(f.dropIndicator!==null){f.dropIndicator=c(f.dropIndicator)}b.initTargetDrop(this,f);b.initEventForActive(this,f);return this},destroy:function(){return this.off(".bdDrop").removeAttr("onc_mouseenter onc_mouseleave onc_mouseover onc_mouseout onc_activate onc_deactivate onc_drop onc_mousemove onc_mouseup sizset sizcache").removeClass("bd-bdDrop")},initTargetDrop:function(g,f){var e=null;g.addClass("bd-bdDrop").on("mouseenter.bdDrop",function(h){c(this).trigger("c_mouseenter.bdDrop",h)}).on("mouseleave.bdDrop",function(h){c(this).trigger("c_mouseleave.bdDrop",h)}).on("mouseup.bdDrop",function(h){c(this).trigger("c_mouseup.bdDrop",h)}).on("c_mouseenter.bdDrop",function(j,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);j.target=h.target;if(c.contains(this,h.target)&&!c(this).data("isInside")){c(this).data("isInside",true);f.enter.call(this,j,i)}else{if(h.target===this&&!c(this).data("isInside")){if(h.relatedTarget&&h.relatedTarget!=h.target){f.enter.call(this,j,i)}else{if(h.relatedTarget&&c.contains(this,h.relatedTarget)!==true){f.enter.call(this,j,i)}else{f.enter.call(this,j,i)}}c(this).data("isInside",true)}}return}}).on("c_mouseleave.bdDrop",function(k,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){k.originalEvent=h;var j=a(h,f),i=h.relatedTarget||h.toElement;if(i&&c.contains(this,i)&&!c(i).hasClass("bd-bdDrop")){return false}else{if(h.target===d||i===d||c.contains(d,i)){return false}}c(this).data("isInside",false);f.leave.call(this,k,j);return}}).on("c_mouseup.bdDrop",function(k,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){k.originalEvent=h;var j=a(h,f);c(this).data("isInside",false);if(c(".jstree-invalid",d).length>0){f.leave.call(this,k,j);return}f.drop.call(this,k,j);f.deactivate.call(this,k,j);try{bd.observer.notifyObserver("bdDrop.drop.recentlyUse",j.helper.bdDragData)}catch(i){}}}).on("mousemove.bdDrop",function(h){c(this).trigger("c_mousemove.bdDrop",h)}).on("c_mousemove.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.move.call(this,j,i)}}).on("mouseover.bdDrop",function(h){c(this).trigger("c_mouseover.bdDrop",h)}).on("c_mouseover.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.over.call(this,j,i)}}).on("mouseout.bdDrop",function(h){c(this).trigger("c_mouseout.bdDrop",h)}).on("c_mouseout.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.out.call(this,j,i)}}).on("c_activate.bdDrop",function(h){h.stopPropagation();h.preventDefault();d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){var i=a(h,f);f.activate.call(this,h,i)}return false}).on("c_deactivate.bdDrop",function(h){h.stopPropagation();h.preventDefault();d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&!d.isShow){c(this).data("isInside",false);var i=a(h,f);f.deactivate.call(this,h,i)}return false})},initEventForActive:function(g,e){var f=c("body");if(!f.data("hasActivateEvent")){f.data("hasActivateEvent",true);f.on("c_activate.bdDrop",function(h){f.addClass("bd-all-cur-grabbing");f.find(".bd-bdDrop").trigger("c_activate.bdDrop")}).on("c_deactivate.bdDrop",function(h){f.removeClass("bd-all-cur-grabbing");f.find(".bd-bdDrop").trigger("c_deactivate.bdDrop")})}}};c.fn.bdDrop=function(e){if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return b.init.apply(this,arguments)}else{c.error("Method "+e+" does not exist on jQuery.bdDrop")}}}})(jQuery);(function(a){if(!a.bd){a.bd={}}if(!bd.assetsPicker){bd.assetsPicker={}}bd.assetsPicker={params:{},init:function(c,b){if(this.params.isInited){if(this.params.viewSettings.before){this.params.viewSettings.before()}return}var e=$.extend({target:$(document),id:"bd-ap-jstree-id-"+(new Date().getTime())},b),d={init:"Init.assetsPicket",loadMore:"loadMore.assetsPicket",openNode:"openNode.assetsPicket",search:"search.assetsPicket",searchResult:"searchResult",sort:"sort.assetsPicket",openInfoPanel:"openInfoPanel.assetsPicket",slidingInfoPanel:"slidingInfoPanel.assetsPicket",loadRecentlyUse:"loadRecentlyUse.assetsPicket",loadingError:"error.assetsPicket",initLoadingError:"initLoadingError.assetsPicket"};this.params={options:c,obsEvents:d};this.params.viewSettings=e;bd.assetsPicker.view.init(this.params);bd.assetsPicker.dTrans.initTree(d.init);bd.observer.addObserver(bd.notifications.pageMgmt.STOP,function(f){bd.assetsPicker.destroy()})},destroy:function(){var b,c;for(b in bd.assetsPicker.params.obsEvents){c=bd.assetsPicker.params.obsEvents[b];bd.observer.removeObserver(c)}bd.assetsPicker.files={};bd.assetsPicker.params={}}}})(window);if(!window.bd.assetsPicker){window.bd.assetsPicker={}}bd.assetsPicker.dTrans=(function(){var n={};var h=50,s=h-1;var j=function(w){bd.assetsPicker.files={};c(w)};var q=function(y){var z=jQuery.Deferred();if(!y){z.resolve([])}else{var w=function(C){if(!C.length){z.resolve([])}else{var B,A;for(B=0,A=C.length;B<A;B++){C[B].repoName=y}z.resolve(C)}},x=function(){z.resolve([])};be.cmis.getFolders({condition:"+cmis%3Apath='/'",orderBy:"cmis:name",order:"ASC",searchBy:true,successCallback:w,errorCallback:x,repository:y})}return z.promise()};var p=function(z){var y=jQuery.Deferred(),w=function(A){y.resolve(A&&A.length?A:[])},x=function(){y.reject(null)};be.cmis.getFolders({condition:"+cmis%3AparentId+%3D+%27"+z.metadata.folderid+"%27",orderBy:"cmis:name",order:"ASC",searchBy:true,successCallback:w,errorCallback:x,repository:z.repoName});return y.promise()};var k=function(y){var x=jQuery.Deferred(),w={folderId:y.metadata.folderid,maxItem:h,order:"ASC",orderBy:"cmis:name",path:y.metadata.path,repository:y.repoName,successCallback:function(z){x.resolve(z&&z.length?z:[])},errorCallback:function(){x.reject(null)}};be.cmis.getFiles(w);return x.promise()};var m=function(){var z=jQuery.Deferred(),x=function(A){return be.contextRoot+(A?"/portals/"+bd.selectedPortalName:"")+"/catalog.xml?f=type(eq)CONTENTREPOSITORY"},w=be.utils.ajax({url:x(true),cache:false,dataType:"xml",type:"GET"}),y=be.utils.ajax({url:x(),cache:false,dataType:"xml",type:"GET"});jQuery.when(w,y).then(function(C,B){bd.assetsPicker.generatedContentDir=$('property[name="generatedContentDir"] value',C[0]).text().replace(/\/$/,"");try{var A=e(C[0],B[0]);if(A.length){z.resolve(A)}else{z.reject()}}catch(D){z.reject()}},function(A){z.reject(A)});return z.promise()};var i=function(B){var z=jQuery.Deferred();var x=[],y,w,A;for(y=0,w=B.length;y<w;y++){A=B[y];x.push(q(B[y]))}jQuery.when.apply(this,x).then(function(){var C=[],E,D;for(E=0,D=arguments.length;E<D;E++){C=C.concat(arguments[E])}if(C.length){z.resolve(C)}else{z.reject()}},function(C){z.reject(C)});return z.promise()};var o=function(A){var z=jQuery.Deferred();if(!A.length){z.reject();return}var x,w;for(x=0,w=A.length;x<w;x++){A[x].metadata.isRoot=true}var y=A[0];jQuery.when(p(y),k(y)).then(function(B,C){y.state="open";if(C&&C.length>s){C.splice(C.length-1,1);y.metadata.loadmore=true;y.metadata.skipCount=s}C=b(C);y.children=C?B.concat(C):B;z.resolve(A)},function(B){z.reject(B)});return z.promise()};var c=function(w){m().then(function(x){i(x).then(function(y){o(y).then(function(z){v(w,z)})},function(){v(bd.assetsPicker.params.obsEvents.initLoadingError);v(bd.pm.observer.errorMsg,{message:"Content Server Error."})})},function(){v(bd.assetsPicker.params.obsEvents.initLoadingError)})};var r=function(w,x){w.maxItem=h;w.order=w.order?w.order:"ASC";w.orderBy=w.orderBy?w.orderBy:"cmis:name";w.successCallback=function(y){var z={};if(y){if(y.length>s){y.splice(y.length-1,1);z.loadmore=true;if(w.skipCount){z.skipCount=w.skipCount+s}else{z.skipCount=0+s}}z.files=b(y)}if(w.folders){z.folders=w.folders}if(w.folderId){z.openedFolderId=w.folderId}if(w.event){v(w.event,z)}if(x){x(z)}};be.cmis.getFiles(w)};var g=function(w){var x={condition:"cmis%3AcreatedBy%3D%27"+bd.loggedInUserId+"%27"};if(w.skipCount>-1){x.skipCount=w.skipCount}if(w.order){x.order=w.order}if(w.orderBy){x.orderBy=w.orderBy}if(w.event){x.event=w.event}r(x)};var u=function(z){var x;if(z.searchBy){z.condition="";var w=$.extend({},z);if(z.filterBy&&z.filterBy!=="all"){z.condition+="cmis%3AcontentStreamMimeType+LIKE+%27%25"+encodeURIComponent(z.filterBy)+"%25%27"}w.condition="cmis%3Aname+LIKE+%27%25"+encodeURIComponent(z.searchBy)+"%25%27";z.condition+=(z.condition?"+AND+":"")+w.condition;var y=z.event;a(w,z).then(function(A){v(y,A)});return}else{if(z.filterBy){if(z.filterBy!="link"){z.condition="cmis%3AcontentStreamMimeType+LIKE+%27%25"+encodeURIComponent(z.filterBy==="all"?"":z.filterBy)+"%25%27+"}else{z.collection="bb%3Alink"}x=z.filterBy.indexOf("/");if(x>-1){z.condition+="+AND+cmis%3Aname+LIKE+%27%25."+encodeURIComponent(z.filterBy.substring(x+1))+"%27"}}else{return}}r(z)};var a=function(w,y){var x=$.Deferred();if(!y){y=w}var z=y.order==="DESC"?function(B,A){return B.data.title<A.data.title?1:B.data.title>A.data.title?-1:0}:function(B,A){return B.data.title>A.data.title?1:B.data.title<A.data.title?-1:0};m().then(function(B){var A=[];B.forEach(function(D){var E=$.Deferred();A.push(E.promise());var F=$.extend({},w,{repository:D,event:null,successCallback:function(G){if(G){F.folders=G}F=$.extend({},y,{event:null,repository:D});r(F,function(H){E.resolve(H)})}});be.cmis.getFolders(F)});var C={files:[]};$.when.apply($,A).then(function(){Array.prototype.slice.call(arguments).forEach(function(D){C.files=C.files.concat(D.files||[])});C.files=C.files.sort(z);x.resolve(C)},x.reject)});return x.promise()};var d=function(w){if(w.folderId){w.condition="+cmis%3AparentId+%3D+%27"+w.folderId+"%27";w.searchBy=true;w.successCallback=function(x){if(x){w.folders=x.filter(function(y){return !y.metadata||!n[w.repository]||(y.metadata.path!==n[w.repository].replace(/\/$/,"")&&y.metadata.path!=="/rules")})}w.condition="";w.successCallback=null;r(w)};be.cmis.getFolders(w)}else{r(w)}};var t=function(){var y={attr:{id:"shortCuts_ap","class":"bd-ap-shortCuts"},data:{title:"SHORTCUTS"},metadata:{isRoot:true,folderid:"shortCuts_ap"},state:"open",children:[]},w={attr:{id:"recentlyUse_ap"},data:{title:"My recently used content"},metadata:{folderid:"recentlyUse_ap"},state:"close"},x={attr:{id:"myContent_ap"},data:{title:"My recent content"},metadata:{folderid:"myContent_ap"},state:"close"};y.children.push(w);y.children.push(x);return y};var b=function(y){if(!y||!y.length){return null}var x;for(var w=0;w<y.length;w++){x=y[w];bd.assetsPicker.files[x.contentUId]=x;y[w]={attr:{id:x.contentUId,title:x.name},data:{title:x.name}}}return y};var l=function(B){var z,x,C,y=[],w=[],A=function(E){var D=E.pop();if(D){if(bd.assetsPicker.files[D.uid]){w.push(bd.assetsPicker.files[D.uid]);A(E)}else{be.cmis.getMetaData({contentUid:D.uid,errorCallback:function(){A(E)}},function(F){var G={contentUId:F["cmis:objectId"].property,name:F["cmis:name"].property,path:F["cmis:path"].property,type:F["cmis:contentStreamMimeType"].property||F["cmis:objectTypeId"].property,thumbUrl:F.thumbUrl.property,url:F.url.property,metaData:F};if(!bd.assetsPicker.files[D.uid]){bd.assetsPicker.files[D.uid]=G}w.push(G);A(E)})}}else{v(B.event,{fileDataArray:w})}};for(z=0,x=B.contentUId.length;z<x;z++){y.push({uid:B.contentUId[z]})}A(y)};var v=function(x,y){if(jQuery.isArray(x)){for(var w=0;w<x.length;w++){bd.observer.notifyObserver(x[w],[y])}}else{bd.observer.notifyObserver(x,[y])}};var f=function(x){var A=bd.xmlToJson({xml:(new XMLSerializer()).serializeToString(x)}),z=[],C=[],y,w,D;if(A&&A.catalog&&A.catalog.contentRepository){if(A.catalog.contentRepository instanceof Array){z=A.catalog.contentRepository}else{z.push(A.catalog.contentRepository)}}for(y=0,w=z.length;y<w;y++){D=z[y];var B=D.properties.repositoryId?D.properties.repositoryId.value:D.name;if(D.properties.generatedContentDir){n[B]=D.properties.generatedContentDir.value}C.push(B)}return C},e=function(y,z){var x=f(y),C=f(z),B="contentRepository",w=[],A=function(D){return function(F,E){if(F===D||E===D){return 1}else{return 0}}};C.sort(A(B));w=w.concat(x,C);return w};return{initTree:j,loadFiles:r,loadFolders:d,getMyContent:g,searchAndFilter:u,getRecentlyUse:l,searchOnMultipleRepositories:a}})();(function(){if(!bd.assetsPicker){return}bd.assetsPicker.infoPanel=(function(){var p=false,r=false,b=false,g=null,m=null,t={},n="(empty)",c=["text/","image/","application/pdf"],l=0,e=0,u=bd.contextRoot+"/proxy?pipe=mustachePipe&contentPath=",q=function(w){var v=jQuery(w.viewSettings.target);t=w.obsEvents;g=w.apJstree;m=w.searchJstree;r=f("assetPicker_infoPanel",{});h(w);a(w)},f=function(w,v){return jQuery(be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2011.ice/html/assetPicker/"+w+".html",v))},o=function(){return m&&m.is(":visible")&&m.children().length?m:g},k=function(y){var w,x=null,v;if(!y){w=o().jstree("get_selected");if(!w.length||w.data("type")==="cmis:folder"){w=o().find("li.bd-ap-file:first")}}else{y=jQuery(y);w=y.closest(".bd-ap-li");if(y.hasClass("bd-ap-closeSettingPanel")){y.removeClass("bd-ap-closeSettingPanel bd-ap-refreshSettingPanel");bd.observer.notifyObserver(t.slidingInfoPanel,"closeSettingPanel");return}if(y.hasClass("bd-ap-refreshSettingPanel")){b=true;y.removeClass("bd-ap-refreshSettingPanel")}}if(p){l=485;e=350;r=f("assetPicker_infoPanel",{});v=bd.assetsPicker.view.getData(w.attr("id"));x=f("assetPicker_infoPanel_setting",{fileName:v.name});jQuery("#bd_AP_Info",r).empty().append(x);r.find(".bd-AP-itemInfo").show();d(v,x);j(v,x.find(".bd-AP-file-metaData-container"));bd.observer.notifyObserver(t.slidingInfoPanel,{htmlContent:r,isRefreshInfoPanel:b});b=false}},s=function(w){var x,v,y;for(x=0,v=c.length;x<v;x++){y=c[x];if(w.indexOf(y)!==-1){return true}}return false},d=function(x,w){var z=w.find("iframe.bd-AP-iframe-preview"),y=z.siblings(".bd-AP-iframe-preview-cover"),v=y.children(".bd-AP-can-not-preview-msg");bd.repoBrowser.updatePreviewFrame(z,x)},j=function(w,v){var x={cache:false,path:w.path,repository:w.repository};be.cmis.getMetaData(x,function(y){var B,C,A=[],F,D;try{B=bd.uiEditingOptions.assetsPicker.metaDataList;for(C in B){if(y[C]){D=B[C]?B[C]:y[C].displayName;F=y[C].property?y[C].property:n;F=i(C,F);A.push({propName:D,propValue:F})}}var z=be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2011.ice/html/assetPicker/fileMetaData.html",{metaData:A});v.append(z)}catch(E){console.log(E)}})},i=function(w,x){var v={"cmis:contentStreamLength":be.utils.bytesToSize(x),"cmis:creationDate":bd.date.formatDateTime(x),"cmis:lastModificationDate":bd.date.formatDateTime(x)};if(v[w]){return v[w]}else{return x}},h=function(v){bd.observer.addObserver(t.openInfoPanel,function(x){var w=jQuery(v.viewSettings.target);p=w.hasClass("bd-assetsPicker-viewport");k(x)})},a=function(v){};return{init:q,open:k}}())})();(function(){if(!bd.assetsPicker){return}bd.assetsPicker.view=(function(){var F={PREVIEW_OPEN:"Click to open preview",PREVIEW_CLOSE:"Click to close preview"},y="SearchResult_ap",aa="shortCuts_ap",ae="myContent_ap",s="recentlyUse_ap",u=5,e="_mycontent",j="_recentlyuse",aq="_APRecentlyUse",O='<span class="bd-ap-itemIcon bd-ap-fileTrafficn"></span>',ad='<span class="bd-ap-itemIcon bd-ap-preview bi bi-s bi-pm-arrow-right" title="'+F.PREVIEW_OPEN+'"></span>',ar='<span class="bd-ap-itemIcon bd-ap-insert"></span>',J='<span class="bd-ap-itemIcon bd-ap-action-dropdown"></span>',B='<span class="bd-ap-itemIcon bd-ap-infoColumn"></span>',af='<li class="bd-ap-loadMore-trigger"></span></li>',aA='<span class="bd-ap-itemIcon bd-ap-refresh"></span>',ag={folder:'<span class="bc-icn bd-ap-folderIcn"></span>',file:'<span class="bc-icn bd-ap-fileIcn"></span>',link:'<span class="bc-icn bd-ap-linkIcn"></span>',image:'<span class="bc-icn bd-ap-imageIcn"></span>',txt:'<span class="bc-icn bd-ap-txtIcn"></span>',plain:'<span class="bc-icn bd-ap-txtIcn"></span>',doc:'<span class="bc-icn bd-ap-docIcn"></span>',msword:'<span class="bc-icn bd-ap-docIcn"></span>',html:'<span class="bc-icn bd-ap-htmlIcn"></span>',pdf:'<span class="bc-icn bd-ap-pdfIcn"></span>',quicktime:'<span class="bc-icn bd-ap-videoIcn"></span>',avi:'<span class="bc-icn bd-ap-videoIcn"></span>'},ah=function(aD){return ag[aD]||ag.file},o,k,b,P={},at={},H=null,U=null,a=jQuery('<div class="bd-ap-search"></div>'),v=null,A=null,ay=null,l=null,ax=null,M=false,W=false,Y=false,al="",N="apJstree",D={apJstree:{$currentLoadMoreFolder:null,currentFilterBy:"all",currentOrderBy:"cmis:name",currentOrder:"ASC"},searchJstree:{$currentLoadMoreFolder:null,currentFilterBy:"all",currentOrderBy:"cmis:name",currentOrder:"ASC"}},c=false,Z=function(aD){at=aD.viewSettings;P=aD.obsEvents;if(aD.viewSettings.hidePagesList){aD.viewSettings.hidePagesList();$(".bd-pageContainer .bd-pagesListContainer").append('<span class="bi bi-xl bi-pm-spinner"></span>')}be.utils.serverStatus.solr.checkStatus().then(function(){c=true},function(){c=false});ax=aD.viewSettings.target.closest(".bd-pageContainer");H=ai({});m();ac();if(aD.viewSettings.id){H.attr("id",aD.viewSettings.id)}U=H.children("div.bd-ap-tree");v=H.children("div.bd-ap-filterBar");A=v.children("div.bd-ap-filterButtons");ay=v.children("div.bd-ap-sortButtons");l=ax.find("input#token-input-ap-search");bindEvent(aD);addObserver(aD);aD.apJstree=U;aD.searchJstree=a;bd.assetsPicker.infoPanel.init(aD)},ab=function(aE){var aD;if(aE==="folder"){return aE}else{if(aE.indexOf("image/")!==-1){return"image"}else{if(aE.indexOf("link")!==-1){return"link"}else{aD=aE.indexOf("/");if(aD>-1){return aE.substring(aD+1)}return"file"}}}},E=function(aF,aE){try{var aG=aE?aE:x(),aD=aG.find("#"+aF);if(aD.hasClass("bd-ap-accordion-active")){return aD}else{return aG.find(".bd-ap-accordion-active").find("#"+aF)}}catch(aH){return null}},n=function(aG,aD){for(var aF=0,aE=aD.length;aF<aE;aF++){if(aG===aD[aF]||aG.indexOf(aD[aF])>-1){return true}}return false},aj=function(aD){if(aD.metaData&&n(aD.metaData["cmis:objectTypeId"].property,bd.uiEditingOptions.AllowedDNDTypes.typeList)){return true}if(aD.type&&n(aD.type,bd.uiEditingOptions.AllowedDNDTypes.typeList)){return true}return false},G=function(aH,aK,aE){var aI=ab(aH),aF=aK.parent("li"),aD=ah(aI),aM,aG,aJ;aF.addClass("bd-ap-li");aK.addClass("bd-ap-a");if(aI==="folder"){aF.addClass("bd-ap-folder");aK.prepend(aD);aK.append(aA)}else{if(aI==="image"&&aE){aM=document.createElement("img");aM.className="bd-ap-file-imageIcn";if(jQuery("html").hasClass("ie")){aG=aE.thumbUrl+"&"+Math.random();aJ=(new Image());aJ.onload=function(){aK.find(".bd-ap-file-imageIcn").attr("src",aG);bd.assetsPicker.view.setThumbSize(aK.find(".bd-ap-file-imageIcn")[0],aJ.width,aJ.height)};aJ.src=aG}else{aM.onload=function(){bd.assetsPicker.view.setThumbSize(this)};aM.src=aE.thumbUrl}var aL=jQuery(aD);aD=aL.append(aM)}aK.prepend(aD);aK.prepend(O);aK.append(B);aK.append(ar);aK.append(J);aK.append(ad);aK.attr("title",aK.text());aF.addClass("bd-ap-file");createActionDropdown(aK.find(".bd-ap-action-dropdown"))}},ap=function(aH,aJ,aG){var aI=18,aE=16,aF=aJ||aH.width,aD=aG||aH.height,aK=be.utils.calcImageSize(aF,aD,aI,aE);aH.style.width=aK.width+"px";aH.style.height=aK.height+"px";aH.style.marginLeft=(aK.marginLeft-2)+"px";aH.style.marginTop=(aK.marginTop-2)+"px";aH.style.display="block"},f=function(aF){var aG=aF.attr("id"),aD=aF.hasClass("bd-ap-accordion-active")?aF:E(aG,U),aE=aD.data();if(!aF[0].isLoaded||an("currentFilterBy","apJstree")!=="all"){aD.children("a:first").addClass("jstree-loading");aF[0].isLoaded=true;T(aD,"apJstree");if(aG===ae){bd.assetsPicker.dTrans.getMyContent({skipCount:0,event:P.openNode,orderBy:"cmis:lastModificationDate",order:"DESC"})}else{if(aG===s){w()}else{if(an("currentFilterBy","apJstree")!=="all"){av(an("currentFilterBy","apJstree"))}else{bd.assetsPicker.dTrans.loadFolders({folderId:aE.folderid,skipCount:0,repository:aE.repository,event:P.openNode,orderBy:an("currentOrderBy","apJstree"),order:an("currentOrder","apJstree")})}}}}else{if(aE.loadmore){aD.children("ul").append(af)}}},h=function(aF){var aG=aF.attr("id");if(!aF[0].isLoaded){var aD=a.find("#"+aG),aE=aD.data();aD.children("a:first").addClass("jstree-loading");aF[0].isLoaded=true;T(aD);bd.assetsPicker.dTrans.loadFiles({folderId:aE.folderid,repository:aE.repository,skipCount:0,event:P.openNode})}},am=function(aE,aD){aD.map(function(aF){if(aF.children){aF.children=aF.children.filter(function(aG){return !aG.metadata||aG.metadata.path!=="/rules"})}});U.jstree({exclude:{"metadata::path":bd.assetsPicker.generatedContentDir},plugins:["themes","json_data","ui","cookies","crrm","hotkeys"],hotkeys:{del:function(){},space:function(){var aG=this.data.ui.hovered,aF=this,aH;function aI(aJ){if(!$("#bd_AP_Info").length&&aH!=aJ){aJ.children("a:eq(0)").find(".bd-ap-preview:not(.bd-ap-preview-open)").click();aH=aJ}}if(aG){if(aG.hasClass("bd-ap-file")){aG.children("a:eq(0)").click();aI.call(this,aG)}}return false}},themes:{url:bd.contextRoot+"/static/dashboard/js/lib/jstree/themes/default/style_asset.css",dots:false,icons:false},core:{animation:200},ui:{select_limit:1},json_data:{data:aD},cookies:{save_selected:false,save_opened:false},crrm:{move:{check_move:function(aF){return false}}}}).bind("load_node.jstree",function(aN,aH){var aF=U.find("a"),aI,aK,aO,aP,aJ,aG,aM,aL,aQ="";for(aI=0,aK=aF.length;aI<aK;aI++){aO=jQuery(aF[aI]);aP=aO.closest("li");aL=aP.data();aJ=aP.attr("id");aG=aC(aJ);if(aL&&aL.folderid){aM="folder";if(aL.isRoot){aP.removeClass("jstree-closed");aO.addClass("bd-ap-root");aP[0].isRoot=true;if(!aQ){aP[0].isLoaded=true;aQ=aJ}else{aP[0].isLoaded=false}}else{aP.addClass("jstree-closed").removeClass("jstree-leaf");G(aM,aO)}if(aL.loadmore){aP.children("ul").append(af)}}else{if(aG){G(aG.type,aO,aG)}}au(aO,aG?aG:aL)}p(U);az(U,aQ)}).bind("select_node.jstree",function(aH,aG){var aI=aG.rslt.obj;if(aI.children("a").hasClass("bd-ap-root")){if(!aG.rslt.obj[0].isLoaded||an("currentFilterBy","apJstree")!=="all"){f(aI)}}else{if(Y||(ax&&ax.length&&ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")&&aI.hasClass("bd-ap-file"))){var aF=aI.children("a").children(".bd-ap-preview");if(!Y){aF.addClass("bd-ap-refreshSettingPanel")}Y=false;al=aI.attr("id");bd.observer.notifyObserver(P.openInfoPanel,aF)}}}).bind("close_node.jstree",function(aH,aG){var aF=aG.rslt.obj;aF.children("ul").children(".bd-ap-loadMore-trigger").remove()}).bind("open_node.jstree",function(aG,aF){f(aF.rslt.obj)}).bind("before.jstree",function(aG,aF){$('ul li[rel="disabled"] > a').each(function(){$(this).click(false);$(this).dblclick(false)})})},r=function(aK,aJ,aI,aH,aD,aM){var aL='<li id="{{id}}" class="{{state}}"{{#disabled}} rel="disabled"{{/disabled}}>{{^disabled}}<ins class="jstree-icon">&nbsp;</ins>{{/disabled}}<a class="bd-ap-a" href="#"><ins class="jstree-icon">&nbsp;</ins>{{title}}</a></li>',aE={title:aH.data.title,id:aH.attr.id,disabled:aH.data.disabled,state:aD===""?"jstree-leaf":(aD==="closed"?"jstree-closed":"jstree-open")},aG=Mustache.to_html(aL,aE),aF=E(aJ,aK);if(!aF.children("ul").length){aF.append("<ul/>")}aF.find("#"+aH.attr.id).remove();aF.children("ul").append(aG);if(aM){aM()}},aw=function(aJ,aI,aK){var aF,aE,aG,aH,aD=aJ.attr("id");$viewport=x();for(aF=0,aE=aI.length;aF<aE;aF++){aG=aI[aF];r($viewport,aD,"last",aG,aG.state?aG.state:"",function(){var aL=aC(aG.attr.id),aO=aJ.children("ul").children("li#"+aG.attr.id),aM=aO.children("a");if(aL){var aN=aL.type;G(aN,aM,aL);aO[0].isLoaded=true;if(aF==aE-1){if(aK){aH=aJ.find(".bd-ap-loadMore-trigger");if(aH.length>0){aJ.children("ul").append(aH)}else{aJ.children("ul").append(af)}}}}else{G("folder",aM);if(aG.metadata){aO.data(aG.metadata)}}au(aM,aL?aL:aO.data())})}},ai=function(aD){return jQuery(be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2011.ice/html/assetPicker/assetPicker.html",aD))},g=function(aE,aD){H.hide();am(aE,aD);jQuery(aE.viewSettings.target).append(H);if(aE.viewSettings.before){aE.viewSettings.before()}H.show()},aC=function(aE){try{var aD=aE.replace(e,"");aD=aD.replace(j,"");var aF=bd.assetsPicker.files[aD];return aF}catch(aG){return null}},K=function(aG){var aH=jQuery(aG);var aD=aH.find(".bd-ap-loadMore-trigger:first");if(aD.length){aD.scrollTop();var aE=aH.offset().top+aH[0].offsetHeight;var aF=aD.offset().top;if(aF<=aE){aD.trigger("click")}}return},I=false,ak=function(aP,aG,aH){if(I===true){return false}I=true;var aL=aG.find("ul.jstree-no-dots"),aO=aL.children('li:not("#'+aa+'")'),aE=aL.children("li#"+aa),aN=jQuery(aP),aF=aN.parent("li"),aI=40,aK=0,aD=10,aJ=aK+aD,aM;if(aN.attr("id")===aa){I=false;return false}if(aH||!aF.hasClass("bd-ap-accordion-active")){aM=aL.height()-aE.height()-(aI*aO.length)-aJ;v.hide();aO.removeClass("bd-ap-accordion-active").children("ul").stop().animate({height:0,padding:0},400,function(){jQuery(this).css({"overflow-y":"hidden"})});aF.addClass("bd-ap-accordion-active").children("ul").stop().animate({height:aM,margin:aK+"px 0 0","border-top":"1px solid #DDD"},400,function(){I=false;jQuery(this).css({"overflow-y":"auto"});v.css({top:aI*aF.index()}).show()})}else{I=false}return true},p=function(aG,aM){var aN=aG.find("ul.jstree-no-dots"),aD=aN.children("li"),aP=aN.children('li:not("#'+aa+'")'),aF=aN.children("li#"+aa),aI=90,aL=0,aE=10,aK=aL+aE,aO=jQuery('<span class="bd-ap-breaker" ondragstart="return false;"></span>'),aQ=40,aJ=jQuery(document),aH=function(){var aS=aN.children(".bd-ap-accordion-active").children("ul"),aR;if(aS.is(":visible")){aR=aN.height()-aQ*aP.length-aF.height()-aK;aS.css({height:aR})}};A.append(o);ay.append(b);aI=parseInt(bd.pm.model.storage.get("shortCutSectionHeight"),10);aI=isNaN(aI)?90:aI;aF.children("ul").css({height:aI});jQuery(window).unbind("resize.apAccordion").bind("resize.apAccordion",aH);aD.children("a").click(function(){var aR=jQuery(this).parent();if(aR.attr("id")===aa){return false}else{return ak(this,aG)}});if(!aM){aO.bind("mousedown.apAccordion",function(aR){aR.preventDefault();aR.returnValue=false;var aU=aR.pageY,aS=10,aT=aN.height()-aQ*aD.length-aO.height()-aS;aJ.bind("mousemove.apAccordion",function(aV){var aX=aV.pageY,aW=aU-aX;aU=aX;aI=aI+aW;aI=aI>aT?aT:aI;aI=aI<-44?-44:aI;aF.children("ul").css({height:aI});aH()}).bind("mouseleave.apAccordion",function(aV){bd.pm.model.storage.set("shortCutSectionHeight",aI);aJ.unbind("mousemove.apAccordion").unbind("mouseleave.apAccordion")}).bind("mouseup.apAccordion",function(aV){bd.pm.model.storage.set("shortCutSectionHeight",aI);aJ.unbind("mousemove.apAccordion").unbind("mouseleave.apAccordion").unbind("mouseup.apAccordion")})})}aD.each(function(aU,aV){var aR=jQuery(this);if(!aR.find("> ul").length){aR.append("<ul/>")}var aT=aR.children("ul");if(aR.attr("id")===aa){aR.prepend(aO);aT.css({"overflow-x":"hidden","overflow-y":"auto"})}else{aT.css({height:0,"overflow-x":"hidden","overflow-y":"hidden"})}var aS;aR.children("ul").bind("scroll.restoreMenu",function(aW){var aX=this;clearTimeout(aS);aS=setTimeout(function(){K(aX)},300)})})},az=function(aD,aL,aF){var aH=aD.children("ul"),aI=aH.children("li"),aG,aE,aJ,aK;for(aG=0,aE=aI.length;aG<aE;aG++){aJ=jQuery(aI[aG]);aK=aJ.attr("id")===aL?aJ:aJ.find("#"+aL);if(aK.length){if(aJ.attr("id")===aa){aJ=aH.children("li:first");aJ.removeClass("jstree-closed bd-ap-accordion-active");ak(aJ.children("a"),aD)}else{if(aF||!aJ.hasClass("bd-ap-accordion-active")){ak(aJ.children("a"),aD,aF)}}break}}},m=function(){b=bc.component.button({type:"sort",className:"bd-ap-sortDD",uid:"559-ap-sort"})},ac=function(){var aF=[{name:"Remove filters",value:"all",classname:"bd-filter-all"},{name:"Image",value:"image",classname:"bd-filter-image"},{name:"Video",value:"video",classname:"bd-filter-video"},{name:"HTML",value:"text/html",classname:"bd-filter-html"},{name:"Link",value:"link",classname:"bd-filter-link"},{name:"Text",value:"text",classname:"bd-filter-text"}],aD,aE,aG;if(bd.uiEditingOptions&&bd.uiEditingOptions.assetsPicker&&bd.uiEditingOptions.assetsPicker.filterBy){aD=bd.uiEditingOptions.assetsPicker.filterBy;for(aE in aD){aG=aD[aE];aF.push({name:aE,value:aG,classname:"bd-filter-all"})}}o=bc.component.dropdown({type:"action-select",buttonOnly:true,customeClass:"bd-ap-filterDD",uid:"55689-ap",noSelect:"true",options:aF,header:"Filter by type"});k=o[0].dropdownOptions},R=function(aD,aH){var aI=t(),aG=U.children("ul").children("li.bd-ap-accordion-active").data("repository"),aF=an(),aE={skipCount:aF.$currentLoadMoreFolder?aF.$currentLoadMoreFolder.data("skipCount"):0,event:P.search,repository:aG,orderBy:aF.currentOrderBy,order:aF.currentOrder};if(aI&&jQuery.trim(aI).length){aE.searchBy=aI}if(aH){aE.event=P.loadMore;aE.filterBy=aF.currentFilterBy}else{aE.skipCount=0;if(aF.$currentLoadMoreFolder){aF.$currentLoadMoreFolder.data("skipCount",0)}if(aD==="all"){aF.currentFilterBy="all"}else{if(aD){aF.currentFilterBy=aD;aE.filterBy=aD}else{if(aF.currentFilterBy!==""){aE.filterBy=aF.currentFilterBy}}}}bd.assetsPicker.dTrans.searchAndFilter(aE)},V=function(aF){var aE=[],aD;if(aF.folders){aE=aE.concat(aF.folders)}if(aF.files){aE=aE.concat(aF.files)}aD=[{attr:{id:y},children:aE,data:{title:"Search Result"},metadata:{path:"/SEARCHRESULT",folderid:"SEARCHRESULT",loadmore:aF.loadmore,isRoot:true,skipCount:aF.skipCount},state:"open"}];a=jQuery('<div class="bd-ap-search"></div>');a.jstree({exclude:{"metadata::path":bd.assetsPicker.generatedContentDir},plugins:["themes","json_data","ui","crrm","hotkeys"],themes:{url:bd.contextRoot+"/static/dashboard/js/lib/jstree/themes/default/style_asset.css",dots:false,icons:false},core:{animation:200},ui:{},json_data:{data:aD},crrm:{move:{check_move:function(aG){return false}}}}).bind("load_node.jstree",function(aO,aI){var aG=a.find("a"),aJ,aM,aP,aQ,aK,aH,aN,aL;for(aJ=0,aM=aG.length;aJ<aM;aJ++){aP=jQuery(aG[aJ]);aQ=aP.closest("li");folderData=aQ.data();aK=aQ.attr("id");aH=aC(aK);if(folderData&&folderData.folderid){aN="folder";if(folderData.isRoot){aQ.removeClass("jstree-closed");aP.addClass("bd-ap-root");aQ[0].isRoot=true;aQ[0].isLoaded=true}else{aQ.addClass("jstree-closed").removeClass("jstree-leaf");G(aN,aP)}if(folderData.loadmore){aQ.children("ul").append(af)}}else{if(aH){G(aH.type,aP,aH)}}au(aP,aH?aH:folderData)}a.show();p(a);az(a,"SearchResult_ap");d("searchJstree");bd.observer.notifyObserver(bd.pm.observer.searchResult,null)}).bind("select_node.jstree",function(aI,aH){var aJ=aH.rslt.obj;if(Y||(ax&&ax.length&&ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")&&aJ.hasClass("bd-ap-file"))){Y=false;al=aJ.attr("id");var aG=aJ.children("a").children(".bd-ap-preview");bd.observer.notifyObserver(P.openInfoPanel,aG)}}).bind("open_node.jstree",function(aH,aG){h(aG.rslt.obj)});a.on("click",".bd-ap-preview",function(aH){var aG=jQuery(this);if(ax&&ax.length&&!ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")){Y=true}else{Y=false;if(al===aG.closest("li").attr("id")){aG.addClass("bd-ap-closeSettingPanel")}}});if(!H.children(".bd-ap-search").length){H.append(a)}U.hide()},S=function(aH){var aG=Q(aH.openedFolderId?aH.openedFolderId:null);if(!aH||!aH.files||!aH.files.length){aG.children("a:first").removeClass("jstree-loading");return}var aD=aG.data("folderid"),aI=false,aF,aE;if(aD===ae){for(aF=0,aE=aH.files.length;aF<aE;aF++){aH.files[aF].attr.id=aH.files[aF].attr.id+e}}if(aH.skipCount===undefined||aH.skipCount===null){aG.children("ul").children(".bd-ap-loadMore-trigger").remove();aG.data("loadmore",aI)}else{aI=aH.loadmore;aG.data("skipCount",aH.skipCount);aG.data("loadmore",aH.loadmore)}aw(aG,aH.files,aI);aG.children("a:first").removeClass("jstree-loading")},z=function(aD){if(!aD||!aD.folders||!aD.folders.length){return}aw(Q(aD.openedFolderId?aD.openedFolderId:null),aD.folders,false)},i=function(){var aI=U.children("ul").children("li"),aF=null,aH,aE,aG,aD;for(aG=0,aD=aI.length;aG<aD;aG++){aE=jQuery(aI[aG]);if(aE.attr("id")!==aa){if(aE.hasClass("bd-ap-accordion-active")){T(aE,"apJstree");aH=aE;aE.children("ul").empty()}else{aE[0].isLoaded=false}}}aF=aH.data();if(an("currentFilterBy","apJstree")==="all"){bd.assetsPicker.dTrans.loadFolders({folderId:aF.folderid,skipCount:0,repository:aF.repository,event:P.openNode,orderBy:an("currentOrderBy","apJstree"),order:an("currentOrder","apJstree")})}else{bd.assetsPicker.dTrans.searchAndFilter({skipCount:0,repository:aF.repository,event:P.openNode,filterBy:an("currentFilterBy","apJstree"),orderBy:an("currentOrderBy","apJstree"),order:an("currentOrder","apJstree")})}},av=function(aI){var aJ=x().children("ul").children("li"),aF=null,aH,aE,aG,aD;for(aG=0,aD=aJ.length;aG<aD;aG++){aE=jQuery(aJ[aG]);if(aE.attr("id")!==aa){if(aE.hasClass("bd-ap-accordion-active")){T(aE,"apJstree");aH=aE;aE.children("ul").empty()}else{aE[0].isLoaded=false}}}aF=aH.data();if(aI==="all"&&a!==x()){bd.assetsPicker.dTrans.loadFolders({folderId:aF.folderid,skipCount:0,repository:aF.repository,event:P.openNode,orderBy:an("currentOrderBy","apJstree"),order:an("currentOrder","apJstree")})}else{bd.assetsPicker.dTrans.searchAndFilter({skipCount:0,repository:aF.repository,event:P[a===x()?"search":"openNode"],filterBy:aI,searchBy:t(),orderBy:an("currentOrderBy",a===x()?"searchJstree":"apJstree"),order:an("currentOrder",a===x()?"searchJstree":"apJstree")})}},au=function(aF,aE){var aD=jQuery(aF);if(!aj(aE)){aD.bind("dragstart drop",function(aG){aG.preventDefault();return false});return}aD.bdDrag({iframe:".bd-iframeContainer",helper:function(aJ){var aI,aH=U.find(".bd-ap-file .jstree-clicked"),aG=jQuery(aJ.target);if(!aH.length){aH=aG}if(aH&&aH.length){if(aH.length===1){aI=aG.text()}else{aI="Drag "+aH.length+" items"}}else{aI="Can not Drag"}return'<div style="padding-left: 10px; padding-right: 10px; overflow:hidden;  text-overflow:ellipsis;" class="bc-dnd-helper">'+aI+"</div>"},delay:200,start:function(aL,aI){var aG=[],aP=U.find(".bd-ap-file .jstree-clicked"),aO=jQuery(aL.target),aK,aJ,aM,aN,aH;if(!aP.length){aP=aO}if(aP&&aP.length){if(aP.length===1){aN=aO.parent("li");aH=aC(aN.attr("id"));aG.push(aH?aH:aN.data())}else{for(aK=0,aJ=aP.length;aK<aJ;aK++){aM=jQuery(aP[aK]);aN=aM.parent("li");aH=aC(aN.attr("id"));aG.push(aH?aH:aN.data())}}aI.helper.bdDragData={fileDataArray:aG};if(ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")){ax.find(".bd-AP-iframe-preview-cover").show()}}},stop:function(){if(ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")){ax.find(".bd-AP-iframe-preview-cover").hide()}}})},C=function(){var aD=U.find(".bd-ap-file");aD.bdDrag("clearIframeList")},ao=function(){if("localStorage" in window&&window.localStorage!==null){return true}else{return false}},w=function(aE){if(!ao()){return}var aF=localStorage[bd.selectedPortalName+aq],aD=U.find("#"+s);if(aF){aF=JSON.parse(aF);bd.assetsPicker.dTrans.getRecentlyUse({contentUId:aF.list,event:P.loadRecentlyUse})}else{if(!aD.children("ul").length){aD.append("<ul/>");$ul=aD.children("ul")}aD.children("a").removeClass("jstree-loading")}},aB=function(aI,aH){var aJ,aE,aL,aM,aD=[],aN=U.find("#"+s),aG=aN.children("ul"),aF,aK;aN.children("a").removeClass("jstree-loading");W=false;if(!ao()){return}if(!aG.length){aN.append("<ul/>");aG=aN.children("ul")}for(aJ=0;aJ<u;aJ++){aL=aI.fileDataArray.pop();if(aL){aM=aC(aL.contentUId);if(aG.children("#"+aL.contentUId+j).length){aG.children("#"+aL.contentUId+j).remove()}else{if(u-aG.children("li").length<=0){aG.children("li:last").remove()}}if(!aM&&aL.contentUId&&aL.name&&aL.path&&aL.type&&aL.thumbUrl&&aL.url&&aL.metaData){aM=aL}if(aM){r(U,s,"first",{attr:{id:aM.contentUId+j},data:{title:aM.name}},"",function(){var aQ=U.find("#"+aM.contentUId+j),aO=aQ.children("a"),aP=aM.type;G(aP,aO,aM);aQ[0].isLoaded=true;au(aO,aM)})}}else{break}}if(aH){return}setTimeout(function(){aF=aG.children("li");for(aJ=0,aE=aF.length;aJ<aE;aJ++){aL=aF[aJ];if(aL&&aL.id){aD.push(aL.id.replace(j,""))}}aD.reverse();localStorage[bd.selectedPortalName+aq]=JSON.stringify({list:aD})},300)},d=function(aD){if(aD){N=aD}},x=function(aE){var aD=aE||N;return aD==="apJstree"?U:a},q=function(aE,aG,aF){var aD=D[N];if(aF&&D[aF]){aD=D[aF]}if(aE){aD[aE]=aG}},an=function(aE,aF){var aD=D[N];if(aF&&D[aF]){aD=D[aF]}if(aE&&aD[aE]){return aD[aE]}else{return aD}},T=function(aD,aE){q("$currentLoadMoreFolder",aD,aE)},Q=function(aD){var aE,aF;if(aD){aE=x();aF=E(aD)}if(aF&&aF.length){return aF}else{return D[N].$currentLoadMoreFolder}},L=function(){a.jstree("destroy");a.removeData();a.html("");a.remove()},t=function(){var aE=ax.find(".bd-ap-search-container").find("input.bc-search-input"),aF=aE.length?aE.tokenInput("get"):[],aD="";if(aF.length){aD=aE.val()}else{aD=l.val()}return aD},X=function(aD){if(aD){if(typeof aD.stopPropagation!="undefined"){aD.stopPropagation()}else{aD.cancelBubble=true}}};preventReload=function(aG,aF){var aE=aG.view.closest("li").attr("id"),aD=$(".bd-AP-iframe-preview").attr("src")||"";if(aD.indexOf(aE)!==-1){X(aF)}};createActionDropdown=function(aE){var aF=[{name:"Show Usage",id:"showReference",classname:"bd-ap-show-usage"},{name:"Open in Content",id:"openInContent",classname:"bd-ap-open-in-content"}];if(!c){aF=aF.filter(function(aG){return aG.id!=="showReference"})}var aD=bc.component.dropdown({target:aE,type:"action-icon-div",cssClass:"bd-ap-actionDD",staticLabel:true,options:aF,wrapped:true,openLeft:true,beforeOpen:function(aG){preventReload(aG,event);toggleStatusClass(jQuery(this.getOptsParent()).closest("a"),"open")},beforeClose:function(aG){if($(event.target).hasClass("bc-triangle")){preventReload(aG,event)}var aH=this;setTimeout(function(){toggleStatusClass(jQuery(aH.getOptsParent()).closest("a"))},300)},minWidth:110,maxHeight:260,addTitle:true});bindActionDropdown(aD.view[0].dropdownOptions)},bindActionDropdown=function(aD){aD.on("click",".bd-ap-show-usage",function(){var aG=jQuery(aD[0].getOptsParent()).closest("li").attr("id"),aF=aC(aG),aH={label:"uses:"+aF.name,query:"usesuuid:"+(aG?aG:aF.name)},aE={clearInput:true};ax.find(".bd-pm-view-toggle").find(".bd-pm-pageview").click();ax.find(".bd-pm-search-container").find(".bc-search-container").trigger("onSearch",[aH,aE])});aD.on("click",".bd-ap-open-in-content",function(){var aG=jQuery(aD[0].getOptsParent()).closest("li").attr("id"),aF=aC(aG);var aE=bd.contextRoot+"/cxp-manager/"+(aF.repository==="contentRepository"?"shared-content//_":("portal-content//"+encodeURIComponent(bd.selectedPortalName)))+aF.path.replace(/\./g,"%252E");window.location.href=aE})},toggleStatusClass=function(aE,aD){if(aD==="open"){aE.addClass("bd-ap-actionDD-opened")}else{aE.removeClass("bd-ap-actionDD-opened")}},removeSpinner=function(){$(".bd-pageContainer .bd-pagesListContainer span.bi-pm-spinner").remove()},addObserver=function(aE){bd.observer.addObserver(P.init,function(aF){if(ax.hasClass("bd-assetPicker-on")){removeSpinner();g(aE,aF);bd.assetsPicker.params.isInited=true}M=false});bd.observer.addObserver(P.loadMore,function(aF){S(aF);M=false});bd.observer.addObserver(P.openNode,function(aF){if(W){E(aF.openedFolderId).children("ul").empty()}if(aF.folders){z(aF)}S(aF);M=false;W=false});bd.observer.addObserver(P.search,function(aF){if(aF.query){return}if(a){L()}V(aF);M=false});bd.observer.addObserver(P.initLoadingError,function(){removeSpinner();bd.assetsPicker.params.isInited=false;at.errorCall()});bd.observer.addObserver("bdDrop.drop.recentlyUse",function(aH){var aG=U.find("#"+s),aI,aF,aJ;if(aG.children("ul").length){aB(aH)}else{if(aG.hasClass("jstree-closed")){aI=localStorage[bd.selectedPortalName+aq];if(aI){aI=JSON.parse(aI);aI=aI.list}else{aI=[]}for(aF=0;aF<u;aF++){aJ=aH.fileDataArray.pop();if(aJ&&aJ.contentUId){if(aI.indexOf(aJ.contentUId)!==-1){aI.splice(aI.indexOf(aJ.contentUId),1)}else{if(u-aI.length<=0){aI.shift()}}aI.push(aJ.contentUId)}else{break}}localStorage[bd.selectedPortalName+aq]=JSON.stringify({list:aI});aG.children("ins.jstree-icon").trigger("click")}}M=false});bd.observer.addObserver(P.loadRecentlyUse,function(aF){aB(aF,true);M=false});bd.observer.addObserver(bd.pm.observer.cancelSearch,function(aF){M=false;delete bd.PageMgmtTree.searchActive;A.addClass("bd-ap-filter-nofilter").attr("title","Filter by: all");d("apJstree");q("currentFilterBy","all");L();U.show()});try{bd.observer.addObserver(bd.notifications.pageMgmt.STOP,function(){C()})}catch(aD){}},bindEvent=function(){U.delegate(".bd-ap-loadMore-trigger","click",function(aH){if(M){return false}else{M=true;var aG=U.children("ul").children(".bd-ap-accordion-active").children("ul"),aF=jQuery(this).parent("ul").parent("li"),aD=aF.data(),aI,aE;d("apJstree");T(aF);aE=an();jQuery(this).remove();aI=function(){if(aD){switch(aD.folderid){case ae:bd.assetsPicker.dTrans.getMyContent({skipCount:aD.skipCount,event:P.loadMore,orderBy:aE.currentOrderBy,order:aE.currentOrder});break;default:bd.assetsPicker.dTrans.loadFiles({folderId:aD.folderid,skipCount:aD.skipCount,repository:aD.repository,event:P.loadMore,orderBy:aE.currentOrderBy,order:aE.currentOrder});break}}};aG.scrollTop(aG.scrollTop()+24);aI()}});a.on("click",".bd-ap-loadMore-trigger",function(aI){if(M){return false}else{M=true;var aH=a.find("#SearchResult_ap").children("ul"),aG=jQuery(this),aF=aG.parent("ul").parent("li"),aD=aF.data(),aE;d("searchJstree");T(aF);aE=an();aG.remove();aH.scrollTop(aH.scrollTop()+30);if(aF.attr("id")==="SearchResult_ap"){R(null,true)}else{bd.assetsPicker.dTrans.loadFiles({folderId:aD.folderid,skipCount:aD.skipCount,repository:aD.repository,event:P.loadMore,orderBy:aE.currentOrderBy,order:aE.currentOrder})}}});jQuery(k).on("click","a.bc-dropdown-item",function(aF){var aE=jQuery(this),aD=aE.attr("data-value");if(M||an("currentFilterBy")===aD){return false}if(aD==="all"){A.addClass("bd-ap-filter-nofilter").attr("title","Filter by: all");q("currentFilterBy","all")}else{q("currentFilterBy",aD);A.removeClass("bd-ap-filter-nofilter").attr("title","Filter by: "+aE.text())}M=true;av(aD)});l.on("keydown.assetsPicker",function(aD){if(ax.hasClass("bd-assetPicker-on")){if(aD.which===13){aD.stopPropagation();if(!M&&t()!==""){M=true;d("searchJstree");R(an().currentFilterBy,false)}return false}}});bd.observer.addObserver("do-search",function(){if(!M&&t()!==""){M=true;d("searchJstree");R(an().currentFilterBy,false)}return false});b.on("click",function(aE){var aD=x();if(M){return false}M=true;if(aD.hasClass("bd-ap-search")){d("searchJstree");if(an("currentOrder")==="ASC"){q("currentOrder","DESC");ay.addClass("bd-ap-sortButton-DESC");ay.find("span.bi").removeClass("bi-pm-sort-asc").addClass("bi-pm-sort-desc")}else{q("currentOrder","ASC");ay.removeClass("bd-ap-sortButton-DESC");ay.find("span.bi").removeClass("bi-pm-sort-desc").addClass("bi-pm-sort-asc")}R(an("currentFilterBy","searchJstree"),false)}else{d("apJstree");if(an("currentOrder")==="ASC"){q("currentOrder","DESC");ay.addClass("bd-ap-sortButton-DESC");ay.find("span.bi").removeClass("bi-pm-sort-asc").addClass("bi-pm-sort-desc")}else{q("currentOrder","ASC");ay.removeClass("bd-ap-sortButton-DESC");ay.find("span.bi").removeClass("bi-pm-sort-desc").addClass("bi-pm-sort-asc")}i()}});if(jQuery("html").hasClass("ie8")){U.bind("dragstart drag",function(aD){aD.stopPropagation();aD.preventDefault();return false});a.bind("dragstart drag",function(aD){aD.stopPropagation();aD.preventDefault();return false})}U.on("click",".bd-ap-preview",function(aE){var aD=jQuery(this);if(ax&&ax.length&&!ax.hasClass("bd-assetPicker-on bd-pagesLayoutWide")){Y=true;$(this).addClass("bd-ap-preview-open").attr("title",F.PREVIEW_CLOSE)}else{Y=false;if(al===aD.closest("li").attr("id")){aD.addClass("bd-ap-closeSettingPanel")}$(this).removeClass("bd-ap-preview-open").attr("title",F.PREVIEW_OPEN)}});U.on("click",".bd-ap-refresh",function(aF){if(W){return}W=true;var aE=jQuery(this),aD=aE.closest("li"),aG=aD.attr("id");aE.parent("a").click();aD[0].isLoaded=false;aD.data("skipCount",0);f(aD)});a.on("click",".bd-ap-refresh",function(aF){if(W){return}W=true;var aE=jQuery(this),aD=aE.closest("li"),aG=aD.attr("id");aE.parent("a").click();aD[0].isLoaded=false;aD.data("skipCount",0);h(aD)})};return{init:Z,setThumbSize:ap,getData:aC}}())})();(function(j){var m=j.jQuery,f=j.bd||{},g=j.bc||{},i,s,k,o,a,h,p="cmis:propertyString",l="cmis:name",b="cmis:path",d=function(){k=m(".bd-ap-search-container",i);var u={tokenInputParams:{idPrefix:"token-input-ap-search",overwriteRetrieveData:function(x,w,v){x.skipCount=0;x.maxItems=10;x.searchAllVersions=false;x.includeAllowableActions=false;x.includeRelationships="none";x.orderBy="cmis:name";x.order="ASC";x.condition="cmis%3Aname+LIKE+%27%25"+encodeURIComponent(w)+"%25%27";return f.assetsPicker.dTrans.searchOnMultipleRepositories(x).then(function(z){var y=z.files.map(function(A){var B=A.attr.title;return{query:B,label:B,uuid:A.attr.id,isCmdQuery:false}});v(w,y)})}},dropdownParams:{uid:"565633",cssClass:"bd-ap-searchCmdDD",beforeOpen:function(){if(m(".bd-pageContainer",i).hasClass("bd-search-active")){return true}else{return false}}},target:k,onSearch:function(v){f.observer.notifyObserver(f.pm.observer.search,v)},onCancel:function(v){f.observer.notifyObserver(f.pm.observer.cancelSearch,v)}},t=g.component.searchTokenInput(u);h=t.$template;m(".bc-search-button",h).remove();s=m(".bc-search-icon",k);a=m(".bc-search-input",k);o=h.find(".token-input-input-token").find("input");e(h)},e=function(){s.on("click.apSearch",function(t){if(!$(t.target).hasClass("bi-pm-x")){f.observer.notifyObserver("do-search")}});f.observer.addObserver("searchResult",function(t){h.trigger("onResult",t)})},r=function(t){return[t.replace(":","\\:"),t.split(":")[1]]},q=function(v,t){var w=r(v),u=r(t);return w[0]+"[propertyDefinitionId='"+u[0]+"'] , "+w[1]+"[propertyDefinitionId='"+u[1]+"']"},n=function(t,v,u){return t.find(q(v,u)).text()};var c=function(t){i=t.oGadgetBody;d()};f.observer.addObserver(f.notifications.pageMgmt.START,c)}).call(bd.assetsPicker.view,window);