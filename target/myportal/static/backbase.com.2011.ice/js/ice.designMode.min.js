(function(f){var c=false,a=false,d='<div id="bd-dragHelper" class="bd-bddrag-dragHelper" style="display:none; z-index:99999; position:absolute;"></div>',h=f(d),i='<div id="bd-iframeCover" style="display:none; position:fixed;"></div>',g=[],j=function(l){var k={helper:h[0]};return k},b=function(m,k,l){if(m[0].contentWindow&&m[0].contentWindow.jQuery){m[0].contentWindow.jQuery(k[0]).trigger(l)}},e={init:function(k){var l=f.extend({containment:f(document),delay:20,distance:20,scope:false,addClasses:"bd-bdDrag-helper",cursorAt:[5,5],helper:"clone",iframe:null,start:function(m,n){},drag:function(m,n){},stop:function(m,n){},jstreeSupport:false},k);e.initDocumentDrag(l);e.initTargetDrag(this,l);if(l.iframe){l.iframe=f(l.iframe);e.initIframeDrag(l)}return this},destroy:function(){return this.each(function(){f(this).unbind(".bdDrag")})},stop:function(){if(settings.containment){settings.containment.trigger("mouseup.bdDrag")}return this.each(function(){this.trigger("mouseup.bdDrag")})},_getFixedPositions:function(u,w,n){var v=u[0],r=v.ownerDocument.body,s=r.offsetWidth,q=r.offsetHeight,k=v.offsetWidth,l=v.offsetHeight,o=(w.clientX+n.cursorAt[0])+r.scrollLeft,p=(w.clientY+n.cursorAt[1])+r.scrollTop,m=(o+k>s?s-k:o),t=(p+l>q?q-l:p);if(f(".bp-widget:eq(0)",v.ownerDocument).hasClass("bd-dm-clicked")){t-=parseInt(f(".bd-dm-edit-bar:eq(0)",v.ownerDocument).css("height"),10)}return{left:m,top:t}},initDocumentDrag:function(k){h[0].isShow=false;h[0].bdDragData={};f("body").append(h);k.containment.bind("mouseup.bdDrag",function(l){k.containment.trigger("c_mouseup.bdDrag",l)}).bind("c_mousemove.bdDrag",function(q,m){if(c&&!a){q.originalEvent=m;!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();var p=j(m),o,n,l;n=h[0];var r=e._getFixedPositions(h,m,k);o=n.style;o.left=r.left+"px";o.top=r.top+"px";k.drag.call(this,q,p)}}).bind("c_mouseup.bdDrag",function(n,l){f("body").removeClass("bd-all-cur-grabbing bd-link-drag-start bd-link-drag-start-jstree");if(c){e.unbindContainmentEvent(k);e.unbindIframeEvent();n.originalEvent=l;c=false;h[0].isShow=c;var m=j(l);h.hide();e.toggleIframeCoverList("hide");k.stop.call(this,n,m)}})},unbindContainmentEvent:function(k){k.containment.unbind("mousemove.bdDrag").find("body").unbind("keydown.bdDrag").unbind("c_keydown.bdDrag")},initTargetDrag:function(l,k){l.each(function(){var o=f(this),p=false;o.addClass("bd-bdDrag").bind("mousedown.bdDrag",function(q){o.trigger("c_mousedown.bdDrag",q);return !!k.jstreeSupport}).bind("mouseup.bdDrag",function(q){o.trigger("c_mouseup.bdDrag",q)}).bind("c_mousedown.bdDrag",function(r,q){if(q.which===1&&!c){r.originalEvent=q;if(!c){p=setTimeout(function(){m(q,r)},k.delay)}k.containment.bind("mousemove.bdDrag",function(s){if(!c&&n(q,s)){clearTimeout(p);m(s,r)}k.containment.trigger("c_mousemove.bdDrag",s)}).find("body").bind("keydown.bdDrag",function(s){if(s.keyCode===27){s.preventDefault();s.stopPropagation();f(this).trigger("c_keydown.bdDrag",s);return false}}).bind("c_keydown.bdDrag",function(t,s){if(c){k.iframe.contents().trigger("c_mouseup.bdDrag",s);k.containment.trigger("c_mouseup.bdDrag",s)}})}}).bind("c_mouseup.bdDrag",function(r,q){e.unbindContainmentEvent(k);if(c){k.containment.trigger("c_mouseup.bdDrag")}clearTimeout(p);h.trigger("c_deactivate.bdDrop")})});var n=function(o,p){return(Math.max(Math.abs(o.pageX-p.pageX),Math.abs(o.pageY-p.pageY))>=k.distance)},m=function(o,r){c=true;h[0].isShow=c;var p="",s;if(k.helper==="clone"){p=$this.clone()}else{if(k.helper instanceof Function){p=k.helper(r)}else{p=$this}}s=e._getFixedPositions(h,o,k);h.html("").css({top:s.top,left:s.left}).addClass(k.addClasses).append(p).show();e.toggleIframeCoverList("show",k);var q=j(o);k.start.call(this,r,q);f("body").addClass("bd-all-cur-grabbing bd-link-drag-start"+(k.jstreeSupport?" bd-link-drag-start-jstree":""))}},initIframeDrag:function(n){if(n.iframe){var m,k,o;for(m=0,k=n.iframe.length;m<k;m++){o=f(n.iframe[m]);$iframeDocument=o.contents();if($iframeDocument[0].readyState==="complete"){e.createIframeCover(o,n)}}n.iframe.unbind("load.bdDrag").bind("load.bdDrag",function(p){var l=f(this);e.createIframeCover(l,n)})}},unbindIframeEvent:function(){var o,k,p,n,m;for(n=0,m=g.length;n<m;n++){p=g[n];o=p.iframe;k=o.contents();o.data("hasEvent",false);k.unbind("mouseenter.bdDrag").unbind("mouseup.bdDrag").unbind("mouseleave.bdDrag").unbind("mousemove.bdDrag").unbind("c_mouseenter.bdDrag").unbind("c_mouseup.bdDrag").unbind("c_mousemove.bdDrag").unbind("c_mouseleave.bdDrag").unbind("keydown.bdDrag").unbind("c_keydown.bdDrag")}},bindIframeEvent:function(n,l){var k=n.contents(),m=k.find("body");if(!m.find("#bd-dragHelper").length){$iframeHelper=f(d);$iframeHelper[0].isShow=false;$iframeHelper[0].bdDragData={};m.append($iframeHelper)}else{$iframeHelper=m.find("#bd-dragHelper")}k.bind("mouseenter.bdDrag",function(o){k.trigger("c_mouseenter.bdDrag",o)}).bind("mousemove.bdDrag",function(o){k.trigger("c_mousemove.bdDrag",o)}).bind("mouseup.bdDrag",function(o){k.trigger("c_mouseup.bdDrag",o)}).bind("mouseleave.bdDrag",function(o){k.trigger("c_mouseleave.bdDrag",o)}).bind("c_mouseenter.bdDrag",function(p,o){if(c&&a){b(n,$iframeHelper,"c_activate.bdDrop")}}).bind("c_mouseup.bdDrag",function(q,o){var p;if(c&&a){e.unbindContainmentEvent(l);e.unbindIframeEvent();q.originalEvent=o;c=false;a=false;h[0].isShow=c;if($iframeHelper.length){$iframeHelper[0].isShow=a;$iframeHelper.hide();b(n,$iframeHelper,"c_deactivate.bdDrop")}p=j(o);l.stop.call(this,q,p)}}).bind("c_mousemove.bdDrag",function(r,o){var q,s,p;if(c&&a){!+"\v1"?document.selection.empty():window.getSelection().removeAllRanges();r.originalEvent=o;q=j(o);if($iframeHelper.length){$iframeHelper[0].isShow=a;p=$iframeHelper[0].style;s=e._getFixedPositions($iframeHelper,o,l);p.left=s.left+"px";p.top=s.top+"px"}l.drag.call(this,r,q)}}).bind("c_mouseleave.bdDrag",function(q,o){var p,r;if(c&&a&&!o.relatedTarget){q.originalEvent=o;a=false;h[0].isShow=true;f("body").addClass("bd-all-cur-grabbing");if($iframeHelper.length){$iframeHelper.hide();$iframeHelper[0].isShow=a;p=$iframeHelper[0].style;r=e._getFixedPositions($iframeHelper,o,l);p.left=r.left+"px";p.top=r.top+"px"}b(n,$iframeHelper,"c_deactivate.bdDrop");e.toggleIframeCoverList("show")}}).bind("keydown.bdDrag",function(o){if(o.keyCode===27){k.trigger("c_keydown.bdDrag",o)}}).bind("c_keydown.bdDrag",function(p,o){if(c){if(a){o.preventDefault()}k.trigger("c_mouseup.bdDrag",o);l.containment.find("body").trigger("c_mouseup.bdDrag",o)}})},toggleIframeCoverList:function(o,n){var m,k,s,r,q,p;for(m=0,k=g.length;m<k;m++){s=g[m];r=s.iframe;q=s.iframeCover;if(o==="hide"){q.hide()}else{if(n&&!r.data("hasEvent")){r.data("hasEvent",true);e.bindIframeEvent(r,n)}p=r.offset();q.css({width:r.width(),height:r.height(),top:p.top,left:p.left}).show()}}},createIframeCover:function(p,l){p.data("hasEvent",false);if(p.attr("data-forIframeCover")){return}var o=f(i),n=p.offset(),m=f("body"),k=new Date().getTime()+Math.floor((Math.random()*1000)+1);o.css({width:p.width(),height:p.height(),top:n.top,left:n.left}).attr({id:"bd-iframeCover-"+k,"data-forIframe":k}).bind("mouseenter.bdDrag",function(x){var s=p.contents(),y=f(this).offset(),t=x.clientX-y.left,q=x.clientY-y.top,v=x.pageX-y.left,u=x.pageY-y.top,r,z,w;x.pageX=v;x.pageY=u;x.clientX=t;x.clientY=q;if(c&&!a){a=true;h[0].isShow=false;$iframeHelper=s.find("#bd-dragHelper");if($iframeHelper.length){$iframeHelper.html(h.html());$iframeHelper[0].bdDragData=h[0].bdDragData;$iframeHelper[0].isShow=a;z=$iframeHelper[0];r=z.style;fixedPositions=e._getFixedPositions($iframeHelper,x,l);r.left=fixedPositions.left+"px";r.top=fixedPositions.top+"px";r.display="block";f("body").removeClass("bd-all-cur-grabbing");h.hide()}}e.toggleIframeCoverList("hide")});p.attr("data-forIframeCover",k);p.after(o);g.push({iframeCover:o,iframe:p})},clearIframeList:function(){var l,k=true;while(k){l=g.pop();if(l&&l.iframeCover){l.iframeCover.remove()}else{k=false}}}};f.fn.bdDrag=function(k){if(e[k]){return e[k].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof k==="object"||!k){return e.init.apply(this,arguments)}else{f.error("Method "+k+" does not exist on jQuery.bdDrag")}}}})(jQuery);(function(c){var d,a=function(h,f){var g={helper:d,dropIndicator:f.dropIndicator};return g},b={init:function(e){var f=c.extend({scope:false,accpet:"bd-bdDrag",dropIndicator:null,activate:function(g,h){},deactivate:function(g,h){},enter:function(g,h){},leave:function(g,h){},drop:function(g,h){},over:function(g,h){},out:function(g,h){},move:function(g,h){}},e);if(f.dropIndicator!==null){f.dropIndicator=c(f.dropIndicator)}b.initTargetDrop(this,f);b.initEventForActive(this,f);return this},destroy:function(){return this.off(".bdDrop").removeAttr("onc_mouseenter onc_mouseleave onc_mouseover onc_mouseout onc_activate onc_deactivate onc_drop onc_mousemove onc_mouseup sizset sizcache").removeClass("bd-bdDrop")},initTargetDrop:function(g,f){var e=null;g.addClass("bd-bdDrop").on("mouseenter.bdDrop",function(h){c(this).trigger("c_mouseenter.bdDrop",h)}).on("mouseleave.bdDrop",function(h){c(this).trigger("c_mouseleave.bdDrop",h)}).on("mouseup.bdDrop",function(h){c(this).trigger("c_mouseup.bdDrop",h)}).on("c_mouseenter.bdDrop",function(j,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);j.target=h.target;if(c.contains(this,h.target)&&!c(this).data("isInside")){c(this).data("isInside",true);f.enter.call(this,j,i)}else{if(h.target===this&&!c(this).data("isInside")){if(h.relatedTarget&&h.relatedTarget!=h.target){f.enter.call(this,j,i)}else{if(h.relatedTarget&&c.contains(this,h.relatedTarget)!==true){f.enter.call(this,j,i)}else{f.enter.call(this,j,i)}}c(this).data("isInside",true)}}return}}).on("c_mouseleave.bdDrop",function(k,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){k.originalEvent=h;var j=a(h,f),i=h.relatedTarget||h.toElement;if(i&&c.contains(this,i)&&!c(i).hasClass("bd-bdDrop")){return false}else{if(h.target===d||i===d||c.contains(d,i)){return false}}c(this).data("isInside",false);f.leave.call(this,k,j);return}}).on("c_mouseup.bdDrop",function(k,h){d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){k.originalEvent=h;var j=a(h,f);c(this).data("isInside",false);if(c(".jstree-invalid",d).length>0){f.leave.call(this,k,j);return}f.drop.call(this,k,j);f.deactivate.call(this,k,j);try{bd.observer.notifyObserver("bdDrop.drop.recentlyUse",j.helper.bdDragData)}catch(i){}}}).on("mousemove.bdDrop",function(h){c(this).trigger("c_mousemove.bdDrop",h)}).on("c_mousemove.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.move.call(this,j,i)}}).on("mouseover.bdDrop",function(h){c(this).trigger("c_mouseover.bdDrop",h)}).on("c_mouseover.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.over.call(this,j,i)}}).on("mouseout.bdDrop",function(h){c(this).trigger("c_mouseout.bdDrop",h)}).on("c_mouseout.bdDrop",function(j,h){if(!d){d=document.getElementById("bd-dragHelper")}if(d&&d.isShow){j.originalEvent=h;var i=a(h,f);f.out.call(this,j,i)}}).on("c_activate.bdDrop",function(h){h.stopPropagation();h.preventDefault();d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&d.isShow){var i=a(h,f);f.activate.call(this,h,i)}return false}).on("c_deactivate.bdDrop",function(h){h.stopPropagation();h.preventDefault();d=this.ownerDocument.getElementById("bd-dragHelper");if(d&&!d.isShow){c(this).data("isInside",false);var i=a(h,f);f.deactivate.call(this,h,i)}return false})},initEventForActive:function(g,e){var f=c("body");if(!f.data("hasActivateEvent")){f.data("hasActivateEvent",true);f.on("c_activate.bdDrop",function(h){f.addClass("bd-all-cur-grabbing");f.find(".bd-bdDrop").trigger("c_activate.bdDrop")}).on("c_deactivate.bdDrop",function(h){f.removeClass("bd-all-cur-grabbing");f.find(".bd-bdDrop").trigger("c_deactivate.bdDrop")})}}};c.fn.bdDrop=function(e){if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return b.init.apply(this,arguments)}else{c.error("Method "+e+" does not exist on jQuery.bdDrop")}}}})(jQuery);(function(){if(!window.be){window.be={}}var d=100000;var c=function(){return bd&&bd.contextRoot!==undefined?bd.contextRoot:b$&&b$.portal&&b$.portal.config.serverRoot!==undefined?b$.portal.config.serverRoot:""};var a=function(e){return e?e:"contentRepository"};var b=function(e){return c()+"/content/atom/"+a(e)+"/"};be.iceWidgetImageMetaData={metaDataList:{"bb:altText":"alt","bb:title":"title","bb:subTitle":"data-subtitle"}};be.commonContentUtils=(function(){var f=function(p){var m=[];for(var l=0,j=p.oGadget.model.preferences.array.length;l<j;l++){var k="",n=p.oGadget.model.preferences.array[l];try{k=n.dataType.name}catch(o){}if(k=="contentRef"&&n.value){m.push(n)}}return m};var g=function(i,j){j=j||be.iceWidgetImageMetaData.metaDataList;var l={};for(var m in j){if(i[m]){var k=j[m];l[k]=i[m].property===null?"":i[m].property}}return l};var h=function(j){var i=c()+(j?"/proxy?pipe=mustachePipe&clearCacheRef="+j:"/proxy/clear_ptc_cache?cacheId=mustache-cache");be.utils.ajax({url:i,cache:false,success:function(k){},error:function(k){}})};var e=function(j){var i=c()+"/proxy/clear_ptc_cache";be.utils.ajax({url:i,success:function(k){if(typeof j==="function"){j()}},error:function(k){}})};return{getSrcRefs:f,returnMetaData:g,cleanMusCache:h,cleanPTCCache:e}}());be.cmis=(function(K){var r=0,x=750,n=!jQuery("html").hasClass("ie10minus"),R=top&&top.be&&top.be.utils&&top.be.utils.alert?top.be.utils.alert:be&&be.utils&&be.utils.alert?be.utils.alert:function(){};var t=function(Z,ab,V,Y){try{if(!Z){Z="/Generated content"}var W;var aa=Z.indexOf("?versionLabel=");if(aa!==-1){var U=Z.substring(aa+14,Z.length);Z=Z.substring(0,aa);W=b(Y)+"query?q=SELECT+*+FROM+cmis:document+WHERE+cmis:path='"+Z+"'+AND+cmis:versionLabel='"+U+"'&searchAllVersions=true"}else{W=b(Y)+"path/?path="+Z+"&filter=cmis:objectId,cmis:name&includeAllowableActions=false"}be.utils.ajax({url:W,dataType:"xml",success:function(ae){r=0;if(ae!==null){var ad=H(ae);var ac={id:ad["cmis:objectId"].property,name:ad["cmis:name"].property};ab(ac)}},error:function(ac){if(ac.status==404){if(V){V(Z)}}else{r++;E()}}})}catch(X){console.log("bd.cmis.getRootFolderId > "+X)}};var m=function(U){F(U&&U.fileName,function(){Q(U)},100)};var Q=function(X){try{X.repository=X.repository||"contentRepository";var W=function(Y){o(Y,X)},U=function(){X.isCreateContent=true;k(X)};if(!X.path){X.path="/Generated content/"+b$.portal.portalName+"/"+b$.portal.pageName}t(X.path,W,U)}catch(V){console.log(V)}};var o=function(Y,aa){var W=function(ac){var ag=false,ab=new Date();if(aa.objectType==null){aa.objectType="cmis:document"}var ad=[{key:"cmis:createdBy",value:bd.loggedInUserId||b$.portal.loggedInUserId},{key:"cmis:lastModifiedBy",value:bd.loggedInUserId||b$.portal.loggedInUserId},{key:"cmis:objectTypeId",value:aa.objectType}];if(aa.properties){$.each(aa.properties,function(ai,aj){var ah=q(ai,aj,x);ad.push({key:ai,value:ah})})}ab=be.utils.ISODateString(ab);var ae={uniqueId:aa.fileName,fileName:aa.fileName,mediatype:aa.type,timeStamp:ab,properties:ad};if(aa.type.indexOf("text")!=-1){ag=true}if(aa.content!=null){var af=$.base64.encode(aa.content,ag);ae.base64DocumentContent=af;ae.create=true}return be.utils.processHTMLTemplateByUrl(c()+"/static/backbase.com.2011.ice/xml/cmis/xhtml-post.xml",ae)},Z=function(ac){if(ac!=null){var ab=H(ac);if(aa.successCallback){X=b(aa.repository)+"content/"+ab["cmis:name"].property+"?id="+ab["cmis:objectId"].property;ab.url={property:X,displayName:"URL"};var ad=O(ac,X);ab.thumbUrl={property:ad,displayName:"Thumbnail URL"};aa.successCallback(ab)}}},V=function(ab){if(ab.status==409){if(aa.path){top.bd.observer.notifyObserver(top.bd.pm.observer.contentLocked);aa.path=aa.path+"/"+aa.fileName;J(aa)}}else{E()}if(aa.errorCallback){aa.errorCallback()}},U=Y.id;if(U!=false){var X=b(aa.repository)+"children?id="+U+"&overwriteFlag=true";be.utils.ajax({url:X,data:W(Y),dataType:"xml",type:"POST",encodeURI:false,success:Z,error:V})}else{console.log("bd.cmis.saveNewContent > unable to get root folder id")}};var k=function(X){var U=[],V,Z,Y=function(aa){if(aa!="/"){V=aa.lastIndexOf("/");U.push(aa.substring(V+1,aa.length));aa=aa.slice(0,V);if(aa==""){aa="/"}t(aa,function(ab){V=U.length-1;W(ab.id)},Y)}},W=function(aa){if(V<0){if(X.isCreateContent){Q(X)}return}Z={folderId:aa,folderName:U[V],successCallback:W,errorCallback:W};V--;h(Z)};if(X.path){Y(X.path)}};var A=function(W){try{W.repository=W.repository||"contentRepository";if(W.fileId){U(W.fileId,W)}else{t(W.path,function(X){U(X.id,W)})}}catch(V){console.log(V)}function U(X,ad){var Y=new Date();Y=be.utils.ISODateString(Y);var aa=[{key:"cmis:name",value:ad.newName}];var ab={rename:true,uniqueId:"00000000-0000-0000-0000-00000000000",timeStamp:Y,fileName:ad.newName,properties:aa};var ac=be.utils.processHTMLTemplateByUrl(c()+"/static/backbase.com.2011.ice/xml/cmis/xhtml-post.xml",ab);var Z=b(ad.repository)+"entry?id="+X;be.utils.ajax({url:Z,data:ac,dataType:"xml",type:"PUT",contentType:"application/atom+xml;type=entry",success:function(ae){if(ad.successCallback){ad.successCallback()}},error:function(ae){if(ae.responseText.indexOf("exists")!=-1){bc.component.notify({uid:"8735",icon:"error",message:ad.newName+" already exists. Please use a different name."})}else{E()}if(ad.errorCallback){ad.errorCallback()}}})}};var f=function(V){try{V.repository=V.repository||"contentRepository";t(V.to,function(X){var W=X.id;if(W!=false){t(V.from,function(Z){var Y=Z.id;if(V.type=="folder"){t(V.object,function(aa){V.object=aa.id;B(Y,W,V)})}else{B(Y,W,V)}})}else{console.log("bd.cmis.moveTo > unable to get object id")}})}catch(U){console.log(U)}};var B=function(X,U,ab){if(X!=false){var V=new Date();V=be.utils.ISODateString(V);var Y=[{key:"cmis:objectId",value:ab.object}];var Z={move:true,uniqueId:"00000000-0000-0000-0000-00000000000",timeStamp:V,properties:Y};var aa=be.utils.processHTMLTemplateByUrl(c()+"/static/backbase.com.2011.ice/xml/cmis/xhtml-post.xml",Z);var W=b(ab.repository)+"children?id="+U+"&sourceFolderId="+X;be.utils.ajax({url:W,data:aa,dataType:"xml",type:"POST",contentType:"application/atom+xml;type=entry",success:function(ad){if(ad!=null){var ac=H(ad);contentId=ac["cmis:objectId"].property}if(ab.successCallback){ab.successCallback(ab.fileName)}},error:function(ac){if(ac.responseText.indexOf("exists")){if(ab.errorCallback){ab.errorCallback(ab.fileName)}}else{E()}}})}else{console.log("bd.cmis.moveTo > unable to get object id")}};var h=function(Z){try{var U=new Date();U=be.utils.ISODateString(U);var X={uniqueId:be.utils.trimString(Z.folderName),folderName:be.utils.trimString(Z.folderName),user:bd.loggedInUserId||b$.portal.loggedInUserId,timeStamp:U};var Y=be.utils.processHTMLTemplateByUrl(c()+"/static/backbase.com.2011.ice/xml/cmis/xhtml-createFolder.xml",X);var V=function(aa){if(aa!=false){var ab=b(Z.repository)+"children?id="+aa+"&overwriteFlag=true";be.utils.ajax({url:ab,data:Y,dataType:"xml",type:"POST",success:function(ad){if(ad!=null){var ac=H(ad);var ae=ac["cmis:objectId"].property}if(Z.successCallback){Z.successCallback(ae)}},error:function(ac){if(ac.status==500){E()}if(Z.errorCallback){Z.errorCallback()}}})}else{console.log("create folder fail.")}};if(Z.folderId){V(Z.folderId)}else{t(Z.path,function(ab){var aa=ab.id;V(aa)},null,Z.repository)}}catch(W){console.log(W)}};var p=[];var F=function(V,W,U){if(V){if(p[V]){window.clearTimeout(p[V])}p[V]=setTimeout(W,U)}};var J=function(U){F(U&&U.fileName,function(){P(U)},100)};var P=function(U){if(U.ContentUid){U.content==null?C(U):I(U)}else{t(U.path,function(V){U.ContentUid=V.id;U.content==null?C(U):I(U)})}};var I=function(X){try{var W=X.repository||"contentRepository";var U=b(X.repository)+"content?id="+X.ContentUid+"&overwriteFlag=true";return be.utils.ajax({url:U,data:X.content,type:"PUT",contentType:X.type,success:function(Y){C(X);if(X.successCallback){X.successCallback({contentRef:W+":"+X.ContentUid})}},error:function(Y){if(Y.responseText.indexOf("Object Not found")!=-1){be.utils.alert({message:"Unable update content, the content doesn't exist."})}else{if(Y.status===409){top.bd.observer.notifyObserver(top.bd.pm.observer.contentLocked)}else{E()}}if(X.errorCallback){X.errorCallback()}}})}catch(V){console.log(V)}return false};var C=function(X){var U=[],V={timeStamp:be.utils.ISODateString(new Date()),lastModifiedBy:bd.loggedInUserId||b$.portal.loggedInUserId};if(X.properties){$.each(X.properties,function(Z,aa){var Y=q(Z,aa,x);U.push({key:Z,value:Y})});if(U.length>0){V.properties=U}}var W=be.utils.processHTMLTemplateByUrl(c()+"/static/backbase.com.2011.ice/xml/cmis/xhtml-put.xml",V);return K.cmis.updateProperty(X.ContentUid,W,null,null,X.repository).then(X.successCallback,X.errorCallback)};var g=function(X){var W=null;try{var U=b(X.repository)+"content?id="+X.contentUid;be.utils.ajax({url:U,dataType:"html",cache:bd.designMode=="true"?false:true,success:function(Y,aa,Z){r=0;if(Y!=null){W=Y;if(X.successCallback){X.successCallback(W)}}},error:function(Y){if(Y.responseText.indexOf("null")!=-1){W="Error: The Content doesn't exist."}else{r++;E()}}})}catch(V){console.log(V)}};var G=function(U){t(U.path,function(V){U.contentUid=V.id;if(U.callback){U.successCallback=U.callback}g(U)})};var e=function(X){try{var U=c()+"/proxy?pipe=mustachePipe&contentPath="+X.path,W="";be.utils.ajax({url:U,dataType:"html",success:function(Y,aa,Z){r=0;if(Y!=null){W=Y;if(X.successCallback){X.successCallback(W)}}},error:function(Y){if(Y.responseText.indexOf("null")!=-1){W="Error: The Content doesn't exist."}else{r++;E()}if(X.errorCallback){X.errorCallback(W)}}})}catch(V){console.log(V)}};var z=function(Z){var af=[];try{var ae=Z.maxItem==null?d:Z.maxItem;var V=Z.skipCount==null?0:Z.skipCount;var ad="cmis%3AlastModificationDate",Y="DESC",ac="",X="+WHERE+";if(Z.condition){X+=Z.condition}else{X="+WHERE"}if(Z.folderId){X+="+cmis%3AparentId+%3D+%27"+Z.folderId+"%27"}if(Z.searchType&&Z.searchType!=""){ac="+AND+cmis%3AcontentStreamMimeType+like+%27%25"+Z.searchType+"%25%27";X+=ac}if(Z.orderBy){ad=Z.orderBy}if(Z.order){Y=Z.order}if(X=="+WHERE"){X=""}X+="+ORDER+BY+"+ad+"+"+Y;var aa=Z.collection||"cmis%3Adocument";var ab="SELECT+*+FROM+"+aa+X+"&&searchAllVersions=false&includeAllowableActions=false&includeRelationships=source&maxItems="+ae+"&skipCount="+V;var U=b(Z.repository)+"query?q="+ab;be.utils.ajax({url:U,dataType:"xml",encodeURI:false,cache:false,success:function(ag,ai,ah){jQuery(ag).find("atom\\:entry, entry").each(function(an,au){var ar=H(au);var aq=N(au);var ap=D(au);if(ar["cmis:contentStreamMimeType"]!==undefined){var am=ar["cmis:name"].property;var ak=ar["cmis:objectId"].property;var at=ar["cmis:contentStreamMimeType"].property?ar["cmis:contentStreamMimeType"].property:ar["cmis:objectTypeId"].property;var aj=b(Z.repository)+"content?id="+ak;var ao=O(au,aj);var al={metaData:ar,name:am,url:aj,thumbUrl:ao,contentUId:ak,type:at,path:ar["cmis:path"].property,iconWidth:aq.width,iconHeight:aq.height,repository:a(Z.repository),relationships:ap};af.push(al)}});if(Z.successCallback){Z.successCallback((af.length>0)?af:null)}},error:function(ag){E();if(Z.errorCallback){Z.errorCallback(null)}}})}catch(W){console.log(W)}};var l=function(V,U,X,aa){var W=[];try{var Y=b(aa)+"versions?versionSeries="+V;be.utils.ajax({url:Y,dataType:"xml",encodeURI:false,cache:n,success:function(ab,ad,ac){jQuery(ab).find("atom\\:entry, entry").each(function(ai,ao){var am=H(ao);console.log(am);if(am["cmis:contentStreamMimeType"]!==undefined){var ag=am["cmis:lastModifiedBy"].property;var af=am["cmis:objectId"].property;var an=am["cmis:contentStreamMimeType"].property;var aj=am["cmis:lastModificationDate"].property;var ah=am["cmis:versionLabel"].property;var ap=am["cmis:path"].property;var ae=b(aa)+"content?id="+af;var ak=O(ao,ae);var al={publishState:am["bb:publishState"].property,isLatestMajorVersion:am["cmis:isLatestMajorVersion"].property,isLatestVersion:am["cmis:isLatestVersion"].property,isMajorVersion:am["cmis:isMajorVersion"].property,url:ae,path:ap,versionLabel:ah,thumbUrl:ak,contentUId:af,type:an,modifiedBy:ag,modifiedDate:aj};W.push(al)}});if(U){U((W.length>0)?W:null)}},error:function(ab){E()}})}catch(Z){console.log(Z)}};var w=function(Z){var ad=[],ac=[],af=[],Y="",X="",ab=Z&&Z.searchBy?true:false,V=0,aa=d;if(Z&&Z.orderBy&&Z.order){Y="+ORDER+BY+"+Z.orderBy+"+"+Z.order}if(Z&&Z.condition){X="+WHERE+"+Z.condition}if(Z&&Z.skipCount){V=Z.skipCount}if(Z&&Z.maxItems){aa=Z.maxItems}var ae="SELECT+*+FROM+cmis%3Afolder"+X+Y+"&searchAllVersions=false&includeAllowableActions=false&includeRelationships=none&maxItems="+aa+"&skipCount="+V;try{var U=b(Z.repository)+"query?q="+ae;be.utils.ajax({url:U,dataType:"xml",encodeURI:false,cache:false,success:function(ag,ai,ah){jQuery(ag).find("atom\\:entry, entry").each(function(ak,al){var aj=H(al);if(!ad[aj["cmis:parentId"].property]){ac.push(aj);ad[aj["cmis:parentId"].property]=ac;ac=[]}else{ad[aj["cmis:parentId"].property].push(aj)}});if(ab){af=u(ad,Z.repository)}else{af=v(ad[""],ad,Z.repository)}af=(af.length>0)?af:null;if(Z.successCallback){Z.successCallback(af)}},error:function(ag){E();if(Z.errorCallback){Z.errorCallback(null)}}})}catch(W){console.log(W)}};var v=function(ab,ad,ac){var af=[];if(!ab){return af}else{for(var aa=0;aa<ab.length;aa++){var Z=ab[aa];var U=v(ad[Z["cmis:objectId"].property],ad,ac);var Y=Z["cmis:objectId"].property;if(Z["cmis:path"].property=="/"&&ac==="contentRepository"){var V="Shared Content";var X="ROOT"}else{if(Z["cmis:path"].property=="/"){var V="Portal Content";var X=Y}else{var V=Z["cmis:name"].property;var X=Y}}var ae={path:Z["cmis:path"].property,folderid:Y,type:Z["cmis:objectTypeId"].property,repository:ac};var W={attr:{id:X},metadata:ae,data:{title:V}};if(U.length>0){W.state="closed";W.children=U}af.push(W)}}return af};var u=function(V,Z){var U,W,ac,ab,ad=[],aa,ae;for(var af in V){if(V.hasOwnProperty(af)){W=V[af];for(var Y=0,X=W.length;Y<X;Y++){U=W[Y];if(U["cmis:path"].property=="/"&&Z==="contentRepository"){aa="Shared Content";ae="ROOT"}else{if(U["cmis:path"].property=="/"){aa="Portal Content"}else{aa=U["cmis:name"].property}}ac={attr:{id:ae?ae:U["cmis:objectId"].property},metadata:{path:U["cmis:path"].property,folderid:U["cmis:objectId"].property,type:U["cmis:objectTypeId"].property,repository:Z},data:{title:aa?aa:U["cmis:name"].property},state:"closed",metaData:U};ad.push(ac)}}}return ad};var O=function(V,U){var W=jQuery(V).find("cmis\\:rendition, rendition").find("cmis\\:streamId, streamId").text();if(W){U=U+"&streamId="+W}else{jQuery(V).find("atom\\:link, link").each(function(X,Y){if(jQuery(Y).attr("rel")=="alternate"){U=jQuery(Y).attr("href")}})}return U};var H=function(V){var U={};jQuery(V).find("cmisra\\:object > cmis\\:properties, properties").children().each(function(W,X){U[jQuery(X).attr("propertyDefinitionId")]={property:jQuery(X).find("cmis\\:value, value").text(),displayName:jQuery(X).attr("displayName")}});return U};var N=function(V){var U={};jQuery(V).find("cmis\\:rendition, rendition").children().each(function(W,X){U[X.tagName.split(":")[1]]=X.firstChild.data});return U};var D=function(V){var U={};jQuery(V).find("cmisra\\:object > cmis\\:relationship, relationship").each(function(X,Y){var W=jQuery(Y).find('cmis\\:properties > cmis\\:propertyId[propertyDefinitionId="cmis\\:objectId"] > cmis\\:value, properties').text();U[W]={};jQuery(Y).find("cmis\\:properties, properties").children().each(function(Z,aa){U[W][jQuery(aa).attr("propertyDefinitionId")]=jQuery(aa).find("cmis\\:value, value").text()})});return U};var j=function(X){try{var V;if(X.objectId){V=b(X.repository)+"entry?id="+X.objectId+"&allVersions=true";U(V,X)}else{t(X.path,function(Z){var Y=Z.id;if(Y!=false){V=b(X.repository)+"descendants?id="+Y+"&allVersions=true&unfileObjects=delete&continueOnFailure=true";U(V,X)}})}}catch(W){console.log(W)}function U(Y,Z){be.utils.ajax({url:Y,type:"DELETE",success:function(aa){if(Z.successCallback){Z.successCallback()}},error:function(aa){if(Z.errorCallback){Z.errorCallback()}if(aa.responseText.indexOf("objectNotFound")!=-1){}else{E()}}})}};var M=function(Z,aa){var V="",X;try{if(Z.contentUid){V=b(Z.repository)+"entry?id="+Z.contentUid+"&includeAllowableActions=false"}else{Z.path=L(Z.path);var Y=Z.path.indexOf("?versionLabel=");if(Y!==-1){var U=Z.path.substring(Y+14,Z.path.length);Z.path=Z.path.substring(0,Y);V=b(Z.repository)+"query?q=SELECT+*+FROM+cmis:document+WHERE+cmis:path='"+Z.path+"'+AND+cmis:versionLabel='"+U+"'&searchAllVersions=true"}else{V=b(Z.repository)+"path/?path="+Z.path+"&includeAllowableActions=false"}}if(Z.filter){V+="&filter="+Z.filter.join(",")}be.utils.ajax({url:V,encodeURI:Z.path?false:true,dataType:"xml",cache:bd.designMode=="true"||Z.cache===false?false:true,success:function(ac){if(ac!=null){var ab=H(ac);if(!ab["cmis:name"]){aa(ab)}else{V=b(Z.repository)+"content/"+L(ab["cmis:name"].property)+"?id="+ab["cmis:objectId"].property;ab.url={property:V,displayName:"URL"};var ad=O(ac,V);ab.thumbUrl={property:ad,displayName:"Thumbnail URL"}}}aa(ab)},error:function(ab){if(ab.responseText.indexOf("objectNotFound")!=-1||ab.responseText.indexOf("Object Not found")!=-1){if(Z.errorCallback){Z.errorCallback()}}else{E()}}})}catch(W){console.log("bd.cmis.getMetaData > "+W)}};var i=function(X,W){var U=null;var V=null;t(X,function(Y){U=b(W)+"content/"+Y.name+"?id="+Y.id;V={name:Y.name,url:U}});return V};var T=function(U,X){var V=b(X)+"type?id="+U;try{be.utils.ajax({url:V,dataType:"xml",success:function(Y){if(Y!=null){}callback(properties)},error:function(Y){if(Y.responseText.indexOf("objectNotFound")!=-1||Y.responseText.indexOf("Object Not found")!=-1){if(params.errorCallback){params.errorCallback()}}else{E()}}})}catch(W){console.log("bd.cmis.getUpdatability > "+W)}};var E=function(){if(r<=1){var U=R({message:"An unexpected error has occurred with the CMIS server.",title:"CMIS Server Error"})}};var L=function(U){return encodeURIComponent(U)};var q=function(V,W,U){var X=W;if(X.length>U){s(V,U)}return X.slice(0,U)};var s=function(V,U){setTimeout(function(){bc.component.notify({uid:"1231",icon:"attention",message:"Maximum is "+U+" characters for "+V,delay:2000})},10)};var y=function(Z,ab,V,Y){try{if(!Z){Z="/Generated content"}var W;var aa=Z.indexOf("?versionLabel=");if(aa!==-1){var U=Z.substring(aa+14,Z.length);Z=Z.substring(0,aa);W=b(Y)+"query?q=SELECT+*+FROM+cmis:document+WHERE+cmis:path='"+Z+"'+AND+cmis:versionLabel='"+U+"'&searchAllVersions=true&includeRelationships=source"}else{W=b(Y)+"path/?path="+Z+"&includeAllowableActions=false&includeRelationships=source"}be.utils.ajax({url:W,dataType:"xml",encodeURI:false,success:function(ad){r=0;var ac=[];jQuery(ad).find("atom\\:entry, entry").each(function(ai,ao){var am=H(ao);var al=N(ao);var ak=D(ao);if(am["cmis:contentStreamMimeType"]!==undefined){var ah=am["cmis:name"].property;var af=am["cmis:objectId"].property;var an=am["cmis:contentStreamMimeType"].property?am["cmis:contentStreamMimeType"].property:am["cmis:objectTypeId"].property;var ae=b(Y)+"content?id="+af;var aj=O(ao,ae);var ag={metaData:am,name:ah,url:ae,thumbUrl:aj,contentUId:af,type:an,path:am["cmis:path"].property,iconWidth:al.width,iconHeight:al.height,repository:a(Y),relationships:ak};ac.push(ag)}});ab(ac)},error:function(ac){if(ac.status==404){if(V){V(Z)}}else{r++;E()}}})}catch(X){console.log("bd.cmis.getRootFolderId > "+X)}};var S=function(Y,Z,U,X){try{var V=b(X)+"entry/?id="+Y+"&includeAllowableActions=false&includeRelationships=source";be.utils.ajax({url:V,dataType:"xml",encodeURI:false,success:function(aa){r=0;jQuery(aa).find("atom\\:entry, entry").each(function(af,al){var aj=H(al);var ai=N(al);var ah=D(al);if(aj["cmis:contentStreamMimeType"]!==undefined){var ae=aj["cmis:name"].property;var ac=aj["cmis:objectId"].property;var ak=aj["cmis:contentStreamMimeType"].property?aj["cmis:contentStreamMimeType"].property:aj["cmis:objectTypeId"].property;var ab=b(X)+"content?id="+ac;var ag=O(al,ab);var ad={metaData:aj,name:ae,url:ab,thumbUrl:ag,contentUId:ac,type:ak,path:aj["cmis:path"].property,iconWidth:ai.width,iconHeight:ai.height,repository:a(X),relationships:ah};Z(ad)}})},error:function(aa){if(aa.status===404){if(U){U(Y)}}else{r++;E()}}})}catch(W){console.log("bd.cmis.getRootFolderId > "+W)}};return{saveNewContent:m,updateContent:I,readContent:g,getFolders:w,getFiles:z,createFolder:h,moveTo:f,rename:A,deleteContent:j,getMetaData:M,updateProperty:C,updateContentByPath:J,getFileUrlByPath:i,readContentByPath:G,getVersionsList:l,readContentByPipe:e,getObject:y,getContentObjectById:S}}(be.promise))})();(function(){var d=this;var c=function(){return window.b$&&b$.portal&&b$.portal.config&&b$.portal.config.serverRoot||(bd.contextRoot!==undefined&&bd.contextRoot!==null?bd.contextRoot:"")};var b=function(e){return c()+"/content/atom/"+(e||"contentRepository")+"/"};var a=function(){return window.b$&&b$.portal&&b$.portal.portalName||""};this.cmis={getObject:function(m,i,l,j){if(!m){m="/Generated content"}else{if(typeof m==="object"){j=m.repository;m=m.path}}var e,g;var k=m.indexOf("?versionLabel=");if(k!==-1){var h=m.substring(k+14,m.length);m=m.substring(0,k);e="query";g={q:"SELECT+*+FROM+cmis:document+WHERE+cmis:path='"+m+"'+AND+cmis:versionLabel='"+h+"'",searchAllVersions:"true"}}else{e="path";g={path:m,includeAllowableActions:"false"}}var f={url:b(j)+e,extention:"",format:"xml",data:g,before:i,after:l};return d._makeRequest(f)},readContent:function(i,h,e,g){var f={url:b(g)+"content",extention:"",dataType:"html",format:"html",data:{id:i},before:h,after:e};return d._makeRequest(f)},updateProperty:function(j,h,i,e,g){var f={url:b(g)+"entry?id="+j,extention:"",format:"xml",type:"PUT",data:h,contentType:"text/xml",before:i,after:e};return d._makeRequest(f)}}}).apply(be.promise);(function(g){var c=window.bd=window.bd||{},f=".bp-area, .bp-widget",b,e,d=function(k){var j=h(k);var i=j;while(i.model.tag.toLowerCase()!=="page"&&i.model.tag.toLowerCase()!=="portal"&&i.model.tag.toLowerCase()!=="application"){i=i.parentNode}if(j){if(i.pageType==="inherited"&&j.model.manageable==="false"){return""}else{if(j.nodeName==="dragIndicator"||j.model.tag==="container"||j.model.tag==="page"){if(i.pageType==="master"&&j.model.tag==="container"&&j.getPreference("isManageableArea")){return""}else{if(!j.isPossibleDragTarget){return""}}return"canvas"}else{if(j.model.tag==="widget"){return"widget"}}}}},h=function(i){if(!i){return null}if(i.viewController){return i.viewController}else{if(i.parentNode){return h(i.parentNode)}else{return null}}},a=function(j,n,m){e=m.helper.bdDragData;b=e&&e.fileDataArray&&e.fileDataArray.length?e.fileDataArray:null;if(b||e.link){var i=d(this,n,m,j),k=h(this),l={evt:n,info:m,dropType:i,viewController:k,dropArea:this,dragData:e};k.dispatchCustomEvent(j,true,true,l);g(this).trigger(j,l)}};c.bindDropEvents=function(k){var j=g(k),i={activate:function(m,l){a.call(this,"bdDrop.activate",m,l);return},deactivate:function(m,l){a.call(this,"bdDrop.deactivate",m,l);return},enter:function(m,l){m.stopPropagation();a.call(this,"bdDrop.enter",m,l);return},leave:function(m,l){a.call(this,"bdDrop.leave",m,l);return},drop:function(m,l){a.call(this,"bdDrop.drop",m,l);return},over:function(m,l){a.call(this,"bdDrop.over",m,l);return},out:function(m,l){a.call(this,"bdDrop.out",m,l);return}};if(j.hasClass("bp-widget")){i.move=function(m,l){a.call(this,"bdDrop.move",m,l);return}}j.bdDrop(i)};c.bindDropOnCanvasEvent=function(o,r){var q=r||f,k=g("body"),s=o?g(o).find(q):k.find(q),m,j,p,n=c.bindDropEvents;if(o&&!s.length){n(o);return}else{if(!o){k.bdDrop({activate:function(l,i){a.call(this,"bdDrop.activate",l,i);return},deactivate:function(l,i){a.call(this,"bdDrop.deactivate",l,i);return},drop:function(l,i){k.unbind("mousemove.iceDnD");a.call(this,"bdDrop.drop",l,i);return}})}else{s.push(o)}for(m=0,j=s.length;m<j;m++){p=s[m];n(p)}}}})(window.jQuery);(function(d,a,h,b,e){if(!b){return}var g=function(k,j){var i=j.getCommand("removeImage");if(k){if(k.getAttribute("data-parentid")&&k.getAttribute("src").indexOf("/blank.gif")===-1){i.enable()}else{if(k.getAttribute("data-ice-ref")){i.enable()}else{i.disable()}}}else{i.disable()}},f=function(m){var l=m.getSelection(),j=l?l.getStartElement():null,i=m.element,k=null;if(j&&j.is("img")&&j.hasClass("bd-imgArea")){k=j}else{if(i&&i.is("img")&&i.hasClass("bd-imgArea")){k=i}}return k},c=function(){if(b.currentInstance){var i=f(b.currentInstance);g(i,b.currentInstance)}};b.plugins.add("iceImage",{init:function(n){var o=e.contextRoot+"/static/backbase.com.2011.ice/js/ckeditor-plugins/ice-image/icons/image-delete.png";var k=new b.command(n,{exec:function(q){e.observer.notifyObserver("nicEditOpenAssetPicker.assetPicker")}});var p=new b.command(n,{exec:function(q){var r=f(q);if(r){if(r.getAttribute("data-parentid")){if(e.iceEvents&&e.iceEvents.deleteImageCK){e.iceEvents.deleteImageCK(r.$,q)}}else{if(r.getAttribute("data-ice-ref")){h(r.$).trigger("removeImage.iceImage")}}}g(r,q)}});var i=n.addCommand("openAssetPicker",k);var m=n.addCommand("removeImage",p);i.modes={wysiwyg:1,source:1};i.readOnly=1;m.modes={wysiwyg:1,source:1};m.readOnly=1;n.ui.addButton("OpenAssetPicker",{label:"Open Assets Picker",command:"openAssetPicker",icon:"Image"});n.ui.addButton("RemoveImage",{label:"Remove Image",command:"removeImage",icon:o});var l=new b.style({element:"img"});n.attachStyleStateChange(l,function(r){var q=f(n);g(q,n)});n.on("iceImageFocus",function(r){var q=f(r.editor);g(q,r.editor)});n.on("key",function(s){var q=f(s.editor),r=s.data.keyCode;if(q){var t=q.getAttribute("src");if(t&&t.indexOf("/blank.gif")==-1&&(r===8||r===46)){n.getCommand("removeImage").exec();g(q,n)}}});var j=f(n);if(j){e.observer.removeObserver("ckEditDropped.iceImage");e.observer.addObserver("ckEditDropped.iceImage",function(){c()});h(j.$).on("ckEditDropped.iceImage",function(){c()})}}});b.config.extraPlugins="iceImage"+(b.config.extraPlugins.length>1?","+b.config.extraPlugins:"")})(window,document,jQuery,CKEDITOR,bd);(function(c,a,e,b,d){if(!b){return}b.plugins.add("iceLink",{init:function(g){var f=g.addCommand("bindIceLink",new b.dialogCommand("bindIceLink"));g.ui.addButton("bindIceLink",{label:"Ice Link",command:"bindIceLink",icon:"Link"});g.on("doubleclick",function(h){var i=b.plugins.iceLink.getSelectedLink(g)||h.data.element;if(i&&i.hasAttribute("data-parentid")&&g.filter.check("a")){h.data.dialog="bindIceLink"}});g.on("paste",function(i){var k=b.plugins.iceLink.getSelectedLink(g)||i.data.element;if(k&&k.hasAttribute("data-parentid")){i.stop();var l=k.$;var h=be.utils.getCursor(l);h.replace(a.createTextNode(i.data.dataValue));var j=b.plugins.iceLink.findTextNode(l);b.plugins.iceLink.convert2SingleTextNode(j)}})}});b.dialog.add("bindIceLink",function(h){var g=h.lang.common,f=h.lang.link,i={title:"Ice Link",minWidth:350,minHeight:230,contents:[{id:"Ice Link Info",label:"Ice Link Info",title:"Ice Link Info",elements:[{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:g.protocol,"default":"http://",items:[["http://\u200E","http://"],["https://\u200E","https://"],["ftp://\u200E","ftp://"],["news://\u200E","news://"],[f.other,""]],setup:function(j){if(j.url){this.setValue(j.url.protocol||"http://")}},commit:function(j){if(!j.url){j.url={}}j.url.protocol=this.getValue()}},{type:"text",id:"url",label:g.url,required:true,onLoad:function(){this.allowOnChange=true},onKeyUp:function(){this.allowOnChange=false;var l=this.getDialog().getContentElement("info","protocol"),j=this.getValue(),k=/^(http|https|ftp|news):\/\/(?=.)/i,n=/^((javascript:)|[#\/\.\?])/i;var m=k.exec(j);if(m){this.setValue(j.substr(m[0].length));l.setValue(m[0].toLowerCase())}else{if(n.test(j)){l.setValue("")}}this.allowOnChange=true},onChange:function(){if(this.allowOnChange){this.onKeyUp()}},validate:function(){var j=this.getDialog();if(j.getContentElement("info","linkType")&&j.getValueOf("info","linkType")!="url"){return true}if((/javascript\:/).test(this.getValue())){alert(g.invalidValue);return false}if(this.getDialog().fakeObj){return true}var k=b.dialog.validate.notEmpty(f.noUrl);return k.apply(this)},setup:function(j){this.allowOnChange=false;if(j.url){this.setValue(j.url.url)}this.allowOnChange=true},commit:function(j){this.onChange();if(!j.url){j.url={}}j.url.url=this.getValue();this.allowOnChange=false}}]}]},{type:"vbox",id:"elmAttr",children:[{type:"hbox",widths:["15%","85%"],children:[{type:"text",label:"Title","default":"",id:"advTitle",setup:function(j){if(j.title){this.setValue(j.title||"")}},commit:function(j){if(!j.title){j.title={}}j.title=this.getValue()}}]}]},{type:"vbox",id:"elmLabel",children:[{type:"hbox",widths:["15%","85%"],children:[{type:"text",label:"Label","default":"",id:"advLabel",setup:function(j){if(j.label){this.setValue(j.label||"")}},commit:function(j){if(!j.label){j.label={}}j.label=this.getValue()}}]}]}]}],onShow:function(o,p){var m=null,j="",k={},l,q="",r="",n=/^((?:http|https|ftp|news):\/\/)?(.*)$/;if((m=b.plugins.iceLink.getSelectedLink(h))&&m.hasAttribute("href")){j=m.getAttribute("href");q=m.getAttribute("title");r=b.plugins.iceLink.getLinkText(m.$)}if(j&&(l=j.match(n))){k.type="url";k.url={};k.url.protocol=l[1];k.url.url=l[2]}k.title=q;k.label=r;this.setupContent(k)},onOk:function(){var j={},m={},l=b.plugins.iceLink.getSelectedLink(h);this.commitContent(m);if(l){var n=(m.url&&m.url.protocol!==undefined)?m.url.protocol:"http://",k=(m.url&&b.tools.trim(m.url.url))||"";j.href=(k.indexOf("/")===0)?k:n+k;j.title=m.title;l.setAttributes(j);if(m.label){b.plugins.iceLink.replaceLinkText(m.label,l.$)}d.iceEvents.onSave(e(l.$))}}};return i});b.plugins.iceLink={getSelectedLink:function(h){var g=h.getSelection();var i=g.getSelectedElement();if(i&&i.is("a")){return i}var f=g.getRanges(true)[0];if(f){f.shrink(b.SHRINK_TEXT);return h.elementPath(f.getCommonAncestor()).contains("a",false)}return null},findTextNode:function(h){var f=h.childNodes.length;for(var i=0;i<f;i++){var g=h.childNodes[i];if(g.nodeType==3){return g}else{if(g.nodeType==1){g=this.findTextNode(g);if(g!==null){return g}}}}return null},replaceLinkText:function(g,f){if(f.childNodes){var h=this.findTextNode(f);if(h!==null){h.nodeValue=g}else{f.appendChild(a.createTextNode(g))}}else{f.appendChild(a.createTextNode(g))}},getLinkText:function(f){if(f.childNodes){var g=this.findTextNode(f);if(g!==null){return g.nodeValue}}return""},convert2SingleTextNode:function(g){var f=g.nextSibling;if(f&&f.nodeType==3){g.nodeValue+=f.nodeValue;f.remove();this.convert2SingleTextNode(g)}}};b.config.extraPlugins="iceLink"+(b.config.extraPlugins.length>1?","+b.config.extraPlugins:"")})(window,document,jQuery,CKEDITOR,bd);(function(d,a,c){if(!a){return}var e=function(g){return top.bd.pm.controller.onLinkByUUID(g)};var f=function(g){d("ul.token-input-list",g).parent().find("label.error").remove()};var b=function(i,g){var h=g.getDialog().getElement().$,j=a.dialog.validate.notEmpty(i.noUrl);f(h);if(j.apply(g)!==true){d("ul.token-input-list",h).parent().append('<label class="error" for="'+g.getInputElement().$.id+'">Not an existing menu item</div>');return false}else{return true}};a.plugins.add("iceMLink",{init:function(g){g.addCommand("bindIceMLink",new a.dialogCommand("bindIceMLink"));g.ui.addButton("bindIceMLink",{label:"Managed Link",command:"bindIceMLink",icon:"Link"});g.on("paste",function(i){var k=a.plugins.iceLink.getSelectedLink(g)||i.data.element;if(k){i.stop();var l=k.$;var h=c.utils.getCursor(l);h.replace(document.createTextNode(i.data.dataValue));var j=a.plugins.iceLink.findTextNode(l);a.plugins.iceLink.convert2SingleTextNode(j)}});g.on("doubleclick",function(h){var i=a.plugins.iceMLink.getSelectedLink(g)||h.data.element;if(!i.isReadOnly()){if(i.is("a")){h.data.dialog="bindIceMLink"}}});if(g.contextMenu){if(g.addMenuItem){g.addMenuGroup("linkGroup");g.addMenuItems({iceMLink:{label:"Link",command:"bindIceMLink",icon:"Link",group:"linkGroup",order:1},unlink:{label:g.lang.link.unlink,command:"unlink",icon:"unlink",group:"linkGroup",order:5}})}g.contextMenu.addListener(function(h){if(!h||h.isReadOnly()){return null}var i=a.plugins.iceMLink.getSelectedLink(g);if(!i){return null}return{iceMLink:a.TRISTATE_OFF}})}}});a.dialog.add("bindIceMLink",function(i){var j,h=i.lang.common,g=i.lang.link,k={title:"Link",minWidth:350,minHeight:200,contents:[{id:"Ice Link Info",label:"Ice Link Info",title:"Ice Link Info",elements:[{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["75%","25%"],children:[{type:"text",id:"url",label:"Link",required:true,onLoad:function(){this.allowOnChange=true},onKeyUp:function(){this.allowOnChange=false;var n=this.getDialog().getContentElement("info","protocol"),l=this.getValue(),m=/^(http|https|ftp|news):\/\/(?=.)/i,p=/^((javascript:)|[#\/\.\?])/i;var o=m.exec(l);if(o){this.setValue(l.substr(o[0].length));n.setValue(o[0].toLowerCase())}else{if(p.test(l)){n.setValue("")}}this.allowOnChange=true},onShow:function(){f(this.getDialog().getElement().$);d(".token-input-input-token input").css("width","100%")},onChange:function(){if(this.allowOnChange){this.onKeyUp()}},onBlur:function(){b(g,this);d(".token-input-input-token input").css("width","100%")},validate:function(){var l=this.getDialog();if(l.getContentElement("info","linkType")&&l.getValueOf("info","linkType")!="url"){return true}if((/javascript\:/).test(this.getValue())){alert(h.invalidValue);return false}if(this.getDialog().fakeObj){return true}return b(g,this)},setup:function(p){this.allowOnChange=false;var t=this,o=this.getInputElement(),q=".token-input-input-token input",s=d(o.$),r=s.data("tokenInputObject"),n=function(u){if(u){var v=top.bd.pm.view.getItemTypeObj(u);return{id:u.uuid,name:c.utils.HTMLEncode(u.properties.title.value),icon:v?v.icon:"bc-page",finalUrl:u.finalUrl,managed:true}}else{return{}}};j=j||function(){t.onBlur()};if(!r){bc.component.tokenize({field:s,zindex:20000,tokenLimit:1,animateDropdown:false,placeholder:"Link to a menu Drag a page from the Page List or start typing",hintText:"Type in a menu item",onAdd:function(){o.focusNext();j()}})}else{d(o.$).tokenInput("clear")}d(q).off("blur",j).on("blur",j);if(p.ref&&top&&top.bd&&top.bd.pm){var l=p.ref;if(l){e(l).done(function(u){d(o.$).tokenInput("add",n(u))})}else{c.utils.log("uuid is not defined","ice.ckeditor-plugins.managed-link")}}else{if(p.url){var m=p.url.protocol?p.url.protocol:"";m+=p.url.url;d(o.$).tokenInput("add",{id:"0",name:m})}else{setTimeout(function(){d(q).focus()},100)}}this.isATemplateLink=Boolean(p.el&&p.el.getAttribute("data-ice-link"));if(this.isATemplateLink){this.required=false}this.allowOnChange=true},commit:function(m){this.onChange();var l=this.getInputElement(),o=d(l.$).data("tokenInputObject"),n=o&&o.getTokens()[0];m.tokenData=n;this.allowOnChange=false}}]},{type:"hbox",widths:["75%","25%"],children:[{type:"select",id:"target",label:"Target",required:true,items:[["Empty / No value"," "],["New window","_blank"],["Same frame","_self"],["Parent frame","_parent"],["Entire window","_top"]],"default":" ",onLoad:function(){this.allowOnChange=true},onSelect:function(l){if(this.allowOnChange&&!this.isHidden){l.target=this.getValue()}},onShow:function(){f(this.getDialog().getElement().$);d(".token-input-input-token select").css("width","100%")},setup:function(m){if(m.el&&!m.el.hasAttribute("target")){this.getElement().$.style.display="none";this.isHidden=true}else{var l=this.getInputElement();this.isHidden=false;d(l.$).val(m.target||this["default"])}},commit:function(l){this.onSelect(l)}}]}]}]}],onShow:function(q,s){var o=null,l="",m={},n,t="",r="",p=/^((?:http|https|ftp|news):\/\/)?(.*)$/;d(d(".cke_resizer")[0]).mousedown(function(u){d(d(".token-input-input-token > input")[0]).blur()});if((o=a.plugins.iceMLink.getSelectedLink(i))&&o.hasAttribute("href")){l=o.getAttribute("href");t=o.getAttribute("title");m.ref=o.data("ice-link-ref");m.el=o.$;m.target=o.getAttribute("target")}if(l&&(n=l.match(p))){m.type="url";m.url={};m.url.protocol=n[1];m.url.url=n[2]}m.title=t;this.setupContent(m)},onLoad:function(){var l=d(this.parts.dialog.$),m=this;l.bdDrop({drop:function(o,n){m._.contents["Ice Link Info"].url.setup({ref:n.helper.bdDragData.link.uuid});return}})},onOk:function(){var m=a.plugins.iceMLink.getSelectedLink(i),o={},l=i.element.$,p={attr:{},editor:l};this.commitContent(o);if(m){p.link=m.$}p.attr.title=o.title;p.attr.target=o.target;if(o.tokenData){if(o.tokenData.managed){p.uuid=o.tokenData.id}else{if(o.tokenData.id=="0"){p.attr.href=o.tokenData.name}}}else{var n=m.data("ice-link-ref");if(!n){return}p.uuid=n;p.resetLink=true}d(l).trigger("ice.updatelink",p)}};return k});a.plugins.iceMLink={getSelectedLink:function(j){var i=j.element;if(i&&d(i.$).is("a")){return i}var h=j.getSelection();var k=h.getSelectedElement();if(k&&k.is("a")){return k}var g=h.getRanges(true)[0];if(g){g.shrink(a.SHRINK_TEXT);return j.elementPath(g.getCommonAncestor()).contains("a",false)}return null}};a.config.extraPlugins="iceMLink"+(a.config.extraPlugins.length>1?","+a.config.extraPlugins:"")})(window.jQuery,window.CKEDITOR,window.be);(function(i,f,h,e,n){if(!h){return}var o=jQuery("body"),l=null,k='<div class="bd-ckeditor-dock-close-btn-div"><div class="bd-dock-close-btn" title="Close the editor"></div></div>',q=false,a,j={CLOSED:33,OPENED:108},m=function(s){return s?l.children("#cke_"+s):l.children(".bd-active-cke")},p=function(u){if(!o.hasClass("bd-ckeditor-docked")){o.children(".bd-mainContainer").css("top","");return}var t=u.height(),s=o.hasClass("bd-preview-open")?j.OPENED:j.CLOSED;if(t>-1){t+=s}o.children(".bd-mainContainer").css("top",t)},r=function(){if(o.hasClass("bd-ckeditor-docked")){var s=m();if(s.length){p(s)}}},c=function(s){return function(v){var x=m(s.name),u=f(s.container.$).closest(".bp-widget"),w,t=[];if(v&&(v.uuid&&u[0].viewController.model.uuid===v.uuid)||!v.uuid){w=s.focusManager&&s.focusManager.currentActive&&s.focusManager.currentActive.$;if(w){jQuery(w).blur()}o.removeClass("bd-ckeditor-docked");x.addClass("bd-dock-closed");f("[contenteditable]",u).each(function(y,z){t.push(f(z).attr("contenteditable"))});r();if(typeof h.__animateDock__==="function"){h.__animateDock__(function(){f("[contenteditable]",u).attr("contenteditable",false);u.one("mousedown",".be-ice-widget-enabled",function(){f("[contenteditable]",u).each(function(y,z){f(z).attr("contenteditable",t[y])})})})}}}},b=function(s){if(!o.hasClass("bd-ckeditor-docked")){o.addClass("bd-ckeditor-docked")}this.setState(h.TRISTATE_ON);m().removeClass("bd-active-cke");s.addClass("bd-active-cke")},g=function(t,s){if(s){t.addClass("bd-ckeditor-freeze").append('<div class="bd-ckeditor-freeze-cover"></div>')}else{t.removeClass("bd-ckeditor-freeze").children(".bd-ckeditor-freeze-cover").remove()}},d=function(){l=o.find(".bd-ckeditor-container");if(!q&&l.length){q=true;jQuery("html").addClass("bd-cke-dock-enabled");o.on("click.bbDocking",".bd-mobile-close-wrapper",function(){r()});jQuery(i).on("resize.bbDocking",function(){if(a!==n){clearTimeout(a)}a=setTimeout(function(){r()},50)})}};jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:e.contextRoot+"/static/backbase.com.2011.ice/js/ckeditor-plugins/dock/plugin.css"}).appendTo("head");h.plugins.add("bbDocking",{init:function(s){d();s.addCommand("dockCkEditor",{exec:function(t){var v=t.name,u=m(v);b.call(this,u);p(u)},modes:{wysiwyg:1,source:1},readOnly:1});s.on("instanceReady",function(){var v=m(s.name),u=jQuery(k),t=c(s);v.children().append(u);e.observer.removeObserver("closeEditBar",t);e.observer.addObserver("closeEditBar",t);u.off("click",".bd-dock-close-btn",t).on("click",".bd-dock-close-btn",t)});s.on("focus",function(){var t=m(s.name);t.removeClass("bd-dock-closed");s.execCommand("dockCkEditor");g(t,false);r()});s.on("blur",function(){if(o.hasClass("bd-ckeditor-docked")){var t=m(s.name);g(t,true)}});s.on("destroy",function(){if(o.hasClass("bd-ckeditor-docked")){var t=l.children(".bd-active-cke");if(t.length){if(t.attr("id").replace("cke_","")===s.name){if(o.hasClass("bd-preview-open")){o.children(".bd-mainContainer").css("top",j.OPENED+"px")}else{o.children(".bd-mainContainer").css("top",j.CLOSED+"px")}}}}})}});h.config.extraPlugins="bbDocking"+(h.config.extraPlugins.length>1?","+h.config.extraPlugins:"")}(window,jQuery,CKEDITOR,bd));(function(i,k,l,c,h){var f=l("body"),g=h.uiEditingOptions.ckEditorConfigs||[],a=h.uiEditingOptions.configStylesSet||{},b=false,e=l('<div class="bd-ckeditor-container"></div>'),d=[{name:"clipboard",groups:["clipboard","undo"],items:["Cut","Copy","Paste","-","Undo","Redo"]}],j=function(){if(!f.children(".bd-ckeditor-container").length){f.prepend(e);h.observer.addObserver(top.bd.notifications.publishing.TOGGLE_LOCK,function(m){if(m.locked){if(k.activeElement){k.activeElement.blur()}if(c.dialog&&c.dialog.getCurrent()){c.dialog.getCurrent().hide()}}})}};c.basePath=h.contextRoot+"/static/backbase.com.2011.ice/js/ext-libs/ckeditor/";c.on("instanceCreated",function(q){var p=q.editor,m=l(p.element.$),o=h.customStylesSelector&&a[h.customStylesSelector]?a[h.customStylesSelector]:"";p.config.contentsCss=o===""?c.basePath+"contents.css":o.contentCss;p.config.stylesSet=o===""?"default":o.styleSet;p.config.menu_groups="clipboard,tablecell,tablecellproperties,tablerow,tablecolumn,table,image,iceMLink";p.on("configLoaded",function(w){var v="",x,u,y,t=false;for(x=0,u=g.length;x<u;x++){t=false;y=g[x];v="."+y.parentList.join(", .");if(m.is(v)){w.editor.config.toolbar=y.toolbar;t=true;break}}if(!t){w.editor.config.toolbar=d}});p.on("instanceReady",function(){var t=f.children("#cke_"+p.name);t.removeClass("cke_hc");e.append(t);m.data("ckEditorName",p.name);p.setReadOnly(false)});var s=function(){p.fire("saveSnapshot");if(m.attr("data-ice-plaintext")!==undefined){m.text(m.text())}m.trigger("ice.change");m.trigger("iceFocusOut")};var n=function(){p.fire("iceImageFocus")};var r=function(u,w){var v=m[0];var t=m.html();if(t.charCodeAt(0)===8203){m.html(t.substring(1))}if($(".pm-icon2:visible",v.ownerDocument).length===0){if(typeof w==="function"){w()}}else{u.cancel()}};p.on("blur",function(t){r(t,s)});p.on("focus",function(t){r(t,n)})});c.on("createInstance.ice",function(m){c.inline(m.data.editArea,m.data.config)});c.on("dialogDefinition",function(n){var o=n.data.name;var p=n.data.definition;if(o=="image"){p.minHeight=200;p.removeContents("advanced");p.removeContents("Link");var m=p.getContents("info");m.remove("ratioLock");m.remove("txtBorder");m.remove("txtHSpace");m.remove("txtVSpace");m.remove("cmbAlign");m.remove("txtWidth");m.remove("txtHeight");m.get("htmlPreview").hidden=true;m.get("txtUrl").hidden=true}});c.on("initSetup.ice",function(){if(b){return}b=true;j();c.disableAutoInline=true;c.dtd.$editable.span=1;c.dtd.$editable.a=1;c.dtd.$editable.li=1;c.dtd.$editable.img=1;c.config.removePlugins="image";if(c.env.ie&&c.env.version<9){c.dom.element.prototype.setHtml=function(){var m=function(n){return this.$.innerHTML=n};return c.env.ie&&c.env.version<9?function(o){try{return this.$.innerHTML=o}catch(n){try{this.$.innerHTML="";var q=new c.dom.element("body",this.getDocument());q.$.innerHTML=o;for(q=q.getChildren();q.count();){this.append(q.getItem(0))}return o}catch(p){return o}}}:m}()}})})(window,document,jQuery,CKEDITOR,bd);window.be=window.be||{};window.be.ice=window.be.ice||{};be.ice.config={events:["init-drop","init-ckeditor","incontextnav"],mappers:["plaintext","image","link","richtext","mustache","richtext-link","richtext-image","mustache"],ckeditor:{plaintext:{allowedContent:"!*",extraAllowedContent:"!*",enterMode:2}},getContentPath:function(b){var a=be.utils.module("top.bd.PageMgmtTree.selectedLink.properties.generatedUrl")["value"];return("/Generated content/"+(a?a+"/":"")+(b?b:""))}};be.utils.define("be.ice.util",["jQuery"],function(j){var i=function(q){return function(s){var r=j.Deferred();q(s,function(){r.resolve.apply(this,arguments)},function(){r.reject.apply(this,arguments)});return r.promise()}},h=function(q){return function(s){var r=j.Deferred();s.successCallback=function(){r.resolve.apply(this,arguments)};s.errorCallback=function(){r.reject.apply(this,arguments)};q(s);return r.promise()}},a=function a(q){return q.reduce(function(r,s){return r.then(function(t){return s().then(function(u){return t.concat(u)})})},j.Deferred().resolve([]))},n=function(r){var q=Array.prototype.slice.call(arguments,1);return function(){return r.apply(this,q)}},d=function(q){bc.component.notify({uid:q.uid||Math.random.toString(26),icon:q.error||"error",message:q.message||"",delay:q.delay||5000})},k=function(t,s){if(!t){return{}}if(!s){return t}var u=s.split(".");var r=u[0];var q=u[1]&&/^\d+$/.test(u[1])&&"array"||"object";s=u.slice(1).join(".");if(t[r]===undefined&&q=="array"){t[r]=[]}if(t[r]===undefined&&q=="object"){t[r]={}}return k(t[r],s)},p=function(t,s,u){s=s.split(".");var q=s[s.length-1];s=s.slice(0,-1).join(".");var r=k(t,s)[q];if(!r){r=k(t,s);r[q]=typeof u==="string"?u:u.length?[]:{};r=r[q]}if(typeof u!=="string"){j.extend(true,r,u)}},b=function(){return window.b$&&b$.portal&&b$.portal.config&&b$.portal.config.serverRoot||""},f=function(q){q=q||"contentRepository";return b()+"/content/atom/"+q+"/"},m=function(){return window.b$&&b$.portal&&b$.portal.portalName||""},o=function(q){var s=[];for(var r in q){if(q.hasOwnProperty(r)){s.push(r)}}return s},g=function(){var q=window.console||{log:function(){},};if(e.debug||top.bd&&top.bd.devMode||bd&&bd.devMode||(top.location.search&&top.location.search.indexOf("debug=true")>-1)){q.log.apply(q,arguments)}},c=function(q){return q.replace(/ href=""/g,"").replace(/ class=""/g,"").replace(/>\s+</g,"><").replace(/\{\uFEFF\{/g,"{{").replace(/<!--[\s\S]*?-->/gi,"").replace(/ sizcache[^=]+="[^"]*"/g,"").replace(/=""/g,"")},e={},l=function(q,r){if(j("html").hasClass("ie")){console.log(q);console.log(r);return{o:q,n:r}}else{var A=function(K,L){var I={};var J={};for(var H=0,F=L.length;H<F;H++){if(I[L[H]]==null){I[L[H]]={rows:[],o:null}}I[L[H]].rows.push(H)}for(var H=0,G=K.length;H<G;H++){if(J[K[H]]==null){J[K[H]]={rows:[],n:null}}J[K[H]].rows.push(H)}for(var H in I){if(I[H].rows.length==1&&typeof(J[H])!=="undefined"&&J[H].rows.length==1){L[I[H].rows[0]]={text:L[I[H].rows[0]],row:J[H].rows[0]};K[J[H].rows[0]]={text:K[J[H].rows[0]],row:I[H].rows[0]}}}for(var H=0;H<L.length-1;H++){if(L[H].text!=null&&L[H+1].text==null&&L[H].row+1<K.length&&K[L[H].row+1].text==null&&L[H+1]==K[L[H].row+1]){L[H+1]={text:L[H+1],row:L[H].row+1};K[L[H].row+1]={text:K[L[H].row+1],row:H+1}}}for(var H=L.length-1;H>0;H--){if(L[H].text!=null&&L[H-1].text==null&&L[H].row>0&&K[L[H].row-1].text==null&&L[H-1]==K[L[H].row-1]){L[H-1]={text:L[H-1],row:L[H].row-1};K[L[H].row-1]={text:K[L[H].row-1],row:H-1}}}return{o:K,n:L}};var C,x,u="%c",z="%c";q=q.replace(/\s+$/,"");r=r.replace(/\s+$/,"");C=q.match(/\s+/g);x=r.match(/\s+/g);if(C==null){C=["\n"]}else{C.push("\n")}if(x==null){x=["\n"]}else{x.push("\n")}var v=A(q==""?[]:q.split(/\s+/),r==""?[]:r.split(/\s+/));for(var w=0,s=v.o.length;w<s;w++){if(v.o[w].text!=null){u+=v.o[w].text+C[w]}else{u+="%c"+v.o[w]+C[w]+"%c"}}for(var w=0,y=v.n.length;w<y;w++){if(v.n[w].text!=null){z+=v.n[w].text+x[w]}else{z+="%c"+v.n[w]+x[w]+"%c"}}var t="background:red;color:#fff;",E="background:green;color:#fff;",B="color: rgba(0,0,0,0.4);",D=function(J,I,G){var H=J.match(/%c/g).length,F=[J].concat(new Array(H).join(".").split(".").map(function(L,K){return K%2?I:G}));console.log.apply(console,F)};D(u,t,B);D(z,E,B);return{o:u,n:z}}};j.extend(j.expr[":"],{attr:function(v,s,q){var r=j.getAttrAll(v),t=q[3],u=false;j.each(r,function(x,w){if(new RegExp(t).test(w)){return u=true}});return u}});j.getAttrAll=function(t){var u=[];for(var s=0,r=t.attributes,q=r.length;s<q;s++){u.push(r.item(s).nodeName)}return u};return{fbind1:i,fnkbind:h,chain:a,bind:n,portalManagerMessage:d,path2obj:k,setPathOnObj:p,getContextRoot:b,getContentServiceProxyUrl:f,getPortalName:m,keys:o,consoleDiff:l,cleanup:c,config:e,log:g}});if(!window.be){window.be={}}if(!window.be.ice){window.be.ice={}}be.ice.mapper=(function(g,a,b){var r={annotators:{mustache:a.to_html},cleaners:{}};var h={extractors:{}};var m={handlers:{},cleaners:{}};var t={names:[]};var s=function(u,v){r.annotators[u]=v};var l=function(u,v){r.cleaners[u]=v};var q=function(u,v){h.extractors[u]=v};var n=function(u,v){m.handlers[u]=v};var j=function(u,v){m.cleaners[u]=v};var c=function(u,v,w){var x=w||t.names;return x.reduce(function(y,z){return r.annotators[z]?r.annotators[z](y,v):y},u)};var i=function(u,w){var x=w||g.extend(true,[],t.names);var v=x.reverse().reduce(function(z,y){return{model:h.extractors[y]?(function(A,B){g.each(B,function(D,E){var C=E;b.setPathOnObj(z.model,D,E)});return z.model})(z.model,h.extractors[y](z.view)):z.model,view:r.cleaners[y]?r.cleaners[y](z.view):z.view}},{model:{},view:u}).model;return v};var d=function(u,w){var v=["content","url","path","contentRef","browserRef","linkRef"];g.each(u||[],function(y,z){var x=w[y]&&w[y].meta&&w[y].meta["cmis:objectTypeId"]==="bb:richtext";if(x||z.hasOwnProperty("content")){g.each(z||[],function(B,A){z.meta=z.meta||{"cmis:objectTypeId":"bb:richtext"};if(g.inArray(B,v)===-1){z.meta[B]=A;delete z[B]}})}})};var e=function(w,u){var v=u||t.names;v.forEach(function(x){m.handlers[x]&&m.handlers[x](w)});return w};var o=function(w,u){var v=u||t.names;v.forEach(function(x){m.cleaners[x]&&m.cleaners[x](w)});return w};var f=function(u,v){if(!v){u=u.replace(/ src=/g," _src=")}return g(u)};var k=function(w,v){var u=w.clone().wrap("<p>").parent().html()||"";if(!v){u=u.replace(/ _src=/g," src=")}return u};var p=function(u){return k(f(u))};return{config:t,registerViewAnnotator:s,registerViewCleaner:l,registerModelExtractor:q,registerDomHandler:n,registerDomCleaner:j,annotate:c,cleanupAndExtract:i,separateMetaData:d,attachHandlers:e,cleanupHandlers:o,toDom:f,toView:k,normalizeView:p,_mappers:{viewMappers:r,modelMappers:h,domMappers:m}}})(jQuery,Mustache,be.ice.util);if(!window.be){window.be={}}if(!window.be.ice){window.be.ice={}}be.ice.events=(function(c){var f={listeners:{},cleaners:{}};var b={names:[]};var a=function(j,k){f.listeners[j]=k};var d=function(j,k){f.cleaners[j]=k};var i=function(l,j){var k=b.names||[];k.forEach(function(m){g(m,l,j)});return l};var e=function(k){var j=b.names||[];j.forEach(function(l){h(l,k)});return k};var g=function(j,l,k){j&&f.listeners[j]&&f.listeners[j](l,k);return l};var h=function(j,k){j&&f.cleaners[j]&&f.cleaners[j](k);return k};return{registerEventListener:a,registerEventCleaner:d,attachEvents:i,detachEvents:e,attach:g,detach:h,config:b}})(jQuery);be.utils.define("be.ice.model.client",["be.ice.util"],function(d){var g=function(j){return{name:j.name,value:j.value,type:j.dataType&&j.dataType.name||"string"}};var f=function(j){return(j&&j.model&&j.model.preferences&&j.model.preferences.array||[]).map(g)};var h=function(k,j){return f(k).filter(function(l){return l.name==j})[0]};var b=function(o,l,n,m){m=m||"string";if(!o){return}var k=h(o,l)||{};if(k.value==n&&k.type==m){return}if(k.name&&k.type==m){o.model.setPreference(l,n)}else{var j=o.model.createPreference(l,m,n);o.model.setPreferenceNode(j)}};var i=function(k,j){k&&k.model.removePreference(j)};var e=d.fbind1(function(k,l,j){return k&&k.model.save(l,j)});var c=function(j){if(window.b$&&window.b$.portal&&window.b$.portal.portalView&&window.b$.portal.portalView.getElementById){return window.b$.portal.portalView.getElementById("VIEW-"+j)}};var a=function(j){return j&&j.model&&j.model.name};return{getPreferences:f,getPreference:h,setPreference:b,deletePreference:i,savePreferences:e,getWidgetByName:c,getName:a}});window.be=window.be||{};window.be.ice=window.be.ice||{};window.be.ice.model=window.be.ice.model||{};be.ice.model.cmis=(function(g,c,h,m,d){var f={contextRoot:c.getContextRoot()};var n=function(u){var t={};if(u){g(u).find("cmisra\\:object > cmis\\:properties, properties").children().each(function(v,w){t[g(w).attr("propertyDefinitionId")]={property:g(w).find("cmis\\:value, value").text(),displayName:g(w).attr("displayName")}})}return t};var p=function(u){var t={};jQuery(u).find("cmisra\\:object > cmis\\:relationship, relationship").each(function(w,x){var v=jQuery(x).find('cmis\\:properties > cmis\\:propertyId[propertyDefinitionId="cmis\\:objectId"] > cmis\\:value, properties').text();t[v]={};jQuery(x).find("cmis\\:properties, properties").children().each(function(y,z){t[v][jQuery(z).attr("propertyDefinitionId")]=jQuery(z).find("cmis\\:value, value").text()})});return t};var k=function(t){var u={};g.each(t,function(w,v){u[w]=v.property});return u};var o=function(w){var v=n(w),u=p(w),t=g(w).find("atom\\:content, content").attr("src"),x="/content/atom/";var y={objectId:v["cmis:objectId"].property,name:v["cmis:name"].property,path:t,meta:k(v),relationships:u};if(t&&t.indexOf(x)>-1){y.repositoryId=t.substring(t.indexOf(x)+x.length).split("/")[0];y.contentRef=y.repositoryId+":"+y.objectId}return y};var s=function(u,t){return l(u,t).then(function(w){var v=o(w);return v})};var l=function(v,u){u=u||"contentRepository";var t=f.contextRoot+"/content/atom/"+u+"/entry?id="+v+"&includeRelationships=source";return be.utils.ajax({url:t,dataType:"xml",cache:false,error:function(x){var w=be.utils.getErrorText(x);console.log(w?w:"Unknown error")}})};var i={getObject:function(w,u,v,t){d.cmis.getObject(w,null,null,t).then(function(y){if(y!==null){var x=o(y);u(x)}}).fail(function(x){if(x&&x.status==404){v(x)}})},saveNewContent:function(z){var w=function(C,B){var D=jQuery(C).find("cmis\\:rendition, rendition").find("cmis\\:streamId, streamId").text();if(D){B=B+"&streamId="+D}else{jQuery(C).find("atom\\:link, link").each(function(E,F){if(jQuery(F).attr("rel")=="alternate"){B=jQuery(F).attr("href")}})}return B};var A=false;if(z.type.indexOf("text")!=-1){A=true}var t=new Date();t=be.utils.ISODateString(t);if(z.objectType==null){z.objectType="cmis:document"}var u=[{key:"cmis:createdBy",value:f.loggedInUserId||m.portal.loggedInUserId},{key:"cmis:lastModifiedBy",value:f.loggedInUserId||m.portal.loggedInUserId},{key:"cmis:objectTypeId",value:z.objectType}];if(z.properties){g.each(z.properties,function(B,C){if(C){u.push({key:B,value:C})}})}var v={uniqueId:z.fileName,fileName:z.fileName,mediatype:z.type,timeStamp:t,properties:u};if(z.content!=null){var x=g.base64.encode(z.content,A);v.base64DocumentContent=x;v.create=true}var y=be.utils.processHTMLTemplateByUrl(f.contextRoot+"/static/backbase.com.2011.ice/xml/cmis/xhtml-post.xml",v);i.getObject(z.path,function(D){var B=D.objectId;if(B!=false){var C=be.ice.util.getContentServiceProxyUrl(z.repository)+"children?id="+B+"&overwriteFlag=true";g.ajax({url:C,data:y,dataType:"xml",contentType:"text/xml",type:"POST",headers:{bbCSRF:be.utils.getCookie("bbCSRF")},encodeURI:false,success:function(F){if(F!=null){var E=n(F);if(z.successCallback){C=be.ice.util.getContentServiceProxyUrl()+"content/"+E["cmis:name"].property+"?id="+E["cmis:objectId"].property;E.url={property:C,displayName:"URL"};var G=w(F,C);E.thumbUrl={property:G,displayName:"Thumbnail URL"};z.successCallback(o(F))}}},error:function(E){z.errorCallback(E)}})}else{console.log("bd.cmis.saveNewContent > unable to get root folder id")}},z.errorCallback,z.repository)}};var r=c.fbind1(i.getObject);var b=c.fnkbind(h.createFolder);var q=c.fnkbind(i.saveNewContent);var a=c.fbind1(i.readContent);var j=c.fnkbind(h.updateContent);var e=c.fnkbind(h.deleteContent);return{getEntry:l,getEntryObject:s,getObject:r,createFolder:b,saveNewContent:q,readContent:d.cmis.readContent,updateContent:j,deleteContent:e}})(jQuery,be.ice.util,be.cmis,b$,be.promise);be.utils.define("be.ice.model.content",["jQuery","be.ice.model.cmis","be.ice.util","be.utils"],function(h,j,c,e){var p=j.getObject;var b=j.createFolder;var o=j.saveNewContent;var m=j.readContent;var k=j.updateContent;var g=j.deleteContent;var s={absoluteUrl:/^\$\(contextRoot\)\//,rootMarker:"$(contextRoot)",contextRoot:c.getContextRoot()};var n=function(t,u){for(var v in u){if(u.hasOwnProperty(v)){t=t.replace(new RegExp("rel:"+v,"g"),["cs",u[v]["bb:targetRepositoryId"]==="contentRepository"?"contentRepository":"@portalRepository",u[v]["cmis:targetId"]].join(":"))}}return t};var l=function(t){return t.split("/").slice(1).reduce(function(u,w){var v=u.slice(-1)||"";u.push(v+"/"+w);return u},[])};var f=function(t){return p({path:t,repository:be.ice.model.repositoryId},null,null,be.ice.model.repositoryId).then(null,function(){return b({path:t.replace(/\/[^\/]+$/,"")||"/",folderName:t.replace(/^.*\//,""),repository:be.ice.model.repositoryId})})};var i=function(y,w,x){var A=y.replace(/^.*\//,""),u=x&&x["cmis:objectTypeId"]==="bb:richtext",z=(u?"text/html":"application/json")+"; charset=utf-8",t=u?"bb:richtext":"bb:structuredcontent";y=y.replace(/\/[^\/]+$/,"");var v=c.bind(o,{path:y,fileName:A,content:w,type:z,objectType:t,properties:x,repository:be.ice.model.repositoryId});return v().then(null,function(B){if(B.status==404){return c.chain(l(y).map(function(C){return c.bind(f,C)}).concat(v)).then(function(C){return C[C.length-1]})}return B})};var d=function(u){if(s.absoluteUrl.test(u)){return r(u)}else{var t=h.Deferred();q(u).then(function(v){var w=v.meta;if(w&&(w["cmis:objectTypeId"]=="bb:structuredcontent"||w["cmis:objectTypeId"]=="bb:richtext")){if(w["cmis:contentStreamLength"]!="0"){m(v.objectId,null,null,v.repositoryId).then(function(x){v.content=n(x,v.relationships);t.resolve(v)})}else{t.resolve(v)}}else{v.browserRef=u;t.resolve(v)}},function(v){t.resolve({error:"Can not read CMIS object by path"})});return t.promise()}};var r=function(t){t=t.replace(s.rootMarker,s.contextRoot);return e.loadTemplateByUrl(t,true).then(function(u){return{content:u}})};var a=function(t){if(s.absoluteUrl.test(t)){return r(t)}else{return q(t).then(function(u){return m({contentUid:u.objectId})}).then(null,function(){return h.when("")})}};var q=function(u){var t=u.split(":");if(t&&t.length===2){return j.getEntryObject(t[1],t[0]).then(function(v){return v})}else{if(t&&t.length===3){if(t[1]==="@portalRepository"){t[1]=be.ice.model.repositoryId}return j.getEntryObject(t[2],t[1]).then(function(v){return v})}}return j.getObject({path:u,repository:be.ice.model.repositoryId}).then(function(v){return v})};return{createContent:i,readObject:d,readContent:a,updateContent:function(v,t,u){return q(v).then(function(x){var w=u&&u["cmis:objectTypeId"]==="bb:richtext",y=(w?"text/html":"application/json")+"; charset=utf-8";if(w){delete u["cmis:objectTypeId"]}return k({ContentUid:x.objectId,content:t,properties:u,repository:x.repositoryId,type:y})},function(w){if(w.status==404){return i(v,t,u)}return w})},deleteContent:function(t){return p(t).then(function(u){return g({objectId:u.id})})},getId:function(t){return p(t).then(null,function(){return h.when("")})}}});be.utils.define("be.ice.model.links",["be.ice.util"],function(a){var d=function(e){var f="";if(e.referencedItem){f=a.getContextRoot()+"/"+e.finalUrl}else{if(e.itemType=="externalLink"){f=e.finalUrl}}return f};var b=function(e){var f=function(){e.path="";return $.Deferred().resolve(e)};if(e.uuid){return c(e.uuid).then(function(g){e.path=d(g);return e},f)}else{f()}};var c=function(e){return top.bd.pm.controller.onLinkByUUID(e,"ice-getLinkByUUID")};return{getLinkPath:d,resolveLink:b,getLinkByUUID:c}});window.be=window.be||{};window.be.ice=window.be.ice||{};window.be.ice.model=window.be.ice.model||{};be.ice.model.portal=(function(f){var i=f.getPreferences;var l=f.getPreference;var b=f.setPreference;var m=f.deletePreference;var h=f.savePreferences;var a=f.getName;var d=f.getWidgetByName;var g=function(n){return i(n).filter(function(o){return o.type=="contentRef"||o.type=="linkRef"})};var k=function(n){return n.map(function(o){return o.name}).sort()};var e=function(n){return n.reduce(function(p,o){p[o]=true;return p},{})};var c=function(q,o){var p=g(q);var n=e(k(o));p.filter(function(r){return !n[r.name]}).forEach(function(r){console.log("deleting pref",r);m(q,r.name)});o.filter(function(r){return r.name!="templateUrl"}).forEach(function(r){b(q,r.name,r.value,r.type)})};var j=function(n,o){c(n,o);return h(n)};return{getPreferences:i,getPreference:l,setPreference:b,deletePreference:m,savePreferences:h,getName:a,getWidgetByName:d,getReferences:g,updateReferences:c,saveModel:j}})(be.ice.model.client);be.utils.define("be.ice.model.xforms",["jQuery","be.ice.util"],function(c,e){var d={contentRef:"cref__",browserRef:"bref__",linkRef:"lref__"};var f=function(m,n){return m};var a=function(m){return m};var b=function(m,n){var o=m.reduce(function(p,q){if(q.name=="templateUrl"){p.template={ref:q.value}}else{if(q.type=="linkRef"){p[a(q.name)]={linkRef:q.value}}else{if(q.type=="contentRef"){p[a(q.name)]={contentRef:q.value}}}}return p},{widgetName:n});return o};var l=function(n){var m=[];var o=Object.keys(n).map(function(p){var r=n[p];if(typeof r==="object"&&!r.ref&&!r.browserRef&&!r.linkRef){var q=l(r);if(q.length>0){m=m.concat(q.filter(function(s){return s.type==="linkRef"}))}}return p}).filter(function(p){var q=n[p];return q.ref!==undefined||(q.contentRef!==undefined&&(q.content!=""||q.meta!=undefined))||(q.browserRef!==undefined&&q.browserRef!="")||(q.linkRef!==undefined)}).map(function(p){var q=n[p];if(q.contentRef){var r=q.contentRef.split(":");q.contentRef=["cs",(r[0]==="contentRepository"?"contentRepository":"@portalRepository"),r[1]].join(":")}return{name:p=="template"?"templateUrl":f(p,q),value:q.ref||q.contentRef||q.browserRef||q.linkRef||"",type:(q.linkRef&&"linkRef")||((q.contentRef||q.browserRef)&&"contentRef")||"string"}});o=o.concat(m);return o};var i=function(n){n=c.extend(true,{},n);var p=Object.keys(n).reduce(function(s,q){if(q!="widgetName"){var r=n[q];e.setPathOnObj(s,q,r);if(r.contentRef&&r.content&&r.meta&&r.meta["cmis:objectTypeId"]=="bb:structuredcontent"){var t=JSON.parse(r.content.replace(/"\\&quot;|\\&quot;"/g,'\\"'));t.contentRef=r.contentRef;e.setPathOnObj(s,q,t)}else{if(r.meta&&r.meta["cmis:objectTypeId"]=="bb:richtext"){c.each(r.meta,function(v,u){e.setPathOnObj(s,q+"."+v,r.meta[v])})}}}return s},{widgetName:n.widgetName});var o=be.ice.model.client.getWidgetByName(n.widgetName),m=be.ice.model.portal.getPreferences(o).reduce(function(r,q){r[q.name]=q.value;if(q.type){r[q.type]=r[q.type]||{};r[q.type][q.name]=q.value}return r},{});p=c.extend(m,p);return p};var h=function(m){return c("<p>").html(m.replace(/ src=/g," _src="))};var k=function(m){return c(m).html().replace(/ _src=/g," src=")};var g=function(m){for(var n in m){if(m.hasOwnProperty(n)&&typeof m[n]==="object"&&!c.isArray(m[n])){if(m[n].browserRef&&!m[n].linkRef){m[n]=m[n].browserRef}else{m[n]=g(m[n])}}}return m};var j=function(n){for(var o in n){if(n.hasOwnProperty(o)){if(typeof n[o]==="string"&&n[o].match(/^cs:(contentRepository|@portalRepository):[0-9a-f\-]+$/)){var m=n[o].split(":");if(m[1]==="@portalRepository"){m[1]=be.ice.model.repositoryId}n[o]={browserRef:n[o],path:bd.contextRoot+"/content/atom/"+m[1]+"/content?id="+m[2]}}else{if(typeof n[o]==="string"&&n[o].match(/^rel:[0-9a-f\-]+$/)){n[o]={browserRef:"[broken]",path:"[broken]"}}else{if(typeof n[o]==="object"&&!c.isArray(n[o])){n[o]=j(n[o])}}}}}return n};return{preferences2model:b,model2preferences:l,model2mustache:i,html2dom:h,dom2html:k,prefixes:d,obj2contentRef:g,contentRef2obj:j}});be.utils.define("be.ice.model.unified",["be.ice.model.xforms","be.ice.model.portal","be.ice.model.links","be.ice.model.content","be.ice.util","be.ice.config","be.utils","jQuery"],function(j,i,k,g,e,c,f,d){var b=function(n,m,o,l){j=n;portalmodel=m;linkmodel=o;contentmodel=l};var a=function(p,o){var n=i.getName(p);var m=i.getPreferences(p);if(o){m.forEach(function(q){if(q.name=="templateUrl"){q.value=o;return q}})}var l=j.preferences2model(m,n);return d.when.apply(d,Object.keys(l).map(function(q){return l[q]}).filter(function(q){return q.ref!==undefined||q.contentRef!==undefined||q.browserRef!==undefined||q.linkRef!==undefined}).map(function(q){if(q.ref||q.contentRef||q.browserRef){return g.readObject(q.ref||q.contentRef||q.browserRef).then(function(s){if(q.contentRef&&s.content&&s.meta&&s.meta["cmis:objectTypeId"]=="bb:structuredcontent"){var r=JSON.parse(s.content.replace(/"\\&quot;|\\&quot;"/g,'\\"'));r=j.contentRef2obj(r);s.content=JSON.stringify(r)}q=d.extend(q,s);if(q.browserRef==q.contentRef){q.contentRef=null}return q})}if(q.linkRef){return k.resolveLink({uuid:q.linkRef}).then(function(r){q.path=r.path;return q})}})).then(function(){return l})};var h=function(n,l){var m=i.getWidgetByName(n.widgetName);return d.when(l||a(m)).then(function(p){var o={};return e.chain(Object.keys(n).filter(function(q){return q!=="template"&&q!=="widgetName"}).filter(function(q){return n[q].contentRef!==undefined}).filter(function(r){var s=p[r]&&p[r].contentRef;n[r]=j.obj2contentRef(n[r]);if(s&&s.indexOf(":")>-1){n[r].contentRef=s}var q=p[r]===undefined||n[r]!==p[r];if(!q&&p[r]){d.each(n[r].meta||[],function(t,u){var v=p[r].meta;if(v&&v[t]!=u){q=true}})}return q}).map(function(t){o[t]=n[t];var u=n[t],s=function(w){if(w&&w.contentRef){u.contentRef=w.contentRef}else{u.contentRef=r}return n};if(u.meta&&u.meta["cmis:objectTypeId"]=="bb:richtext"){var v=u.content?u.content.replace(/ _src="/gi,' src="'):"";return function(){return g.updateContent(u.contentRef,v,u.meta).then(s)}}var r=u.contentRef;delete u.contentRef;var q=JSON.stringify(u);q=q.replace(/ _src=\\"/gi,' src=\\"');return function(){return g.updateContent(r,q).then(s)}})).then(function(r){var q=j.model2preferences(n);m.model.setPreference("widgetContentsUpdated",new Date().getTime());i.saveModel(m,q).then(function(){if(top.bd&&top.bd.observer){top.bd.observer.notifyObserver(top.bd.pm.observer.updateVisibleLink)}});d.ajax({type:"PUT",headers:{bbCSRF:be.utils.getCookie("bbCSRF")},url:b$.portal.config.serverRoot+"/caches/all/portals/"+(b$.portal.portalName||"[BBHOST]")+"/content/"+q[0].value});return r})})};return{_testinit:b,get:a,save:h}});(function(c,b,a){c.registerViewAnnotator("plaintext",function(d){return d.replace(/>{{([^#\/{&^][^}]*)}}/g,' data-ice-plaintext="$1" contenteditable="true">{{$1}}')});c.registerViewCleaner("plaintext",function(d){return d.replace(/ data-ice-plaintext="([^"]+)" contenteditable="true">[^<]*/g,">{{$1}}")});c.registerModelExtractor("plaintext",function(e){var d={};$(c.toDom(e)).find('[data-ice-plaintext][contenteditable="true"]').each(function(){var g=$(this),j=g.text(),h=g.attr("data-ice-plaintext"),f=h.split(".")[0],i=j&&j.replace(/{{/g,"{\uFEFF{");a.setPathOnObj(d,h,i)});return d});c.registerDomHandler("plaintext",function(d){$(d).find("[data-ice-plaintext]").filter(":not(a)").each(function(e,f){b.attach("ckeditor",f,{config:"plaintext"})})});c.registerDomCleaner("plaintext",function(d){$(d).off(".ice_plaintext").find("[data-ice-plaintext]").filter(":not(a)").each(function(e,f){b.detach("ckeditor",f,{config:"plaintext"})})})})(be.ice.mapper,be.ice.events,be.ice.util);(function(c,b,a){c.registerViewAnnotator("link",function(d){d=d.replace(/ href="{{(([^#\/{&^]*)\.[^}\.]*)}}"/g,' data-ice-link="$1" data-ice-content-path="{{$2.browserRef}}" data-ice-link-ref="{{$2.linkRef}}" href="{{$1}}"');d=d.replace(/ target="{{(([^#\/{&^]*)\.[^}\.]*)}}"/g,' data-ice-target="$1" target="{{$1}}"');return d});c.registerDomHandler("link",function(d){$(d).on("click.ice_link",function(f){var e=$(f.target).parents("a[data-ice-link]")}).find("a[data-ice-link]").each(function(e,f){$(f).addClass("bd-linkArea");b.attach("ckeditor",f);b.attach("drop",f)})});c.registerDomCleaner("link",function(d){$(d).off("click.ice_link").find("a[data-ice-link]").each(function(f,g){var e=$(g);e.removeClass("bd-linkArea").removeClass("bd-ice-link-target").removeAttr("data-ice-link-name");if(this.attributes.title){e.attr("title","")}else{e.removeAttr("title")}if(e.attr("contenteditable")==="false"){e.removeAttr("contenteditable")}b.detach("ckeditor",g);b.detach("drop",g)})});c.registerModelExtractor("link",function(e){var d={},e=$(c.toDom(e));e.find("[data-ice-link]").each(function(){var g=$(this),h=g.attr("data-ice-link"),f;if(h){f=h.split(".").slice(0,-1).join(".")}if(f){a.setPathOnObj(d,f,{path:g.attr("href"),linkRef:g.attr("data-ice-link-ref"),browserRef:g.attr("data-ice-content-path")})}});e.find("[data-ice-target]").each(function(){var g=$(this),h=g.attr("data-ice-target"),f;if(h){if(f=h.split(".").slice(0,-1).join(".")){a.setPathOnObj(d,f,{target:g.attr("target")})}}});console.log("link extractor",d);return d});c.registerViewCleaner("link",function(d){var e=d.match(/<a[^>]*>/gi);if(e){e.map(function(i){var g,h,j=i.match(/ data-ice-link="([^"]*)"/),f=i.match(/ data-ice-target="([^"]*)"/);if(j){g=i.replace(/ href="[^"]*"/g,' href="{{'+j[1]+'}}"').replace(/ data-ice-content-path="([^"]*)"/g,"").replace(/ data-ice-link-ref="([^"]*)"/g,"").replace(/ data-ice-link-name="([^"]*)"/g,"").replace(/ data-ice-link="([^"]*)"/g,"");d=d.replace(i,g)}if(f){h=g.replace(/ target="[^"]*"/g,' target="{{'+f[1]+'}}"').replace(/ data-ice-target="([^"]*)"/g,"");d=d.replace(g,h)}})}return d})})(be.ice.mapper,be.ice.events,be.ice.util);(function(c,d,b,a){d.registerViewAnnotator("image",function(e){var f=e.replace(/ src="{{(([^}]*)\.[^}\.]+)}}"/g,' data-ice-src="$1" data-ice-ref="{{$2.browserRef}}" src="{{$1}}"');return f});d.registerViewCleaner("image",function(e){return e.replace(/ data-ice-src="([^"]+)" data-ice-ref="[^"]*" src="[^"]*"/g,' src="{{$1}}"')});d.registerModelExtractor("image",function(f){var e={};c(d.toDom(f)).find("[data-ice-src][data-ice-ref]").each(function(){var h=c(this),k=h.attr("_src"),i=h.attr("data-ice-src"),j=h.attr("data-ice-ref"),g=i.split(".").slice(0,-1).join(".");a.setPathOnObj(e,i,k);a.setPathOnObj(e,g+".browserRef",j)});return e});d.registerDomHandler("image",function(e){c(e).find("[data-ice-src]").addClass("bd-imgArea").attr("contenteditable","false").each(function(){b.attach("ckeditor",this);b.attach("drop",this);if(c(this).attr("data-ice-ref")==="[broken]"){c(this).parent().addClass("broken");c(this).attr("data-ice-ref","").attr("src","")}})});d.registerDomCleaner("image",function(f){var e=c(f).find("[data-ice-src]").removeClass("bd-imgArea").removeClass("bd-ice-link-target").removeAttr("contenteditable").each(function(){b.detach("drop",this);b.detach("ckeditor",this);c(this).parent().removeClass("broken")})})})(jQuery,be.ice.mapper,be.ice.events,be.ice.util);(function(c,b,a){c.registerViewAnnotator("richtext",function(d){return d.replace(/>{{{([^}]*)}}}/g,' data-icerichtext="$1" contenteditable="true">{{{$1}}}')});c.registerViewCleaner("richtext",function(d){return d.replace(/ data-icerichtext="([^"]+)" contenteditable="true">(.*)<\//g,">{{{$1}}}</")});c.registerModelExtractor("richtext",function(d){return c.toDom(d).find("[data-icerichtext]").toArray().reduce(function(e,h){var g=$(h).attr("data-icerichtext"),f=g.split(".");a.setPathOnObj(e,g,$(h).html());return e},{})});c.registerDomHandler("richtext",function(d){$(d).find("[data-icerichtext]").each(function(f,g){var h=g.getAttribute("data-icerichtext"),e=h&&h.split(".")[1];b.attach("ckeditor",g,{});b.attach("drop",g)}).addClass("bd-contentEditor-div-editable")});c.registerDomCleaner("richtext",function(d){$(d).off(".ice_richtext").find("[data-icerichtext]").each(function(e,f){b.detach("ckeditor",f);b.detach("drop",f)})})})(be.ice.mapper,be.ice.events,be.ice.util);(function(b,d,a){d.registerViewAnnotator("richtext-link",function(e){var f=e.replace(/ href="{{([^#\/{&^][^}]*)}}"/g,' data-ice-rtlink="$1" href="{{$1}}"');return f});d.registerDomHandler("richtext-link",function(e){});d.registerDomCleaner("richtext-link",function(f){var e=b(f);e.find("[data-cke-saved-href]").removeAttr("data-cke-saved-href");e.find("[data-ice-link-name]").each(function(h,j){var k=b(j).not("[data-ice-link]"),g=k.attr("data-ice-link-name");k.attr("data-ice-rtlink",g+".path").removeAttr("data-ice-link-name")});e.find("[data-ice-rtlink][href]").attr("href","")});var c=function(f,e){return(f.match(/<a[^>]*>/gi)||[])};d.registerModelExtractor("richtext-link",function(f){var e={};c(f).map(function(g){var i=b(g).filter("[data-ice-rtlink]");if(i.length){var h=i.attr("data-ice-rtlink").split(".")[0];e[h]={path:i.attr("href"),linkRef:i.attr("data-ice-link-ref")||null,browserRef:i.attr("data-ice-content-path")||null}}});return e});d.registerViewCleaner("richtext-link",function(e){c(e).map(function(g){var f,h=g.match(/ data-ice-rtlink="([^"]*)"/);if(h){f=g.replace(/ href="[^"]*"/g,' href="{{'+h[1]+'}}"').replace(/ data-ice-rtlink="([^"]*)"/g,"");e=e.replace(g,f)}});return e})})(jQuery,be.ice.mapper,be.ice.events);(function(c,d,b,a){d.registerViewAnnotator("richtext-image",function(e){return e.replace(/ src="{{([^#\/{&^][^}]*)}}"/g,' src="{{$1}}" data-ice-rtimage="$1"')});d.registerDomHandler("richtext-image",function(e){});d.registerDomCleaner("richtext-image",function(e){c(e).find("[data-cke-saved-src]").removeAttr("data-cke-saved-src");c(e).find("[data-ice-refname]").each(function(){var f=this.getAttribute("data-ice-refname");this.setAttribute("data-ice-rtimage",f+".path")}).removeAttr("data-ice-refname");c(e).find("[data-ice-rtimage]").each(function(){var f=jQuery(this),g=f.attr("src");g=g.slice(g.indexOf(bd.contextRoot));f.attr("src",g)})});d.registerModelExtractor("richtext-image",function(g){var f=c(g).find("img[data-ice-rtimage]"),e={};f.each(function(j,k){var h=k.getAttribute("data-ice-rtimage").split(".")[0];e[h]={path:k.getAttribute("src"),browserRef:k.getAttribute("data-ice-content-path")}});return e});d.registerViewCleaner("richtext-image",function(e){(e.match(/<img[^>]*>/gi)||[]).map(function(g){var f,h=g.match(/ data-ice-rtimage="([^"]*)"/);if(h){f=g.replace(/ src="[^"]*"/,' src="{{'+h[1]+'}}"');e=e.replace(g,f)}});return e})})(jQuery,be.ice.mapper,be.ice.events,be.ice.util);(function(f,c,d){d.registerEventListener("incontextnav",function(h,g){e(g)});var a=function(h,o,p,i){var k=h.offset(),n=h.height()+k.top+8,j=k.left,l=o.offset()["left"]+o.width(),m=h[0],g=h.attr("href"),q="_self";if(j>l){j=l}if(location.host===m.host&&location.protocol===m.protocol){q="_self"}else{q="_blank"}p.css({top:n+"px",left:j+"px"});if(g){if(q==="_self"){if(i.designmode){g+=(g.indexOf("?")!==-1?"&":"?")+"designmode=true"}if(i.devmode){g+=(g.indexOf("?")!==-1?"&":"?")+"devmode=true"}}p.children(".bd-ice-linkIcon").attr({href:g,target:q}).removeClass("bc-gradient-grey-disabled")}else{p.children(".bd-ice-linkIcon").attr({href:"#",target:"_self"}).addClass("bc-gradient-grey-disabled")}};var b=function(h,g){if(!h||!h.parentNode||h===g){return false}else{if(h.nodeName==="A"){return h}else{return b(h.parentNode,g)}}};var e=function(h){var i=f(h.body),j=f("body"),g=f('<div class="bd-ice-arrow-box bc-roundcorner-3"><a class="bd-ice-linkIcon bc-button bc-gradient-grey bc-roundcorner-3" href="">GO TO LINK</a></div>'),k=false;if(!j.children(".bd-ice-arrow-box").length){j.append(g)}else{g=j.children(".bd-ice-arrow-box")}i.on("click.ice-enableInContextNav",function(q){clearInterval(k);if(!q.target){return}var p=q.target;if(!p){clearInterval(k);return}var o,n=p,m=b(n,this),l=c.getQueryStringParam();if(m===false){clearInterval(k);g.hide();return}else{n=m}o=f(n);a(o,i,g,l);g.show();k=setInterval(function(){if(!o.closest("body").length){clearInterval(k);g.hide()}else{a(o,i,g,l)}},400)}).on("keydown.ice-enableInContextNav",function(l){clearInterval(k);if(!l.target){return}var m=this;k=setInterval(function(){var r=be.utils.getCursor(l.target).getStartElement();if(!r){clearInterval(k);return}var q,p=r,o=b(p,m),n=c.getQueryStringParam();if(o===false){g.hide();clearInterval(k);return}else{p=o}q=f(p);if(!q.closest("body").length){clearInterval(k);g.hide()}else{a(q,i,g,n);g.show()}},400)}).on("iceFocusOut",function(){clearInterval(k);g.hide()})}})(jQuery,be.utils,be.ice.events);(function(d,b){var g="cs";var a="${portalRepository}";var f=false,e={},c=false;b.registerEventListener("init-drop",function(k,j){var i=function(n){var m={};if(n&&n.helper&&n.helper.bdDragData){m=n.helper.bdDragData}return{linkData:m&&m.link,fileData:m&&m.fileDataArray&&m.fileDataArray[0]}};var l=function(m,n){return function(p,o){d(p.originalEvent&&p.originalEvent.target||p.target).trigger("ice_"+m+".iceDrop",n?i(o):null)}};k.bdDrop({activate:l("activate",true),deactivate:l("deactivate"),enter:l("enter",true),leave:l("leave"),over:l("over",true),out:l("out"),drop:l("drop",true)});b.attach("updatelink",k)});b.registerEventCleaner("init-drop",function(i){i.bdDrop("destroy")});var h=function(i){var j=i.nodeName;return{link:j==="A",image:j==="IMG",richtext:j!=="IMG"&&j!=="A"}};b.registerEventListener("drop",function(u,z){var l=h(u),r=d(u),s=function(A){return(A.linkData&&n(A.linkData)||A.fileData&&A.fileData.metaData&&A.fileData.metaData["cmis:objectTypeId"].property!=="bb:richtext")},q=function(F,E){var A=d(F),D=A.hasClass("bd-ice-wrapper")?A.find("img"):A,C=D.prop("tagName").toLowerCase(),B=D.closest('[contenteditable="true"]').length>0;if((C=="a"||C=="img")&&B&&s(E)){return true}return false},n=function(B){var D=y(B,"itemType"),C=["menuHeader","divider"],A=B&&(!B.isMasterPage&&C.indexOf(D)==-1);return A},m=function(A){if(c){c=false;d(A).removeClass("bd-ice-link-target").find(".bd-ice-link-target").removeClass("bd-ice-link-target")}},t=function(B){var A=d(B);return A.hasClass("bd-contentEditor-container")||A.hasClass("bd-textContent-dropArea")},y=function(A,B){var C=A&&A.properties;if(C&&C[B]){return C[B].value}},i=function(A){if(d(A).parent(".bd-ice-wrapper").length===0){d(A).wrap('<div class="bd-ice-wrapper"></div>')}return p(A)},x=function(A){d(".bd-ice-wrapper img",A).unwrap()},p=function(A){var B=d(A).parent(".bd-ice-wrapper");return B.toggleClass("bd-ice-wrapper-empty",!A.getAttribute("src")||A.getAttribute("src")==="[broken]")},v=function(B,A){var C=d(B).parent(".bd-ice-wrapper");C.removeClass("bd-ice-wrapper-replace bd-ice-wrapper-hightlight");if(A&&C.length){C.addClass("bd-ice-wrapper-hightlight");if(!C.hasClass("bd-ice-wrapper-empty")){C.addClass("bd-ice-wrapper-replace")}}},j=function(A){if(l.image){v(u,false)}else{m(u)}},w=function(C,B){var A;if(d(".pm-icon2:visible",C.target.ownerDocument).length>0){return false}if(!q(C.target,B)){return false}if(l.image&&B.fileData&&B.fileData.type.indexOf("image")>-1){v(u,true)}else{m(u);A=d(C.target);if(!A.hasClass("bd-ice-link-target")){c=true;A.addClass("bd-ice-link-target")}}},o=function(D,C){var B=d(D.target),A=C.fileData,E=A&&A.type.indexOf("image")>-1;if(l.image){if(E){d(u).attr({"data-ice-ref":[g,A.repository==="contentRepository"?A.repository:"@portalRepository",A.contentUId].join(":"),src:A.url});p(u);v(u,false);d(u).trigger("ckEditDropped.iceImage")}}else{if(s(C)||E){B.trigger("ice.updatelink",C)}m(B)}B.trigger("ice.change")};if(l.image){var k=d(u);k.on("removeImage.iceImage",function(){this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";this.src="";this.setAttribute("data-ice-ref","");p(u);k.trigger("ice.change")});r=i(u)}r.on("ice_deactivate.iceDrop",j).on("ice_leave.iceDrop",j).on("ice_over.iceDrop",w).on("ice_out.iceDrop",j).on("ice_drop.iceDrop",o)});b.registerEventCleaner("drop",function(k){var j=h(k),i=d(k);if(j.image){var l=i.parent(".bd-ice-wrapper");if(l.length){l.off(".iceDrop");i.unwrap()}}else{i.off(".iceDrop")}i.removeAttr("onice_deactivate onice_leave onice_over onice_out onice_drop")})})(jQuery,be.ice.events);(function(c,a,b){a.registerEventListener("init-ckeditor",function(f,e){b.fire("initSetup.ice")});a.registerEventListener("ckeditor",function(i,h){var g={},e=c(i),f=function(k){var j=c(k);if(c(".pm-icon2:visible",k.ownerDocument).length>0){return false}var l=(j.text()===""||(j.html().charCodeAt(0)===8203&&j.html().lenght===1))&&j.is('[contenteditable="true"]');j.toggleClass("bd-ice-content-empty",l);return true};f(i);e.on("mouseover",function(){var j=this;c(j).one("mouseout",function k(){var m=c(j);if(m.is('[contenteditable="true"]')){var l=m.html();if(l.charCodeAt(0)===8203){m.html(l.substring(1))}if(m.text()===""){m.html("")}}})}).on("blur.ice_cke",function(j){if(!f(this)){return false}}).on("focus",function(j){if(!f(this)){return false}});if(h&&h.config&&a.config&&a.config.editor&&a.config.editor[h.config]){g=a.config.editor[h.config]}b.inline(i,g)});var d=function(e){if(!c("html").hasClass("mozilla")){return}e.children("br:last-child").remove()};a.registerEventCleaner("ckeditor",function(f){var e=c(f);e.off(".ice_cke").removeClass("cke_editable cke_editable_inline cke_contents_ltr cke_contents_rtl cke_focus cke_show_borders bd-dm-clicked bd-contentEditor-div-editable bd-ice-content-empty").removeAttr("tabindex spellcheck role style aria-label aria-describedby data-cke-expando").filter('[class=""]').removeAttr("class");e.closest("[sizset]").removeAttr("sizset")})})(jQuery,be.ice.events,CKEDITOR);(function(f,j){j.registerEventListener("updatelink",function(m,l){f(m).on("ice.updatelink",function(p,n){var o=f(p.target),q=n.fileData&&n.fileData.type.indexOf("image")>-1;n.link=n.link||(o.is("a")?p.target:o.closest("a")[0]);if(o.is("img")){n.image=p.target}if(!n.link&&q){g(n)}else{k(n)}})});var i=function(l,m){var n=l&&l.properties;if(n&&n[m]){return n[m].value}},a=function(l){var m,n="page";if(l){m=i(l,"itemType");if(m==="page"&&i(l,"isDefaultLandingPage")==="true"){m="landingPage"}if(m==="page"&&l.isMasterPage){m="masterpage"}}return m||n},c=function(l){return top.bd.pm.controller.onLinkByUUID(l)},k=function(l){if(l.linkData||l.fileData){e(l)}else{if(l.uuid){c(l.uuid).done(function(m){l.linkData=m;e(l)})}else{b(l)}}},d=function(p){var l={},r,q=p.attr||{},m=p.linkData,n=p.fileData,o=p.resetLink;l["data-cke-saved-href"]=null;if(o){l["data-ice-content-path"]="";l["data-ice-link-ref"]="";l["data-ice-link-name"]="";l.href=""}else{if(m){r=a(m);l["data-ice-content-path"]="";l["data-ice-link-ref"]=m.uuid;l["data-ice-link-name"]=m.name;if(p.link&&p.link.attributes.title){l.title=i(m,"menuAccessibilityTitle")||p.link.attributes.title.value}if(m.referencedItem){l.href=bd.contextRoot+"/"+m.finalUrl}else{if(r=="externalLink"){l.href=m.finalUrl}else{if(r=="menuHeader"){l.href=null}}}}if(n){l["data-ice-content-path"]=n.path;l["data-ice-link-ref"]="";l["data-ice-link-name"]="_"+n.contentUId;l.href=n.url}}return f.extend(l,q)},e=function(l){l.attr=d(l);if(l.resetLink&&l.link){f(l.link).attr(l.attr)}else{if(l.attr.href){if(l.link){f(l.link).attr(l.attr)}else{if(l.image){f(l.image).wrap(f("<a>").attr(l.attr))}else{l.label=l.linkData?i(l.linkData,"title"):l.fileData.name;h(l)}}}}},b=function(n){var m=n.link,l=n.attr||{};if(m){f(m).attr(l);m.removeAttribute("data-ice-link-ref");m.removeAttribute("data-cke-saved-href")}else{n.label=n.attr.title||n.attr.href;h(n)}},h=function(q){var m=window.CKEDITOR&&window.CKEDITOR.currentInstance,p,r,l,s="",o,n;if(m){p=m.getSelection();r=p.getSelectedText();n=p.getSelectedElement();l=r||q.label;o=f("<a>").attr(q.attr);if(n&&n.is("img")){f(n.$).wrap(o)}else{o.text(l);s=o.get(0).outerHTML;m.insertHtml(s)}}else{}},g=function(s,q){var r=s.fileData,l=r.url.replace("?id=",r.path+"?id="),p={"data-ice-content-path":["cs",r.repository==="contentRepository"?r.repository:"@portalRepository",r.contentUId].join(":"),"data-ice-content-preview":l,"data-ice-refname":"rtimage_"+r.contentUId,src:l};var t=window.CKEDITOR&&window.CKEDITOR.currentInstance,n,o="",m;if(t){n=t.getSelection();m=n.getSelectedElement();if(m&&m.is("img")){f(m.$).attr(p)}else{o=f("<img />").attr(p).get(0).outerHTML;t.insertHtml(o)}}else{if(s.image){f(s.image).attr(p)}}}})(jQuery,be.ice.events);be.utils.define("be.ice.controller",["jQuery","be.ice.model.unified","be.ice.mapper","be.ice.events","be.ice.model.xforms","be.ice.util"],function(f,h,a,l,j,g){var e={};var c=function(m){var n=e.getContentPath(m.widgetName);m=f.extend(true,{},m);Object.keys(m).filter(function(o){return o!=="template"&&o!=="widgetName"}).filter(function(o){return m[o].browserRef===undefined}).map(function(o){m[o].contentRef=n+"/"+o});return m};var k=function(o,p,n){var m=false;f(p).on("ice.change",function(){var r=true;if(m){return}m=true;var u=a.cleanupHandlers(f(p).clone(true,true));u=l.detachEvents(u);u.find('[style="display: block;"]').removeAttr("style");u.find('[style="display: none;"]').removeAttr("style");u.find('[ice-ignore="true"]').remove();var s=a.toView(u,r);var t=a.cleanupAndExtract(s);a.separateMetaData(t,o);t.widgetName=o.widgetName;t.template=o.template;var q=a.annotate(t.template.content.replace(/<script[^>]+><\/script>/g,""),f.extend(true,{},j.model2mustache(t),n));q=a.normalizeView(q);s=g.cleanup(s);q=g.cleanup(q);t=c(t);if(s!==q){g.consoleDiff(s,q);g.log(t);if(s.length!==q.length){g.portalManagerMessage({message:"Unable to save widget content! Please contact your administrator."});m=false;return}}h.save(t);m=false});return p};var d=function(m,n){h=m;a=n;return{config:e,editHandler:k}};var b=function(p,o,n){var m=true;return h.get(p,o).then(function(r){var s=p.iceConfig.mappers.filter(function(u){return u=="mustache"});n=n||{};var q=a.annotate(r.template.content,f.extend(true,{},j.model2mustache(r),n),s);var t=a.toDom(q,m);return a.attachHandlers(t,s,p)})};var i=function(q,p,o){var n=true,m;q.saveContent=function(){};f(q.body).addClass("be-ice-widget-enabled");f.ajax(b$.portal.config.serverRoot+"/portals/"+b$.portal.portalName+"/catalog.xml?f=type(eq)CONTENTREPOSITORY",{async:false}).then(function(r){be.ice.model.repositoryId=f('contentRepository > properties > [name="repositoryId"] > value',r).text()});e=q.iceConfig||{};if(e){a.config.names=e.mappers||[];l.config.names=e.events||[];l.config.editor=e.ckeditor||{};g.config=e||{}}m=h.get(q,p).then(function(t){o=o||{};var u=/<script\b[^>]*>([\s\S]*?)<\/script>/gm;var s=u.exec(t.template.content);var w="";var x="";if(s){u=/\ssrc=(?:(?:'([^']*)')|(?:"([^"]*)")|([^\s]*))/i;w=u.exec(s[0]);if(w){w=g.getContextRoot()+w[0].replace(' src="',"").replace('"',"");u=/\sid=(?:(?:'([^']*)')|(?:"([^"]*)")|([^\s]*))/i;x=u.exec(s[0])[2];f.getScript(w,function(){gadgets.pubsub.publish("enable:"+x,{src:w,widget:q})})}}var r=a.annotate(t.template.content.replace(/<script[^>]+><\/script>/g,""),f.extend(true,{},j.model2mustache(t),o));var v=a.toDom(r,n);v=l.attachEvents(v,q);v=a.attachHandlers(v);f(q.body).addClass("be-ice-widget-rendered");return k(t,v,o)});setTimeout(function(){f(q.htmlNode).trigger("ice.rerendered")},0);return m};return{render:b,edit:i,_testinit:d,editHandler:k}});