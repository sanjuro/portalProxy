/*******************************************************************
 *
 *		Backbase Client 5.2.0.0 20120504-1127
 *
 *		Copyright Backbase 2008 / All rights reserved
 *		Author : Backbase R&D
 *
 *******************************************************************/
window.b$={version:"5.2.0.0",timestamp:"20120504-1127"};if(window.OpenAjax){OpenAjax.hub.registerLibrary("b$","http://backbase.com",b$.version)}b$.browser=(function(){var a={ie:false,gecko:false,opera:false,webkit:false,name:null,version:0,quirks:false};if(document.all&&!navigator.userAgent.match(/opera/i)&&!navigator.appVersion.match(/mac/i)){a.ie=true;a.name="ie";a.version=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE ")+5,3));(function(){try{var c=new ActiveXObject("MSXML2.XSLTemplate")}catch(d){a.ie=false}})()}else{if(typeof window.XSLTProcessor!="undefined"){if(window.controllers&&parseInt(navigator.productSub,10)>20031001){a.gecko=true;a.name="gecko";a.version=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("rv:")+3,4))}else{if(navigator.userAgent.match(/opera/i)){a.opera=true;a.name="opera";a.version=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf(/opera[ \/]/i)+7,5))}else{if(navigator.userAgent.match(/applewebkit/i)){a.webkit=true;a.name="webkit";a.version=parseFloat(navigator.userAgent.match(/applewebkit\/([0-9\.]+)/i)[1]);a.air=navigator.userAgent.match(/AdobeAIR/)&&!!window.runtime}}}}}if(a.ie&&a.version<7){try{document.execCommand("BackgroundImageCache",false,true)}catch(b){}}return a})();(function(){var v=b$.browser;var k=["toString","hasOwnProperty","toLocaleString","isPrototypeOf","valueOf","constructor","propertyIsEnumerable"];var i=Object.prototype.hasOwnProperty;function t(z,y,A,C){y=y||function(){z.apply(this,arguments)};o(y,z);if(C){o(y,C)}var B=new Function;B.prototype=z.prototype;y.prototype=o(new B,A);y.prototype.constructor=y;y.superClass=z;return y}function o(B,y){var z="";if(y){for(z in y){if(i.call(y,z)){B[z]=y[z]}}if(v.ie&&v.version<9){for(var A=0;A<k.length;++A){z=k[A];if(i.call(y,z)){B[z]=y[z]}}}}return B}var r=function(){};r.superClass=null;r.classID=0;var q=1;r.extend=function(y,A,B){var z=t(this,y,A,B);z.classID=q++;return z};r.getClassID=function(){return this.classID};r.prototype.toString=function(){return m(this)||"b$.Class"};var j=r.extend(function(y){this.message=y});j.prototype.toString=function(){return this.message};var p=r.extend(function(){});p.prototype.test=function(y){return true};var s=p.extend(function(y){this.test=y});var u=p.extend(function(y){this.type=y});u.prototype.test=function(y){if(this.type instanceof p){return this.type.test(y)}return y instanceof this.type};var e=u.extend(function(y){u.call(this,y)});e.prototype.test=function(y){return y===null||u.prototype.test.call(this,y)};var f=u.extend(function(y){u.call(this,y)});f.prototype.test=function(y){return y==undefined||u.prototype.test.call(this,y)};var d=p.extend(function(y){this.pattern=y});d.prototype.test=function(z){if(!z){return false}for(var y in this.pattern){if(!l(z[y],this.pattern[y])){return false}}return true};d.prototype.extend=function(z){for(var y in this.pattern){if(!(y in z)){z[y]=this.pattern[y]}}return new d(z)};d.prototype.implementedBy=function(y){if(!this.test(y.prototype)){throw new Error("Interface not implemented by class.")}};function l(y,z){if(z instanceof p){return z.test(y)}if(z instanceof Function){return y instanceof z}throw new Error("Wrong type passed to checkType().")}function a(B,A){for(var z=0,y=A.length;z<y;z++){if(!l(B[z],A[z])){throw new c(null,B,z,A[z])}}}var c=j.extend(function(y,B,z,A){this.message=y;this.arguments=B;this.index=z;this.expected=A});c.prototype.toString=function(){return"ArgumentException - Wrong argument type for argument "+this.index+" ("+this.arguments[this.index]+") in "+this.arguments.callee+"."+(this.message?" ("+this.message+")":"")};var x=r.extend(function(z,y){this.name=z;this.initializer=y;this.object=null});x.prototype.create=function(){var y=this.getNamespace();this.initializer.call(y);return y};x.prototype.getNamespace=function(){if(this.object){return this.object}var A=window;var y=this.name.split(".");if(y.length==1&&y[0]==""){return A}for(var z=0;z<y.length;z++){if(!(y[z] in A)){A=A[y[z]]={}}else{A=A[y[z]]}}x.namespaces[this.name]=A;return this.object=A};x.namespaces={"b$":b$};function b(A,y){var z=new x(A,y);return z.create()}function g(C){var B=window;var y=C.split(".");if(y.length==1&&y[0]==""){return B}for(var A=0;A<y.length;A++){if(y[A] in B){B=B[y[A]]}else{var E=new Error('Cannot find object "'+C+'".');if(E.stack){var z=E.stack&&E.stack.split("\n")[2];var D=z&&z.match(/^[^@]*@(.*):(\d+)$/);if(D&&D[1]&&D[2]){E=new Error(E.message,D[1],Number(D[2]))}}throw E}}return B}function w(z){for(var B in x.namespaces){if(x.namespaces.hasOwnProperty(B)){var A=x.namespaces[B];for(var y in A){if(z==A[y]){return B+"."+y}}}}return null}function m(A){if(!A.constructor){throw new c("Instance object expected.",arguments,0,null)}var C=A.constructor;var z=null;var F=null;for(var E in x.namespaces){if(x.namespaces.hasOwnProperty(E)){var B=x.namespaces[E];for(var y in B){if(B.hasOwnProperty(y)){var D=B[y];if(C==D){return E+"."+y}else{if(D instanceof Function&&A instanceof D&&(!F||D.prototype instanceof F)){z=E+"."+y+" (subclass)";F=D}}}}}}return z}var n=r.extend(function(){throw new Error("Must implement.")});n.prototype.next=function(){throw new Error("Must implement.")};n.prototype.hasNext=function(){throw new Error("Must implement.")};n.prototype.forEach=function(z,y){while(this.hasNext()){z.call(y||this,this.next())}};var h=n.extend(function(y){this.array=y;this.index=0});h.prototype.next=function(){return this.array[this.index++]};h.prototype.hasNext=function(){return this.index<this.array.length};b$.extend=t;b$.mixin=o;b$.Class=r;b$.Exception=j;b$.TypeConstraint=p;b$.TypeConstraintFn=s;b$.TypeConstraintObject=u;b$.TypeConstraintNull=e;b$.TypeConstraintOptional=f;b$.Interface=d;b$.checkType=l;b$.testArguments=a;b$.ArgumentException=c;b$.Module=x;b$.module=b;b$.require=g;b$.findExport=w;b$.findExportClass=m;b$.Iterator=n;b$.ArrayIterator=h})();b$.module("b$.types",function(){var i=b$.require("b$.TypeConstraintFn");var h=b$.browser.ie;var b=new i(function(m){return true});var e=new i(function(m){return typeof m=="number"||m instanceof Number});var g=new i(function(m){return typeof m=="string"||m instanceof String});var f=new i(function(m){return typeof m=="boolean"||m instanceof Boolean});var l=new i(function(m){return typeof m=="function"});var d=new i(function(m){if(!h){return m instanceof Node}else{return !!m&&"nodeType" in m&&"ownerDocument" in m&&"parentNode" in m&&"nodeName" in m&&"nodeValue" in m&&"nextSibling" in m&&"previousSibling" in m}});var k=new i(function(m){if(!h){return m instanceof Element}else{if(window.Element&&!(m&&"selectNodes" in m)){return !!m&&m instanceof Element}else{return d.test(m)&&m.nodeType==1}}});var j=new i(function(m){if(!h){return m instanceof Document}else{if(window.HTMLDocument&&!(m&&"selectNodes" in m)){return !!m&&m instanceof HTMLDocument&&m.nodeType==9}else{return d.test(m)&&m.nodeType==9}}});var c=new i(function(m){if(!h){return m instanceof HTMLElement}else{if(window.Element&&window.HTMLDocument){return !!m&&m instanceof Element&&!!m.ownerDocument&&m.ownerDocument instanceof HTMLDocument}else{return d.test(m)&&m.nodeType==1&&!("baseName" in m)}}});var a=new i(function(m){if(!h){return m instanceof HTMLDocument}else{if(window.HTMLDocument){return !!m&&m instanceof HTMLDocument&&m.nodeType==9}else{return d.test(m)&&m.nodeType==9&&!("baseName" in m)}}});this.ANY=b;this.NUMBER=e;this.STRING=g;this.BOOLEAN=f;this.FUNCTION=l;this.NODE=d;this.ELEMENT=k;this.DOCUMENT=j;this.HTMLELEMENT=c;this.HTMLDOCUMENT=a});b$.module("b$.bom",function(){var b=b$.require("b$.browser.gecko");var p=b$.require("b$.browser.ie");var j=9;function c(s){var q=document.createElement("div"),r=null;if(!s){return null}s=s.replace(/^\w|\w$/g,"");var t=s.match(/^<([a-z0-9]+)/i);if(!t){return null}switch(t[1]){case"tbody":case"thead":case"tfoot":q.innerHTML="<table>"+s+"</table>";r=q.firstChild.firstChild;break;case"tr":q.innerHTML="<table><tbody>"+s+"</tbody></table>";r=q.firstChild.firstChild.firstChild;break;case"td":case"th":q.innerHTML="<table><tbody><tr>"+s+"</tr></tbody></table>";r=q.firstChild.firstChild.firstChild.firstChild;break;case"option":q.innerHTML="<select>"+s+"</select>";r=q.firstChild.firstChild;break;default:q.innerHTML="&nbsp;"+s;r=q.childNodes[1];break}return r.parentNode.removeChild(r)}var e=window.DOMParser;if(!e){e=function(){this.baseURI=null};e.prototype.parseFromString=function(s,q){var r=new ActiveXObject("Microsoft.XMLDOM");try{r.setProperty("SelectionLanguage","XPath")}catch(t){}r.async=false;r.preserveWhiteSpace=true;r.validateOnParse=false;r.resolveExternals=false;r.loadXML(s);return r}}var o=window.XMLSerializer;if(!o){o=function(){};o.prototype.serializeToString=function(q){return q.nodeType==9?q.xml.replace(/\s+$/g,""):q.xml}}var k=window.XSLTProcessor;if(!k){k=function(){this._template=new ActiveXObject("MSXML2.XSLTemplate");this._outputMethod="xml";this._parameters={}};k.prototype.importStylesheet=function(s){var q=new ActiveXObject("MSXML2.FreeThreadedDOMDocument");q.async=false;if(s.nodeType==j&&s.url){s.setProperty("SelectionLanguage","XPath");s.setProperty("SelectionNamespaces",'xmlns:xsl="http://www.w3.org/1999/XSL/Transform"');if(s.selectSingleNode("//xsl:*[local-name() = 'include' or local-name() = 'import']")!==null){q.load(s.url)}else{q.loadXML(s.xml)}}else{q.loadXML(s.xml)}q.setProperty("SelectionNamespaces",'xmlns:xsl="http://www.w3.org/1999/XSL/Transform"');var r=q.selectSingleNode("//xsl:output");this._outputMethod=r?r.getAttribute("method"):"html";this._template.stylesheet=q;this.clearParameters()};k.prototype._transformToString=function(t){var s=this._template.createProcessor();for(var q in this._parameters){for(var r in this._parameters[q]){if(q){s.addParameter(r,this._parameters[q][r],q)}else{s.addParameter(r,this._parameters[q][r])}}}s.input=t;s.output=null;s.transform();return s.output};k.prototype.transformToDocument=function(t){var r=this._transformToString(t),s=this._outputMethod,q=null;if(s=="text"){return new e().parseFromString("<transformation>"+r+"</transformation>","text/xml")}else{if(s=="xhtml"||s=="html"){throw new Error("Feature is not supported!")}else{if(s=="xml"){return new e().parseFromString(r,"text/xml")}}}};k.prototype.transformToFragment=function(u,v){var r=this._transformToString(u),t=this._outputMethod,s=v.createDocumentFragment(),q=null;if(t=="text"){s.appendChild(v.createTextNode(r))}else{if(t=="xhtml"||t=="html"||t=="xml"){if(t=="xml"){q=new e().parseFromString("<root>"+r.replace(/\w*<\?xml[^\?]*\?>/g,"")+"</root>","text/xml").documentElement}else{q=c("<div>"+r+"</div>")}while(q.firstChild){s.appendChild(q.firstChild)}}}return s};k.prototype.setParameter=function(q,s,r){q=q||"";if(!this._parameters[q]){this._parameters[q]={}}this._parameters[q][s]=r};k.prototype.getParameter=function(r,s){var q=this._parameters[r||""];return q&&q[s]||null};k.prototype.removeParameter=function(r,s){var q=this._parameters[r||""];if(q&&q.hasOwnProperty(s)){delete q[s]}};k.prototype.clearParameters=function(){this._parameters={}};k.prototype.reset=function(){this.clearParameters();this._template=new ActiveXObject("MSXML2.XSLTemplate")}}var d;if(window.XMLHttpRequest&&(!p||(p&&String(location.href).indexOf("file")!=0))){d=window.XMLHttpRequest}else{d=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var n=0;var i=1;var g=2;var l=3;var h=4;var m=function(){this._object=new d();this._sendInvoked=false;if(this._object.wrapped){this.wrapped=this._object.wrapped}this.readyState=n;this.responseText="";this.responseXML=null;this.status=0;this.statusText="";this.onreadystatechange=null;this._handleUnloadForIE=null};m.prototype.open=function(z,s,u,B,w){if(u===undefined){u=true}if(String(s).indexOf("wsrp-urlType")!=-1){s=String(s);var A=s.indexOf("wsrp-url=")+9;var t=s.substr(A).split("&");var C=decodeURIComponent(t[0]);var v=s.substr(s.indexOf("?")+1).split("&");var y=[];for(var x=0;x<v.length;x++){if(v[x].indexOf("wsrp")!==0&&v[x]){y.push(v[x])}}t[0]=encodeURIComponent(C+(C.indexOf("?")<0?"?":"&")+y.join("&"));s=s.substr(0,A)+t.join("&")}this._headers=[];this._async=u;this._sendInvoked=false;this._aborted=false;var r=this;var q=this.readyState;if(p&&u){this._handleUnloadForIE=function(){if(r._object.readyState!=h){r.abort()}};window.attachEvent("onunload",this._handleUnloadForIE)}this._object.onreadystatechange=function(){r._handleReadystatechange()};if(arguments.length>4){this._object.open(z,s,u,B,w)}else{if(arguments.length>3){this._object.open(z,s,u,B)}else{this._object.open(z,s,u)}}if(!u&&b){this.readyState=i;a(this)}};m.prototype.send=function(q){if(q&&q.nodeType){if(!this._headers["Content-Type"]){this.setRequestHeader("Content-Type","application/xml")}q=new o().serializeToString(q)}if(this._async){this._sendInvoked=true}this._object.send(q);if(b&&!this._async){this.readyState=g;a(this);this.readyState=l;a(this);this.readyState=h;this.status=this._object.status;this.statusText=this._object.statusText;this.responseText=this._object.responseText;this.responseXML=this._object.responseXML;a(this)}};m.prototype.abort=function(){this._aborted=true;this._object.abort();this.responseText="";this.responseXML=null;this.status=0;this.statusText="";this._headers=[];if(!(this.readyState==n||(this.readyState==i&&!this._sendInvoked)||this.readyState==h)){this.readyState=h;this._sendInvoked=false;if(this.onreadystatechange instanceof Function){this.onreadystatechange.apply(this)}}this.readyState=n;f(this)};m.prototype.getAllResponseHeaders=function(){if(b){return this._object.getAllResponseHeaders().replace(/\r\n/g,"\n").replace(/\n/g,"\r\n")}else{return this._object.getAllResponseHeaders()}};m.prototype.getResponseHeader=function(q){return this._object.getResponseHeader(q)};m.prototype.setRequestHeader=function(q,r){this._headers[q]=r;return this._object.setRequestHeader(q,r)};m.prototype._handleReadystatechange=function(){if(b&&!this._async){return}if(this._aborted){return}var q=this.readyState;this.readyState=this._object.readyState;if(this.readyState==h){this.status=this._object.status;this.statusText=this.status?this._object.statusText:"";this.responseText=this._object.responseText;this.responseXML=this._object.responseXML;if(p&&this.status==1223){this.status=204}f(this);if(p&&this.responseXML&&!this.responseXML.documentElement&&this.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){this.responseXML=new e().parseFromString(this.responseText,"text/xml")}if(p&&this._async){window.detachEvent("onunload",this._handleUnloadForIE);this._handleUnloadForIE=null}}if(q!=this.readyState){a(this)}q=this.readyState};function a(q){if(q.onreadystatechange){if(q._async&&q.readyState==h){setTimeout(function(){q.onreadystatechange.apply(q)},0)}else{q.onreadystatechange.apply(q)}}}function f(q){if(p){q._object.onreadystatechange=new window.Function()}delete q._headers}window.DOMParser=this.DOMParser=e;window.XMLSerializer=this.XMLSerializer=o;window.XSLTProcessor=this.XSLTProcessor=k;window.XMLHttpRequest=this.XMLHttpRequest=m});b$.module("b$.ecma5",function(){var Array=b$.require("Array");if(!Array.prototype.indexOf){Array.prototype.indexOf=function(oItem,iFromIndex){iFromIndex=arguments.length<2?0:toInteger(iFromIndex);if(iFromIndex<0){iFromIndex=Math.max(this.length-iFromIndex,0)}for(var iIndex=iFromIndex,iLength=this.length;iIndex<iLength;iIndex++){if(this[iIndex]===oItem){return iIndex}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(oItem,iFromIndex){iFromIndex=arguments.length<2?this.length:toInteger(iFromIndex);if(iFromIndex<0){iFromIndex=this.length-iFromIndex}iFromIndex=Math.min(iFromIndex,this.length-1);for(var iIndex=iFromIndex;iIndex>=0;iIndex--){if(this[iIndex]===oItem){return iIndex}}return -1}}if(!Array.prototype.every){Array.prototype.every=function(fFunction,oThisArg){if(!(fFunction instanceof Function)){throw new TypeError()}for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){if(this.hasOwnProperty(iIndex)){if(!fFunction.call(oThisArg,this[iIndex],iIndex,this)){return false}}}return true}}if(!Array.prototype.some){Array.prototype.some=function(fFunction,oThisArg){if(!(fFunction instanceof Function)){throw new TypeError()}for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){if(this.hasOwnProperty(iIndex)){if(fFunction.call(oThisArg,this[iIndex],iIndex,this)){return true}}}return false}}if(!Array.prototype.forEach){Array.prototype.forEach=function(fFunction,oThisArg){if(!(fFunction instanceof Function)){throw new TypeError()}for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){if(this.hasOwnProperty(String(iIndex))){fFunction.call(oThisArg,this[iIndex],iIndex,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(fFunction,oThisArg){if(!(fFunction instanceof Function)){throw new TypeError()}var aNewArray=[];for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){aNewArray.push(fFunction.call(oThisArg,this[iIndex],iIndex,this))}return aNewArray}}if(!Array.prototype.filter){Array.prototype.filter=function(fFunction,oThisArg){if(!(fFunction instanceof Function)){throw new TypeError()}var oNewArray=[];for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){if(fFunction.call(oThisArg,this[iIndex],iIndex,this)){oNewArray.push(this[iIndex])}}return oNewArray}}if(!Array.prototype.reduce){Array.prototype.reduce=function(fFunction,vInitialValue){if((this.length==0&&vInitialValue===undefined)||!(fFunction instanceof Function)){throw new TypeError()}var bIsInitialValueEmpty=arguments.length<2;for(var iIndex=0,iLength=this.length;iIndex<iLength;iIndex++){if(bIsInitialValueEmpty){vInitialValue=this[iIndex];bIsInitialValueEmpty=false}else{vInitialValue=fFunction(vInitialValue,this[iIndex],iIndex,this)}}return vInitialValue}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(fFunction,vInitialValue){if(this.length==0||!(fFunction instanceof Function)){throw new TypeError()}var bIsInitialValueEmpty=arguments.length<2;for(var iIndex=this.length-1;iIndex>=0;iIndex--){if(bIsInitialValueEmpty){vInitialValue=this[iIndex];bIsInitialValueEmpty=false}else{vInitialValue=fFunction(vInitialValue,this[iIndex],iIndex,this)}}return vInitialValue}}function toInteger(vValue){var number=Number(vValue);return isNaN(number)?0:number>0?Math.floor(number):Math.ceil(number)}function fFormaNumber(iNumber){return iNumber<10?"0"+iNumber:String(iNumber)}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(sKey){return this.getUTCFullYear()+"-"+fFormaNumber(this.getUTCMonth()+1)+"-"+fFormaNumber(this.getUTCDate())+"T"+fFormaNumber(this.getUTCHours())+":"+fFormaNumber(this.getUTCMinutes())+":"+fFormaNumber(this.getUTCSeconds())+"Z"}}if(typeof String.prototype.toJSON!=="function"){String.prototype.toJSON=function(sKey){return this.valueOf()}}if(typeof Number.prototype.toJSON!=="function"){Number.prototype.toJSON=function(sKey){return this.valueOf()}}if(typeof Boolean.prototype.toJSON!=="function"){Boolean.prototype.toJSON=function(sKey){return this.valueOf()}}var JSON_STRING_ESCAPE_CHARS_REEGEXP=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var JSON_STRING_ESCAPE_CHARS_MAPPINGS={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function fQuoteString(sString){JSON_STRING_ESCAPE_CHARS_REEGEXP.lastIndex=0;return JSON_STRING_ESCAPE_CHARS_REEGEXP.test(sString)?'"'+sString.replace(JSON_STRING_ESCAPE_CHARS_REEGEXP,function(sToEscpe){var sEscaped=JSON_STRING_ESCAPE_CHARS_MAPPINGS[sToEscpe];return typeof sEscaped==="string"?sEscaped:"\\u"+("0000"+sToEscpe.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+sString+'"'}var sGap="";var sIndent="";var vGlobalReplacer={};function fStignifyJSONValue(sKey,oHolder){var sValue=null,iLength=0,sMind=sGap,aPartial=[],vValue=oHolder[sKey];if(vValue&&typeof vValue==="object"&&typeof vValue.toJSON==="function"){vValue=vValue.toJSON(sKey)}if(typeof vGlobalReplacer==="function"){vValue=vGlobalReplacer.call(oHolder,sKey,vValue)}switch(typeof vValue){case"string":return fQuoteString(vValue);case"number":return isFinite(vValue)?String(vValue):"null";case"boolean":case"null":return String(vValue);case"object":if(!vValue){return"null"}sGap+=sIndent;if(Object.prototype.toString.apply(vValue)==="[object Array]"){iLength=vValue.length;for(var iItem=0;iItem<iLength;iItem+=1){aPartial[iItem]=fStignifyJSONValue(iItem,vValue)||"null"}sValue=aPartial.length===0?"[]":sGap?"[\n"+sGap+aPartial.join(",\n"+sGap)+"\n"+sMind+"]":"["+aPartial.join(",")+"]";sGap=sMind;return sValue}if(vGlobalReplacer&&typeof vGlobalReplacer==="object"){iLength=vGlobalReplacer.length;for(var iItem=0;iItem<iLength;iItem+=1){var sPropertyName=vGlobalReplacer[iItem];if(typeof sPropertyName==="string"){sValue=fStignifyJSONValue(sPropertyName,vValue);if(sValue){aPartial.push(fQuoteString(sPropertyName)+(sGap?": ":":")+sValue)}}}}else{for(var sPropertyName in vValue){if(Object.hasOwnProperty.call(vValue,sPropertyName)){sValue=fStignifyJSONValue(sPropertyName,vValue);if(sValue){aPartial.push(fQuoteString(sPropertyName)+(sGap?": ":":")+sValue)}}}}sValue=aPartial.length===0?"{}":sGap?"{\n"+sGap+aPartial.join(",\n"+sGap)+"\n"+sMind+"}":"{"+aPartial.join(",")+"}";sGap=sMind;return sValue}}if(!window.JSON){window.JSON={}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(vValue,vReplacer,vSpace){sGap="";sIndent="";if(typeof vSpace==="number"){for(var iIndentCount=0;iIndentCount<vSpace;iIndentCount+=1){sIndent+=" "}}else{if(typeof vSpace==="string"){sIndent=vSpace}}vGlobalReplacer=vReplacer;if(vReplacer&&typeof vReplacer!=="function"&&(typeof vReplacer!=="object"||typeof vReplacer.length!=="number")){throw new Error("JSON.stringify")}return fStignifyJSONValue("",{"":vValue})}}if(typeof JSON.parse!=="function"){var BROKEN_UNICODE_CHAR_REGEXP=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;JSON.parse=function(sText,fReviver){function fWalk(oHolder,sKey){var vPropertyValue=null,vValue=oHolder[sKey];if(vValue&&typeof vValue==="object"){for(var sPropertyName in vValue){if(Object.hasOwnProperty.call(vValue,sPropertyName)){vPropertyValue=fWalk(vValue,sPropertyName);if(vPropertyValue!==undefined){vValue[sPropertyName]=vPropertyValue}else{delete vValue[sPropertyName]}}}}return fReviver.call(oHolder,sKey,vValue)}BROKEN_UNICODE_CHAR_REGEXP.lastIndex=0;if(BROKEN_UNICODE_CHAR_REGEXP.test(sText)){sText=sText.replace(BROKEN_UNICODE_CHAR_REGEXP,function(sChar){return"\\u"+("0000"+sChar.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(sText.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var oParsedObject=eval("("+sText+")");return typeof fReviver==="function"?fWalk({"":oParsedObject},""):oParsedObject}throw new SyntaxError("JSON.parse")}}this.Array=Array;this.JSON=JSON});b$.module("b$.mvc",function(){var a=b$.require("b$.Class");var i=b$.require("b$.Interface");var y=b$.require("b$.Exception");var m=b$.require("b$.TypeConstraintOptional");var f=b$.require("b$.testArguments");var J=b$.require("b$.types.STRING");var b=b$.require("b$.types.FUNCTION");var c=b$.require("b$.types.ANY");var A=b$.require("b$.ArgumentException");var K=b$.require("b$.Iterator");var p=b$.require("b$.ArrayIterator");var r=b$.require("b$.ecma5.Array.prototype.indexOf");var D={};var B=Array.prototype,g=Object.prototype,q=Function.prototype;var n=B.slice,z=B.unshift,e=g.toString,h=g.hasOwnProperty;var Q=B.forEach;var I=function(W,V,U){if(W==null){return}if(Q&&W.forEach===Q){W.forEach(V,U)}else{if(P(W.length)){for(var T=0,R=W.length;T<R;T++){if(V.call(U,W[T],T,W)===D){return}}}else{for(var S in W){if(h.call(W,S)){if(V.call(U,W[S],S,W)===D){return}}}}}};var P=function(R){return !!(R===0||(R&&R.toExponential&&R.toFixed))};this.each=I;this.mixin=function(S,T,R){var U;if(S){for(U in T){if(R||S[U]===undefined){S[U]=config[T]}}}return S};var C=a.extend(function(R){a.call(this);this.array=[];this.keys=[];this.map={};if(R){this.keyFn=R}},{keyFn:function(R){return R.id},add:function(S,T){var U=this,R;if(arguments.length==1){T=S;S=U.keyFn(T)}if(typeof S!="undefined"&&S!==null){R=U.map[S];if(typeof R!="undefined"){return U.replace(S,T)}U.map[S]=T}U.array.push(T);U.keys.push(S);$(U).triggerHandler("add",[U.array.length-1,T,S]);return T},addAll:function(W){var V=this,U=0,S,R,T;if(arguments.length>1||$.isArray(W)){S=arguments.length>1?arguments:W;for(R=S.length;U<R;U++){V.add(S[U])}}else{for(T in W){if(W.hasOwnProperty(T)){V.add(T,W[T])}}}},insertAt:function(R,S,T){var U=this;if(arguments.length==2){T=S;S=U.keyFn(T)}if(typeof U.map[S]!="undefined"){U.suspendEvents();U.removeByKey(S);U.resumeEvents()}if(R>=U.array.length){return U.add(S,T)}U.array.splice(R,0,T);if(typeof S!="undefined"&&S!==null){U.map[S]=T}U.keys.splice(R,0,S);return T},remove:function(R){return this.removeAt(this.array.indexOf(R))},removeByKey:function(R){return this.removeAt(this.keys.indexOf(R))},removeAll:function(R){},removeAt:function(R){var U=this,T,S;if(R<U.array.length&&R>=0){T=U.array[R];U.array.splice(R,1);S=U.keys[R];if(typeof S!="undefined"){delete U.map[S]}U.keys.splice(R,1);return T}return false},replace:function(T,U){var R,S;if(arguments.length==1){U=arguments[0];T=this.keyFn(R)}R=this.map[T];if(typeof T=="undefined"||T===null||typeof R=="undefined"){return this.add(T,U)}S=this.indexOfKey(T);this.array[S]=U;this.map[T]=U;return U},get:function(R){var S=this.map[R],S=S!==undefined?S:(typeof R=="number")?this.array[R]:undefined;return S},getAt:function(R){return this.array[R]},indexOf:function(R){return r.call(this.array,R)},indexOfKey:function(R){return r.call(this.keys,R)},each:function(U,T){var W=[].concat(this.array),S=0,R=W.length,V;for(;S<R;S++){V=W[S];if(U.call(T||V,V,S,R)===false){break}}},clear:function(){this.array=[];this.keys=[];this.map={}}});this.HashMap=C;var E=this.Event=a.extend(function(){this.bubbles=false;this.cancelable=false;this.currentTarget=null;this.eventPhase=E.CAPTURING_PHASE;this.target=null;this.timeStamp=(new Date()).getTime();this.type="";this.namespaceURI=null;this.defaultPrevented=false;this._captures=null;this._stopped=false;this._stoppedImmediate=false;this._stoppedHorizontal=false},{initEvent:function(T,S,R){this.type=T;this.bubbles=S;this.cancelable=R},initEventNS:function(S,U,T,R){this.initEvent(U,T,R);this.namespaceURI=S},preventDefault:function(){this.defaultPrevented=this.cancelable},stopPropagation:function(){this._stopped=true},stopImmediatePropagation:function(){this.stopPropagation();this.stopHorizontalPropagation();this._stoppedImmediate=true},stopHorizontalPropagation:function(){this._stoppedHorizontal=true},isPropagationStopped:function(){return this._stopped},isImmediatePropagationStopped:function(){return this._stoppedImmediate},isHorizontalPropagationStopped:function(){return this._stoppedHorizontal}});E.CAPTURING_PHASE=1;E.AT_TARGET=2;E.BUBBLING_PHASE=3;E.LISTENER_ENTRY=0;var L=this.CustomEvent=E.extend(function(){this.detail=0;E.call(this)},{initCustomEvent:function(U,T,R,S){this.initEvent(U,T,R);this.detail=S},initCustomEventNS:function(S,V,U,R,T){this.initCustomEvent(V,U,R);this.namespaceURI=S}});var k=this.MutationEvent=E.extend(function(){this.relatedNode=null;this.prevValue="";this.newValue="";this.attrName="";this.attrChange=0;E.call(this)});k.MODIFICATION=1;k.ADDITION=2;k.REMOVAL=3;k.prototype.initMutationEvent=function(Y,X,V,U,T,W,R,S){this.initEvent(Y,X,V);this.relatedNode=U;this.prevValue=T;this.newValue=W;this.attrName=R;this.attrChange=S};k.prototype.initMutationEventNS=function(Y,R,V,X,W,S,Z,T,U){this.initMutationEvent(R,V,X,W,S,Z,T,U);this.namespaceURI=Y};var G=this.ObservedEvent=a.extend(function(R,S){this.type=R;this.observable=S;this.observers=[]},{addObserver:function(U,T,S){var V=this,R;T=T||this.observable;if(!this.isObserving(U,T)){R=this.createObserver(U,T,S);this.observers.push(R)}return R},createObserver:function(U,T,S){S=S||{};T=T||this.observable;var R={oe:this,fn:U,fnenv:U,context:T,options:S};return R},findObserver:function(U,T){var V=this.observers,S=V.length,R,W;while(S--){R=V[S];if(R){W=R.context;if(R.fn==U&&(W==T||W==this.observable)){return S}}}return -1},isObserving:function(S,R){return this.findObserver(S,R)!==-1},removeObserver:function(W,V){var U=this,S,T,R;T=U.findObserver(W,V);if(T!=-1){U.observers.splice(T,1);return true}return false},clearObservers:function(){var S=this.observers,R=S.length;while(R--){this.removeObserver(S[R].fn,S[R].context)}},dispatch:function(){var V=this,W=V.observers.slice(0),U=W.length,T,S,R;if(U>0){V.dispatching=true;for(T=0;T<U;T++){R=W[T];S=arguments.length?n.call(arguments,0):[];if(R&&R.options){S.push(R.options)}if(R&&R.fnenv.apply(R.context||V.observable,S)===false){return(V.dispatching=false)}}}V.dispatching=false;return true}});var d=(this.Observable=a.extend(function(){this.events={}}));d.prototype.addObserver=function(V,U,T,S){f(arguments,[J,b]);var R=this.events[V];if(!R){R=new G(V,this);this.events[V]=R}return R.addObserver(U,T,S)};d.prototype.removeObserver=function(U,T,S){f(arguments,[J,b]);var R=this.events[U];if(R){R.removeObserver(T,S)}};d.prototype.removeAllObservers=function(S){var R=this.events,T,U;if(S){if(R[S]){R[S].clearObservers()}}else{for(U in R){if(R.hasOwnProperty(U)){R[U].clearObservers()}}}};d.prototype.notifyObservers=function(U){var W;var S=n.call(arguments,0);if(this.eventsMuted===true){if(this.eventQueue){this.eventQueue.push(S)}return false}if(U instanceof E){W=U;U=W.type;if(!W.target){W.target=this;W.currentTarget=this}}else{S.shift()}var X=this.events[U];if(X){S.push(X);X.target=this;X.currentTarget=this}var T=this.events["*"];if(W instanceof E&&W.bubbles){if(X&&X.dispatch.apply(X,S)===false){return false}if(T&&T.dispatch.apply(T,[U,this])===false){return false}var V=this.getBubbleParent&&this.getBubbleParent();if(V&&V.notifyObservers){W.currentTarget=V;V.notifyObservers.apply(V,S)}else{return true}}else{var R=(X)?X.dispatch.apply(X,S):true;if(R){return(T)?T.dispatch.apply(T,[U,this]):true}return false}};d.prototype.hasObservers=function(S){f(arguments,[J]);var R=this.events[S];return(R&&R.observers.length>0)===true};d.prototype.muteEvents=function(R){this.eventsMuted=true;if(R&&!this.eventQueue){this.eventQueue=[]}};d.prototype.unmuteEvents=function(){var S=this,R=this.eventQueue||[];this.eventsMuted=false;delete this.eventQueue;I(R,function(T){S.notifyObservers.apply(S,T)})};this.Observable=d;var H=d.extend(function(){d.call(this)},{});this.Model=H;var w=y.extend(function(S,R){f(arguments,[c,t]);y.call(this,"Can't find the view to instantiate for the model.");this.model=S;this.factory=R});var t=new i({createView:Function});var u=new i({getViewClass:Function});var x=new m(t);var j=new m(u);var M=a.extend(function(S,R){f(arguments,[c,x]);this.model=S;this.factory=R||null;this.html=null});M.prototype.getModel=function(){return this.model};M.prototype.getFactory=function(){return this.factory};M.prototype.registerObservers=function(){if(this.model instanceof H){this.model.addObserver("*",this.update,this)}};M.prototype.unregisterObservers=function(){if(this.model instanceof H){this.model.removeObserver("*",this.update,this)}};M.prototype.createHTML=function(R){throw new Error("Must implement createHTML().")};M.prototype.renderHTML=function(S,R){console&&console.log&&console.log("should implement renderHTML: ",this);S.replaceWith(this.getHTML(R))};M.prototype.getHTML=function(R){if(!this.html){this.html=this.createHTML(R);this.registerObservers()}else{if(this.html.ownerDocument!=R){throw new Error("HTML document mismatch with existing view.")}}return this.html};M.prototype.release=function(){if(jQuery(this.html).find("#"+(this.model.item&&this.model.item.id)).length==0){if(this.html&&this.html.id!==(this.model.item&&this.model.item.id)){this.unregisterObservers();if(this.html.parentNode){this.html.parentNode.removeChild(this.html)}this.html=null}}};M.prototype.update=function(S,R){if(!this.html){throw new Error("Unexpected call to update(), no HTML exists.")}var T=this.html;this.html=this.createHTML(T.ownerDocument);if(T.parentNode){T.parentNode.replaceChild(this.html,T)}};M.prototype.reflow=function(){};M.prototype.attachHandlerTo=function(R,U,T){var S=this;if(R.addEventListener){R.addEventListener(U,function(V){return T.call(S,V)},false)}else{R.attachEvent("on"+U,function(){return T.call(S,event)})}};var v=a.extend(function(R){f(arguments,[t]);this.factory=R;this.views=[]});v.prototype.getViews=function(){return new p(this.views)};v.prototype.updateViews=function(T){if(!(T instanceof K)){throw new A("Iterator expected. Did you mean to invoke updateView()?",arguments,0,null)}var S=0;var R=[];for(var U;U=T.next();S++){if(this.views[S]){if(this.views[S].getModel()==U){R.push(this.views[S])}else{if(this.views[S-1]&&this.views[S-1].getModel()==U){R.push(this.views[S-1])}else{if(this.views[S+1]&&this.views[S+1].getModel()==U){R.push(this.views[S+1])}else{this.views[S].release();R.push(this.factory.createView(U))}}}}else{R.push(this.factory.createView(U))}}for(;S<this.views.length;S++){this.views[S].release()}this.views=R};v.prototype.updateView=function(S){if(S instanceof K){throw new A("Model expected. Did you mean to invoke updateViews()?",arguments,0,null)}if(S){if(this.views[0]){if(this.views[0].getModel()!=S){this.views[0].release();this.views[0]=this.factory.createView(S)}}else{this.views[0]=this.factory.createView(S)}}for(var R=S?1:0;R<this.views.length;R++){this.views[R].release()}this.views.length=S?1:0;return this.views[0]||null};v.prototype.render=function(S,Z,R){var W=S.ownerDocument;var X=S.childNodes;var T=0;if(Z){while(X[T++]!=Z){if(!X[T-1]){throw new Error("The node to insert after is not a child of the element.")}}}for(var U,V=0;U=this.views[V];V++){var Y=U.getHTML(W);if(X[T]!=Y){if(X[T+1]==Y&&X[T]!=R){S.removeChild(X[T])}else{S.insertBefore(Y,X[T++]||null)}}else{T++}}while(X[T]!=R&&X[T]){S.removeChild(X[T])}if(R!=X[T]){throw new Error("The node to insert before is not a child of the element.")}};v.prototype.renderViews=function(T,R,S,U){this.updateViews(T);this.render(R,S,U)};v.prototype.getView=function(){return this.views[0]||null};v.prototype.clear=function(){for(var R=0;R<this.views.length;R++){this.views[R].release()}this.views=[]};v.prototype.toString=function(){return a.prototype.toString.call(this)+" ("+this.views.length+" views cached)"};var O=a.extend(function(R,T,S){f(arguments,[Function,Function,j]);this.modelClass=R;this.viewClass=T;this.parentViewClassProvider=S});O.prototype.getViewClass=function(R){return R instanceof this.modelClass?this.viewClass:(this.parentViewClassProvider?this.parentViewClassProvider.getViewClass(R):null)};O.prototype.createView=function(S){var R=this.getViewClass(S);if(R){return new R(S,this)}else{throw new w(S,this)}};t.implementedBy(O);u.implementedBy(O);var l=a.extend(function(R){f(arguments,[j]);this.views=[];this.parentViewClassProvider=R});l.prototype.registerView=function(R,S){this.views[R.getClassID()]=S};l.prototype.getViewClass=function(T){var R=T.constructor;do{var S=this.views[R.getClassID()];if(S){return S}}while(R=R.superClass);return this.parentViewClassProvider?this.parentViewClassProvider.getViewClass(T):null};l.prototype.createView=function(S){var R=this.getViewClass(S);if(!R){throw new w(S,this)}return new R(S,this)};u.implementedBy(l);t.implementedBy(l);var F=y.extend();var o=F.extend();var s=a.extend(function(T,S,R){this.namespace=T;this.localName=S;this.modelClass=R});s.prototype.getNamespace=function(){return this.namespace};s.prototype.getLocalName=function(){return this.localName};s.prototype.getModelClass=function(){return this.modelClass};s.prototype.createModel=function(S,T,R){throw new Error("Must implement ElementMapping::createModel().")};s.prototype.createElement=function(T,R,S){if(!this.namespace){return R.createElement(this.localName)}else{if(R.createElementNS){return R.createElementNS(this.namespace,this.localName)}else{return R.createNode(1,this.localName,this.namespace)}}};s.prototype.getChildren=function(T,U,S){var W=[];var X=T.childNodes;for(var R=0;R<X.length;R++){if(X[R].nodeType==1){var V=this.getChild(X[R],U,S);if(V){W.push(V)}}}return W};s.prototype.getChild=function(T,U,S){var R=U.getMappingByElement(T);return R?R.createModel(T,U,S):null};s.prototype.addChild=function(S,U,T){var R=T.getMappingByModel(U);if(R){S.appendChild(R.createElement(U,S.ownerDocument))}};s.prototype.addChildren=function(S,U,T){for(var R=0;R<U.length;R++){this.addChild(S,U[R],T)}};var N=a.extend(function(){this.mappings=[];this.namespaces=[]});N.prototype.addMapping=function(R){f(arguments,[s]);this.mappings[R.getModelClass().getClassID()]=R;var T=R.getNamespace()||"";var S=R.getLocalName();if(!this.namespaces[T]){this.namespaces[T]={}}this.namespaces[T][S]=R};N.prototype.getMappingByModel=function(T){var R=T.constructor;do{var S=this.mappings[R.getClassID()];if(S){return S}}while(R=R.superClass);return null};N.prototype.createElementByModel=function(T,S){var R=this.getMappingByModel(T);if(R){return R.createElement(T,S,this)}else{throw new o("Can't find the mapping for the provided model.")}};N.prototype.getMappingByElement=function(R){var S=this.namespaces[R.namespaceURI||""];return S&&S[R.localName||R.baseName]||null};N.prototype.createModelByElement=function(T,S){var R=this.getMappingByElement(T);if(R){return R.createModel(T,this,S)}else{throw new o("Can't find the mapping for the provided XML element.")}};this.View=M;this.ViewCache=v;this.ViewNotFoundError=w;this.IViewFactory=t;this.IViewClassProvider=u;this.SimpleViewFactory=O;this.ViewRegistry=l;this.MappingError=F;this.MappingNotFoundError=o;this.ElementMapping=s;this.XMLMappingRegistry=N});b$.module("b$.xmvc",function(){var c=b$.require("b$.mvc.Model");var a=c.extend(function(d){c.call(this);this.model=d},{registerObservers:function(){},unregisterObservers:function(){},releaseFromModel:function(){this.unregisterObservers()}});this.ModelView=a;var b=a.extend(function(d){a.call(this,d);this.dom=null},{registerObservers:function(){},unregisterObservers:function(){},createDOM:function(d){throw new Error("Must implement createDOM().")},getDOM:function(d){if(!this.dom){this.dom=this.createDOM(d);this.registerObservers()}else{if(this.dom.ownerDocument!=d){throw new Error("HTML document mismatch with existing view.")}}return this.dom},releaseFromModel:function(){if(this.dom){this.unregisterObservers();if(this.dom.parentNode){this.dom.parentNode.removeChild(this.dom)}this.dom=null}}});this.View=b});b$.module("b$.mappings.xml",function(){var A=b$.require("b$.Class");var c=b$.require("b$.Interface");var s=b$.require("b$.Exception");var h=b$.require("b$.TypeConstraintNull");var i=b$.require("b$.TypeConstraintOptional");var a=b$.require("b$.testArguments");var v=b$.require("b$.types.ANY");var u=b$.require("b$.types.NUMBER");var t=b$.require("b$.types.STRING");var k=b$.require("b$.types.FUNCTION");var x=b$.require("b$.types.ELEMENT");var j=b$.require("b$.types.DOCUMENT");var B=new h(Object);var r=new h(t);var g=new i(u);var q=s.extend(function(E,D){a(arguments,[t,w]);s.call(this,E);this.builder=D});q.prototype.toString=function(){return s.prototype.toString()+" Builder: "+String(this.builder)+"."};var y=q.extend(function(D){q.call(this,"Timeout waiting for sub process result.",D)});var d=s.extend(function(E,F,D){a(arguments,[t,v,e]);s.call(this,E);this.input=F;this.mapping=D||null});d.prototype.toString=function(){return s.prototype.toString()+" Input: "+String(this.input)+". Mapping: "+String(this.mapping)+"."};var z=d.extend(function(D){d.call(this,"Can't find the mapping for the provided XML element.",D)});var b=new c({acceptBuildResult:k,acceptBuildError:k});var w=new c({build:k});var m=A.extend(function(G,E,D,F){a(arguments,[v,l,B,g]);A.call(this);this.input=G;this.registry=E;this.context=D;this.timeout=typeof F=="number"?F:60000;this.builders=[];this.results=[];this.errors=[]});m.prototype.getSubBuilders=function(){return this.builders};m.prototype.acceptSubBuilderResult=function(D,E){this.results[this.builders.indexOf(D)]=E};m.prototype.acceptSubBuilderFailure=function(D,E){this.errors[this.builders.indexOf(D)]=E};m.prototype.finalizeBuild=function(D){if(this.errors.length){D.acceptBuildError(this.errors.filter(function(E){return Boolean(E)})[0])}else{D.acceptBuildResult(this.results)}};m.prototype.startSubBuilder=function(D,F){a(arguments,[w,k]);var E=this;D.build({acceptBuildResult:function(G){E.acceptSubBuilderResult(D,G);F(D)},acceptBuildError:function(G){E.acceptSubBuilderFailure(D,G);F(D)}})};m.prototype.build=function(J){a(arguments,[b]);var I=this.getSubBuilders();var F=[];var G=0;var E=this;var K=0;function D(L){F.push(L);if(++G>=I.length){E.finalizeBuild(J);clearTimeout(K)}}if(I.length){for(var H=0;H<I.length;++H){this.startSubBuilder(I[H],D)}K=setTimeout(function(){if(F.length<I.length){for(var M=0,L;M<I.length;++M){L=I[M];if(F.indexOf(L)==-1){E.acceptSubBuilderFailure(L,new y(L))}}E.finalizeBuild(J)}},this.timeout)}else{this.finalizeBuild(J)}};w.implementedBy(m);var f=A.extend(function(D){a(arguments,[d]);A.call(this);this.error=D});f.prototype.build=function(D){D.acceptBuildError(this.error)};w.implementedBy(f);var p=m.extend(function(G,E,D,F){a(arguments,[Array]);m.call(this,G,E,D,F);this.builders=this.input.map(function(I){var H=E.getMappingByElement(I);return H&&H.createModelBuilder(I,E,D)||new f(new z(I))})});var o=m.extend(function(F,E,D,G){a(arguments,[Array]);m.call(this,F,E,null,G);this.document=D;this.builders=this.input.map(function(I){var H=E.getMappingByModel(I);return H&&H.createElementBuilder(I,E,D)||new f(new z(I))})});o.prototype.createElementNS=function(D,E){return !D?this.document.createElement(E):(this.document.createElementNS?this.document.createElementNS(D,E):this.document.createNode(1,E,D))};var n=A.extend(function(F,E,D){a(arguments,[r,t,j]);A.call(this);this.namespaceURI=F;this.localName=E;this.document=D});n.prototype.build=function(D){try{D.acceptBuildResult(this.buildElement())}catch(E){D.acceptBuildError(E)}};n.prototype.buildElement=function(){return this.createElementNS(this.namespace,this.localName)};n.prototype.createElementNS=function(D,E){return !D?this.document.createElement(E):(this.document.createElementNS?this.document.createElementNS(D,E):this.document.createNode(1,E,D))};var C=A.extend(function(F,E,D){a(arguments,[r,t,k]);this.namespace=F;this.localName=E;this.modelClass=D});C.prototype.getNamespace=function(){return this.namespace};C.prototype.getLocalName=function(){return this.localName};C.prototype.getModelClass=function(){return this.modelClass};C.prototype.createModelBuilder=function(E,F,D){throw new Error("Must implement Mapping::createModelBuilder().")};C.prototype.createElementBuilder=function(F,E,D){throw new Error("Must implement Mapping::createElementBuilder().")};var e=new i(C);var l=A.extend(function(){this.mappings=[];this.namespaces=[]});l.prototype.addMapping=function(D){a(arguments,[C]);this.mappings[D.getModelClass().getClassID()]=D;var F=D.getNamespace()||"";var E=D.getLocalName();if(!this.namespaces[F]){this.namespaces[F]={}}this.namespaces[F][E]=D};l.prototype.getMappingByModel=function(F){var D=F.constructor;do{var E=this.mappings[D.getClassID()];if(E){return E}}while(D=D.superClass);return null};l.prototype.buildElementFromModel=function(G,E,F){a(arguments,[A,j,b]);var D=this.getMappingByModel(G);if(D){D.createElementBuilder(G,this,E).build(F)}else{F.acceptBuildError(new z(G))}};l.prototype.getMappingByElement=function(D){var E=this.namespaces[D.namespaceURI||""];return E&&E[D.localName||D.baseName]||null};l.prototype.buildModelFromElement=function(F,E,G){a(arguments,[x,B,b]);var D=this.getMappingByElement(F);if(D){D.createModelBuilder(F,this,E).build(G)}else{G.acceptBuildError(new z(F))}};this.MappingError=d;this.MappingNotFoundError=z;this.BuildTimeoutError=y;this.IBuildAcceptor=b;this.IBuilder=w;this.CompositeBuilder=m;this.FailingBuilder=f;this.ModelsListBuilder=p;this.ElementsListBuilder=o;this.SimpleElementBuilder=n;this.Mapping=C;this.MappingRegistry=l});b$.module("b$.uri",function(){var a=b$.require("b$.Class");var h=a.extend(function(j){if(j instanceof h){this.scheme=j.scheme;this.authority=j.authority;this.path=j.path;this.query=j.query;this.fragment=j.fragment}else{if(j){var k=c.exec(j);this.scheme=k[1];this.authority=k[2];this.path=k[3];this.query=k[4];this.fragment=k[5]}}});h.prototype.scheme=null;h.prototype.authority=null;h.prototype.path="";h.prototype.query=null;h.prototype.fragment=null;var c=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");h.prototype.getScheme=function(){return this.scheme};h.prototype.getAuthority=function(){return this.authority};h.prototype.getPath=function(){return this.path};h.prototype.getQuery=function(){return this.query};h.prototype.getFragment=function(){return this.fragment};h.prototype.isAbsolute=function(){return this.scheme&&!this.fragment};h.prototype.isSameDocumentAs=function(j){return j.scheme==this.scheme&&j.authority==this.authority&&j.path==this.path&&j.query==this.query};h.prototype.equals=function(j){return this.isSameDocumentAs(j)&&j.fragment==this.fragment};h.prototype.normalize=function(){this.removeDotSegments();if(this.scheme){this.scheme=this.scheme.toLowerCase()}if(this.authority){this.authority=this.authority.replace(e,g).replace(b,d)}if(this.path){this.path=this.path.replace(b,d)}if(this.query){this.query=this.query.replace(b,d)}if(this.fragment){this.fragment=this.fragment.replace(b,d)}};var b=/%[0-9a-z]{2}/gi;var i=/[a-zA-Z0-9\-\._~]/;var e=/(.*@)?([^@:]*)(:.*)?/;function d(j){var k=unescape(j);return i.test(k)?k:j.toUpperCase()}function g(j,m,l,k){return(m||"")+l.toLowerCase()+(k||"")}h.prototype.resolve=function(k){var j=new h();if(this.scheme){j.scheme=this.scheme;j.authority=this.authority;j.path=this.path;j.query=this.query}else{j.scheme=k.scheme;if(this.authority){j.authority=this.authority;j.path=this.path;j.query=this.query}else{j.authority=k.authority;if(this.path==""){j.path=k.path;j.query=this.query||k.query}else{if(this.path.charAt(0)=="/"){j.path=this.path;j.removeDotSegments()}else{if(k.authority&&k.path==""){j.path="/"+this.path}else{j.path=k.path.substring(0,k.path.lastIndexOf("/")+1)+this.path}j.removeDotSegments()}j.query=this.query}}}j.fragment=this.fragment;return j};h.prototype.removeDotSegments=function(){var l=this.path.split("/"),j=[],m,n=l[0]=="";if(n){l.shift()}var k=l[0]==""?l.shift():null;while(l.length){m=l.shift();if(m==".."){j.pop()}else{if(m!="."){j.push(m)}}}if(m=="."||m==".."){j.push("")}if(n){j.unshift("")}this.path=j.join("/")};h.resolve=function(m,k){var j=f[m]||(f[m]=new h(m));var l=f[k]||(f[k]=new h(k));return j.resolve(l).toString()};var f={};h.prototype.toString=function(){var j="";if(this.scheme){j+=this.scheme+":"}if(this.authority){j+="//"+this.authority}j+=this.path;if(this.query){j+="?"+this.query}if(this.fragment){j+="#"+this.fragment}return j};this.URI=h});b$.module("portal",function(){var c=b$.require("b$.Class");var g=b$.require("b$.testArguments");function f(){var h=new DOMParser().parseFromString("<dummy/>","application/xml");h.removeChild(h.documentElement);return h}function b(h){return h.replace(/\&/g,"&amp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\>/g,"&gt;").replace(/\</g,"&lt;")}var e=c.extend(function(h,i){this.x=h;this.y=i});e.prototype.translate=function(h){if(!(h instanceof a)){throw new Error("Argument must be instance of Vector.")}return new e(this.x+h.x,this.y+h.y)};e.prototype.to=function(h){if(!(h instanceof e)){throw new Error("Argument must be instance of Point.")}return new a(h.x-this.x,h.y-this.y)};e.prototype.equals=function(h){if(!(h instanceof e)){throw new Error("Argument must be instance of Point.")}return this.x==h.x&&this.y==h.y};e.prototype.toString=function(){return c.prototype.toString.call(this)+" ("+this.x+", "+this.y+")"};var a=c.extend(function(h,i){this.x=h;this.y=i});a.prototype.getLength=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))};a.prototype.multiply=function(h){return new a(this.x*h,this.y*h)};a.prototype.equals=function(h){if(!(h instanceof a)){throw new Error("Argument must be instance of Vector.")}return this.x==h.x&&this.y==h.y};a.prototype.toString=function(){return c.prototype.toString.call(this)+" ("+this.x+", "+this.y+")"};var d=c.extend(function(h,i){g(arguments,[e,e]);c.call(this);this.from=h;this.to=i});d.prototype.contains=function(h){return(h.x>=Math.min(this.from.x,this.to.x)&&h.x<=Math.max(this.from.x,this.to.x)&&h.y>=Math.min(this.from.y,this.to.y)&&h.y<=Math.max(this.from.y,this.to.y))};this.escapeXml=b;this.Point=e;this.Vector=a;this.Rectangle=d;this.createXmlDocument=f});b$.module("portal.models.item",function(){var e=b$.require("b$.Exception");var d=b$.require("b$.TypeConstraint");var c=d.extend();c.prototype.serializeToString=function(h){throw new e("Method not implemented.")};c.prototype.parseFromString=function(h){throw new e("Method not implemented.")};c.prototype.getName=function(){throw new e("Method not implemented.")};var g=c.extend();g.prototype.test=function(h){return typeof h=="string"};g.prototype.serializeToString=function(h){return String(h)};g.prototype.parseFromString=function(h){return h};g.prototype.getName=function(){return"string"};var b=c.extend();b.prototype.test=function(h){return typeof h=="boolean"};b.prototype.serializeToString=function(h){return String(h)};b.prototype.parseFromString=function(h){return h.toLowerCase()==="true"};b.prototype.getName=function(){return"boolean"};var f=c.extend();f.prototype.test=function(h){return typeof h=="number"};f.prototype.serializeToString=function(h){return String(h)};f.prototype.parseFromString=function(h){return Number(h)};f.prototype.getName=function(){return"double"};var a=c.extend();a.prototype.test=function(h){return typeof h=="string"};a.prototype.serializeToString=function(h){return String(h)};a.prototype.parseFromString=function(h){return h};a.prototype.getName=function(){return"contentRef"};this.DataType=c;this.StringDataType=g;this.BooleanDataType=b;this.DoubleDataType=f;this.ContentReferenceDataType=a});b$.module("portal",function(){var i=b$.require("b$.testArguments"),j=b$.require("b$.Interface"),e=b$.require("b$.Exception"),l=b$.require("b$.TypeConstraintOptional"),d=b$.require("b$.ArrayIterator"),k=b$.require("b$.types.FUNCTION"),f=b$.require("b$.types.STRING"),c=b$.require("b$.mvc.Model");var h=new l(Array);var g=new j({equals:k});var a=new j({getId:k});var b=e.extend(function(o,n){i(arguments,[f,m]);e.call(this,o);this.collection=n});var m=c.extend(function(o){i(arguments,[h]);c.call(this);this.items=[];if(o){for(var n=0;n<o.length;++n){this.add(o[n])}}});m.newInstance=function(){return new this()};m.prototype.getIterator=function(){return new d(this.items)};m.prototype.add=function(n){i(arguments,[g]);this.items.push(n)};m.prototype.remove=function(p){i(arguments,[g]);var o=-1;var n=false;while((o=this.indexOf(p))!=-1){this.items.splice(o,1);n=true}return n};m.prototype.item=function(n){return this.items[Number(n)]||undefined};m.prototype.indexOf=function(o){i(arguments,[g]);for(var n=0;n<this.items.length;++n){if(o.equals(this.items[n])){return n}}return -1};m.prototype.slice=function(q,o){var n=this.items.slice.apply(this.items,arguments),r=this.constructor.newInstance();for(var p=0;p<n.length;++p){r.add(n[p])}return r};m.prototype.map=function(o){i(arguments,[k]);var n=this.constructor.newInstance();for(var p=0;p<this.items.length;++p){n.add(o.call(this,this.items[p],p))}return n};m.prototype.each=function(n){i(arguments,[k]);for(var o=0;o<this.items.length;++o){n.call(this,this.items[o],o)}};m.prototype.every=function(n){i(arguments,[k]);return this.items.every(function(p,o){return n.call(this,p,o)},this)};m.prototype.getLength=function(){return this.items.length};m.prototype.toArray=function(){return this.items.slice()};this.IComparable=g;this.IIdentifiable=a;this.OrderedCollectionModificationException=b;this.OrderedCollection=m});b$.module("portal.template",function(){var b=b$.require("b$.Class");var f=b$.require("b$.Interface");var e=b$.require("b$.testArguments");var d=b$.require("b$.types.STRING");var i=b$.require("b$.types.FUNCTION");var g=b$.require("b$.uri.URI");var j=new f({getContextVariableValue:i});var a=b.extend(function(k){e(arguments,[d]);b.call(this);this.template=k});a.VARIABLE_REGEXP=/\${([^}]*)}/gm;a.prototype.generate=function(k){e(arguments,[j]);return this.template.replace(a.VARIABLE_REGEXP,function(m,l){return k.getContextVariableValue(l)})};a.prototype.getVariableNames=function(){return(this.template.match(/\${([^}]*)}/gm)||[]).map(function(k){return k.slice(2,-1)})};var c=new f({match:i,bind:i});var h=b.extend(function(m,l,k){e(arguments,[d,d]);b.call(this);k=k||{};this.bindingTemplate=new a(g.resolve(l,m));this.matchingRegexp=new RegExp("^"+this.bindingTemplate.generate({getContextVariableValue:function(n){return"("+(k[n]||/.+/).source+")"}})+"$");this.constraints=k});h.prototype.match=function(m){e(arguments,[d]);var l=this.bindingTemplate.getVariableNames();var k=this.matchingRegexp.exec(m);return k?{getContextVariableValue:function(n){return k[l.indexOf(n)+1||-1]||""}}:null};h.prototype.bind=function(k){return this.bindingTemplate.generate(k)};c.implementedBy(h);this.IContextProvider=j;this.StringTemplate=a;this.IURITemplate=c;this.SimpleURITemplate=h});
/*
 *
 * Copyright 2010 Backbase - All rights reserved.
 *
 */
b$.module("portal.models.item",function(){var E=b$.Class;var e=b$.require("b$.Interface");var b=b$.require("b$.testArguments");var s=b$.require("b$.Exception");var d=b$.require("b$.ArgumentException");var i=b$.require("b$.TypeConstraintOptional");var t=b$.require("b$.types.STRING");var z=b$.require("b$.types.ANY");var D=b$.require("portal.models.item.DataType");var r=b$.require("b$.mvc.Model");var G=b$.require("b$.mvc.HashMap");var f=b$.require("b$.mvc.MutationEvent");var l=b$.require("portal.IComparable");var C=b$.require("portal.OrderedCollection");var B=b$.require("portal.OrderedCollectionModificationException");var q=b$.require("portal.template.IURITemplate");var n=b$.require("portal.template.SimpleURITemplate");var A=new i(t);var o={ADMIN:0,CREATOR:1,COLLABORATOR:2,CONTRIBUTOR:3,CONSUMER:4};var w=s.extend(function(J){b(arguments,[t]);s.call(this,"There is no preference with the name '"+J+"' defined.");this.preferenceName=J});var u=r.extend(function(N,L,M,K,J){b(arguments,[t,t,z,D,A]);if(!K.test(M)){throw new d("Incorrect initial value provided.",arguments,2,K)}r.call(this);this.name=N;this.label=L;this.value=M;this.dataType=K;if(J){this.viewHint=J}this.markedForDeletion=false});u.prototype.getName=function(){return this.name};u.prototype.getLabel=function(){return this.label};u.prototype.getViewHint=function(){return this.viewHint};u.prototype.getValue=function(){return this.value};u.prototype.setValue=function(J){if(!this.dataType.test(J)){throw new d("Incorrect value type.",arguments,0,this.dataType)}if(J!=this.value){this.value=J;this.notifyObservers("value")}};u.prototype.getDataType=function(){return this.dataType};u.prototype.equals=function(J){return J==this};u.prototype.clone=function(){return new u(this.name,this.label,this.value,this.dataType,this.viewHint)};u.prototype.markForDeletion=function(){this.markedForDeletion=true};u.prototype.isMarkedForDeletion=function(){return this.markedForDeletion};l.implementedBy(u);var g=C.extend(function(J){C.call(this,J)});g.prototype.add=function(J){b(arguments,[u]);if(this.getByName(J.getName())){throw new d("Attempt to add non unique preference.",arguments,0,u)}C.prototype.add.call(this,J)};g.prototype.getByName=function(L){var K=this.getIterator(),J=null;while(K.hasNext()){J=K.next();if(J.getName()==L){return J}}return null};g.prototype.remove=function(K){K.markForDeletion();var J=this.indexOf(K)>-1;return J};g.prototype.__remove=function(K){var J=C.prototype.remove.call(this,K);return J};var k=r.extend(function(K,J,L,M){b(t,t,t,A);r.call(this);this.id=K;this.itemId=J;this.cmisUid=L;this.type=M||"";this.markedForDeletion=false});k.prototype.getId=function(){return this.id};k.prototype.getItemId=function(){return this.itemId};k.prototype.getCmisId=function(){return this.cmisUid};k.prototype.getType=function(){return this.type};k.prototype.markForDeletion=function(){this.markedForDeletion=true};k.prototype.equals=function(J){return this==J||(J instanceof k&&J.getId()==this.id)};k.prototype.isMarkedForDeletion=function(){return this.markedForDeletion};l.implementedBy(k);var F=C.extend(function(J){C.call(this,J)});F.prototype.add=function(J){C.prototype.add.call(this,J);this.notifyObservers("Contents",J)};F.prototype.remove=function(L){L.markForDeletion();var K=this.indexOf(L)>-1;if(K){var J=new f();J.initMutationEvent("ContentItemRemoved",true,false,null,L,null,L.getId(),null);this.notifyObservers(J,false)}return K};F.prototype.update=function(K){var J=this.indexOf(K);if(J>-1){this.items.splice(J,1,K);this.notifyObservers("Contents",K)}else{this.add(K)}};F.prototype.__remove=function(K){var J=C.prototype.remove.call(this,K);return J};var H=f.extend(function(K,L,J){f.call(this);this.initMutationEvent("PropertyModified",true,false,null,J,L,K,null)});var h=f.extend(function(L,K,J){f.call(this);this.initMutationEvent("PrefModified",true,false,null,J,K.getValue(),K.getName(),L)});var j=C.extend();var p=E.extend(function(K,J){b(arguments,[c,u]);E.call(this);this.oldValue=J.getValue();this.item=K;J.addObserver("value",this.valueChanged,this)});p.prototype.valueChanged=function(K){var L=K.target.getValue();var J=this.oldValue;if(L!=J){this.oldValue=L;this.item.notifyObservers(new h(f.MODIFICATION,K.target,J))}};var c=r.extend(function(J,N,M,K,L,P){var O=this;r.call(this);this.id=M;this.parentItemName=null;this.extendedItemName=N;this.portal=J;this.bCreated=L;this.bChanged=L;this.preferences=K;this.preferences.each(function(Q){new p(O,Q)});this.securityProfile=o.CONSUMER;if(P){this.contents=P}else{this.contents=new F([])}this.contents.addObserver("Contents",this.contentsChanged,this);this.contents.addObserver("ContentItemRemoved",this.contentItemRemoved,this);if(J){J.registerItem(this)}});c.prototype.setPreference=function(L,J){var K=this.preferences.getByName(L);if(K){K.setValue(J)}else{throw new w(L)}};c.prototype.getPreference=function(K){var J=this.preferences.getByName(K);if(J){return J.getValue()}};c.prototype.getPreferenceObject=function(J){return this.preferences.getByName(J)};c.prototype.isPreference=function(J){return Boolean(this.preferences.getByName(J))};c.prototype.addPreference=function(O,N,L,K,J){var M=new u(O,N,L,K,J);this.bChanged=true;this.preferences.add(M);this.notifyObservers(new h(f.ADDITION,M,null));new p(this,M)};c.prototype.removePreference=function(K){var J=this.preferences.getByName(K);if(J){this.bChanged=true;this.preferences.remove(J);this.notifyObservers(new h(f.REMOVAL,J,J.getValue()))}};c.prototype.getPreferences=function(){return this.preferences};c.prototype.setContentsObject=function(K){b(arguments,[F]);var J=this.contents;K.each(function(L){J.update(L)});J.each(function(M){var L=true;K.each(function(N){if(N.equals(M)){L=false}});if(L){J.remove(M)}})};c.prototype.getContentsObject=function(){return this.contents};c.prototype.getBubbleParent=function(){if(this.parent){return this.parent}else{if(!(this instanceof a)){return this.portal}return null}};c.prototype.softDelete=function(){this.bDeleted=true};c.prototype.hardDelete=function(){this.bHardDeleted=true};c.prototype.getParent=function(){return this.parent};c.prototype.getParentItemName=function(){return this.parent?this.parent.getId():this.parentItemName};c.prototype.getExtendedItemName=function(){return this.extendedItemName};c.prototype.getPortal=function(){return this.portal};c.prototype.getId=function(){return this.id};c.prototype.setSecurityProfile=function(J){this.securityProfile=J};c.prototype.getSecurityProfile=function(){return this.securityProfile};c.prototype.equals=function(J){return this==J||(J instanceof c&&J.getId()==this.id)};c.prototype.contentsChanged=function(){this.notifyObservers(new H("Contents",null,null))};c.prototype.contentItemRemoved=function(J){var K=new f();K.initMutationEvent("ContentItemRemoved",true,false,null,J.prevValue,null,J.prevValue.getId(),null);this.notifyObservers(K)};l.implementedBy(c);var m=c.extend(function(J,O,M,K,N,L){c.call(this,J,O,M,K,L);this.children=[];N.forEach(function(P){this.children.push(P);P.parent=this;P.parentItemName=this.id},this)});m.prototype.addChild=function(K){if(K.parent&&K.parent.removeChild){K.parent.removeChild(K)}this.children.push(K);this.bChanged=true;K.parent=this;K.parentItemName=this.id;var J=new f();J.initMutationEvent("NodeInserted",true,false,this,null,null,null,null);K.notifyObservers(J,false)};m.prototype.insertBefore=function(M,L){if(M.parent&&M.parent.removeChild){M.parent.removeChild(M)}var K=this.children.indexOf(L);if(K>-1){this.children.splice(K,0,M)}else{this.children.push(M)}this.bChanged=true;M.parent=this;M.parentItemName=this.id;var J=new f();J.initMutationEvent("NodeInserted",true,false,this,null,null,null,null);M.notifyObservers(J,false)};m.prototype.removeChild=function(M){var K=this.children.indexOf(M);if(K>-1){var J=new f();J.initMutationEvent("NodeRemoved",true,false,this,null,null,null,null);M.notifyObservers(J,false);this.children.splice(K,1);this.bChanged=true;var L=new f();L.initMutationEvent("NodeRemovedComplete",true,false,this,null,null,null,null);M.notifyObservers(L,false);M.parent=null;M.parentItemName=null}};m.prototype.getChildren=function(){return this.children};m.prototype.refresh=function(){this.getChildren().forEach(function(J){J.refresh()})};m.prototype.updateWidget=function(J){var K=this;var L=this.getChildren();L.forEach(function(N,M){if(N instanceof m){N.updateWidget(J)}else{if(N.equals(J)){J.parent=N.parent;K.children.splice(M,1,J)}}})};var a=m.extend(function(J,P,M,K,O,L){m.call(this,J,P,M,K,O,L);this.registry=new G();var N={dragEnabled:false};this.getDragEnabled=function(){return N.dragEnabled};this.setDragEnabled=function(Q){N.dragEnabled=Q}},{registerItem:function(J){this.registry.add(J);this.notifyObservers("nodeRegistered",J)},unregisterItem:function(J){this.registry.remove(J);this.notifyObservers("nodeUnregistered",J)},getItem:function(J){return this.registry.get(J)}});var y=m.extend(function(J,O,M,K,N,L){m.call(this,J,O,M,K,N,L)});y.prototype.extendItem=function(){var L=[];var J=new g([]);this.preferences.each(function(M){J.add(M.clone())});var K=new y(this.portal,this.id,String(this.id+Math.random()).replace(".","_"),J,L,false);K.setSecurityProfile(this.getSecurityProfile());return K};var I=c.extend(function(J,O,N,K,M,L){c.call(this,J,O,N,K,M);this.templateType=L});var x=c.extend(function(J,N,M,K,L){c.call(this,J,N,M,K,L)});var v=C.extend();this.NoPreferenceDefinedException=w;this.SecurityProfile=o;this.DataType=D;this.Preference=u;this.Preferences=g;this.Content=k;this.Contents=F;this.PropertyModifiedEvent=H;this.Children=j;this.Item=c;this.BaseContainer=m;this.Portal=a;this.Container=y;this.Template=I;this.Include=x;this.Portals=v});b$.module("portal.widget",function(){var l=b$.require("b$.Interface");var c=b$.require("b$.Class");var i=b$.require("b$.testArguments");var m=b$.require("b$.TypeConstraintOptional");var q=b$.require("b$.TypeConstraintNull");var z=b$.require("b$.Exception");var D=b$.require("b$.ArgumentException");var e=b$.require("b$.types.FUNCTION");var t=b$.require("b$.types.BOOLEAN");var L=b$.require("b$.types.STRING");var f=b$.require("b$.types.ANY");var C=b$.require("b$.uri.URI");var K=b$.require("b$.mvc.Model");var M=b$.require("portal.IComparable");var H=b$.require("portal.OrderedCollection");var J=b$.require("portal.OrderedCollectionModificationException");var k=b$.require("portal.template.IURITemplate");var G=b$.require("portal.template.SimpleURITemplate");var B=b$.require("portal.models.item.Preference");var A=b$.require("portal.models.item.Preferences");var r=b$.require("portal.models.item.Item");var u=b$.require("portal.models.item.Portal");var T=new m(t);var w=new m(Array);var s=new m(L);var P=new m(u);var g=K.extend(function(W,V,U){i(arguments,[L,L,L]);if(!/inline|external/.test(W)){throw new D("Incorrect resource type provided.",arguments,0,L)}K.call(this);this.ready=false;this.type=W;this.contentType=V;this.contentSource=W=="inline"?U:null;this.uri=W=="external"?new C(U).resolve(new C(portal.config.resourceRoot)):null});g.prototype.getType=function(){return this.type};g.prototype.isReady=function(){return this.ready};g.prototype.becomeReady=function(){if(!this.ready){this.ready=true;this.notifyObservers("ready")}};g.prototype.getContentType=function(){return this.contentType};g.prototype.getContentSource=function(){return this.contentSource};g.prototype.setContentSource=function(U){i(arguments,[L]);this.contentSource=U};g.prototype.getURI=function(){return this.uri};g.prototype.equals=function(U){return U instanceof g&&(U==this||(this.type=="external"&&U.getType()=="external"&&U.getURI().equals(this.uri)))};M.implementedBy(g);var Q=g.extend();var d=g.extend();var y=H.extend();y.prototype.add=function(U){i(arguments,[g]);H.prototype.add.call(this,U)};var N=new m(y);var p=new m(A);var R=new l({handleWidgetTerminationConfirmed:e,handleWidgetTerminationAborted:e});var h=r.extend(function(X,Y,W,U,V,aa,Z){i(arguments,[P,s,L,A,T,N]);r.call(this,X,Y,W,U,V,Z);this.resources=aa||new y()});h.prototype.getTitle=function(){return"Widget "+this.id};h.prototype.getResources=function(){return this.resources};h.prototype.run=function(){};h.prototype.tryToTerminate=function(U){i(arguments,[R]);this.terminate();U.handleWidgetTerminationConfirmed(this)};h.prototype.terminate=function(){};h.prototype.extendItem=function(){var V=new A([]);this.preferences.each(function(W){V.add(W.clone())});var U=new h(this.portal,this.getId(),String(this.id+Math.random()).replace(".","_"),V,false,this.resources);U.setSecurityProfile(this.getSecurityProfile());return U};h.prototype.toString=function(){return r.prototype.toString.call(this)+" "+this.title+""};var b=K.extend(function(V,U){i(arguments,[L,f]);K.call(this);this.name=V;this.value=U});b.prototype.getName=function(){return this.name};b.prototype.getValue=function(){return this.value};b.prototype.equals=function(U){return U===this||(U instanceof b&&this.getName()==U.getName()&&this.getValue()==U.getValue())};M.implementedBy(b);var O=H.extend();O.prototype.add=function(U){i(arguments,[b]);if(this.getByName(U.getName())){H.prototype.remove.call(this,this.getByName(U.getName()))}H.prototype.add.call(this,U)};O.prototype.getByName=function(W){var V=this.getIterator(),U=null;while(V.hasNext()){U=V.next();if(U.getName()==W){return U}}return null};var S=c.extend(function(U){i(arguments,[L]);if(!S.NAME_REGEXP.test(U)){throw new D("Perspective type name does not satisfy the grammar rules.",arguments,0,L)}c.call(this);this.name=U});S.NAME_REGEXP=/^([\w\d]+)(?:\.([\w\d]+))?$/;S.prototype.getName=function(){return this.name};S.prototype.getPrimarySurface=function(){return this.name.split(".")[0]};S.prototype.getSecondarySurface=function(){return this.name.split(".")[1]||""};var E=K.extend(function(U,W,V){i(arguments,[k,S,O]);K.call(this);this.uriTemplate=U;this.type=W;this.parameters=V});E.prototype.getURITemplate=function(){return this.uriTemplate};E.prototype.getType=function(){return this.type};E.prototype.getParameters=function(){return this.parameters};E.prototype.bind=function(){var U=this.parameters;return this.uriTemplate.bind({getContextVariableValue:function(W){var V=U.getByName(W);return V&&V.getValue()}})};var x=new l({createPerspective:e});var a=x.extend({getCurrentPerspective:e,setCurrentPerspective:e});var v=z.extend(function(V,U){i(arguments,[L,j]);z.call(this,V);this.field=U});var j=K.extend(function(U){i(arguments,[B]);K.call(this);this.preference=U;this.value=U.getValue();this.valid=true});j.prototype.getPreference=function(){return this.preference};j.prototype.getValue=function(){return this.value};j.prototype.setValue=function(U){if(arguments.length<1){throw new D("Value argument was not provided.",arguments,0,f)}if(this.value!=U){this.value=U;this.validate();this.notifyObservers("value")}};j.prototype.validate=function(){this.valid=this.preference.getDataType().test(this.getValue());this.notifyObservers("valid")};j.prototype.isValid=function(){return this.valid};j.prototype.isChanged=function(){return this.preference.getValue()!=this.getValue()};j.prototype.apply=function(){if(!this.isValid()){throw new v("Can't apply invalid value of field to the preference.",this)}if(this.isChanged()){this.preference.setValue(this.getValue())}};j.prototype.reset=function(){if(this.isChanged()){this.setValue(this.preference.getValue())}};j.prototype.equals=function(U){return this==U};M.implementedBy(j);var o=H.extend();o.prototype.add=function(U){i(arguments,[j]);H.prototype.add.call(this,U)};var n=K.extend(function(U,V){i(arguments,[h,T]);K.call(this);this.widget=U;var X=[],W=this;U.getPreferences().each(function(Z){var Y=W.createFieldFromUserPreference(Z);if(Y){Y.addObserver("value",W.fieldsValueChanged,W);X.push(Y)}});this.fields=new o(X);this.requiresSubmit=V==undefined?true:V;this.active=false});n.prototype.getWidget=function(){return this.widget};n.prototype.getFields=function(){return this.fields};n.prototype.isSubmitRequired=function(){return this.requiresSubmit};n.prototype.isActive=function(){return this.active};n.prototype.activate=function(){this.active=true;this.notifyObservers("active")};n.prototype.deactivate=function(){this.active=false;this.notifyObservers("active")};n.prototype.reset=function(){this.fields.each(function(U){U.reset()})};n.prototype.applyField=function(U){U.apply()};n.prototype.apply=function(){if(!this.isValid()){var U=[];this.fields.each(function(W){if(!W.isValid()){U.push(W)}});throw new v("Can't apply invalid value of field to the preference.",U[0])}var V=this;this.fields.each(function(W){V.applyField(W)})};n.prototype.hasChanges=function(){return !this.fields.every(function(U){return !U.isChanged()})};n.prototype.isValid=function(){return this.fields.every(function(U){return U.isValid()})};n.prototype.createFieldFromUserPreference=function(U){return new j(U)};n.prototype.fieldsValueChanged=function(U){if(!this.isSubmitRequired()){if(U.target.isValid()){this.applyField(U.target)}}};var F=new l({createUserPreferencesFormForWidget:e});var I=c.extend();I.prototype.createUserPreferencesFormForWidget=function(U){return new n(U)};F.implementedBy(I);this.Resource=g;this.ScriptResource=Q;this.StylesheetResource=d;this.Resources=y;this.IWidgetTerminationAcceptor=R;this.Widget=h;this.PerspectiveParameter=b;this.PerspectiveParameters=O;this.PerspectiveType=S;this.Perspective=E;this.IPerspectiveFactory=x;this.IPerspectiveProvider=a;this.UserPreferenceFieldApplicationException=v;this.UserPreferenceField=j;this.UserPreferenceFields=o;this.UserPreferencesForm=n;this.IUserPreferencesFormFactory=F;this.DefaultUserPreferencesFormFactory=I});
/*
 *
 * Copyright 2010 Backbase - All rights reserved.
 *
 */
b$.module("portal.models.holder",function(){var k=b$.require("b$.types.STRING");var g=b$.require("b$.TypeConstraintOptional");var j=b$.require("b$.mvc.Model");var s=b$.require("portal.models.item.PropertyModifiedEvent");var c=b$.require("portal.models.item.Item");var p=b$.require("portal.widget.Perspective");var m=b$.require("portal.widget.PerspectiveType");var f=b$.require("portal.widget.PerspectiveParameters");var l=b$.require("portal.widget.IPerspectiveProvider");var r=b$.require("portal.widget.IPerspectiveFactory");var d=b$.require("portal.widget.Widget");var h=b$.require("portal.widget.IUserPreferencesFormFactory");var q=b$.require("portal.widget.DefaultUserPreferencesFormFactory");var a=b$.require("b$.testArguments");var o=new g(c);var b=j.extend(function(t){a(arguments,[c]);j.call(this);this.item=t});b.prototype.setItem=function(t){a(arguments,[c]);if(this.item){this.item.removeAllObservers()}this.item=t;this.notifyObservers("item")};b.prototype.getItem=function(){return this.item};var i=b.extend(function(u,t){a(arguments,[c,o]);b.call(this,u);this.beforeItem=t||null});i.prototype.getBeforeItem=function(){return this.beforeItem};var e=new g(h);var n=b.extend(function(u,w,t,v,x){a(arguments,[d,p,k,r,e]);b.call(this,u);this.layoutHint=t;this.perspectiveFactory=v;this.perspective=w;this.preferencesForm=(x||new q()).createUserPreferencesFormForWidget(this.item);this.item.run()});n.prototype.getCurrentPerspective=function(){return this.perspective};n.prototype.setCurrentPerspective=function(t){a(arguments,[p]);var u=this.perspective;this.perspective=t;this.notifyObservers(new s("currentPerspective",t,u))};n.prototype.createPerspective=function(u,t){return this.perspectiveFactory.createPerspective(u,t)};n.prototype.getPreferencesForm=function(){return this.preferencesForm};n.prototype.getLayoutHint=function(){return this.layoutHint};l.implementedBy(n);this.ItemHolder=b;this.PlaceHolder=i;this.WidgetHolder=n});b$.module("portal",function(){var a=b$.require("b$.testArguments");var u=b$.require("b$.Class");var m=b$.require("b$.ArrayIterator");var o=b$.require("b$.types.STRING");var n=b$.require("b$.mvc.Model");var v=b$.require("portal.widget.Perspective");var q=b$.require("portal.widget.PerspectiveType");var h=b$.require("portal.widget.PerspectiveParameter");var i=b$.require("portal.widget.PerspectiveParameters");var p=b$.require("portal.widget.IPerspectiveProvider");var x=b$.require("portal.widget.IPerspectiveFactory");var e=b$.require("portal.widget.Widget");var j=b$.require("portal.widget.IUserPreferencesFormFactory");var w=b$.require("portal.widget.DefaultUserPreferencesFormFactory");var k=b$.require("portal.template.SimpleURITemplate");var f=b$.require("b$.mvc.MutationEvent");var d=b$.require("portal.models.item.Item");var c=b$.require("portal.models.holder.ItemHolder");var l=b$.require("portal.models.holder.PlaceHolder");var r=b$.require("portal.models.holder.WidgetHolder");var b=n.extend(function(z){a(arguments,[o]);n.call(this);this.name=z;this.holders=[];this.mutated=false;this.placeholder=null});b.prototype.getName=function(){return this.name};b.prototype.setUserPreferencesFormFactory=function(z){this.userPreferencesFormFactory=z};b.prototype.getHolders=function(){if(this.mutated){var C=null;for(var z=0;this.holders.length>z;z++){for(var B=z+1;this.holders.length>B;B++){var A=this.holders[B];var D=this.holders[z];if(A.getItem().getPreference("order")<D.getItem().getPreference("order")){C=D;this.holders[z]=A;this.holders[B]=C}}}}this.mutated=false;return new m(this.holders)};b.prototype.getItemCount=function(){return this.holders.length};b.prototype.removeHolder=function(A){a(arguments,[c]);var B=this.holders.indexOf(A);if(B>=0){this.holders.splice(B,1);this.mutated=true;var z=new f();z.initMutationEvent("NodeRemovedComplete",true,false,this,null,null,null,null);this.notifyObservers(z,false)}return A};b.prototype.removeItem=function(z){a(arguments,[d]);this.holders.forEach(function(A){if(A.getItem().equals(z)){this.removeHolder(A)}},this)};b.prototype.addItem=function(B){a(arguments,[d]);var A=this.createHolder(B);this.holders.push(A);this.mutated=true;var z=new f();z.initMutationEvent("NodeInserted",true,false,this,null,null,null,null);this.notifyObservers(z,false);return A};b.prototype.hasHolder=function(z){return this.holders.indexOf(z)!=-1};b.prototype.materializePlaceholder=function(){if(this.placeholder){var G=this.placeholder.getItem();var C=this.placeholder.getBeforeItem();var z=null;var B=this.holders;if(C){for(var A=0;A<B.length&&z==null;A++){if(B[A].getItem()==C){z=B[A-1]?B[A-1].getItem():null}}}else{z=B[B.length-1]?B[B.length-1].getItem():null}var D=z?z.getPreference("order"):-1000;var F=C?C.getPreference("order"):1000;var E=(D+F)/2;G.setPreference("area",this.getName());G.setPreference("order",E);this.addItem(G)}};b.prototype.insertPlaceholder=function(A){this.placeholder=this.createHolder(A);var z=new f();z.initMutationEvent("PlaceholderInserted",true,false,this,null,null,null,null);this.notifyObservers(z,false);return this.placeholder};b.prototype.removePlaceholder=function(){this.placeholder=null;var z=new f();z.initMutationEvent("PlaceholderRemoved",true,false,this,null,null,null,null);this.notifyObservers(z,false)};b.prototype.getPlaceholder=function(){return this.placeholder};b.prototype.clearItems=function(){this.holders=[];this.placeholder=null;var z=new f();z.initMutationEvent("NodeRemovedComplete",true,false,this,null,null,null,null);this.notifyObservers(z,false);var z=new f();z.initMutationEvent("PlaceholderRemoved",true,false,this,null,null,null,null);this.notifyObservers(z,false)};b.prototype.matchItem=function(z){return z.getPreference("area")==this.name};b.prototype.createHolder=function(B){var A=null;if(B instanceof e){var z=new g();A=new r(B,z.createPerspective(new q("Dashboard"),new i([new h("perspective","Dashboard")])),"",z,this.userPreferencesFormFactory)}else{if(B instanceof l){A=B}else{A=new c(B)}}return A};b.prototype.toString=function(){return"Area "+this.name+" ("+this.holders.length+" holders)"};var y=b.extend(function(){b.call(this,"catalog-area");this.catalog=new portal.models.Composer()});y.prototype.addItems=function(z){z.forEach(function(A){this.addItem(A)},this);this.catalog.load(this.holders)};y.prototype.getCatalog=function(){return this.catalog};var g=n.extend(function(){n.call(this);this.templates=[new k(document.location.href,"perspective1"),new k(document.location.href,"perspective2"),new k(document.location.href,"perspective3")];this.perspective=this.createPerspective(new q("Dashboard"),new i())});g.prototype.navigateToURI=function(z){if(this.templates[0].match(z)){this.setCurrentPerspective(this.createPerspective(new q("Dashboard"),new i()))}else{if(this.templates[1].match(z)){this.setCurrentPerspective(this.createPerspective(new q("Canvas"),new i()))}else{if(this.templates[2].match(z)){this.setCurrentPerspective(this.createPerspective(new q("Profile"),new i()))}else{document.location.href=z}}}};g.prototype.createPerspective=function(A,z){if(A.getPrimarySurface()=="Dashboard"){return new v(this.templates[0],A,z)}else{if(A.getPrimarySurface()=="Canvas"){return new v(this.templates[1],A,z)}else{if(A.getPrimarySurface()=="Profile"){return new v(this.templates[2],A,z)}else{throw new Error("Unsupported view type - "+A.getName()+".")}}}};g.prototype.getCurrentPerspective=function(){return this.perspective};g.prototype.setCurrentPerspective=function(z){a(arguments,[v]);this.perspective=z;this.notifyObservers("currentPerspective")};var t=n.extend(function(z,A){n.call(this);this.container=z;this.userPreferencesFormFactory=A;this.areas=[]});t.prototype.findAreaWithPlaceholderFor=function(z){var A=new m(this.areas);while(A.hasNext()){var B=A.next();if(B.getPlaceholder()){return B}}return null};t.prototype.handleEvent=function(z){if(z.target.getParent()==this.container){if(z.type=="NodeInserted"){var A=this.findAreaWithPlaceholderFor(z.target);if(A){A.materializePlaceholder()}else{this.distribute()}}else{if(z.type=="NodeRemovedComplete"){var B=new m(this.areas);while(B.hasNext()){B.next().removeItem(z.target)}}else{this.distribute()}}}};t.prototype.attach=function(){this.container.addObserver("NodeInserted",this.handleEvent,this);this.container.addObserver("NodeRemovedComplete",this.handleEvent,this);this.distribute()};t.prototype.detach=function(){this.container.removeObserver("NodeInserted",this.handleEvent,this);this.container.removeObserver("NodeRemovedComplete",this.handleEvent,this);this.clearAreas()};t.prototype.getAreas=function(){return new m(this.areas)};t.prototype.getAreaByName=function(A){var z=this.getAreas();while(z.hasNext()){var B=z.next();if(B.getName()==A){return B}}return null};t.prototype.getAreaByHolder=function(z){var A=this.getAreas();while(A.hasNext()){var B=A.next();if(B.hasHolder(z)){return B}}return null};t.prototype.getAreaForItem=function(B){var z=this.getAreas();while(z.hasNext()){var A=z.next();if(A.matchItem(B)){return A}}return null};t.prototype.clearAreas=function(){this.areas.forEach(function(z){z.clearItems()})};t.prototype.addArea=function(A){a(arguments,[b]);if(this.getAreaByName(A.getName())){throw new Error('An area with name "'+A.getName()+'" already exists.')}this.areas.push(A);A.setUserPreferencesFormFactory(this.userPreferencesFormFactory);var z=new f();z.initMutationEvent("NodeInserted",true,false,this,null,null,null,null);A.notifyObservers(z,false);return A};t.prototype.distribute=function(){if(!this.areas.length){throw new Error("Layout must have at least 1 area.")}this.clearAreas();new m(this.container.getChildren()).forEach(function(z){(this.getAreaForItem(z)||this.getFallbackArea()).addItem(z)},this)};t.prototype.getFallbackArea=function(){if(!this.areas.length){throw new Error("Layout must have at least 1 area.")}return this.areas[0]};t.prototype.toString=function(){return"Layout ("+this.areas.length+" areas)"};t.prototype.getContainer=function(){return this.container};t.prototype.createCatalogArea=function(){this.areas=[];var z=new y();this.addArea(z);return z};var s=u.extend(function(){});s.prototype.createLayout=function(A,z){throw new Error("Layout "+A+" not found.")};s.prototype.toString=function(){return"LayoutFactory"};this.TestPerspectiveProvider=g;this.Area=b;this.CatalogArea=y;this.Layout=t;this.LayoutFactory=s});b$.module("portal.page",function(){var n=b$.require("b$.Class");var a=b$.require("b$.testArguments");var d=b$.require("b$.TypeConstraintOptional");var j=b$.require("b$.types.STRING");var g=b$.require("b$.ArrayIterator");var h=b$.require("b$.mvc.Model");var f=b$.require("portal.template.SimpleURITemplate");var r=b$.require("portal.widget.Resources");var k=b$.require("portal.widget.PerspectiveType");var c=b$.require("portal.widget.PerspectiveParameters");var p=b$.require("portal.widget.Perspective");var q=b$.require("portal.widget.IPerspectiveFactory");var b=b$.require("portal.widget.Widget");var l=b$.require("portal.models.holder.WidgetHolder");var e=b$.require("portal.models.item.BaseContainer");var m=new d(j);var o=n.extend(function(){n.call(this);this.uniqueResources=new r()});o.prototype.add=function(v){var u=this.uniqueResources,s=u.indexOf(v),t=s!=-1?u.item(s):null;if(s==-1){u.add(v)}else{if(t!=v){if(t.isReady()){v.becomeReady()}else{t.addObserver("ready",function(w){if(w.target.isReady()){v.becomeReady()}},this)}}}};o.prototype.addItemResources=function(t){var s=this;(function(u){if(u instanceof b){u.getResources().each(function(v){s.add(v)},this)}if(u instanceof e){new g(u.getChildren()).forEach(arguments.callee)}})(t)};o.prototype.getUnique=function(){return this.uniqueResources};var i=e.extend(function(u,x,t,y,v,s){e.call(this,u,x,t,y,v,s);this.uniqueResources=new o();var w=this.uniqueResources;this.children.forEach(function(z){w.addItemResources(z)},this);this.addObserver("NodeInserted",function(z){w.addItemResources(z.target)},this)});i.prototype.createPerspective=function(s,t){return new p(this.findURITemplateForPerspectve(s,t),s,t)};i.prototype.findURITemplateForPerspectve=function(s,t){return new f("/","page")};i.prototype.getUniqueResources=function(){return this.uniqueResources.getUnique()};q.implementedBy(i);this.Page=i});b$.module("portal.mappings.xml",function(){var j=b$.require("b$.testArguments");var O=b$.require("b$.Exception");var U=b$.require("b$.ArgumentException");var b=b$.require("b$.Class");var g=b$.require("b$.types.ANY");var af=b$.require("b$.types.STRING");var e=b$.require("b$.types.FUNCTION");var x=b$.require("b$.mappings.xml.IBuildAcceptor");var k=b$.require("b$.mappings.xml.IBuilder");var v=b$.require("b$.mappings.xml.ModelsListBuilder");var r=b$.require("b$.mappings.xml.ElementsListBuilder");var w=b$.require("b$.mappings.xml.SimpleElementBuilder");var ab=b$.require("b$.mappings.xml.MappingError");var E=b$.require("b$.mappings.xml.Mapping");var V=b$.require("b$.mappings.xml.MappingRegistry");var C=b$.require("portal.models.item.SecurityProfile");var Z=b$.require("portal.models.item.DataType");var S=b$.require("portal.models.item.Preference");var o=b$.require("portal.models.item.Content");var q=b$.require("portal.models.item.Contents");var ag=b$.require("portal.models.item.Children");var Q=b$.require("portal.models.item.Preferences");var M=b$.require("portal.widget.Resources");var c=b$.require("portal.models.item.Container");var J=b$.require("portal.models.item.Portal");var i=b$.require("portal.widget.Widget");var ak=b$.require("portal.page.Page");var P=b$.require("portal.models.item.StringDataType");var p=b$.require("portal.models.item.BooleanDataType");var D=b$.require("portal.models.item.DoubleDataType");var H=b$.require("portal.models.item.ContentReferenceDataType");var a=function(ao,ap){return function(){return(this.localName||this.baseName)==ap}};var X=ab.extend();var ae=b.extend(function(ao,ap){j(arguments,[x,e]);b.call(this);this.parent=ao;this.proxy=ap});ae.prototype.acceptBuildResult=function(ao){this.proxy(ao)};ae.prototype.acceptBuildError=function(ao){this.parent.acceptBuildError(ao)};ae.prototype.getParentAcceptor=function(){return this.parent};var R=b.extend(function(ao){b.call(this);this.input=ao});R.prototype.build=function(aq){var ar=jQuery(this.input).children().filter(a(null,"value")).text();var ao=jQuery(this.input).children().filter(a(null,"value")).attr("type");var ap=null;switch(ao){case"boolean":ap=new p();break;case"double":ap=new D();break;case"contentRef":ap=new H();break;default:ap=new P()}aq.acceptBuildResult(new S(this.input.getAttribute("name"),this.input.getAttribute("label")||"",ap.parseFromString(ar),ap,this.input.getAttribute("viewHint")))};var n=w.extend(function(ap,ao){w.call(this,null,"property",ao);this.input=ap});n.prototype.buildElement=function(){var aq=w.prototype.buildElement.call(this);aq.setAttribute("name",this.input.getName());var ao=this.input.getLabel();if(ao!=null&&ao!=""){aq.setAttribute("label",ao)}var ap=this.input.getViewHint();if(ap!=null&&ap!=""){aq.setAttribute("viewHint",ap)}var at=this.createElementNS(null,"value");var au=this.input.getDataType().serializeToString(this.input.getValue());at.appendChild(this.document.createTextNode(au));if(this.input.getDataType().getName()!="string"){var ar=this.document.createAttribute("type");ar.nodeValue=this.input.getDataType().getName();at.setAttributeNode(ar)}if(this.input.isMarkedForDeletion()){aq.setAttribute("markedForDeletion","true")}aq.appendChild(at);return aq};var ah=v.extend(function(ao,ap){v.call(this,jQuery(ao).children().get(),ap,null)});ah.prototype.build=function(ao){v.prototype.build.call(this,new ae(ao,function(ap){this.getParentAcceptor().acceptBuildResult(new Q(ap))}))};var aj=r.extend(function(aq,ap,ao){r.call(this,aq.toArray(),ap,ao)});aj.prototype.build=function(ap){var ao=this.createElementNS(null,"properties");r.prototype.build.call(this,new ae(ap,function(aq){aq.forEach(function(ar){ao.appendChild(ar)});this.getParentAcceptor().acceptBuildResult(ao)}))};var B=b.extend(function(ao){b.call(this);this.input=ao});B.prototype.build=function(ar){var ap=jQuery(this.input).attr("id");var ao=jQuery(this.input).attr("itemName");var aq=jQuery(this.input).children().filter(a(null,"cmisUid")).text();var at=jQuery(this.input).attr("type");ar.acceptBuildResult(new o(ap,ao,aq,at))};var F=w.extend(function(ap,ao){w.call(this,null,"content",ao);this.input=ap});F.prototype.buildElement=function(){var ap=w.prototype.buildElement.call(this);ap.setAttribute("id",this.input.getId());ap.setAttribute("itemName",this.input.getItemId());if(this.input.isMarkedForDeletion()){ap.setAttribute("markedForDeletion","true")}if(this.input.getType()){ap.setAttribute("type",this.input.getType())}var ao=this.createElementNS(null,"cmisUid");ao.appendChild(this.document.createTextNode(this.input.getCmisId()));ap.appendChild(ao);return ap};var z=v.extend(function(ap,ao){v.call(this,jQuery(ap).children().get(),ao,null)});z.prototype.build=function(ao){v.prototype.build.call(this,new ae(ao,function(ap){this.getParentAcceptor().acceptBuildResult(new q(ap))}))};var s=r.extend(function(aq,ap,ao){r.call(this,aq.toArray(),ap,ao)});s.prototype.build=function(ap){var ao=this.createElementNS(null,"contents");r.prototype.build.call(this,new ae(ap,function(aq){aq.forEach(function(ar){ao.appendChild(ar)});this.getParentAcceptor().acceptBuildResult(ao)}))};var ai=v.extend(function(ao,aq,ap){v.call(this,jQuery(ao).children().get(),aq,ap)});ai.prototype.build=function(ao){v.prototype.build.call(this,new ae(ao,function(ap){this.getParentAcceptor().acceptBuildResult(new ag(ap))}))};var N=r.extend(function(aq,ap,ao){r.call(this,aq.toArray(),ap,ao)});N.prototype.build=function(ap){var ao=this.createElementNS(null,"children");r.prototype.build.call(this,new ae(ap,function(aq){aq.forEach(function(ar){ao.appendChild(ar)});this.getParentAcceptor().acceptBuildResult(ao)}))};var ac=b.extend(function(ap,aq,ao){b.call(this);this.input=ap;this.registry=aq;this.context=ao});ac.prototype.build=function(ap){j(arguments,[x]);var ao=jQuery(this.input).children();var at=ao.filter(a(null,"name")).text();var av=ao.filter(a(null,"extendedItemName")).text();var au=ao.filter(a(null,"properties")).get()[0];var aq=ao.filter(a(null,"contents")).get()[0];var ar=ao.filter(a(null,"securityProfile")).text();var ax=this.registry;var aw=this.context;if(aq){ax.buildModelFromElement(aq,aw,new ae(ap,function(ay){ax.buildModelFromElement(au,aw,new ae(ap,function(az){this.getParentAcceptor().acceptBuildResult([at,av,az,ar,ay])}))}))}else{ax.buildModelFromElement(au,aw,new ae(ap,function(ay){this.getParentAcceptor().acceptBuildResult([at,av,ay,ar])}))}};var K=w.extend(function(aq,ar,ap,ao){w.call(this,null,aq,ao);this.input=ar;this.registry=ap});K.prototype.buildElement=function(){var aq=w.prototype.buildElement.call(this);var ap=this.createElementNS(null,"name");ap.appendChild(this.document.createTextNode(this.input.getId()));var ao=this.createElementNS(null,"parentItemName");ao.appendChild(this.document.createTextNode(this.input.getParentItemName()));if(this.input.getExtendedItemName()){var au=this.createElementNS(null,"extendedItemName");au.appendChild(this.document.createTextNode(this.input.getExtendedItemName()));aq.appendChild(au)}var ar=this.createElementNS(null,"securityProfile");var at;switch(this.input.getSecurityProfile()){case C.ADMIN:at="ADMIN";break;case C.CREATOR:at="CREATOR";break;case C.COLLABORATOR:at="COLLABORATOR";break;case C.CONTRIBUTOR:at="CONTRIBUTOR";break;default:at="CONSUMER"}ar.appendChild(this.document.createTextNode(at));aq.appendChild(ar);aq.appendChild(ap);aq.appendChild(ao);return aq};K.prototype.build=function(ar){var ap=this.buildElement();var aq=this.registry;var at=this.input;var ao=this.document;if(at.getContentsObject()){aq.buildElementFromModel(at.preferences,ao,new ae(ar,function(au){aq.buildElementFromModel(at.getContentsObject(),ao,new ae(ar,function(av){ap.appendChild(au);ap.appendChild(av);this.getParentAcceptor().acceptBuildResult(ap)}))}))}else{aq.buildElementFromModel(at.preferences,ao,new ae(ar,function(au){ap.appendChild(au);this.getParentAcceptor().acceptBuildResult(ap)}))}};var L=ac.extend(function(aq,ar,ap,ao){ac.call(this,ar,ap,ao);this.mapping=aq});L.prototype.build=function(ar){j(arguments,[x]);var ap=this.context;var ao=this.mapping;var aq=this.registry;var at=this.input;ac.prototype.build.call(this,new ae(ar,function(aB){var aA=aB[0];var az=aB[1];var av=aB[2];var ay=aB[3];var aw=null;if(aB[4]){aw=aB[4]}var ax=av.getByName("template");if(!ax){this.getParentAcceptor().acceptBuildError(new X("Abscent 'template' properties in the widget source.",at,ao))}else{var au=ao.createWidgetBuilder(ax.getValue(),[aA,az,av,aq,ap,aw]);if(!au){this.getParentAcceptor().acceptBuildError(new X("Abscent builder for the widget type '"+ax.getName()+"'.",at,ao))}else{au.build(new ae(this.getParentAcceptor(),function(aC){var aD=C.CONSUMER;switch(ay){case"ADMIN":aD=C.ADMIN;break;case"CREATOR":aD=C.CREATOR;break;case"COLLABORATOR":aD=C.COLLABORATOR;break;case"CONTRIBUTOR":aD=C.CONTRIBUTOR;break;default:aD=C.CONSUMER;break}aC.setSecurityProfile(aD);this.getParentAcceptor().acceptBuildResult(aC)}))}}}))};var t=K.extend(function(ao,aq,ap){K.call(this,"widget",ao,aq,ap)});var ad=ac.extend(function(aq,ap,ao){ac.call(this,aq,ap,ao)});ad.prototype.createContainerInstance=function(at,ap,ao,aq,ar){throw new O(String(this)+"::createContainerInstance() not implemented")};ad.prototype.build=function(ap){var ao=this;var aq=jQuery(this.input).children().filter(a(null,"children")).get()[0];ac.prototype.build.call(this,new ae(ap,function(ar){ao.registry.buildModelFromElement(aq,ao.context,new ae(this.getParentAcceptor(),function(av){var au=C.CONSUMER;switch(ar[3]){case"ADMIN":au=C.ADMIN;break;case"CREATOR":au=C.CREATOR;break;case"COLLABORATOR":au=C.COLLABORATOR;break;case"CONTRIBUTOR":au=C.CONTRIBUTOR;break;default:au=C.CONSUMER;break}var at=ao.createContainerInstance(ar[0],ar[1],ar[2],au,av);this.getParentAcceptor().acceptBuildResult(at)}))}))};var d=K.extend();d.prototype.build=function(aq){var ar=new ag(this.input.getChildren());var ap=this.registry;var ao=this.document;K.prototype.build.call(this,new ae(aq,function(at){ap.buildElementFromModel(ar,ao,new ae(this.getParentAcceptor(),function(au){at.appendChild(au);this.getParentAcceptor().acceptBuildResult(at)}))}))};var T=ad.extend();T.prototype.createContainerInstance=function(au,at,ao,aq,ar){var ap=new c(this.context,at,au,ao,ar.toArray(),true);ap.setSecurityProfile(aq);return ap};var aa=ad.extend();aa.prototype.createContainerInstance=function(at,ar,ao,ap,aq){var au=new ak(this.context,ar,at,ao,aq.toArray(),true);au.setSecurityProfile(ap);return au};var h=ad.extend();h.prototype.createContainerInstance=function(au,at,ao,aq,ar){var ap=new J(null,at,au,ao,ar.toArray(),true);ap.setSecurityProfile(aq);return ap};var G=E.extend(function(){E.call(this,null,"property",S)});G.prototype.createModelBuilder=function(aq,ap,ao){return new R(aq)};G.prototype.createElementBuilder=function(aq,ap,ao){return new n(aq,ao)};var A=E.extend(function(){E.call(this,null,"properties",Q)});A.prototype.createModelBuilder=function(aq,ap,ao){return new ah(aq,ap)};A.prototype.createElementBuilder=function(aq,ap,ao){return new aj(aq,ap,ao)};var an=E.extend(function(){E.call(this,null,"content",o)});an.prototype.createModelBuilder=function(aq,ap,ao){return new B(aq)};an.prototype.createElementBuilder=function(aq,ap,ao){return new F(aq,ao)};var y=E.extend(function(){E.call(this,null,"contents",q)});y.prototype.createModelBuilder=function(aq,ap,ao){return new z(aq,ap)};y.prototype.createElementBuilder=function(aq,ap,ao){return new s(aq,ap,ao)};var f=E.extend(function(){E.call(this,null,"children",ag)});f.prototype.createModelBuilder=function(aq,ap,ao){return new ai(aq,ap,ao)};f.prototype.createElementBuilder=function(aq,ap,ao){return new N(aq,ap,ao)};var al=E.extend(function(){E.call(this,null,"catalog",ag)});al.prototype.createModelBuilder=function(aq,ap,ao){return new ai(aq,ap,ao)};var W=b.extend(function(ao){j(arguments,[af]);b.call(this);this.typeName=ao});W.prototype.getTypeName=function(){return this.typeName};W.prototype.createModelBuilder=function(ao,ar,at,aq,ap){throw new O(this.toString()+"::createModelBuilder() should be implemented.")};var m=E.extend(function(ao){j(arguments,[Array]);E.call(this,null,"widget",i);this.handlers=[];var ap=this;ao.forEach(function(aq){ap.registerCustomWidgetHandler(aq)})});m.prototype.registerCustomWidgetHandler=function(ao){j(arguments,[W]);if(this.handlers.some(function(ap){return ap.getTypeName()==ao.getTypeName()})){throw new U("Widget tpye handler already registered.",arguments,0,W)}this.handlers.push(ao)};m.prototype.createWidgetBuilder=function(ap,aq){var ao=this.handlers.filter(function(ar){return ar.getTypeName()==ap})[0]||null;if(!ao){throw new X("Can't find the handler for the type of widget '"+ap+"'.",this)}return ao.createModelBuilder.apply(ao,aq)};m.prototype.createModelBuilder=function(aq,ap,ao){return new L(this,aq,ap,ao)};m.prototype.createElementBuilder=function(aq,ap,ao){return new t(aq,ap,ao)};var l=E.extend(function(){E.call(this,null,"container",c)});l.prototype.createModelBuilder=function(aq,ap,ao){return new T(aq,ap,ao)};l.prototype.createElementBuilder=function(aq,ap,ao){return new d(this.localName,aq,ap,ao)};var u=E.extend(function(){E.call(this,null,"page",ak)});u.prototype.createModelBuilder=function(aq,ap,ao){return new aa(aq,ap,ao)};u.prototype.createElementBuilder=function(aq,ap,ao){return new d(this.localName,aq,ap,ao)};var am=E.extend(function(){E.call(this,null,"portal",J)});am.prototype.createModelBuilder=function(aq,ap,ao){return new h(aq,ap,ao)};am.prototype.createElementBuilder=function(aq,ap,ao){return new d(this.localName,aq,ap,ao)};var I=L.extend();I.prototype.build=function(ar){var ap=this.context;var ao=this.mapping;var aq=this.registry;var at=this.input;ac.prototype.build.call(this,new ae(ar,function(ax){var aw=ax[0];var av=ax[1];var au=ax[2];ar.acceptBuildResult(new i(ap,av,aw,au,false))}))};var Y=E.extend(function(){E.call(this,null,"widget",i)});Y.prototype.createModelBuilder=function(aq,ap,ao){return new I(this,aq,ap,ao)};this.Preference=G;this.Preferences=A;this.Content=an;this.Contents=y;this.Children=f;this.Catalog=al;this.CustomWidgetHandler=W;this.Widget=m;this.CatalogWidget=Y;this.Container=l;this.Page=u;this.Portal=am});b$.module("portal.datasource",function(){var A=b$.require("b$.Class"),q=b$.require("b$.Exception"),a=b$.require("b$.testArguments"),d=b$.require("b$.TypeConstraintNull"),i=b$.require("b$.types.FUNCTION"),r=b$.require("b$.types.STRING"),t=b$.require("b$.types.NUMBER"),b=b$.require("b$.Interface"),n=b$.require("b$.mvc.Model"),c=b$.require("b$.mappings.xml.MappingError"),j=b$.require("b$.mappings.xml.MappingRegistry"),k=b$.require("portal.IIdentifiable"),w=b$.require("portal.createXmlDocument");var l=new d(n);var B=new b({handleDataSourceResponse:Function});var E=q.extend(function(F,G){q.call(this,F);this.request=G});var m=E.extend();var y=E.extend();var p=E.extend();var z=p.extend();var C=z.extend();var D=p.extend(function(G,H,F){p.call(this,G,H);this.reason=F});var s=A.extend(function(F,G){this.name=F;this.value=G});s.prototype.toString=function(){return encodeURIComponent(this.name)+"="+encodeURIComponent(this.value)};var x=b$.extend(XMLHttpRequest,function(G,F,H){a(arguments,[l,i,i]);XMLHttpRequest.call(this);delete this.onreadystatechange;this.responseObject=null;this.responseError=null;this.mappings=null;this.params=[];this.preprocessors=[];this.mappingContext=G;this.dataAcceptor=F;this.errorAcceptor=H;this.busy=false;this.responseCallbacks=[]});x.prototype.addResponsePreProcessor=function(F){a(arguments,[i]);this.preprocessors.push(F)};x.prototype.removeResponsePreProcessor=function(F){a(arguments,[i]);this.preprocessors=this.preprocessors.filter(function(G){return G!=F})};x.prototype.addResponseCallback=function(F){a(arguments,[i]);this.responseCallbacks.push(F)};x.prototype.removeResponseCallback=function(F){a(arguments,[i]);this.responseCallbacks=this.responseCallbacks.filter(function(G){return G!=F})};x.prototype.onreadystatechange=function(){if(this.readyState==4){try{if(this.status==200||this.status==201||this.status==400||this.status==204){if(this.status!=204&&!this.responseXML){throw new D("Bad response type or content.",this,null)}this.preprocessResponse();this.processResponse()}else{throw new z("Could not successfuly finish the request.",this)}}catch(F){if(F instanceof p){this.responseError=F;this.errorAcceptor()}else{throw F}}}};x.prototype.preprocessResponse=function(){this.preprocessors.forEach(function(F){F.call(this)},this)};x.prototype.processResponse=function(){var F=this;if(F.status!=204){F.mappings.buildModelFromElement(F.responseXML.documentElement,F.mappingContext,{acceptBuildResult:function(G){F.responseObject=G;F.callbackResponse();if(F.status==400){F.responseError=new C("Server could not process the request.",F);F.errorAcceptor()}else{F.dataAcceptor()}},acceptBuildError:function(G){F.callbackResponse();F.responseError=new D("Can not map the response into the model.",F,G);F.errorAcceptor()}})}else{F.callbackResponse();F.dataAcceptor()}};x.prototype.callbackResponse=function(){this.responseCallbacks.forEach(function(F){F.call(this)},this)};x.prototype.setDataMappings=function(F){a(arguments,[j]);this.mappings=F};x.prototype.getDataMappings=function(){return this.mappings};x.prototype.setParameter=function(G,H){if(this.readyState>=1){throw new m("Can't set parameters on open request.",this)}var F=this.params.filter(function(I){return I.name==G})[0];if(F){F.value=H}else{this.params.push(new s(G,H))}};x.prototype.addParameter=function(F,G){if(this.readyState>=1){throw new m("Can't set parameters on open request.",this)}this.params.push(new s(F,G))};x.prototype.getParameter=function(G){var F=this.params.filter(function(H){return H.name==G})[0];return F?F.value:""};x.prototype.generateFullURI=function(G){var F=this.params.join("&");return G+(F&&((G.indexOf("?")>=0?"&":"?")+F))};x.prototype.open=function(H,I,G,J,F){if(!this.mappings){throw new y("Can't open request when data mappings are not defined.",this)}XMLHttpRequest.prototype.open.call(this,H,this.generateFullURI(I),G,J,F)};x.prototype.send=function(G){var F=this;F.setRequestHeader("Accept","application/xml");if(F.getParameter("cache")===false){F.setRequestHeader("Cache-Control","no-cache,max-age=0");F.setRequestHeader("Pragma","no-cache")}if(G instanceof n&&this.readyState==1){this.mappings.buildElementFromModel(G,w(),{acceptBuildResult:function(H){XMLHttpRequest.prototype.send.call(F,H)},acceptBuildError:function(H){if(H instanceof c){throw new E("Can not serialize the object to be sent.",F)}throw H}})}else{XMLHttpRequest.prototype.send.call(F)}};var f=b$.extend(x);f.prototype.open=function(H,I,G,J,F){if(H.toUpperCase()!="GET"){throw new E("Can't retrieve data with non GET request type.",this)}x.prototype.open.call(this,H,I,G,J,F)};var g=b$.extend(f,function(J,H,G,F,I){a(arguments,[t,t]);f.call(this,G,F,I);this.setParameter("offset",J);this.setParameter("size",H)});g.prototype.getResponseFrameOffset=function(){var F=this.responseXML?this.responseXML.documentElement.getAttribute("offset"):"";return F?Number(F):NaN};g.prototype.getResponseFrameSize=function(){var F=this.responseXML?this.responseXML.documentElement.getAttribute("size"):"";return F?Number(F):NaN};g.prototype.processResponse=function(){if(isNaN(this.getResponseFrameOffset())){throw new D("Response does does not specify the offset of the frame.")}if(isNaN(this.getResponseFrameSize())){throw new D("Response does does not specify the size of the frame.")}f.prototype.processResponse.call(this)};var v=b$.extend(x,function(I,G,F,H){a(arguments,[n]);x.call(this,G,F,H);this.data=I});v.prototype.open=function(H,I,G,J,F){if(H.toUpperCase()!="PUT"){throw new E("Can't retrieve data with non PUT request type.",this)}x.prototype.open.call(this,H,I,G,J,F)};v.prototype.send=function(F){if(F){throw new E("Can't send additional data using this type of request.",this)}x.prototype.send.call(this,this.data)};var h=b$.extend(v,function(I,G,F,H){a(arguments,[k]);v.call(this,I,G,F,H)});h.prototype.generateFullURI=function(F){return v.prototype.generateFullURI.call(this,F+"/"+encodeURIComponent(this.data.getId()))};var o=b$.extend(x,function(I,G,F,H){a(arguments,[l]);x.call(this,G,F,H);this.data=I});o.prototype.open=function(H,I,G,J,F){if(H.toUpperCase()!="POST"){throw new E("Can't retrieve data with non POST request type.",this)}x.prototype.open.call(this,H,I,G,J,F)};o.prototype.send=function(F){if(F){throw new E("Can't send additional data using this type of request.",this)}x.prototype.send.call(this,this.data)};var u=b$.extend(x,function(J,I,G,F,H){a(arguments,[k]);x.call(this,G,F,H);this.data=J;this.alternativeItem=I});u.prototype.open=function(H,I,G,J,F){if(H.toUpperCase()!="DELETE"){throw new E("Can't delete data with non DELETE request type.",this)}x.prototype.open.call(this,H,I,G,J,F)};u.prototype.send=function(F){if(F){throw new E("Can't send additional data using this type of request.",this)}this.setRequestHeader("Content-Type","application/xml");x.prototype.send.call(this,this.alternativeItem)};u.prototype.generateFullURI=function(F){return x.prototype.generateFullURI.call(this,F+"/"+encodeURIComponent(this.data.getId()))};var e=n.extend(function(H,G,F){a(arguments,[r,j]);n.call(this);this.uri=H;this.filter=null;this.total=0;this.mappings=G;if(F&&F.cache!==undefined){this.cache=F.cache}this.responseObservers=[]});e.prototype.getURI=function(){return this.uri};e.prototype.getMappings=function(){return this.mappings};e.prototype.getTotal=function(){return this.total};e.prototype.retrieve=function(G){a(arguments,[f]);var F=this;G.addResponsePreProcessor(function(){var H=this.responseXML?this.responseXML.documentElement.getAttribute("total"):"";F.total=H?Number(H):NaN});this.responseObservers.forEach(function(H){G.addResponseCallback(function(){H.handleDataSourceResponse(this)})});G.setDataMappings(this.mappings);if(this.filter){G.setParameter("filter",this.filter)}if(this.cache!==undefined){G.setParameter("cache",this.cache);if(!this.cache){G.addParameter("timestamp",new Date().getTime())}}G.open("GET",this.getURI());G.send();return G};e.prototype.addResponseObserver=function(F){a(arguments,[B]);this.responseObservers.push(F)};e.prototype.put=function(F){a(arguments,[v]);F.setDataMappings(this.mappings);F.open("PUT",this.uri);F.send();return F};e.prototype.post=function(F){a(arguments,[o]);F.setDataMappings(this.mappings);F.open("POST",this.uri);F.send();return F};e.prototype.remove=function(F){a(arguments,[u]);F.setDataMappings(this.mappings);F.open("DELETE",this.uri);F.send();return F};e.prototype.setFilter=function(F){this.filter=F!==null?String(F):null;this.notifyObservers("filter")};e.prototype.getFilter=function(){return this.filter};this.RequestError=E;this.RequestParameterError=m;this.ResponseError=p;this.HttpError=z;this.HttpBadRequestError=C;this.ResponseProcessingError=D;this.DataSourceRequest=x;this.DataRetrieveRequest=f;this.DataPutRequest=v;this.DataItemPutRequest=h;this.DataPostRequest=o;this.DataFrameRetrieveRequest=g;this.DataItemDeleteRequest=u;this.DataSource=e});b$.module("portal.com",function(){var v=b$.require("b$.uri.URI");var J=b$.require("b$.mappings.xml.MappingRegistry");var B=b$.require("b$.mvc.Model");var d=b$.require("b$.testArguments");var E=b$.require("b$.types.STRING");var m=b$.require("portal.models.item.PropertyModifiedEvent");var F=b$.require("b$.mvc.CustomEvent");var x=b$.require("portal.datasource.DataSource");var l=b$.require("portal.datasource.DataSourceRequest");var H=b$.require("portal.datasource.DataRetrieveRequest");var e=b$.require("portal.datasource.DataItemPutRequest");var G=b$.require("portal.datasource.DataItemDeleteRequest");var M=b$.require("portal.datasource.DataPostRequest");var p=b$.require("portal.models.item.Item");var a=b$.require("portal.models.item.Container");var u=b$.require("portal.widget.Resources");var c=b$.require("portal.widget.Widget");var w=b$.require("portal.mappings.xml.CustomWidgetHandler");var h=b$.require("portal.mappings.xml.Widget");var g=b$.require("portal.mappings.xml.Container");var k=b$.require("portal.mappings.xml.Page");var K=b$.require("portal.mappings.xml.Portal");var s=b$.require("portal.mappings.xml.Preference");var o=b$.require("portal.mappings.xml.Preferences");var L=b$.require("portal.mappings.xml.Content");var n=b$.require("portal.mappings.xml.Contents");var b=b$.require("portal.mappings.xml.Children");var I=b$.require("portal.mappings.xml.Catalog");var z=b$.require("portal.mappings.xml.CatalogWidget");var y=new J();y.addMapping(new K());y.addMapping(new k());y.addMapping(new g());y.addMapping(new h([new (w.extend(function(){w.call(this,"custom")},{createModelBuilder:function(Q,T,U,S,R){return{build:function(W){var V=new c(R,T,Q,U.toArray(),true,new u());W.acceptBuildResult(V)}}}}))]));y.addMapping(new b());y.addMapping(new s());y.addMapping(new o());y.addMapping(new L());y.addMapping(new n());var q=new J();q.addMapping(new g());q.addMapping(new z());q.addMapping(new b());q.addMapping(new s());q.addMapping(new o());q.addMapping(new L());q.addMapping(new n());q.addMapping(new I());function i(R){var Q=new v(R);return(Q.scheme?Q.scheme+":":"")+(Q.authority?"//"+Q.authority:"")+Q.path+".xml"+(Q.query?"?"+Q.query:"")+(Q.fragment?"#"+Q.fragment:"")}var P=b$.extend(H);P.prototype.generateFullURI=function(){return i(H.prototype.generateFullURI.apply(this,arguments))};var t=b$.extend(H,function(T,R,Q,S){H.call(this,R,Q,S);this.item=T});t.prototype.generateFullURI=function(){var Q=H.prototype.generateFullURI.apply(this,arguments);var R=new v(Q);R.path=R.path+"/"+encodeURIComponent(this.item.getId());return i(R.toString())};var C=b$.extend(e);C.prototype.generateFullURI=function(){return i(e.prototype.generateFullURI.apply(this,arguments))};var r=b$.extend(M);r.prototype.generateFullURI=function(){return i(M.prototype.generateFullURI.apply(this,arguments))};var j=b$.extend(G);j.prototype.generateFullURI=function(){return i(G.prototype.generateFullURI.apply(this,arguments))};var f=x.extend(function(S,T,U,Q){var R=new v("portals/"+encodeURIComponent(U)+"/pages/"+encodeURIComponent(T)).resolve(new v(S)).toString();x.call(this,R,y,Q)});var N=x.extend(function(S,T,Q){var R=new v("portals/"+encodeURIComponent(T)+"/widgets").resolve(new v(S)).toString();x.call(this,R,y,Q)});var O=x.extend(function(R,S){var Q=new v("portals/"+encodeURIComponent(S)+"/containers").resolve(new v(R)).toString();x.call(this,Q,y)});var A=x.extend(function(R,S){var Q;if(S==null){Q=new v("catalog").resolve(new v(R)).toString()}else{Q=new v("portals/"+encodeURIComponent(S)+"/catalog").resolve(new v(R)).toString()}x.call(this,Q,q)});var D=B.extend(function(R,Q){B.call(this);this.container=Q;this.portalName=Q.getPortal().getId();this.portalServerURI=R;this.container.addObserver("NodeInserted",this.handleContentModified,this);this.container.addObserver("PrefModified",this.handleContentModified,this);this.container.addObserver("PropertyModified",this.handleContentModified,this);this.container.addObserver("ContentItemRemoved",this.handleContentModified,this);this.container.addObserver("NodeRemovedComplete",this.handleNodeRemoved,this);this.putTimeout=[]});D.prototype.handleContentModified=function(R){if(R instanceof m&&R.attrName=="title"){return}var S=R.target;var Q=this;if(S.bCreated&&!S.bypassPreferences){if(Q.putTimeout&&!Q.putTimeout[S.getId()]){this.putTimeout[S.getId()]=setTimeout(function(){Q.putItem(S,function(){S.getContentsObject().each(function(T){if(T.isMarkedForDeletion()){S.getContentsObject().__remove(T)}});S.getPreferences().each(function(T){if(T.isMarkedForDeletion()){S.getPreferences().__remove(T)}})});Q.putTimeout[S.getId()]=null},300)}}};D.prototype.handleNodeRemoved=function(Q){var R=Q.target;if(R.getPortal()==null){this.deleteItem(R)}};D.prototype.getDataSourceByItemType=function(R){var Q=null;if(R instanceof c){Q=new N(this.portalServerURI,this.portalName)}else{if(R instanceof a){Q=new O(this.portalServerURI,this.portalName)}else{throw new Error("Unsupported Item type!")}}return Q};D.prototype.putItem=function(T,S){var R=this;var Q=this.getDataSourceByItemType(T);Q.put(new C(T,T.getPortal(),function(){if(typeof S==="function"){S.apply(this,arguments)}R.requestCompleted(this)},function(){console.log("Put failed",T);R.requestCompleted(this)}))};D.prototype.postItem=function(T,U,S){var R=this;var Q=this.getDataSourceByItemType(T);Q.post(new r(T,T.getPortal(),function(){if(this.responseObject){T=this.responseObject}var V=this;jQuery.ajax({url:Q.uri+"/"+encodeURIComponent(T.id)+".html",success:function(W){U.call(V,W);R.requestCompleted(this)},error:function(){U.call(V)},dataType:"xml"})},function(){console.log("Post failed",T);S.apply(this,arguments);R.requestCompleted(this)}))};D.prototype.deleteItem=function(S){var R=this;var Q=this.getDataSourceByItemType(S);Q.remove(new j(S,null,S.getPortal(),function(){R.requestCompleted(this)},function(){console.log("Delete failed",S);R.requestCompleted(this)}))};D.prototype.requestCompleted=function(R){var Q=new F();Q.initCustomEvent("requestCompleted",false,true,R);this.notifyObservers(Q,false)};this.PortalClientDataRetrieveRequest=P;this.PortalClientDataItemRetrieveRequest=t;this.PortalsDataSource=f;this.ContainersDataSource=O;this.WidgetsDataSource=N;this.SynchronizationManager=D;this.PortalCatalogDataSource=A});
/*
 *
 * Copyright 2010 Backbase - All rights reserved.
 *
 */
b$.module("portal.views.item",function(){var a=b$.require("b$.testArguments");var e=b$.require("b$.ArgumentException");var o=b$.require("b$.Exception");var v=b$.require("b$.Class");var m=b$.require("b$.ArrayIterator");var h=b$.require("b$.TypeConstraintOptional");var p=b$.require("b$.types.STRING");var k=b$.require("b$.types.FUNCTION");var r=b$.require("b$.mvc.IViewFactory");var u=b$.require("b$.mvc.IViewClassProvider");var s=b$.require("b$.mvc.View");var n=b$.require("b$.mvc.ViewRegistry");var i=b$.require("portal.widget.IUserPreferencesFormFactory");var A=b$.require("portal.Point");var d=b$.require("portal.Rectangle");var t=b$.require("portal.Layout");var f=b$.require("portal.models.item.Item");var q=b$.require("portal.models.item.Container");var c=b$.require("portal.Area");var x=b$.require("portal.widget.DefaultUserPreferencesFormFactory");var B=new h(u);var g=s.extend();g.prototype.contains=function(C,D){if(this.html&&this.getBox(D)){return this.getBox(D).contains(C)}else{return false}};g.prototype.getBox=function(E){var F=this.getElementByHint(E);if(!F){return null}var D=jQuery(F);var C=D.offset();return new d(new A(C.left,C.top),new A(C.left+D.width(),C.top+D.height()))};g.prototype.getElementByHint=function(C){return null};var j=g.extend();j.prototype.renderHTML=function(D,C){if(D.hasClass("portal-item")){this.registerObservers();this.html=D.get(0)}else{this.html=this.getHTML(C);D.replaceWith(this.html)}};j.prototype.createHTML=function(C){return jQuery(this.createItemHTML(C)).addClass("portal-item").get()[0]};j.prototype.createItemHTML=function(C){return C.createElement("div")};var l=j.extend(function(D,C){j.call(this,D,C);this.layout=C.createView(C.createLayout(D));this.layout.getModel().attach()});l.prototype.createItemHTML=function(C){return this.layout.getHTML(C)};l.prototype.renderHTML=function(D,C){if(D.attr("id")==this.model.id){this.layout.renderHTML(D,C);this.registerObservers();this.html=D.get(0)}else{this.html=this.getHTML(C);D.replaceWith(this.html)}};l.prototype.createHTML=function(C){var D=j.prototype.createHTML.call(this,C);jQuery(D).addClass("portal-container");return D};l.prototype.release=function(){this.layout.release();j.prototype.release.call(this)};l.prototype.getItemViews=function(){var C=[];this.layout.getAreaViews().forEach(function(D){D.getHolders().getViews().forEach(function(E){C.push(E)},this)},this);return new m(C)};l.prototype.getLayoutView=function(){return this.layout};var b=j.extend(function(D,C){j.call(this,D,C)});b.prototype.createItemHTML=function(C){return jQuery("<div>Widget here</div>",C).get()[0]};var w=v.extend(function(C){a(arguments,[l]);v.call(this);this.container=C});w.prototype.findDeepest=function(D){var C=null;this.visitBottomUp(function(E){if(!C&&D(E)){C=E}});return C};w.prototype.visitBottomUp=function(C){this.container.getItemViews().forEach(function(D){if(D.getItemView() instanceof l){new w(D.getItemView()).visitBottomUp(C)}C(D)})};w.prototype.visitTopDown=function(C){this.container.getItemViews().forEach(function(D){C(D);if(D.getItemView() instanceof l){new w(D.getItemView()).visitTopDown(C)}})};var z=o.extend();var y=v.extend(function(C){a(arguments,[B]);v.call(this);this.viewClasses={};this.layouts={};this.parents=C?[C]:[];this.userPreferencesFormFactory=new x()});y.prototype.addParent=function(C){a(arguments,[u]);this.parents.unshift(C)};y.prototype.getParents=function(){return this.parents};y.prototype.setUserPreferencesFormFactory=function(C){a(arguments,[i]);this.userPreferencesFormFactory=C};y.prototype.registerView=function(C,D){a(arguments,[p,k]);if(this.viewClasses[C]){throw new z("Template with name '"+C+"' already has associated view class.")}this.viewClasses[C]=D};y.prototype.registerLayout=function(C,D){a(arguments,[p,k]);if(D!=t&&!(D.prototype instanceof t)){throw new e("Registered class should be subclass of Layout.",arguments,1,k)}this.layouts[C]=D};y.prototype.getViewClass=function(D){var C=null;if(D instanceof f){C=this.viewClasses[D.getPreference("TemplateName")||D.getPreference("client-template")]||this.viewClasses[D.getPreference("client-template")]||null}if(!C){this.parents.forEach(function(E){if(!C){C=E.getViewClass(D)}},this)}return C};y.prototype.createView=function(D){var C=this.getViewClass(D);if(C){return new C(D,this)}else{console.dir(this);console.trace();throw new o("Can't find view for the model - "+D+".")}};y.prototype.createLayout=function(D){a(arguments,[f]);var C=this.layouts[D.getPreference("TemplateName")||D.getPreference("client-template")];if(!C){C=this.layouts[D.getPreference("client-template")]}if(C){return new C(D,this.userPreferencesFormFactory)}else{throw new z("Can not find layout for the model - "+D+".The value of the TemplateName property - "+D.getPreference("TemplateName")+". The value of the client-template property - "+D.getPreference("client-template"))}};u.implementedBy(y);r.implementedBy(y);this.BoxShapedView=g;this.Item=j;this.Container=l;this.Widget=b;this.ItemViewsTreeVisitor=w;this.ItemViewRegistryException=z;this.ItemViewRegistry=y});b$.module("portal.views.widget",function(){var h=b$.require("b$.testArguments");var l=b$.require("b$.ArgumentException");var a=b$.require("b$.mvc.View");var g=b$.require("b$.mvc.IViewClassProvider");var d=b$.require("b$.mvc.SimpleViewFactory");var i=b$.require("b$.mvc.ViewCache");var m=b$.require("portal.widget.Widget");var j=b$.require("portal.widget.IPerspectiveProvider");var f=b$.require("portal.widget.UserPreferenceField");var k=b$.require("portal.widget.UserPreferencesForm");var e=b$.require("portal.views.item.Item");var c=a.extend(function(q,p){h(arguments,[m]);a.call(this,q,p)});c.prototype.renderHTML=function(q,p){if(q.hasClass("portal-widgetHolder-title")){this.registerObservers()}else{q.replaceWith(this.getHTML(p))}};c.prototype.createHTML=function(p){var q=jQuery('<div class="portal-widget-title"></div>',p);q.text(this.model.getTitle());return q.get()[0]};var o=e.extend(function(r,p,q){h(arguments,[m,j]);e.call(this,r,q);this.perspectiveProvider=p;this.title=this.createTitleView()});o.prototype.registerObservers=function(){e.prototype.registerObservers.call(this);this.perspectiveProvider.addObserver("*",this.update,this)};o.prototype.unregisterObservers=function(){e.prototype.unregisterObservers.call(this);this.perspectiveProvider.removeObserver("*",this.update,this)};o.prototype.createTitleView=function(){return new c(this.model)};o.prototype.getTitleView=function(){return this.title};o.prototype.renderHTML=function(r,q){var p;if(r.attr("id")==this.model.item.id){p=r}else{p=r.find("#"+this.model.item.id)}if(p.length==0){console.log("not SSR!");r.append(this.getHTML(q))}};o.prototype.createItemHTML=function(p){return jQuery('<div class="portal-widget"></div>',p).get()[0]};o.prototype.getPerspectiveProvider=function(){return this.perspectiveProvider};var n=a.extend(function(q,p){h(arguments,[f]);a.call(this,q,p);this.id=n.generateUniqueFieldID()});n.prototype.createHTML=function(p){var q=jQuery('<div class="portal-userPreferenceField"><label class="portal-userPreferenceField-label" for="'+this.id+'"></label></div>',p);q.append(this.createFieldHTML(p));q.find(".portal-userPreferenceField-label").text(this.model.getPreference().getLabel()+": ");q.addClass(this.model.isValid()?"portal-userPreferenceField-valid":"portal-userPreferenceField-invalid");return q.get()[0]};n.prototype.createFieldHTML=function(p){var q=this.model,r=q.getPreference(),s=r.getName(),t=r.getDataType().serializeToString(q.getValue());return this.createUserInputElement(p).addClass("portal-userPreferenceField-field").attr("id",this.id).attr("name",s).val(t).bind("change keyup",function(){try{var u=q.getPreference().getDataType().parseFromString(this.value)}catch(v){if(!(v instanceof l)){throw v}var u=this.value}q.setValue(u)})};n.prototype.createUserInputElement=function(p){return jQuery('<input type="text" />',p)};n.prototype.update=function(p,r){if(r==this.model&&p=="valid"){jQuery(this.html).removeClass("portal-userPreferenceField-valid portal-userPreferenceField-invalid").addClass(this.model.isValid()?"portal-userPreferenceField-valid":"portal-userPreferenceField-invalid")}else{if(r==this.model&&p=="value"){var q=jQuery(this.html).find(".portal-userPreferenceField-field");if(q.val()!=r.getValue()){q.val(r.getValue())}}else{if(r==this.model){a.prototype.update.call(this,p,r)}}}};n.generateUniqueFieldID=function(){return"__bb-portal-5-preferences-form-field-"+this.fieldID++};n.fieldID=0;var b=a.extend(function(q,p){h(arguments,[k]);a.call(this,q,p);this.fields=new i(p)});b.prototype.createHTML=function(q){var t=this.model;var r=jQuery('<form class="portal-userPreferencesForm portal-userPreferencesForm-'+(t.isActive()?"active":"inactive")+(!t.isSubmitRequired()?" portal-userPreferencesForm-noSubmit":"")+'"><div class="portal-userPreferencesForm-buttonsPannel"><button class="portal-userPreferencesForm-okButton" onclick="return false;">ok</button><button class="portal-userPreferencesForm-cancelButton" onclick="return false;">cancel</button></div><div class="portal-userPreferencesForm-end"></div></form>',q);this.fields.updateViews(t.getFields().getIterator());this.fields.render(r.get()[0],null,r.find(".portal-userPreferencesForm-buttonsPannel").get()[0]);var p=r.find(".portal-userPreferencesForm-okButton"),s=r.find(".portal-userPreferencesForm-cancelButton");p.click(function(){t.apply();t.deactivate()});s.click(function(){t.reset();t.deactivate()});if(!t.hasChanges()){p.get()[0].disabled=true}return r.get()[0]};b.prototype.registerObservers=function(){var p=this;this.model.addObserver("active",this.toggleVisibility,this);this.model.getFields().each(function(q){q.addObserver("value",p.valueChanged,p)});a.prototype.registerObservers.call(this)};b.prototype.unregisterObservers=function(){var p=this;this.model.removeObserver("active",this.toggleVisibility);this.model.getFields().each(function(q){q.removeObserver("value",p.valueChanged)});a.prototype.unregisterObservers.call(this)};b.prototype.valueChanged=function(p){var q=jQuery(this.html);if(p.target instanceof f){q.find(".portal-userPreferencesForm-okButton").get()[0].disabled=!(this.model.hasChanges()&&this.model.isValid())}};b.prototype.toggleVisibility=function(p){var q=jQuery(this.html);q.removeClass("portal-userPreferencesForm-active portal-userPreferencesForm-inactive").addClass("portal-userPreferencesForm-"+(this.model.isActive()?"active":"inactive"));q.find(".portal-userPreferencesForm-okButton").get()[0].disabled=!(this.model.hasChanges()&&this.model.isValid())};this.WidgetTitle=c;this.Widget=o;this.UserPreferenceField=n;this.UserPreferencesForm=b});b$.module("portal.views.holder",function(){var d=b$.require("b$.testArguments");var f=b$.require("b$.ArgumentException");var i=b$.require("portal.widget.Widget");var k=b$.require("portal.views.item.BoxShapedView");var c=b$.require("b$.mvc.IViewClassProvider");var j=b$.require("portal.models.holder.WidgetHolder");var l=b$.require("portal.models.holder.ItemHolder");var g=b$.require("portal.models.item.SecurityProfile");var a=b$.require("portal.views.widget.UserPreferencesForm");var e=k.extend(function(n,m){d(arguments,[l,c]);k.call(this,n,m);this.itemView=this.createItemView(m)});e.prototype.createItemView=function(n){var m=n.getViewClass(this.model.getItem());return new m(this.model.getItem(),n)};e.prototype.renderHTML=function(o,n){if(this.model.item.html){o.replaceWith(this.model.item.html);o=jQuery(this.model.item.html)}var m;if(o.attr("id")==this.model.item.id){m=o}else{m=o.find("#"+this.model.item.id)}if(m.length){this.bindControls(o,n);this.itemView.renderHTML(m,n);this.registerObservers();this.html=o.get(0)}else{this.html=this.getHTML(n);o.replaceWith(this.html)}this.draggrippy=o.find("> .itemHolder-draggrippy");this.deleteButton=o.find("> .itemHolder-deleteButton")};e.prototype.createHTML=function(n,m){var o=jQuery('<div class="portal-manager-itemHolder"></div>',n);o.append("<div class='portal-manager-itemHolder-dropTop' style='height:5px; position:relative; top: 5px;'></div>");this.addControls(o,n);o.append(this.itemView.getHTML(n));return o.get()[0]};e.prototype.addControls=function(n,m){this.draggrippy=jQuery('<div class="itemHolder-draggrippy"></div>',m);n.append(this.draggrippy);this.deleteButton=jQuery('<div class="itemHolder-deleteButton"></div>',m);n.append(this.deleteButton);this.bindControls(n,m)};e.prototype.bindControls=function(o,m){var n=this;o.unbind("mouseover").bind("mouseover",function(){n.showControls(m)});o.unbind("mouseout").bind("mouseout",function(){n.hideControls(m)});o.find(".itemHolder-deleteButton").unbind("click").bind("click",function(){n.deleteButtonClicked()})};e.prototype.getItemView=function(){return this.itemView};e.prototype.getElementByHint=function(m){if(m=="droparea"){return this.html}else{if(m=="draghandle"&&this.isItemDraggable()){return this.draggrippy.get()[0]}else{if(m=="droparea-top"){return jQuery(".portal-manager-itemHolder-dropTop",this.html).get()[0]}else{return null}}}};e.prototype.showControls=function(){this.draggrippy&&this.draggrippy.addClass("itemHolder-controlsVisible");this.deleteButton.addClass("itemHolder-controlsVisible")};e.prototype.hideControls=function(){this.draggrippy&&this.draggrippy.removeClass("itemHolder-controlsVisible");this.deleteButton.removeClass("itemHolder-controlsVisible")};e.prototype.deleteButtonClicked=function(){var m=this.model.getItem();m.portal=null;m.getParent().removeChild(m)};e.prototype.isItemDraggable=function(){return((this.getModel().getItem().getPortal().getDragEnabled&&this.getModel().getItem().getPortal().getDragEnabled())||this.getModel().getItem().getSecurityProfile()!=g.CONSUMER)};var b=k.extend();b.prototype.createHTML=function(n){var o=this.getModel().getItem() instanceof i?"Drop widget here":"Drop layout here";var m=jQuery("<div class='portal-samplePlaceholder-text'></div>").text(o);var p=jQuery("<div class='portal-samplePlaceholder'></div>").html(m);return p.get()[0]};b.prototype.getElementByHint=function(m){if(m=="droparea"){return this.html.parentNode}else{return null}};var h=e.extend(function(n,m){d(arguments,[j,c]);e.call(this,n,m);this.form=new a(n.getPreferencesForm(),m)});h.prototype.createItemView=function(m){var n=m.getViewClass(this.model.getItem());return new n(this.model.getItem(),this.model,m)};h.prototype.renderHTML=function(v,s){if(this.model.item.html){v.replaceWith(this.model.item.html);v=jQuery(this.model.item.html)}var n;if(v.attr("id")!=this.model.item.id){n=v.find("#"+this.model.item.id)}else{n=v}var u=n.find("> .portal-widgetHolder-head");var t=n.find("> .portal-widgetHolder-body");var m=u.find("> .portal-widgetHolder-title");var q=u.find("> .portal-widgetHolder-preferencesButton");var o=u.children().not(".portal-widgetHolder-title, .portal-widgetHolder-preferencesButton");var p=this.model;var r=this.itemView;if(n.length){this.bindControls.call(this,v,s);r.getTitleView().renderHTML(m,s);q.unbind("click").click(jQuery.proxy(this.bindPrefButton,this));o.replaceWith(this.form.getHTML(s));t.children().each(function(w,x){r.renderHTML(x,s)});this.registerObservers();this.html=v.get(0)}else{this.html=this.getHTML(s);v.replaceWith(this.html)}this.draggrippy=v.find("> .itemHolder-draggrippy");this.deleteButton=v.find("> .itemHolder-deleteButton")};h.prototype.createHTML=function(m){var p=this.model,n=this.itemView;var o=jQuery('<div class="portal-widgetHolder"><div class="portal-widgetHolder-head"><div class="portal-widgetHolder-title"></div><div class="portal-widgetHolder-preferencesButton'+(p.getPreferencesForm().getFields().getLength()?"":" portal-widgetHolder-preferencesButton-hidden")+'">preferences</div></div><div class="portal-widgetHolder-body"></div></div>',m);this.addControls(o,m);o.find(".portal-widgetHolder-title").append(n.getTitleView().getHTML(m));o.find(".portal-widgetHolder-preferencesButton").click(jQuery.proxy(this.bindPrefButton,this));o.find(".portal-widgetHolder-head").append(this.form.getHTML(m));o.find(".portal-widgetHolder-body").each(function(){this.appendChild(n.getHTML(m))});return o.get()[0]};h.prototype.bindPrefButton=function(){var m=this.model.getPreferencesForm();if(!m.isActive()){m.activate()}else{if(!m.isSubmitRequired()){m.reset();m.deactivate()}}};h.prototype.update=function(m,n){if(n==this.model){k.prototype.update.call(this,m,n)}};h.prototype.getElementByHint=function(m){if(m=="draghandle"&&this.isItemDraggable()){return jQuery(".portal-widgetHolder-title",this.html).get()[0]}else{if(m=="droparea"){return this.html}else{return null}}};h.prototype.addControls=function(n,m){this.deleteButton=jQuery('<div class="itemHolder-deleteButton"></div>',m);n.append(this.deleteButton);this.bindControls(n,m)};this.WidgetHolder=h;this.ItemHolder=e;this.PlaceHolder=b});b$.module("portal.views",function(){var f=b$.require("b$.testArguments");var b=b$.require("b$.Class");var a=b$.require("b$.mvc.View");var g=b$.require("b$.mvc.ViewCache");var e=b$.require("portal.Area");var d=b$.require("portal.views.holder.PlaceHolder");var i=b$.require("portal.views.item.Container");var c=b$.require("portal.CatalogArea");var l=b$.require("portal.views.item.BoxShapedView");var k=l.extend(function(o,n){f(arguments,[e]);l.call(this,o,n);this.holders=new g(n);this.placeholder=new g(n)});k.prototype.renderHTML=function(o,n){if(o.hasClass("portal-area")&&(o.children()[0]&&o.children().attr("id")||o.hasClass("ssr"))){this.renderWidgetContainerHTML(o,n);this.registerObservers();var p=this;if(this.timeout){clearTimeout(this.timeout);this.timeout=null}this.timeout=setTimeout(function(){p.setMinHeight();p.timeout=null},100);this.html=o.get(0)}else{this.html=this.getHTML(n);o.replaceWith(this.html)}};k.prototype.createHTML=function(q){var s=q.createElement("div");s.className="portal-area";var p=q.createElement("div");p.className="portal-area-overlay";var n=q.createElement("div");n.className="portal-area-overlay-name";jQuery(n).text("Name: "+this.model.getName());p.appendChild(n);s.appendChild(p);var o=this.createWidgetContainerHTML(q);s.appendChild(o);var r=this;if(this.timeout){clearTimeout(this.timeout);this.timeout=null}this.timeout=setTimeout(function(){r.setMinHeight();r.timeout=null},100);return s};k.prototype.renderWidgetContainerHTML=function(r,n,o){r.find(".portal-layout-area-item-wrapper:empty").remove();this.holders.updateViews(this.model.getHolders());var q=this.holders.getViews().array;var p=jQuery(r.children().get(0)).hasClass("portal-layout-area-item-wrapper")?jQuery(r.children().get(1)).attr("id"):jQuery(r.children().get(0)).attr("id");if(r.hasClass("portal-area")&&(r.hasClass("ssr")&&r.children().get(0)||p)){q.forEach(function(s,u){var t;var v=s.getModel().getItem().getId();if(r.attr("id")==v){t=r}else{t=r.find("#"+v)}if(!t.length){t=r.children().eq(u)}s.renderHTML(t,n)},this);this.purgeObservers();this.registerObservers();this.html=r.get(0)}else{this.html=this[o?"createHTML":"getHTML"](n);r.replaceWith(this.html)}};k.prototype.createWidgetContainerHTML=function(n){var o=n.createElement("div");o.className="portal-area-container";this.holders.updateViews(this.model.getHolders());var p=this.holders.getViews();while(p.hasNext()){var q=this.createItemWrapper(n);q.appendChild(p.next().getHTML(n));o.appendChild(q)}return o};k.prototype.createItemWrapper=function(n){var o=jQuery('<div class="portal-layout-area-item-wrapper"></div>',n);return o.get(0)};k.prototype.release=function(){a.prototype.release.call(this);this.holders.clear()};k.prototype.registerObservers=function(){this.getModel().addObserver("NodeInserted",function(){this.update("items",this.model)},this);this.getModel().addObserver("NodeRemovedComplete",function(){this.update("items",this.model)},this);this.getModel().addObserver("PlaceholderInserted",function(){this.update("placeholder",this.model)},this);this.getModel().addObserver("PlaceholderRemoved",function(){this.update("placeholder",this.model)},this)};k.prototype.purgeObservers=function(){this.getModel().removeAllObservers()};k.prototype.getHolders=function(){return this.holders};k.prototype.renderPlaceholder=function(){var q=this.model.getPlaceholder();this.placeholder.updateView(q);if(q){var p=q.getBeforeItem();var n=this.placeholder.getView().getHTML(document);var r=this.createItemWrapper(document);r.appendChild(n);if(p){this.holders.getViews().forEach(function(s){if(s.getModel().getItem()==p){var t=jQuery(s.getHTML(document));if(t.parent(".portal-layout-area-item-wrapper").length){t.parent().before(r)}else{t.before(r)}}},this)}else{var o=jQuery(this.getHTML(document));if(o.find(" > .portal-area-container").length){o.find(" > .portal-area-container").append(r)}else{o.append(r)}}}};k.prototype.update=function(o,n){if(o=="placeholder"&&n==this.model){this.renderPlaceholder();jQuery(".portal-layout-area-item-wrapper",this.html).each(function(p,q){if(jQuery(q).children().length==0){jQuery(q).remove()}})}else{this.renderWidgetContainerHTML(jQuery(this.html),document,true)}};k.prototype.getHolderViewUnderPoint=function(o,p){var q=this.holders.getViews();while(q.hasNext()){var n=q.next();if(n.contains(o,p)){return n}}return null};k.prototype.getPlaceholderView=function(){return this.placeholder.getView()};k.prototype.getElementByHint=function(n){if(n=="droparea"){return this.html}else{return null}};k.prototype.setMinHeight=function(){};var j=k.extend(function(o,n){f(arguments,[c]);k.call(this,o,n);this.catalog=new g(n)});j.prototype.createWidgetContainerHTML=function(n){this.holders.updateViews(this.model.getHolders());this.catalog.updateView(this.model.getCatalog());return this.catalog.getView().getHTML(n)};j.prototype.createHTML=function(n){var o=k.prototype.createHTML.call(this,n);jQuery(o).addClass("portal-catalog-area");return o};j.prototype.registerObservers=function(){this.getModel().addObserver("NodeInserted",function(){this.update("items",this.model)},this);this.getModel().addObserver("NodeRemovedComplete",function(){jQuery(this.html).find(".pm-composer-strip").empty()},this)};j.prototype.getHolders=function(){return this.catalog.getView().getThumbnails()};var h=a.extend(function(o,n){a.call(this,o,n);this.factory=n;this.areas=new g(n)});h.prototype.createHTML=function(n){var o=jQuery("<div></div>",n);this.getModel().distribute();this.updateAreaViews();this.getAreaViews().forEach(function(p){o.append(p.getHTML(n))},this);return o.get()[0]};h.prototype.release=function(){a.prototype.release.call(this);this.model.detach()};h.prototype.updateAreaViews=function(){this.areas.updateViews(this.getModel().getAreas())};h.prototype.getAreaViews=function(){return this.areas.getViews()};h.prototype.getAreaViewUnderPoint=function(n,o){var p=this.getAreaViews();while(p.hasNext()){var q=p.next();if(q.contains(n,o)){return q}}return null};var m=b.extend(function(n){f(arguments,[h]);b.call(this);this.layoutView=n});m.prototype.visitBottomUp=function(n){this.layoutView.getAreaViews().forEach(function(o){o.getHolders().getViews().forEach(function(p){if(p.getItemView() instanceof i){new m(p.getItemView().getLayoutView()).visitBottomUp(n)}n(p)})})};m.prototype.visitTopDown=function(n){this.layoutView.getAreaViews().forEach(function(o){o.getHolders().getViews().forEach(function(p){n(p);if(p.getItemView() instanceof i){new m(p.getItemView().getLayoutView()).visitTopDown(n)}})})};m.prototype.findDeepest=function(n){var o=null;this.visitBottomUp(function(p){if(!o&&n(p)){o=p}});return o};m.prototype.findTopmost=function(n){var o=null;this.visitTopDown(function(p){if(!o&&n(p)){o=p}});return o};this.Placeholder=d;this.Area=k;this.CatalogArea=j;this.Layout=h;this.ItemLayoutsTreeVisitor=m});b$.module("portal.views.page",function(){var u=b$.require("b$.Class");var d=b$.require("b$.Interface");var a=b$.require("b$.testArguments");var h=b$.require("b$.types.FUNCTION");var b=b$.require("b$.ArgumentException");var i=b$.require("b$.uri.URI");var r=b$.require("b$.mvc.IViewFactory");var t=b$.require("b$.mvc.View");var s=b$.require("b$.mvc.ViewCache");var n=b$.require("portal.escapeXml");var c=b$.require("portal.widget.Resource");var q=b$.require("portal.widget.ScriptResource");var m=b$.require("portal.widget.StylesheetResource");var l=b$.require("portal.page.Page");var j=b$.require("portal.views.item.Container");var y=new d({call:h});var o=u.extend(function(z){a(arguments,[Array]);u.call(this);this.callables=[];z.forEach(function(A){this.add(A)},this)});o.prototype.add=function(z){a(arguments,[y]);this.callables.push(z)};o.prototype.call=function(z){this.callables.forEach(function(A){A.call(z)})};var g=t.extend(function(A,z){a(arguments,[c]);t.call(this,A,z);this.attachmentHandlers=new o([])});g.prototype.findExistingElement=function(z){return null};g.prototype.getHTML=function(z){var B=this.model;if(!this.html){var A=this.findExistingElement(z);if(A){this.html=A}else{A=t.prototype.getHTML.call(this,z)}this.whenReady(function(){B.becomeReady()});return A}else{return t.prototype.getHTML.call(this,z)}};g.prototype.whenReady=function(z){if(this.model.isReady()){z()}else{this.attachmentHandlers.add(z)}};g.prototype.attachSelfTo=function(A){var z=this.getHTML(A.ownerDocument);if(A!=jQuery(z).parent("head").get()[0]){A.appendChild(z)}this.attachmentHandlers.call(this)};g.prototype.update=function(z,A){};var k=g.extend(function(A,z){a(arguments,[q]);g.call(this,A,z);this.id=++k.id});k.prototype.createHTML=function(z){var A=z.createElement("script");A.id="__bb_portal_5_"+this.model.getType()+"_resource_"+this.id;A.type=this.model.getContentType();if(this.model.getType()=="external"){A.src=this.model.getURI()}else{A.text=this.getScriptSource()}return A};k.prototype.getScriptSource=function(){return this.model.getContentSource()};k.id=0;var f=k.extend(function(A,z){a(arguments,[q]);if(!/(application|text)\/javascript/.test(A.getContentType())){throw new b("Can accept only resources with JS mime type.",arguments,0,q)}k.call(this,A,z);this.executionListeners=new o([])});f.SCRIPT_EXECUTED_HANDLER=function(){this.ready=true;this.executionListeners.call(this)};f.IE_SCRIPT_READY_STATE_HANDLER=function(){var z=this;(this.states||(this.states=[])).push(this.readyState);if((this.states.length==2&&(this.states.indexOf("loading")!=-1)&&(this.states.indexOf("loaded")!=-1))||this.readyState=="complete"){setTimeout(function(){f.SCRIPT_EXECUTED_HANDLER.call(z)},0)}};f.prototype.findExistingElement=function(B){var A=null,z=i.resolve(this.model.getURI(),B.location.href);this.model.getType()=="external"&&jQuery("script[type="+this.model.getContentType().replace("/","\\/")+"]").each(function(C,E){var D=i.resolve(E.getAttribute("src"),B.location.href);if(D==z){A=E}});if(A){A.ready=!/__bb_portal_5_(inline|external)_resource_\d+/.test(A.id)||A.ready;if(!A.ready){A.executionListeners.add(this.executionListeners)}}return A};f.prototype.createHTML=function(z){var A=k.prototype.createHTML.call(this,z);A.executionListeners=new o([this.executionListeners]);A.onerror=A.onload=f.SCRIPT_EXECUTED_HANDLER;if(this.model.getType()=="external"&&jQuery.browser.msie){A.onreadystatechange=f.IE_SCRIPT_READY_STATE_HANDLER}return A};f.prototype.getScriptSource=function(){return("try {\n"+this.model.getContentSource()+";\n} catch (oError) {(function() {var oScript = document.getElementById('__bb_portal_5_inline_resource_"+this.id+"');oScript.executionListeners.call(oScript);})();throw oError;}(function() {var oScript = document.getElementById('__bb_portal_5_inline_resource_"+this.id+"');oScript.executionListeners.call(oScript);})();")};f.prototype.whenReady=function(z){if(this.model.isReady()||(this.html&&this.html.ready)){z()}else{this.executionListeners.add(z)}};var e=k.extend(function(A,z){a(arguments,[q]);if(!/(application|text)\/(x-)?backbase\+xml/.test(A.getContentType())||A.getType()!="inline"){throw new b("Can accept only inline resources with Backbase mime type.",arguments,0,q)}k.call(this,A,z)});e.prototype.whenReady=function(B){var A=this.model,z=this.html.ownerDocument;k.prototype.whenReady.call(this,function(){var C=new DOMParser().parseFromString(A.getContentSource(),"application/xml");var D=(z.defaultView||z.parentWindow).bb;if(D&&C&&C.documentElement){if(D.document){D.construct(C,B)}else{var E=setInterval(function(){if(D.document){clearInterval(E);D.construct(C,B)}},100)}}else{B()}})};var v=g.extend(function(A,z){a(arguments,[m]);g.call(this,A,z)});v.prototype.findExistingElement=function(A){var B=null,z=i.resolve(this.model.getURI(),A.location.href);this.model.getType()=="external"&&jQuery("link[type="+this.model.getContentType().replace("/","\\/")+"]").each(function(D,E){var C=i.resolve(E.getAttribute("href"),A.location.href);if(C==z){B=E}});return B};v.prototype.createHTML=function(A){var B=null,C=this.model;if(C.getType()=="external"){B=A.createElement("link");B.type=C.getContentType();B.rel="stylesheet";B.href=C.getURI()}else{if(jQuery.browser.msie){var z=A.createElement("div");z.innerHTML="&nbsp;<style type='"+n(C.getContentType())+"'>"+n(C.getContentSource())+"</style>";B=z.removeChild(z.childNodes[1])}else{B=A.createElement("style");B.setAttribute("type",C.getContentType());B.appendChild(A.createTextNode(C.getContentSource()))}}return B};var x=u.extend();x.prototype.createView=function(z){a(arguments,[c]);if(z instanceof q){if(/(application|text)\/javascript/.test(z.getContentType())){return new f(z)}else{if(/(application|text)\/(x-)?backbase\+xml/.test(z.getContentType())){return new e(z)}else{return new k(z)}}}else{if(z instanceof m){return new v(z)}else{throw new b("Unrecognized type of resource.",0,arguments,c)}}};var p=t.extend(function(A,z){a(arguments,[l]);t.call(this,A,z);this.factory=new x();this.resourceViews=[]});p.prototype.getResourceViews=function(){var C=this.model.getUniqueResources(),B=this.resourceViews,z=[],A=this.factory;C.each(function(E){var D=null;B.forEach(function(F){if(F.getModel()==E){D=F}});z.push(D||A.createView(E))});return(this.resourceViews=z)};p.prototype.createHTML=function(B){var D=jQuery("head",B).get()[0],C=this.getResourceViews(),A=this.factory,z=null;C.forEach(function(E,F){var G=E instanceof f||E instanceof e;if(G&&z&&!z.getModel().isReady()){z.getModel().addObserver("ready",function(H){H.target.removeObserver("ready",arguments.callee);E.attachSelfTo(D)})}else{E.attachSelfTo(D)}if(G){z=E}},this);return D};p.prototype.update=function(){if(!this.html){throw new Error("Unexpected call to PageResourcesView::update(), no HTML exists.")}var z=this.html;this.html=this.createHTML(z.ownerDocument)};var w=j.extend(function(A,z){a(arguments,[l]);j.call(this,A,z);this.resources=new p(A,z)});w.prototype.renderHTML=function(A,z){if(A.attr("id")!=this.model.id){A.append(this.getHTML(z))}else{this.resources.getHTML(z);j.prototype.renderHTML.call(this,A,z);this.registerObservers()}};w.prototype.createHTML=function(z){this.resources.getHTML(z);return j.prototype.createHTML.call(this,z)};w.prototype.release=function(){j.prototype.release.call(this);this.layout.clear()};w.prototype.getElementByHint=function(z){if(z=="droparea"){return this.html}else{return null}};this.ResourceView=g;this.ScriptResource=k;this.BBScriptResource=e;this.JSScriptResource=f;this.StylesheetResource=v;this.PageResources=p;this.Page=w;this.ResourceViewFactory=x;this.CompositeCollable=o});b$.module("portal",function(){var g=b$.require("b$.testArguments");var v=b$.require("b$.Exception");var A=b$.require("b$.mvc.Model");var a=b$.require("b$.Class");var l=b$.require("b$.mvc.ViewRegistry");var m=b$.require("portal.views.item.ItemViewsTreeVisitor");var h=b$.require("portal.widget.UserPreferenceField");var w=b$.require("portal.models.item.Preferences");var f=b$.require("portal.models.holder.ItemHolder");var G=b$.require("portal.models.holder.WidgetHolder");var c=b$.require("portal.models.holder.PlaceHolder");var r=b$.require("portal.Area");var d=b$.require("portal.Layout");var p=b$.require("portal.models.item.Item");var b=b$.require("portal.models.item.Container");var e=b$.require("portal.widget.Widget");var F=b$.require("portal.page.Page");var t=b$.require("portal.views.widget.UserPreferenceField");var o=b$.require("portal.views.holder.ItemHolder");var B=b$.require("portal.views.holder.WidgetHolder");var I=b$.require("portal.views.holder.PlaceHolder");var E=b$.require("portal.views.Area");var q=b$.require("portal.views.Layout");var k=b$.require("portal.views.item.Item");var u=b$.require("portal.views.item.Container");var j=b$.require("portal.views.widget.Widget");var H=b$.require("portal.views.page.Page");var K=b$.require("portal.com.PortalClientDataRetrieveRequest");var s=b$.require("portal.com.PortalClientDataItemRetrieveRequest");var C=b$.require("portal.com.SynchronizationManager");var i=b$.require("portal.com.PortalsDataSource");var J=b$.require("portal.com.WidgetsDataSource");var n=b$.require("portal.models.item.PropertyModifiedEvent");var y=b$.require("portal.mappings.xml.CustomWidgetHandler");var z=l.extend(function(M){var L=new l(M);L.registerView(h,t);L.registerView(f,o);L.registerView(c,I);L.registerView(G,B);L.registerView(r,E);L.registerView(d,q);L.registerView(p,k);L.registerView(b,u);L.registerView(e,j);L.registerView(F,H);l.call(this,L)});var x=a.extend(function(M,N){g(arguments,[y,Array]);for(var O=0;O<N.length-1;O+=2){var L=N[O];var P=N[O+1];if(!(L==e||L.prototype instanceof e)){throw new v("Invalid custom widget class (model)"+L)}if(!(P==j||P.prototype instanceof j)){throw new v("Invalid custom widget class (view)"+P)}}a.call(this);this.customWidgetHandler=M;this.customConstructors=N});x.prototype.getCustomWidgetHandler=function(){return this.customWidgetHandler};x.prototype.getCustomConstructors=function(){return this.customConstructors};var D=A.extend(function(N,M,P,L,O){A.call(this);this.document=N;this.pageName=P;this.portal=L;this.portalServerURI=O||this.config.serverRoot;this.viewRegistry=M;this.customWidgetsViewRegistry=new l();this.viewRegistry.addParent(this.customWidgetsViewRegistry);this.pageView=null;this.synchronizationManager=null;this.dragManager=null;this.portalsDataSource=new i(this.portalServerURI,this.pageName,L.getId())});D.prototype.getPageView=function(){return this.pageView};D.prototype.getViewRegistry=function(){return this.viewRegistry};D.prototype.start=function(N){var M=this;var T=this.portal;var Q=this.viewRegistry;var P=this.document;var U=this.portalsDataSource;var O=jQuery(document).find("#ssr-gadget-definitions xmp").remove();if(O.length==0){U.retrieve(new K(T,function(){L(this.responseObject)},function(){S(this.responseError,M)}))}else{var R=new DOMParser().parseFromString(O.text(),"text/xml").documentElement;U.getMappings().buildModelFromElement(R,T,{acceptBuildResult:function(V){L(V)},acceptBuildError:function(V){S(V,M)}})}function L(W){var V;if(N&&N.synchronize){M.synchronizationManager=new C(M.portalServerURI,W);M.synchronizationManager.addObserver("httpError",function(){M.notifyObservers("httpError")})}M.pageView=Q.createView(W);if(N&&N.container){V=jQuery(N.container,P)}else{V=jQuery("body",P)}M.pageView.renderHTML(V,P);M.notifyObservers(new n("pageView",M.pageView,null))}function S(W,V){if(V!=null&&V.errorHandler!=null){V.errorHandler(W)}else{if(this.errorHandler==null){console.log("Error starting portal",W)}else{this.errorHandler(W)}}}};D.prototype.refreshWidget=function(N,T){var W=this.portal;var P=this.pageView.getModel();var O=this.pageView;var R=this.viewRegistry;var Q=this.document;var U=new J(this.portalServerURI,W.getId(),{cache:false});var V=N.getItemView().getModel();var M=new s(V,W,function(){L(this.responseObject)},function(){S(this.responseError)});U.retrieve(M);function L(Y){if(T instanceof Function){T.call(this,Y)}else{P.updateWidget(Y);var X;if(V.getParent().equals(P)){X=O.getLayoutView()}else{new m(O).visitTopDown(function(Z){if(V.getParent().equals(Z.getModel().getItem())){X=Z.getItemView().getLayoutView()}})}X.getModel().distribute();X.updateAreaViews()}Y.run()}function S(){console.log("failed to refresh widget "+sWidgetId)}};D.prototype.getSynchronizationManager=function(){return this.synchronizationManager};D.prototype.registerWidgetTypePackage=function(L){g(arguments,[x]);var M=L.getCustomConstructors();for(var N=0;N<M.length-1;N+=2){var P=M[N];var Q=M[N+1];this.customWidgetsViewRegistry.registerView(P,Q)}var O=this.portalsDataSource.getMappings().getMappingByModel(new e(null,null,"",new w([]),false));O.registerCustomWidgetHandler(L.getCustomWidgetHandler())};D.prototype.registerCatalogOnWidget=function(L){var M=this;if(this.dragManager){this.dragManager.addContainer(L)}else{setTimeout(100,function(){M.registerCatalogOnWidget(L)})}};D.prototype.getItemHolderViewById=function(M){var L=this.getPageView();var N=null;if(L){new m(L).visitTopDown(function(O){if(!N&&O.getModel().getItem().getId()==M){N=O}});return N}else{throw new Error("Page view is not set yet")}};this.DefaultPortalViewRegistry=z;this.PortalClient=D;this.WidgetTypePackage=x;this.config||(this.config={});this.config.serverRoot||(this.config.serverRoot="/"+document.location.pathname.split("/")[1]+"/");this.config.resourceRoot||(this.config.resourceRoot=this.config.serverRoot);this.version="5.2.0.0";this.timestamp="20120504-1136"});b$.module("portal.models.layout-examples",function(){var a=b$.require("b$.mvc.Model");var c=b$.require("b$.mvc.MutationEvent");var g=b$.require("b$.testArguments");var b=b$.require("portal.models.item.Item");var d=b$.require("b$.ArrayIterator");var e=b$.require("portal.Area");var j=b$.require("portal.Layout");var l=e.extend();var k=j.extend(function(n,o){j.call(this,n,o);this.addArea(new e("center"));this.addArea(new e("north"));this.addArea(new e("east"));this.addArea(new e("south"));this.addArea(new e("west"))});var m=j.extend(function(o,p){j.call(this,o,p);var q=o.getPreference("number-columns");for(var n=0;n<q;n++){this.addArea(new e(String(n)))}});var i=j.extend(function(n,o){j.call(this,n,o);this.addArea(new e("0"))});var f=j.extend(function(n,o){j.call(this,n,o);this.addArea(new l("0"))});var h=j.extend(function(n,o){j.call(this,n,o);this.addArea(new e("0"))});this.BorderLayoutModel=k;this.ColumnLayoutModel=m;this.StackFlowLayoutModel=i;this.WrappedLineFlowLayoutModel=f;this.WrappedLineArea=l;this.MaximizedLayoutModel=h});b$.module("portal.models",function(){var c=b$.require("b$.testArguments");var b=b$.require("b$.types.NUMBER");var d=b$.require("b$.mvc.Model");var a=d.extend(function(e){c(arguments,[b]);d.call(this);if(e<0){throw new Error("DesignerPager::constructor() size can't be negative")}this.size=e;this.currentPage=0});a.prototype.getSize=function(){return this.size};a.prototype.setSize=function(e){c(arguments,[b]);if(e<0){throw new Error("DesignerPager: size can't be negative")}this.size=e;this.notifyObservers("size");return this.size};a.prototype.getCurrentPage=function(){return this.currentPage||0};a.prototype.setCurrentPage=function(e){c(arguments,[b]);if((e>0&&e<this.size)||e==0){this.currentPage=e;this.notifyObservers("currentPage")}else{throw new Error("DesignerPager::setCurrentPage() page number("+e+") is out of range")}return this.currentPage};a.prototype.nextPage=function(){if(this.currentPage+1<this.size){this.setCurrentPage(this.currentPage+1)}return this.getCurrentPage()};a.prototype.previousPage=function(){if(this.currentPage-1>=0){this.setCurrentPage(this.currentPage-1)}return this.getCurrentPage()};this.DesignerPager=a});b$.module("portal.models",function(){var g=b$.require("b$.mvc.Model");var c=b$.require("b$.mvc.MutationEvent");var b=b$.require("portal.models.DesignerPager");var f=b$.require("b$.testArguments");var e=b$.require("b$.types.NUMBER");var a=b$.require("b$.ArrayIterator");var d=g.extend(function(){g.call(this);this.items=null;this.itemsPerPage=0;this.itemsPager=null});d.prototype.setItems=function(i){this.items=i;var h=new c();h.initMutationEvent("items",true,false,this,null,null,null,null);this.notifyObservers(h,false)};d.prototype.getItems=function(){return this.items};d.prototype.load=function(h){h.forEach(function(i){i.getItem().parent=this},this);this.setItems(h)};d.prototype.setNumberOfItemsPerPage=function(i){this.itemsPerPage=i;var h=new c();h.initMutationEvent("itemsPerPage",true,false,this,null,null,null,null);this.notifyObservers(h,false)};d.prototype.getNumberOfItemsPerPage=function(){return this.itemsPerPage};d.prototype.getCurrentPage=function(){if(this.itemsPager){return this.itemsPager.getCurrentPage()}return 0};d.prototype.setCurrentPage=function(h){if(this.itemsPager){if(h<0||h>=this.itemsPager.getSize()){return}this.itemsPager.setCurrentPage(h)}};d.prototype.getTotalNumberOfPages=function(){if(this.items){return Math.ceil(this.items.length/this.getNumberOfItemsPerPage())}else{return 0}};d.prototype.setupItemsPager=function(k){var j=this.getTotalNumberOfPages();this.itemsPager=new b(j);var i=new c();i.initMutationEvent("itemsPager",true,false,this,null,null,null,null);this.notifyObservers(i,false);var h=(k&&k<j)?k:this.getCurrentPage();this.itemsPager.setCurrentPage(h)};d.prototype.getItemsPager=function(){return this.itemsPager};d.prototype.getNewPage=function(j){var l=this.getCurrentPage();var h=this.getNumberOfItemsPerPage();var i=l*h;var k=Math.floor(i/j);return k};this.Composer=d});b$.module("portal.models",function(){var b=b$.require("portal.models.item.Container");var a=b$.require("portal.models.item.Preference");var c=b$.require("portal.models.item.Preferences");var e=b$.require("portal.models.item.StringDataType");var d=b.extend(function(f){b.call(this,f,null,"Catalog",new c([new a("client-template","Client Template","wrapped-line-flow-container",new e())]),[],false)});this.Catalog=d});b$.module("portal.widget",function(){var e=b$.require("portal.widget.StylesheetResource");var b=b$.require("portal.widget.ScriptResource");var d=b$.require("portal.widget.Resources");var c=b$.require("portal.widget.Widget");var f=c.extend(function(k,h,j,l,i,g){c.call(this,k,h,j,l,i,new d([new e("external","text/css",g+"/main.css")]))});f.prototype.getTitle=function(){return"CSS Widget"};var a=c.extend(function(k,h,j,l,i,g){c.call(this,k,h,j,l,i,new d([new e("external","text/css",g+"/jquery-ui.css"),new b("external","text/javascript",g+"/jquery-ui.js")]))});a.prototype.getTitle=function(){return"jQuery Widget"};this.CSSWidget=f;this.JQueryWidget=a});
/*
 *
 * Copyright 2010 Backbase - All rights reserved.
 *
 */
b$.module("portal.views.layouts",function(){var f=b$.require("portal.views.Layout");var g=b$.require("portal.views.Area");var d=g.extend();d.prototype.createItemWrapper=function(i){var j=g.prototype.createItemWrapper(i);jQuery(j).addClass("portal-layout-area-wrappedline-item-wrapper");return j};var b=f.extend(function(j,i){f.call(this,j,i)});b.prototype.renderHTML=function(k,j){var l=this.getModel();l.distribute();this.updateAreaViews();var i=this.getAreaViews().array;var m=k.find("> table > tbody > tr > td");if(k.attr("id")==this.model.container.id){i.forEach(function(p){var o=p.getModel().getName();var n=m.filter(".portal-area."+o);p.renderHTML(n,j);p.setMinHeight=function(q){return function(){jQuery(this.html).css("min-height",q.height())}}(n)},this);this.registerObservers();this.html=k.get(0)}else{this.html=this.getHTML(j);k.replaceWith(this.html)}};b.prototype.createHTML=function(j){var k=jQuery('<table class="portal-layouts-BorderLayout" cellpadding="0" cellspacing="0"></table>',j);k.append('<tr><td colspan=3 class="portal-layouts-BorderLayout-north"></td></tr>');var i=jQuery('<tr class="portal-layouts-BorderLayout-centerContainer"></tr>',j);i.append('<td class="portal-layouts-BorderLayout-west"></td>');i.append('<td class="portal-layouts-BorderLayout-center"></td>');i.append('<td class="portal-layouts-BorderLayout-east"></td>');k.append(i);k.append('<tr><td colspan=3 class="portal-layouts-BorderLayout-south"></td></tr>');var l=this.getModel();l.distribute();this.updateAreaViews();this.getAreaViews().forEach(function(n){var o="portal-layouts-BorderLayout-"+n.getModel().getName();var m=k.find(" > tbody > tr > ."+o);n.setMinHeight=function(p){return function(){jQuery(this.html).css("min-height",p.height())}}(m);m.append(n.getHTML(j))},this);return k.get()[0]};var e=f.extend(function(j,i){f.call(this,j,i)});e.prototype.renderHTML=function(k,j){var l=this.getModel();l.distribute();this.updateAreaViews();var i=this.getAreaViews().array;var m=k.children();if(k.attr("id")==this.model.container.id){i.forEach(function(o,n){o.renderHTML(m.eq(n),j)},this);this.registerObservers();this.html=k.get(0)}else{this.html=this.getHTML(j);k.replaceWith(this.html)}};e.prototype.createHTML=function(i){var j=jQuery("<div></div>",i);j.addClass("portal-layouts-StackFlowLayout");var k=this.getModel();k.distribute();this.updateAreaViews();this.getAreaViews().forEach(function(m){var l=m.getHTML(i);jQuery(l).addClass("portal-area-StackFlowLayout");j.append(l)},this);return j.get()[0]};var h=f.extend(function(j,i){f.call(this,j,i)});h.prototype.renderHTML=function(k,j){var l=this.getModel();l.distribute();this.updateAreaViews();var i=this.getAreaViews().array;var m=k.children();if(k.attr("id")==this.model.container.id){i.forEach(function(o,n){o.renderHTML(m.eq(n),j)},this);this.registerObservers();this.html=k.get(0)}else{this.html=this.getHTML(j);k.replaceWith(this.html)}};h.prototype.createHTML=function(i){var j=jQuery("<div></div>",i);j.addClass("portal-layouts-wrappedLineFlowLayout");var k=this.getModel();k.distribute();this.updateAreaViews();this.getAreaViews().forEach(function(l){j.append(l.getHTML(i))},this);return j.get()[0]};var a=f.extend(function(j,i){f.call(this,j,i)});a.prototype.createHTML=function(i){var j=jQuery('<div class="portal-layouts-maximizedLayout"></div>',i);var k=this.getModel();k.distribute();this.updateAreaViews();this.getAreaViews().forEach(function(l){j.append(l.getHTML(i))},this);return j.get()[0]};var c=f.extend(function(j,i){f.call(this,j,i)});c.prototype.renderHTML=function(k,j){var l=this.getModel();l.distribute();this.updateAreaViews();var i=this.getAreaViews().array;var m;if(k.find("> table").length){m=k.find("> table > tbody > tr > td > div")}else{m=k.children()}if(k.attr("id")==this.model.container.id){i.forEach(function(o,n){o.renderHTML(m.eq(n),j)},this);this.registerObservers();this.html=k.get(0)}else{this.html=this.getHTML(j);k.replaceWith(this.html)}};c.prototype.createHTML=function(i){var m;if(this.model.html){m=this.model.html;var n=this.getModel();n.distribute();this.updateAreaViews();return m.get(0)}m=jQuery('<table cellspacing="0" class="portal-layouts-ColumnLayout"><tr class="portal-layouts-ColumnLayout-row"></tr></table>');var j=m.find(".portal-layouts-ColumnLayout-row");var l=this.getModel().getContainer().getPreference("number-columns");for(var k=0;k<l;k++){j.append('<td class="portal-layouts-ColumnLayout-column portal-layouts-ColumnLayout-column-'+k+'"></td>')}var n=this.getModel();n.distribute();this.updateAreaViews();this.getAreaViews().forEach(function(p){var o=jQuery(j[0].cells[p.getModel().getName()]);p.setMinHeight=function(q){return function(){jQuery(this.html).css("min-height",q.height())}}(o);o.append(p.getHTML(i))},this);return m.get()[0]};this.WrappedLineArea=d;this.ColumnLayoutView=c;this.BorderLayoutView=b;this.StackFlowLayoutView=e;this.WrappedLineFlowLayoutView=h;this.MaximizedLayoutView=a});b$.module("portal.views",function(){var c=b$.require("b$.mvc.View");var b=b$.require("b$.testArguments");var a=b$.require("portal.models.DesignerPager");var d=c.extend(function(e){b(arguments,[a]);c.call(this,e);this.model.addObserver("size",function(f){this.updateHTML()},this);this.model.addObserver("currentPage",this.updateCurrentPage,this)});d.prototype.update=function(e){};d.prototype.createHTML=function(e){var f=jQuery('<div class="designer-pager"></div>',e);this.updateHTML(f);return f.get()[0]};d.prototype.updateHTML=function(g){var g=jQuery(this.html||g);var j=this,h=this.model.getCurrentPage();var f=function(i){j.model.setCurrentPage(jQuery(i.target,j.html).prevAll(".designer-pager-page").length)};g.empty();for(var e=0;e<this.model.getSize();e++){g.append(jQuery('<div class="designer-pager-page"></div>').click(f).toggleClass("designer-pager-page-current",e==h))}};d.prototype.updateCurrentPage=function(e){jQuery(".designer-pager-page-current",this.html).removeClass("designer-pager-page-current");jQuery(".designer-pager-page:eq("+this.model.getCurrentPage()+")",this.html).addClass("designer-pager-page-current")};this.DesignerPager=d});b$.module("portal.views",function(){var c=b$.require("portal.models.item.Item");var g=b$.require("b$.mvc.View");var e=b$.require("b$.testArguments");var b=b$.require("b$.uri.URI");var a=b$.require("portal.views.holder.ItemHolder");var f=g.extend(function(i,h){e(arguments,[c]);g.call(this,i,h)});f.prototype.createHTML=function(i){var j=this;var k=jQuery('<div class="pm-icon2"></div>');var h=new b(this.model.getPreference("thumbnail-url")).resolve(new b(portal.config.resourceRoot));k.append($('<div class="pm-icon2-img"></div>').css("background-image","url("+h.toString()+")"));var l=$('<div class="pm-icon2-label"></div>');l.text(this.model.getPreference("Title")||"");k.append(l);return k.get()[0]};var d=a.extend();d.prototype.createHTML=function(h){var i=jQuery('<div class="portal-manager-itemHolder portal-manager-iconHolder"></div>',h);i.append(this.itemView.getHTML(h));return i.get()[0]};d.prototype.getElementByHint=function(h){if(h=="draghandle"){return this.html}else{return null}};this.Icon=f;this.IconHolder=d});b$.module("portal.views",function(){var f=b$.require("portal.models.item.Item");var n=b$.require("portal.models.holder.ItemHolder");var k=b$.require("portal.views.IconHolder");var b=b$.require("portal.models.DesignerPager");var l=b$.require("portal.models.Composer");var a=b$.require("b$.mvc.View");var c=b$.require("portal.views.Icon");var h=b$.require("portal.views.DesignerPager");var j=b$.require("b$.mvc.ViewCache");var g=b$.require("b$.mvc.ViewRegistry");var i=b$.require("b$.testArguments");var d=b$.require("b$.mvc.SimpleViewFactory");var e=b$.require("b$.ArrayIterator");var m=a.extend(function(q,o){i(arguments,[l]);a.call(this,q,o);var p=new d(f,c,o);this.thumbnails=new j(new d(n,k,p));this.thumbnailWidth=119;this.itemsPager=new j(new d(b,h,o));this.resizeTimer=null});m.prototype.createHTML=function(o){var p=jQuery('<div class="pm-composer"></div>');this.stripViewPort=jQuery('<div class="pm-composer-stripViewPort"></div>');this.strip=jQuery('<div class="pm-composer-strip"></div>');this.stripViewPort.append(this.strip);p.append(this.stripViewPort);this.previousArrow=jQuery('<div class="pm-composer-previous pm-composer-previous-disabled"></div>');p.append(this.previousArrow);this.nextArrow=jQuery('<div class="pm-composer-next pm-composer-next-disabled"></div>');p.append(this.nextArrow);this.itemsPagerContainer=jQuery('<div class="pm-composer-pagerContainer"></div>',o);p.append(this.itemsPagerContainer);$(window).unbind("resize",jQuery.proxy(this.handleResize,this));$(window).bind("resize",jQuery.proxy(this.handleResize,this));return p.get()[0]};m.prototype.registerObservers=function(){this.registerArrowEventHandlers();a.prototype.registerObservers.call(this)};m.prototype.registerArrowEventHandlers=function(){jQuery(".pm-composer-previous",this.html).unbind("click");jQuery(".pm-composer-previous",this.html).bind("click",jQuery.proxy(this.handlePrevious,this));jQuery(".pm-composer-next",this.html).unbind("click");jQuery(".pm-composer-next",this.html).bind("click",jQuery.proxy(this.handleNext,this))};m.prototype.update=function(o){switch(o){case"items":this.populateStrip();break;case"currentPage":this.scrollPage();this.renderItemsPager();break;case"itemsPager":if(!this.model.getItemsPager().hasObservers("*")){this.model.getItemsPager().addObserver("*",this.update,this)}break}};m.prototype.populateStrip=function(){var p=this.model.getItems();if(p.length==0){this.strip.text("There are no items selected in the catalog for this portal.")}else{var o=new e(p);this.thumbnails.updateViews(o);this.thumbnails.render(this.strip.get()[0]);this.thumbnailWidth=this.stripViewPort.find(".portal-manager-itemHolder:first").width()||this.thumbnailWidth;this.strip.width(this.thumbnailWidth*p.length);this.recalculateViewPortSize(0);this.registerArrowEventHandlers()}};m.prototype.handleNext=function(){this.model.setCurrentPage(this.model.getCurrentPage()+1)};m.prototype.handlePrevious=function(){this.model.setCurrentPage(this.model.getCurrentPage()-1)};m.prototype.updateButtonClasses=function(){this.previousArrow.toggleClass("pm-composer-previous-disabled",this.model.getCurrentPage()==0);this.nextArrow.toggleClass("pm-composer-next-disabled",this.model.getCurrentPage()>=this.model.getTotalNumberOfPages()-1)};m.prototype.scrollPage=function(){this.showChopped();var q=this.model.getCurrentPage();var p=q*this.model.getNumberOfItemsPerPage()*this.thumbnailWidth;var o=this;this.strip.animate({left:-p},500,"swing",function(){o.updateButtonClasses();o.hideChopped()})};m.prototype.hideChopped=function(){var p=this.model.getCurrentPage();var o=1+(p+1)*this.model.getNumberOfItemsPerPage();jQuery(".portal-manager-iconHolder:nth-child("+o+") .pm-icon2",this.strip).addClass("pm-icon2-hidden")};m.prototype.showChopped=function(){jQuery(".pm-icon2-hidden",this.strip).removeClass("pm-icon2-hidden")};m.prototype.renderItemsPager=function(){this.itemsPager.updateView(this.model.getItemsPager());this.itemsPager.render(this.itemsPagerContainer.get()[0]);$("body").unbind("mouseup",$.proxy(this.handleDragStop,this));$("body").bind("mouseup",$.proxy(this.handleDragStop,this))};m.prototype.recalculateViewPortSize=function(o){var r=this.stripViewPort.width();if(r<this.thumbnailWidth||isNaN(r)){r=this.thumbnailWidth}var p=Math.floor(r/this.thumbnailWidth);var q=o||this.model.getNewPage(p);this.model.setNumberOfItemsPerPage(p);this.model.setupItemsPager(o)};m.prototype.handleDragStop=function(p){var o=$(p.target);if(o.hasClass("bd-widgetTitle")||o.hasClass("bd-DragHandle")){this.handleResize()}};m.prototype.handleResize=function(){clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(jQuery.proxy(this.recalculateViewPortSize,this),100)};m.prototype.getThumbnails=function(){return this.thumbnails};this.Composer=m});b$.module("portal.views",function(){var b=b$.require("b$.testArguments");var d=b$.require("portal.models.Catalog");var a=b$.require("portal.views.item.Container");var c=a.extend(function(e,f){b(arguments,[d]);a.call(this,e,f);this.catalogArea=this.getLayoutView().getModel().createCatalogArea()});c.prototype.addItems=function(e){this.catalogArea.addItems(e)};c.prototype.clearItems=function(){this.catalogArea.clearItems()};c.prototype.getElementByHint=function(e){if(e=="droparea"){return this.html}else{return null}};this.Catalog=c});b$.module("portal.views.dnd",function(){var h=b$.require("b$.testArguments");var r=b$.require("b$.TypeConstraintNull");var a=b$.require("b$.Class");var f=b$.require("b$.types.DOCUMENT");var A=b$.require("portal.models.item.StringDataType");var u=b$.require("portal.models.item.DoubleDataType");var H=b$.require("b$.mvc.Model");var l=b$.require("portal.views.item.Item");var K=b$.require("portal.views.page.Page");var z=b$.require("portal.views.item.Container");var g=b$.require("portal.models.holder.ItemHolder");var s=b$.require("portal.views.holder.ItemHolder");var d=b$.require("portal.models.holder.PlaceHolder");var B=b$.require("portal.views.Placeholder");var v=b$.require("portal.models.item.Item");var b=b$.require("portal.models.item.Container");var G=b$.require("portal.models.item.BaseContainer");var x=b$.require("portal.Area");var m=b$.require("portal.CatalogArea");var n=b$.require("portal.views.IconHolder");var F=b$.require("portal.views.Catalog");var j=b$.require("portal.models.Composer");var I=b$.require("portal.com.SynchronizationManager");var p=b$.require("portal.views.item.ItemViewsTreeVisitor");var k=b$.require("portal.views.ItemLayoutsTreeVisitor");var J=b$.require("b$.mvc.CustomEvent");var t=b$.require("portal.Point");var y=b$.require("portal.Vector");var e=b$.require("b$.browser");var E=new r(v);var w={html:jQuery(".portal-area").get(0)};var q;var i;var D=H.extend(function(Q,R,P){h(arguments,[s,t,f]);H.call(this);this.currentlyDragged=Q;this.document=P;var O=jQuery(Q.getHTML(P));this.offsetX=R.x-O.offset().left;this.offsetY=R.y-O.offset().top;this.dragMoveTimeout=null;i=O.get(0).getAttribute("style");if((Q.getModel().getItem().getParent() instanceof j)){var S=O.clone(true);S.css("position","absolute");S.width(O.width());S.height(O.height());jQuery(P.body).append(S);this.draggedMock=S.get()[0]}else{var N=O.width();var M=O.height();O.css("position","absolute");O.width(N);O.height(M);O.css("z-index","1000");O.addClass("bd-widgetHover-onDrag");this.draggedMock=O}this.startLocation=new t(R.x-this.offsetX,R.y-this.offsetY);this.lastLocation=this.startLocation});D.prototype.start=function(){var M=new J();M.initCustomEvent("DragStart",true,false,null);this.notifyObservers(M,false);this.attachDragHandlers()};D.prototype.attachDragHandlers=function(){jQuery(this.document).bind("mouseup",jQuery.proxy(this.handleMouseUp,this));jQuery(this.document).bind("mousemove",jQuery.proxy(this.handleMouseMove,this))};D.prototype.removeDragHandlers=function(){jQuery(this.document).unbind("mouseup",jQuery.proxy(this.handleMouseUp,this));jQuery(this.document).unbind("mousemove",jQuery.proxy(this.handleMouseMove,this))};D.prototype.handleMouseMove=function(N){var O=new t(N.pageX-this.offsetX,N.pageY-this.offsetY);var P=jQuery(".pageContainer, .clientRenderingContainer",this.document);var M=P.offset().top+P.height();if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null}if(M-O.y<100){this.scrollInterval=setInterval(function(){P.scrollTop(P.scrollTop()+50)},10)}else{if(O.y-P.offset().top<100){this.scrollInterval=setInterval(function(){P.scrollTop(P.scrollTop()-50)},10)}}this.dragMove(O,N);this.lastLocation=O};D.prototype.dragMove=function(O,M){if(!M.pageX||!M.pageY){return}jQuery(this.draggedMock).offset({top:O.y,left:O.x});var P=this;if(!this.dragMoveTimeout){if(!e.ie){this.dragMoveTimeout=setTimeout(function(){this.dragCounter=0;var Q=new J();Q.initCustomEvent("Drag",true,false,new t(M.pageX,M.pageY));P.notifyObservers(Q,false);P.dragMoveTimeout=null},50)}else{var N=new J();N.initCustomEvent("Drag",true,false,new t(M.pageX,M.pageY));P.notifyObservers(N,false)}}};D.prototype.handleMouseUp=function(M){this.handleMouseMove(new t(M.pageX,M.pageY));this.removeDragHandlers();if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null}if(this.dragMoveTimeout){clearTimeout(this.dragMoveTimeout);this.dragMoveTimeout=null}var N=new J();N.initCustomEvent("DragStop",true,false,M);this.notifyObservers(N,false);jQuery(this.draggedMock).removeClass("bd-widgetHover-onDrag");if(this.currentlyDragged.getModel().getItem().getParent() instanceof j){jQuery(this.draggedMock).remove()}};D.prototype.getCurrentDraggable=function(){return this.currentlyDragged};var C=H.extend(function(O,N){h(arguments,[z]);H.call(this);this.containers=[O];this.dragger=null;this.mouseDownPoint=null;var M=this;var P;this.handleMouseDown=function(Q){M.mouseDownPoint=new t(Q.pageX,Q.pageY);P=M.findDraggableTarget(M.mouseDownPoint);if(M.findDraggableTarget(M.mouseDownPoint)){Q.preventDefault()}else{M.mouseDownPoint=null}};this.handleMouseMove=function(Q){if(M.mouseDownPoint&&((Math.abs(M.mouseDownPoint.x-Q.pageX)>5)||(Math.abs(M.mouseDownPoint.y-Q.pageY)>5))){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}var R=new t(M.mouseDownPoint.x,M.mouseDownPoint.y);M.mouseDownPoint=null;M.initDraggable(P,N,R)}};this.handleMouseUp=function(Q){M.mouseDownPoint=null}});C.prototype.start=function(M){this.containers.forEach(function(N){jQuery(N.getHTML(M)).bind("mousedown",this.handleMouseDown)},this);jQuery(M.body).bind("mousemove",this.handleMouseMove).bind("mouseup",this.handleMouseUp)};C.prototype.stop=function(){this.containers.forEach(function(M){jQuery(M.getHTML(oDocument)).unbind("mousedown",this.handleMouseDown)},this);jQuery(oDocument.body).unbind("mousemove",this.handleMouseMove).unbind("mouseup",this.handleMouseUp)};C.prototype.getContainers=function(){return this.containers};C.prototype.getCurrentDraggable=function(){return this.dragger?this.dragger.getCurrentDraggable():null};C.prototype.findDraggableTarget=function(M){var N;this.containers.forEach(function(O){if(!N){N=new k(O.getLayoutView()).findTopmost(function(P){return P.contains(M,"draghandle")})}},this);return N};C.prototype.initDraggable=function(O,M,N){this.dragger=new D(O,N,M);this.dragger.addObserver("DragStart",this.notifyObservers,this);this.dragger.addObserver("Drag",this.notifyObservers,this);this.dragger.addObserver("DragStop",this.notifyObservers,this);this.dragger.start()};C.prototype.addContainer=function(M){h(arguments,[z]);if(this.containers.indexOf(M)==-1){this.containers.push(M)}};C.prototype.getDraggedItem=function(){if(this.getCurrentDraggable()){return this.getCurrentDraggable().getModel().getItem()}return null};C.prototype.getBubbleParent=function(){return this.getDraggedItem()};var c=H.extend(function(M,O,N){h(arguments,[G,x]);H.call(this);this.container=M;this.area=O;this.before=N});c.prototype.reserve=function(M){var N=M.getItem();this.area.insertPlaceholder(new d(N,this.before))};c.prototype.release=function(){this.area.removePlaceholder()};c.prototype.apply=function(M){h(arguments,[g]);var N=M.getItem();N.bypassPreferences=this.isCurrentPlaceholder(M);this.container.addChild(N);this.area.removePlaceholder()};c.prototype.getArea=function(){return this.area};c.prototype.isCurrentPlaceholder=function(Q){h(arguments,[g]);var S=Q.getItem(),R=this.getArea(),P=R.getPlaceholder(),O=R.holders,N,M;if(R.hasHolder(Q)){if(P.getItem()===P.getBeforeItem()){return true}if(!P.getBeforeItem()&&O[O.length-1].getItem()===S){return true}for(N=0,M=O.length-1;N<M;N++){if(S===O[N].getItem()&&P.getBeforeItem()===O[N+1].getItem()){return true}}}return false};c.prototype.getBeforeItem=function(){return this.before};c.prototype.equals=function(M){return(this.area==M.getArea()&&this.before==M.getBeforeItem())};var o=H.extend(function(M){H.call(this);this.dropLocation=null;this.dragManager=M});o.prototype.start=function(){this.dragManager.addObserver("DragStart",this.handleDragStart,this);this.dragManager.addObserver("Drag",this.handleDrag,this);this.dragManager.addObserver("DragStop",this.handleDragStop,this)};o.prototype.stop=function(){if(this.dropLocation){this.dropLocation.release()}this.dragManager.removeObserver("DragStart",this.handleDragStart,this);this.dragManager.removeObserver("Drag",this.handleDrag,this);this.dragManager.removeObserver("DragStop",this.handleDragStop,this)};o.prototype.handleDragStart=function(M){var N=this.dragManager.getCurrentDraggable().getModel();this.dropLocation=this.findDropLocationBeforeItem(N)||this.getDefaultDropLocation();this.dropLocation.reserve(N)};o.prototype.handleDrag=function(M){this.dropLocation.release();this.dropLocation=this.findDropLocationForPoint(M.detail)||this.dropLocation;this.dropLocation.reserve(this.dragManager.getCurrentDraggable().getModel())};o.prototype.handleDragStop=function(M){var N=jQuery(this.dragManager.dragger.draggedMock);if(q&&jQuery(q.html).parent(".portal-layout-area-item-wrapper").length){jQuery(q.html).parent(".portal-layout-area-item-wrapper").before(jQuery('<div class="portal-layout-area-item-wrapper"/>').append(N))}else{if(q&&q.html!==N.get(0)){N.get(0).setAttribute("style",i);jQuery(q.html).before(N)}else{N.get(0).setAttribute("style",i);jQuery(w.html).append(N)}}N.get(0).setAttribute("style",i);this.dragManager.getCurrentDraggable().getModel().getItem().setPreference("area",this.dropLocation.area.name);this.dropLocation.apply(this.dragManager.getCurrentDraggable().getModel())};o.prototype.findDropLocationBeforeItem=function(N){h(arguments,[g]);var Q=N.getItem();var M=Q.getParent();var O=null;this.dragManager.getContainers().forEach(function(S){if(S.getModel()==M){O=S.getLayoutView().getAreaViews().next().getModel()}});if(O){return new c(M,O,Q)}var R;this.dragManager.getContainers().forEach(function(S){if(!R){R=new k(S.getLayoutView()).findDeepest(function(T){return T.getItemView().getModel()==M})}},this);if(R){var P=R.getItemView().getLayoutView().getModel().getAreaByHolder(N);if(P){return new c(M,P,Q)}}return null};o.prototype.findDropLocationForPoint=function(O){var U=this.dragManager.getCurrentDraggable();var Q;this.dragManager.getContainers().forEach(function(W){if(W.contains(O,"droparea")){Q=W}if(!Q||Q instanceof K){Q=new k(W.getLayoutView()).findDeepest(function(X){return X.getItemView() instanceof z&&X!=U&&X.contains(O,"droparea")})||Q}},this);if(Q instanceof F){return new c(Q.getModel(),Q.getLayoutView().getAreaViews().next().getModel(),null)}if(Q instanceof K){w=Q.getLayoutView().getAreaViews().next();q=w.getHolderViewUnderPoint(O,"droparea");var P=null;if(w.getModel().getPlaceholder()&&w.getPlaceholderView().contains(O,"droparea")){return this.dropLocation}else{if(q){P=q.getModel().getItem()}else{var N=O;while(!q&&Q.contains(N,"droparea")){N=N.translate(new y(0,2));q=w.getHolderViewUnderPoint(N,"droparea")}P=q?q.getModel().getItem():null}}return new c(Q.getModel(),w.getModel(),P)}if(Q){var S=Q.getItemView().getLayoutView().getAreaViewUnderPoint(O,"droparea");if(S){var V=null;var T=S.getHolderViewUnderPoint(O,"droparea");if(S.getModel().getPlaceholder()&&S.getPlaceholderView().contains(O,"droparea")){return this.dropLocation}else{if(T){V=T.getModel().getItem()}else{var N=O;while(!T&&Q.contains(N,"droparea")){N=N.translate(new y(0,2));T=S.getHolderViewUnderPoint(N,"droparea")}V=T?T.getModel().getItem():null}}w=S;q=T;return new c(Q.getModel().getItem(),S.getModel(),V)}else{if(Q.contains(O,"droparea-top")){return this.findDropLocationBeforeItem(Q.getModel())}}}var R=null;var M=this;this.dragManager.getContainers().forEach(function(W){if(W instanceof K&&O.y>W.getBox("droparea").from.y){R=M.getDefaultDropLocation()}});return R};o.prototype.getDefaultDropLocation=function(){var M=this.dragManager.getContainers()[0];return new c(M.getModel(),M.getLayoutView().getModel().getAreas().next())};var L=o.extend(function(N,M){h(arguments,[C,I]);o.call(this,N);this.synchronizationManager=M});L.prototype.handleDragStart=function(M){o.prototype.handleDragStart.call(this,M);if(this.dragManager.getCurrentDraggable() instanceof n){jQuery(this.dragManager.getCurrentDraggable().getHTML(document)).show()}};L.prototype.handleDrag=function(M){var N=this.findDropLocationForPoint(M.detail)||(this.dropLocation.getArea() instanceof m?this.getDefaultDropLocation():this.dropLocation);if(!this.dropLocation.equals(N)){this.dropLocation.release();this.dropLocation=N;this.dropLocation.reserve(this.dragManager.getCurrentDraggable().getModel())}};L.prototype.handleDragStop=function(M){var S=function(){var Y=O.before;var V=null;var X=R.getHolders().array;if(Y){for(var W=0;W<X.length&&V==null;W++){if(X[W].getItem().equals(Y)){V=X[W-1]?X[W-1].getItem():null}}}else{V=X[X.length-1]?X[X.length-1].getItem():null}var Z=V?Number(V.getPreference("order")):-1000;var ab=Y?Number(Y.getPreference("order")):1000;var aa=(Z+ab)/2;if(N.getPreferenceObject("area")){N.setPreference("area",R.getName())}else{N.addPreference("area","Area",R.getName(),new A())}if(N.getPreferenceObject("order")){N.setPreference("order",aa)}else{N.addPreference("order","Order",aa,new u())}};var O=this.dropLocation;var T=this.dragManager.getCurrentDraggable().getModel();var Q=T.getItem();var R=O.getArea();if(R instanceof m){if(!(Q.getParent() instanceof j)){this.synchronizationManager.deleteItem(Q)}}else{if(Q.getParent() instanceof j){var N=Q.extendItem();N.parent=O.container;S();var U=this;var P=this.synchronizationManager;this.synchronizationManager.postItem(N,function(Y){if(e.ie&&e.version<9){var W=jQuery(Y).find("body").get(0);var Z=new XMLSerializer().serializeToString(W);var V=jQuery(Z).html()}else{var V=jQuery(Y).find("body").html()}var X=this.responseObject;X.html=V;T=R.createHolder(X);O.reserve(T);O.apply(T);if(P.persistItemCallback){P.persistItemCallback(N)}},function(){console.log("retrieve after save failed")})}else{o.prototype.handleDragStop.call(this,M)}}};this.DragManager=C;this.DropManager=o;this.CatalogDropManager=L});b$.module("portal.views.widget",function(){var d=b$.require("portal.widget.Resource");var a=b$.require("portal.views.widget.Widget");var b=a.extend();b.prototype.createHTML=function(e){var f=a.prototype.createHTML.call(this,e);jQuery(f).html('<ul class="CSSWidget-list"><li class="CSSWidget-list-item">item 1</li><li class="CSSWidget-list-item">item 2</li><li class="CSSWidget-list-item">item 3</li><li class="CSSWidget-list-item">item 4</li><li class="CSSWidget-list-item">item 5</li><li class="CSSWidget-list-item">item 6</li><li class="CSSWidget-list-item">item 7</li></ul>');jQuery(f).addClass("CSSWidget");return f};var c=a.extend();c.prototype.createHTML=function(e){var g=a.prototype.createHTML.call(this,e),f=this;jQuery(g).html('<div class="JQueryWidget-slider"></div>');jQuery(g).addClass("JQueryWidget");if(this.model.getResources().every(function(h){return h.isReady()})){this.initSlider(g)}else{this.model.getResources().each(function(h){h.addObserver("ready",f.resourceReady,f)})}return g};c.prototype.resourceReady=function(e){e.target.removeObserver("ready",this.resourceReady);if(this.model.getResources().every(function(f){return f.isReady()})){this.initSlider(this.html)}};c.prototype.initSlider=function(e){jQuery(e).find(".JQueryWidget-slider").slider()};this.CSSWidget=b;this.JQueryWidget=c});b$.module("portal",function(){var a=b$.require("b$.testArguments");var u=b$.require("b$.Class");var m=b$.require("b$.mvc.ViewRegistry");var r=b$.require("portal.models.layout-examples.WrappedLineArea");var C=b$.require("portal.models.layout-examples.StackFlowLayoutModel");var p=b$.require("portal.models.layout-examples.ColumnLayoutModel");var k=b$.require("portal.models.layout-examples.BorderLayoutModel");var t=b$.require("portal.models.layout-examples.WrappedLineFlowLayoutModel");var l=b$.require("portal.views.layouts.WrappedLineArea");var e=b$.require("portal.views.layouts.StackFlowLayoutView");var f=b$.require("portal.views.layouts.ColumnLayoutView");var w=b$.require("portal.views.layouts.BorderLayoutView");var o=b$.require("portal.views.layouts.WrappedLineFlowLayoutView");var x=b$.require("portal.models.Catalog");var q=b$.require("portal.views.Catalog");var z=b$.require("portal.CatalogArea");var c=b$.require("portal.views.CatalogArea");var i=b$.require("portal.models.Composer");var j=b$.require("portal.views.Composer");var d=b$.require("portal.DefaultPortalViewRegistry");var v=b$.require("portal.WidgetTypePackage");var s=b$.require("portal.mappings.xml.CustomWidgetHandler");var B=b$.require("portal.widget.CSSWidget");var A=b$.require("portal.views.widget.CSSWidget");var h=b$.require("portal.widget.JQueryWidget");var n=b$.require("portal.views.widget.JQueryWidget");var g=m.extend(function(E){var D=new d(E);D.registerView(k,w);D.registerView(p,f);D.registerView(C,e);D.registerView(t,o);D.registerView(r,l);D.registerView(z,c);D.registerView(x,q);D.registerView(i,j);m.call(this,D)});var y=s.extend(function(){s.call(this,"examples")});y.prototype.createModelBuilder=function(D,H,G,F,E){return{build:function(K){var L=G.getByName("type");var J=G.getByName("baseResourceURI");var M=J?J.getValue():"";var I=null;if(L){if(L.getValue()=="CSSWidget"){I=new B(E,H,D,G.toArray(),true,M)}else{if(L.getValue()=="JQueryWidget"){I=new h(E,H,D,G.toArray(),true,M)}else{throw new Error("Unknown value of 'type' preference. Cannot build widget model.")}}}else{throw new Error("On 'examples' widget one should define 'type' preference. Cannot build widget model.")}K.acceptBuildResult(I)}}};var b=v.extend(function(){v.call(this,new y(),[B,A,h,n])});this.DefaultHydrogenViewRegistry=g;this.ExamplesWidgetTypePackage=b});b$.module("packages.portal4gadgets",function(){var b=b$.require("b$.Class");var f=b$.require("b$.testArguments");var a=b$.require("b$.types.HTMLDOCUMENT");var e=b.extend(function(g){b.call(this);this.attribute=g});e.prototype.getNode=function(){return this.attribute};e.prototype.getPrefix=function(){return this.attribute.localName||this.attribute.baseName||this.attribute.nodeName};e.prototype.getURI=function(){return this.attribute.nodeValue};e.prototype.getFullName=function(){var g=this.getPrefix();return(g=="xmlns"||!g)?"xmlns":(/^xmlns:/.test(g)?g:"xmlns:"+g)};e.prototype.toString=function(){return this.getFullName()+'="'+this.getURI()+'"'};var d=b.extend(function(g){b.call(this);this.owner=g});d.prototype.each=function(h){var g=this.owner.attributes,j=null;if(g){for(var i=0;i<g.length;++i){j=g[i];if(j&&j.namespaceURI=="http://www.w3.org/2000/xmlns/"||(!j.namespaceURI&&(j.prefix||j.localName||j.baseName)=="xmlns")||(!j.namespaceURI&&/^xmlns:/.test(String(j.localName||j.nodeName)))){h.call(this,new e(j))}}}};d.prototype.recursiveEach=function(g){var i={},h=this.owner;while(h){new d(h).each(function(j){if(!(j.getPrefix() in i)){i[j.getPrefix()]=true;g.call(this,j)}});h=h.parentNode}};d.prototype.toString=function(){var g=[];new d(this.owner).recursiveEach(function(h){g.push(h)});return g.join(" ")};d.prototype.flatten=function(){var g=this.owner;if("setAttributeNS" in g){new d(g.parentNode).recursiveEach(function(i){if(!g.getAttributeNS("http://www.w3.org/2000/xmlns/",i.getPrefix())){g.setAttributeNS("http://www.w3.org/2000/xmlns/",i.getFullName(),i.getURI())}})}else{var h=new d(g);new d(new DOMParser().parseFromString("<root "+new d(g.parentNode)+" />","application/xml").documentElement).each(function(i){var j=false;h.each(function(k){j=j||i.getPrefix()==k.getPrefix()});if(!j){g.attributes.setNamedItem(i.getNode().cloneNode(true))}})}};var c=b.extend(function(g){f(arguments,[a]);b.call(this);this.document=g;this.creator=g.createElement("div")});c.prototype.parseFromString=function(g){this.creator.innerHTML="&nbsp;"+g;return this.creator.lastChild};c.prototype.parseFragmentFromString=function(j){var h=this.parseFromString("<div>"+j+"</div>");var i=[];for(var g=0;g<h.childNodes.length;++g){i.push(h.childNodes[g])}return i};this.NamespaceDeclaration=e;this.NamespaceDeclarations=d;this.HTMLParser=c});
/*
 * Opensocial gadgets API http://www.opensocial.org/
 * Backbase implementation for opensocial API support, based on 0.8 spec.
 * Copyright 2010 Backbase - All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
b$.module("gadgets.config",function(){this.proxyUrl=(window.portal.config.serverRoot||"/")+"proxy"});b$.module("gadgets.json",function(){var b=JSON.stringify;var a=function(c){sTtext=c.replace(/\\x(..)/g,"\\u00$1");try{c=JSON.parse(c)}catch(d){d.message+=". Source: "+c;throw d}return c};this.stringify=b;this.parse=a});b$.module("gadgets.io",function(){var b=b$.require("b$.Class");var d=b$.require("gadgets.config");var l=b$.require("gadgets.json");var g={};g.METHOD="method";g.CONTENT_TYPE="type";g.POST_DATA="data";g.HEADERS="headers";g.AUTHORIZATION="authorization";g.NUM_ENTRIES="NUM_ENTRIES";g.GET_SUMMARIES="GET_SUMMARIES";g.TIMEOUT="timeout";var f={};f.GET="GET";f.POST="POST";f.PUT="PUT";f.DELETE="DELETE";f.HEAD="HEAD";var e={};e.TEXT="text";e.DOM="xml";e.JSON="json";e.FEED="feed";var j={};j.NONE="NONE";j.SIGNED="SIGNED";j.OAUTH="OAUTH";var k={};k.REFRESH_INTERVAL="refresh";k.BACKBASE_PTC_PIPE="pipe";function c(m){var n=[],p="";for(var o in m){if(m.hasOwnProperty(o)){p=m[o];if(typeof p=="object"&&p.length){for(var q=0;q<p.length;q++){n.push(encodeURIComponent(o)+"="+encodeURIComponent(p[q]))}}else{n.push(encodeURIComponent(o)+"="+encodeURIComponent(p))}}}return n.join("&")}function h(m,n){n=n||{};n.url=m||n.url;return d.proxyUrl+(d.proxyUrl.indexOf("?")==-1?"?":"&")+c(n)}var a=b.extend(function(p,o,q,m,s){this.text=o;this.data=null;this.errors=[];this.status=q;this.headers={};for(var r=0;r<s.length;r++){var n=s[r].replace(/^\s*|\s*$/g,"").split(": ");if(n.length>1){this.headers[n.shift()]=n.join(": ")}}if((q>=200&&q<300)||q==304||q==1223){switch(p){case e.DOM:this.data=new DOMParser().parseFromString(o,"application/xml");break;case e.JSON:try{this.data=l.parse(o)}catch(t){this.errors.push(t.message||t)}break;case e.FEED:this.errors.push("Not implemented");break;case e.TEXT:default:this.data=o;break}}else{if(q==0){this.errors.push("No connection to server")}else{this.errors.push("HTTP error:"+q);if(m){this.errors.push(m)}}}});a.prototype.getHeader=function(n){n=String(n).toLowerCase();for(var m in this.headers){if(this.headers.hasOwnProperty(m)&&m.toLowerCase()==n){return this.headers[m]}}return null};function i(m,t,p){p=p||{};var r=p[g.HEADERS]||{};var s=p[g.POST_DATA]||null;var q=Number(p[g.TIMEOUT])||30000;if(p[g.METHOD]===f.POST&&!r["Content-Type"]&&s){r["Content-Type"]="application/x-www-form-urlencoded"}var o=new XMLHttpRequest();o.open(p[g.METHOD]||f.GET,m,true);for(var n in r){if(r.hasOwnProperty(n)){o.setRequestHeader(n,r[n])}}if(q){q=setTimeout(function(){o.abort()},q)}o.onreadystatechange=function(){if(o.readyState==2){o._headersReceived=true}else{if(o.readyState==4){if(q){clearTimeout(q)}if(t){if(jQuery.browser.opera&&!o.status){o.status=204;o.statusText="No Content"}var u=new a(p[g.CONTENT_TYPE],o.responseText,o.status,o.statusText,o._headersReceived?String(o.getAllResponseHeaders()).split("\n"):[]);t(u)}}}};o.send(s);return o}this.encodeValues=c;this.getProxyUrl=h;this.makeRequest=i;this.RequestParameters=g;this.MethodType=f;this.ContentType=e;this.AuthorizationType=j;this.ProxyUrlRequestParameters=k});b$.module("gadgets.pubsub",function(){var g=b$.require("b$.testArguments");var f=b$.require("b$.types.STRING");var j=b$.require("b$.types.FUNCTION");var a=b$.require("b$.Class");var d=a.extend(function(){this.callbacks=[]});d.prototype.subscribe=function(k){this.callbacks.push(k)};d.prototype.unsubscribe=function(k){if(k){this.callbacks=this.callbacks.filter(function(l){return l!=k})}else{this.callbacks=[]}};d.prototype.publish=function(k){this.callbacks.forEach(function(l){l(k)})};var h=a.extend(function(){this.channels={}});h.prototype.subscribe=function(k,l){g(arguments,[f,j]);if(!this.channels[k]){this.channels[k]=new d()}this.channels[k].subscribe(l)};h.prototype.unsubscribe=function(k,l){g(arguments,[f,j]);if(this.channels[k]){this.channels[k].unsubscribe(l)}};h.prototype.publish=function(k,l){g(arguments,[f]);if(this.channels[k]){this.channels[k].publish(l)}};var e=new h();function b(k,l){e.publish(k,l)}function c(k,l){e.subscribe(k,l)}function i(k,l){e.unsubscribe(k,l)}this.publish=b;this.subscribe=c;this.unsubscribe=i});b$.module("gadgets.util",function(){var b=b$.require("b$.uri.URI");var d={0:false,10:true,13:true,34:true,39:true,60:true,62:true,92:true,8232:true,8233:true};var e=f();function f(g){if(e&&g===undefined){return e}var i=new b(g||document.location.href),h={};(i.getQuery()||"").split("&").concat((i.getFragment()||"").split("&")).forEach(function(k){var j=k.split("=");if(j.length==2){h[j[0]]=decodeURIComponent(j[1].replace(/\+/g," "))}});return h}function a(g){return g&&g.replace(/[\s\S]/mg,function(h){var j=h.charCodeAt(0);var i=d[j];if(i===true){return"&#"+j+";"}else{if(i!==false){return h}}})}function c(g){return g&&g.replace(/&#([0-9]+);/g,function(h,i){return String.fromCharCode(i)})}this.getUrlParameters=f;this.escapeString=a;this.unescapeString=c});b$.module("packages.portal4gadgets.event",function(){var c=b$.require("b$.Class");var g=b$.require("b$.testArguments");var b=b$.require("b$.TypeConstraintNull");var f=b$.require("b$.types.STRING");var e=b$.require("b$.types.BOOLEAN");var d=new b(f);var i=c.extend(function(){c.call(this);this.namespaceURI=null;this.type=null;this.bubbles=null;this.cancelable=null;this.target=null;this.currentTarget=null;this.eventPhase=null;this.timeStamp=new Date();this.defaultPrevented=false;this._stopped=false;this._stoppedImmediate=false;this._stoppedHorizontal=false});i.prototype.initEventNS=function(k,m,l,j){g(arguments,[d,f,e,e]);this.type=m;this.bubbles=l;this.cancelable=j;this.namespaceURI=k};i.prototype.initEvent=function(l,k,j){this.initEventNS(null,l,k,j)};i.prototype.preventDefault=function(){this.defaultPrevented=this.cancelable};i.prototype.stopPropagation=function(){this._stopped=true};i.prototype.stopImmediatePropagation=function(){this.stopPropagation();this.stopHorizontalPropagation();this._stoppedImmediate=true};i.prototype.stopHorizontalPropagation=function(){this._stoppedHorizontal=true};i.prototype.isPropagationStopped=function(){return this._stopped};i.prototype.isImmediatePropagationStopped=function(){return this._stoppedImmediate};i.prototype.isHorizontalPropagationStopped=function(){return this._stoppedHorizontal};var a=i.extend(function(){i.call(this);this.detail=null});a.prototype.initCustomEvent=function(m,l,j,k){this.initCustomEventNS(null,m,l,j,k)};a.prototype.initCustomEventNS=function(k,n,m,j,l){this.initEventNS(k,n,m,j);this.detail=l};var h=i.extend(function(){i.call(this);this.relatedNode=null;this.prevValue=null;this.newValue=null;this.attrName=null;this.attrChange=null});h.prototype.initMutationEvent=function(q,p,n,m,l,o,j,k){this.initMutationEventNS(null,q,p,n,m,l,o,j,k)};h.prototype.initMutationEventNS=function(q,j,n,p,o,k,r,l,m){this.initEventNS(q,j,n,p);this.relatedNode=o;this.prevValue=k;this.newValue=r;this.attrName=l;this.attrChange=m};this.DOMEvent=i;this.DOMCustomEvent=a;this.DOMMutationEvent=h});b$.module("packages.portal4gadgets.include",function(){var x=b$.require("b$.Class");var c=b$.require("b$.Interface");var b=b$.require("b$.ArgumentException");var a=b$.require("b$.testArguments");var y=b$.require("b$.TypeConstraintFn");var d=b$.require("b$.TypeConstraintNull");var e=b$.require("b$.TypeConstraintOptional");var r=b$.require("b$.types.STRING");var q=b$.require("b$.types.BOOLEAN");var i=b$.require("b$.types.FUNCTION");var C=b$.require("b$.types.NODE");var m=b$.require("b$.ArrayIterator");var k=b$.require("b$.uri.URI");var n=b$.require("b$.mvc.Model");var f=b$.require("portal.IComparable");var v=b$.require("portal.OrderedCollection");var p=b$.require("portal.template.IContextProvider");var o=b$.require("portal.template.StringTemplate");var B=b$.require("packages.portal4gadgets.HTMLParser");var A=new y(function(D){return/^proxy|target$/.test(D)});var g=new e(A);var z=new y(function(D){return/^GET|POST$/.test(D)});var l=new d(Array);var h=p.extend({getContextDocument:i,getContextURI:i,getContextPreferenceValue:i});var j=x.extend(function(F,G,E,D){a(arguments,[r,r,A,z]);this.name=new o(F);this.value=new o(G);this.destination=E;this.method=D});j.PROXY_PARAM_PREFIX="internal-";j.prototype.toQueryString=function(D){var E=encodeURIComponent(this.getName(D));return this.getValues(D).map(function(F){return E+"="+encodeURIComponent(F)}).join("&")};j.prototype.getName=function(D){return((this.destination=="proxy"&&this.method=="POST")?j.PROXY_PARAM_PREFIX:"")+this.name.generate(D)};j.prototype.getValues=function(D){return[this.value.generate(D)]};j.prototype.equals=function(D){return this===D};f.implementedBy(j);var t=j.extend(function(F,E,D){j.call(this,F,"",E,D)});t.prototype.getValues=function(E){a(arguments,[h]);var D=E.getContextPreferenceValue(this.getName(E));return D instanceof Array?D:[D]};var w=v.extend();w.prototype.add=function(D){a(arguments,[j]);v.prototype.add.call(this,D)};w.prototype.toQueryString=function(D,E,F){a(arguments,[p,z,g]);return this.items.filter(function(G){return G.method==E&&(!F||G.destination==F)}).map(function(G){return G.toQueryString(D)}).join("&")};w.prototype.toJSONObject=function(D,E,G){a(arguments,[p,z,g]);var F={};this.items.filter(function(H){return H.method==E&&(!G||H.destination==G)}).forEach(function(H){var I=H.getName(D);F[I]=H.getValues(D).concat(F[I]||[])});return F};var s=n.extend(function(G,F,E,D){a(arguments,[r,z,q,w]);n.call(this);var H=new k(G);H.getQuery()&&H.getQuery().split("&").forEach(function(I){var J=I.split("=");D.add(new j(J[0],J[1],"target","GET"))});this.uri=new o((H.getScheme()&&(H.getScheme()+":")||"")+(H.getAuthority()&&("//"+H.getAuthority())||"")+H.getPath());this.method=F;this.proxy=E;this.params=D;this.content=null});s.prototype.setContent=function(D){a(arguments,[l]);D&&D.forEach(function(E){a(arguments,[C])});this.content=D;this.notifyObservers("content");this.notifyObservers("contentRendered")};s.prototype.hasContent=function(){return Boolean(this.content)};s.prototype.getContentIterator=function(){return new m(this.content||[])};s.prototype.getContentURI=function(E){a(arguments,[h]);var D=this.params.toQueryString(E,"GET","target"),F=this.uri.generate(E)+(D&&("?"+D));return !this.proxy?k.resolve(F,E.getContextURI()):gadgets.io.getProxyUrl(F,this.params.toJSONObject(E,"GET","proxy"))};s.prototype.refresh=function(E){a(arguments,[h]);var D=this;gadgets.io.makeRequest(this.getContentURI(E),function(F){D.setContent(new B(E.getContextDocument()).parseFragmentFromString(F.text))},{method:this.method,data:this.method=="POST"?this.params.toQueryString(E,"POST"):""})};s.prototype.equals=function(D){return this===D};f.implementedBy(s);var u=v.extend();u.prototype.add=function(D){a(arguments,[s]);v.prototype.add.call(this,D)};this.IContextProvider=p;this.IIncludeContextProvider=h;this.StringTemplate=o;this.HttpParam=j;this.HttpPreferenceParam=t;this.HttpParams=w;this.Include=s;this.Includes=u});b$.module("packages.portal4gadgets.widget",function(){var aw=b$.require("b$.Class");var w=b$.require("b$.ArgumentException");var W=b$.require("b$.testArguments");var k=b$.require("b$.TypeConstraintFn");var J=b$.require("b$.TypeConstraintNull");var d=b$.require("b$.TypeConstraintOptional");var ao=b$.require("b$.types.ANY");var ax=b$.require("b$.types.STRING");var N=b$.require("b$.types.BOOLEAN");var H=b$.require("b$.types.NUMBER");var Z=b$.require("b$.types.FUNCTION");var ad=b$.require("b$.types.HTMLELEMENT");var ar=b$.require("b$.types.DOCUMENT");var X=b$.require("b$.uri.URI");var x=b$.require("b$.mvc.Model");var j=b$.require("portal.models.item.PropertyModifiedEvent");var y=b$.require("portal.widget.Perspective");var m=b$.require("packages.portal4gadgets.event.DOMEvent");var f=b$.require("packages.portal4gadgets.event.DOMCustomEvent");var P=b$.require("packages.portal4gadgets.event.DOMMutationEvent");var O=b$.require("packages.portal4gadgets.NamespaceDeclaration");var aa=b$.require("packages.portal4gadgets.NamespaceDeclarations");var ay=b$.require("packages.portal4gadgets.include.IIncludeContextProvider");var af=b$.require("packages.portal4gadgets.include.HttpPreferenceParam");var n=b$.require("packages.portal4gadgets.include.HttpParam");var I=b$.require("packages.portal4gadgets.include.HttpParams");var au=b$.require("packages.portal4gadgets.include.Include");var F=b$.require("packages.portal4gadgets.include.Includes");var E=b$.require("portal.models.item.StringDataType");var D=b$.require("portal.models.item.Preference");var V=b$.require("portal.models.item.Preferences");var p=b$.require("portal.widget.Resource");var aD=b$.require("portal.widget.StylesheetResource");var ai=b$.require("portal.widget.ScriptResource");var h=b$.require("portal.widget.Resources");var ap=b$.require("portal.widget.IWidgetTerminationAcceptor");var s=b$.require("portal.widget.Widget");var aC=b$.require("portal.widget.UserPreferenceField");var u=b$.require("portal.widget.UserPreferencesForm");var ae="http://www.w3.org/1999/xhtml";var o="http://www.backbase.com/2006/tdl";var b="http://www.backbase.com/2006/client";var Y="http://www.backbase.com/2008/gadget";var G=new d(N);var l=new d(H);var ag=new d(Z);var an=new J(ax);var B=/(application|text)\/(x-)?backbase\+xml/;var e=/(application|text)\/(x-)?backbase\+(xml|ssr)/;var ac=/(application|text)\/(x-)?backbase\+gadget\+xml/;var z=function(aE,aF){return function(){return this.namespaceURI==aE&&(this.localName||this.baseName)==aF}};var aB=E.extend();aB.prototype.test=function(aE){return typeof aE=="string"||aE instanceof String};aB.prototype.serializeToString=function(aE){W(arguments,[this]);return aE};aB.prototype.parseFromString=function(aE){W(arguments,[this]);return aE};aB.prototype.getCanonicalValue=function(aE){return""};var al=aw.extend(function(aF,aE){W(arguments,[ax,ax]);aw.call(this);this.value=aF;this.label=aE});al.prototype.getValue=function(){return this.value};al.prototype.getLabel=function(){return this.label};var K=aB.extend(function(aE){W(arguments,[Array]);if(aE.length&&!aE.every(function(aF){return aF instanceof al})){throw new w("Incorrect object provided as enumeration option.",arguments,0,Array)}aB.call(this);this.options=aE});K.prototype.getOptions=function(){return this.options};K.prototype.getCanonicalValue=function(){var aE=this.getOptions()[0];return aE?aE.getValue():""};var av=K.extend();av.prototype.getCanonicalValue=function(){return""};var t=K.extend(function(aG,aE,aH){W(arguments,[H,H,l]);if(aG>aE){throw new w("Incorrect range boundaries.",arguments,0,H)}aH=typeof aH=="number"?aH:1;var aI=[];for(var aF=aG;aF<=aE;aF+=aH){aI.push(new al(String(aF),String(aF)))}K.call(this,aI);this.min=aG;this.max=aE;this.step=aH});t.prototype.getMin=function(){return this.min};t.prototype.getMax=function(){return this.max};t.prototype.getStep=function(){return this.step};var ak={};ak.checkbox=aB;ak.hidden=aB;ak.readonly=aB;ak.password=aB;ak.radio=av;ak.range=t;ak["select-one"]=K;ak["select-multiple"]=K;ak["checkbox-multiple"]=K;ak.text=aB;ak.textarea=aB;var a=new k(function(aE){return aE instanceof f&&aE.type=="change"});var M=D.extend(function(aJ,aG,aI,aF,aH,aE){W(arguments,[ao,ao,ao,ao,ax,ag]);D.call(this,aJ,aG,aI,aF);this.editorHint=aH;this.changeHandler=aE||function(){}});M.prototype.getEditorHint=function(){return this.editorHint};M.prototype.dispatchChangeEvent=function(aE,aF){W(arguments,[s,a]);aF.target=aF.currentTarget=this;aF.eventPhase=2;this.changeHandler.call(aE,aF)};var A=V.extend(function(aF,aE){W(arguments,[ao,G]);V.call(this,aF);this.requireSubmit=aE==undefined?false:aE});A.prototype.isSubmitRequired=function(){return this.requireSubmit};var T=aw.extend(function(aE,aF){W(arguments,[i,y]);aw.call(this);this.widget=aE;this.perspective=aF});T.prototype.getContextVariableValue=function(aF){var aE=this.perspective.getParameters().getByName(aF);return aE&&aE.getValue()||""};T.prototype.getContextPreferenceValue=function(aE){return this.widget.getPreference(aE)};T.prototype.getContextURI=function(){return this.widget.getOriginURI()};T.prototype.getContextDocument=function(){return this.widget.getBody().getHTML().ownerDocument};ay.implementedBy(T);var r=aw.extend(function(aF,aE){aw.call(this);this.island=aF;this.bb=aE});r.prototype.getIslandXML=function(){var aF=this.island;var aE=[],aG=false;new aa(aF).each(function(aH){aE.push(aH.toString());aG=aG||aH.getPrefix()=="xmlns"},true);if(!aG){aE.push('xmlns="http://www.w3.org/1999/xhtml"')}if(aF.id){aE.push('id="'+aF.id+'"')}if(aF.className){aE.push('class="'+aF.className+'"')}if(aF.style.cssText){aE.push('style="'+aF.style.cssText+'"')}if(aF.getAttribute("xml:base")){aE.push('xml:base="'+aF.getAttribute("xml:base")+'"')}return new DOMParser().parseFromString('<client:fragment xmlns:client="http://www.backbase.com/2006/client" '+aE.join(" ")+">"+(aF.textContent||aF.text)+"</client:fragment>","application/xml")};r.prototype.build=function(aH){var aE=this.getIslandXML().documentElement,aG=this.island,aF=this.bb;this.bb.construct(aE,function(){var aL=aF.getControllerFromModel(aE);if(aG.getAttribute("fragment")=="true"){var aK=aL.getProperty("childNodes"),aI=0,aJ=null;while(aJ=aK[aI++]){aF.document.getProperty("documentElement").appendChild(aJ);if(aJ.viewNode){aG.parentNode.insertBefore(aJ.viewNode,aG)}}aG.parentNode.removeChild(aG)}else{aF.document.getProperty("documentElement").appendChild(aL);if(aL.viewNode){aG.parentNode.replaceChild(aL.viewNode,aG)}}aH()})};var aq=aw.extend(function(aF,aE){W(arguments,[h,Z]);aw.call(this);this.resources=aF;this.callback=aE});aq.prototype.isReady=function(){return !this.resources.getLength()||this.resources.every(function(aE){return aE.isReady()})};aq.prototype.track=function(){var aE=this;if(!this.isReady()){this.resources.each(function(aF){if(!aF.isReady()){aF.addObserver("ready",aE.readyStateChanged,aE)}})}else{this.callback()}};aq.prototype.readyStateChanged=function(aE){if(this.isReady()){aE.target.removeObserver("ready",this.readyStateChanged,this);this.callback()}};var C=aw.extend(function(aE,aF){W(arguments,[ad,Z]);aw.call(this);this.html=aE;this.callback=aF});C.prototype.constructBBIslands=function(){var aE=this;var aF=jQuery(this.html).find("script").filter(function(){return ac.test(this.getAttribute("type"))}).map(function(){return new r(this,aE.getBBObject())}).get();if(aF.length){(function(){var aG=aF.shift();if(aG){aG.build(arguments.callee)}else{aE.callback()}})()}else{this.callback()}};C.prototype.getBBObject=function(){var aE=this.html.ownerDocument;return(aE.defaultView||aE.parentWindow).bb};C.prototype.resolve=function(){var aE=this,aF=this.getBBObject();if(aF&&aF.version){if(!aF.document){var aG=setInterval(function(){if(aF.document){clearInterval(aG);aE.constructBBIslands()}},50)}else{this.constructBBIslands()}}else{this.callback()}};var am=x.extend(function(aF,aE){W(arguments,[ad,F]);x.call(this);this.html=aF;this.includes=aE});am.prototype.getHTML=function(){return this.html};am.prototype.getIncludes=function(){return this.includes};am.prototype.refresh=function(aE){W(arguments,[ay]);this.includes.each(function(aF){aF.refresh(aE)})};var i=s.extend(function(aN,aK,aG,aH,aI,aL,aJ,aF,aE,aM){W(arguments,[ao,ao,ao,V,ao,ao,ax,am]);s.call(this,aN,aK,aG,aH,aI,aL,aE);this.title=this.getPreference("Title")||aM||"";this.icon=null;this.widgetBody=aF;this.body=aF.getHTML();this.listeners={};this.loaded=false;this.terminated=false;this.src=aJ;this.addObserver("PrefModified",function(aP){if(aP.attrName=="Title"){this.setTitle(aP.newValue)}if(!this.terminated&&this.loaded){var aO=new P();aO.initMutationEvent("preferenceModified",true,false,null,aP.prevValue,aP.newValue,aP.attrName);this.dispatchEvent(aO)}},this)});i.prototype.getOriginURI=function(){return this.src};i.prototype.getBody=function(){return this.widgetBody};i.prototype.getIcon=function(){return this.icon};i.prototype.setIcon=function(aF){W(arguments,[an]);var aE=this.icon;this.icon=aF;this.notifyObservers(new j("icon",aF,aE))};i.prototype.getTitle=function(){return this.title};i.prototype.setTitle=function(aE){W(arguments,[ax]);var aF=this.title;this.title=aE;this.notifyObservers(new j("title",aE,aF))};i.prototype.addEventListener=function(aG,aE){W(arguments,[ax,Z]);var aF=this.listeners[aG]||[];aF.push(aE);this.listeners[aG]=aF};i.prototype.removeEventListener=function(aH,aE){W(arguments,[ax,Z]);var aG=this.listeners[aH]||[],aF=-1;if(aG.length){while((aF=aG.indexOf(aE))!=-1){aG.splice(aF,1)}}};i.prototype.dispatchEvent=function(aF){W(arguments,[m]);var aE=this;aF.target=aF.currentTarget=this;aF.eventPhase=2;(this.listeners[aF.type]||[]).forEach(function(aG){try{aG.call(aE,aF)}catch(aH){if(console&&console.log){console.log("Error",aE,aH)}aE.body.innerHTML="<h3>Widget is broken. Please contact the web site administrator.</h3>"}})};i.prototype.run=function(){var aF=new f();aF.initCustomEvent("beforeload",false,false,null);this.dispatchEvent(aF);var aG=this.getBody(),aE=this;new aq(this.getResources(),function(){new C(aG.getHTML(),function(){if(!aE.terminated&&!aE.loaded){aE.loaded=true;var aH=new f();aH.initCustomEvent("load",false,false,null);aE.dispatchEvent(aH)}}).resolve()}).track()};i.prototype.tryToTerminate=function(aF){W(arguments,[ap]);var aE=new f();aE.initCustomEvent("beforeunload",false,true,null);this.dispatchEvent(aE);if(aE.defaultPrevented){aF.handleWidgetTerminationAborted(this)}else{s.prototype.tryToTerminate.call(this,aF)}};i.prototype.terminate=function(){var aE=new f();aE.initCustomEvent("unload",false,false,null);this.dispatchEvent(aE);this.terminated=true};i.prototype.refresh=function(){};var c=aC.extend(function(aE){W(arguments,[M]);if(!(aE.getDataType() instanceof aB)){throw new w("Preference data type should be instance of DataType.",arguments,0,M)}aC.call(this,aE)});var az=c.extend();az.prototype.containsTrueValue=function(){return this.getValue()=="true"||this.getValue()=="on"};az.prototype.getTrueValue=function(){return"true"};var U=c.extend();U.prototype.setValue=function(aE){throw new w("Can't change the value of the read only field.",arguments,0,ax)};var ab=c.extend();var L=c.extend();var ah=c.extend();var R=c.extend(function(aE){if(aE instanceof D&&!(aE.getDataType() instanceof K)){throw new w("Wrong type of passed preference.",arguments,0,D)}c.call(this,aE)});var S=R.extend();var at=R.extend();var g=R.extend();g.prototype.getValues=function(){return typeof this.value=="string"&&this.value&&this.value.split(",")||[]};g.prototype.setValues=function(aE){W(arguments,[Array]);this.setValue(aE.join(","))};var aj=g.extend();var v=g.extend();var Q={};Q.checkbox=az;Q.readonly=U;Q.password=ab;Q.text=L;Q.textarea=ah;Q["select-multiple"]=aj;Q["checkbox-multiple"]=v;Q["select-one"]=S;Q.range=S;Q.radio=at;var q=u.extend(function(aE,aF){u.call(this,aE,aF)});q.prototype.createFieldFromUserPreference=function(aE){if(aE instanceof M){if(aE.getEditorHint()!="hidden"){return new (Q[aE.getEditorHint()]||L)(aE)}else{return null}}else{if(aE.getViewHint()&&aE.getViewHint()!="hidden"){return new aC(aE)}else{return null}}};q.prototype.apply=function(){var aF=this.hasChanges();u.prototype.apply.call(this);if(aF){var aE=new f();aE.initCustomEvent("change",false,false,null);this.widget.dispatchEvent(aE)}};q.prototype.applyField=function(aG){var aE=aG.isChanged(),aF=null;u.prototype.applyField.call(this,aG);if(aE){aF=new f();aF.initCustomEvent("change",false,false,null);if(aG.getPreference() instanceof M){aG.getPreference().dispatchChangeEvent(this.widget,aF)}if(!this.isSubmitRequired()){aF=new f();aF.initCustomEvent("change",false,false,null);this.widget.dispatchEvent(aF)}}};var aA=x.extend(function(aF,aE){x.call(this);this.src=aF;this.definition=aE;this.resources=null});aA.CSS_IMPORT_REGEXP=/@import\s+(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)")/gm;aA.CSS_URL_REGEXP=/url\(\s*(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)"|((?:[^\\\)]|\\.)*))\s*\)/gm;aA.CSS_ESCAPE_REGEXP=/\\([^\n\r\f0-9a-fA-F])|\\([0-9a-fA-F]{1,6})(?:\r\n|[ \n\r\t\f])?/g;aA.unescapeCSSLiteral=function(aE){return aE.replace(aA.CSS_ESCAPE_REGEXP,function(aG,aF,aH){return aF||String.fromCharCode(parseInt(aH,16))})};aA.resolveUrlsInCSS=function(aF,aE){return aF.replace(aA.CSS_URL_REGEXP,function(aI,aG,aJ,aH){return"url('"+X.resolve(aA.unescapeCSSLiteral(aG||aJ||aH),aE).replace(/'/g,"\\'")+"')"}).replace(aA.CSS_IMPORT_REGEXP,function(aH,aG,aI){return"@import '"+X.resolve(aA.unescapeCSSLiteral(aG||aI),aE).replace(/'/g,"\\'")+"'"})};aA.prototype.createWidget=function(aG,aI,aF,aK){var aE=new i(aG,aI,aF,this.getPreferencesFromDefinition(),true,this.getResourcesFromDefinition(),this.src,new am(this.getHTMLBodyFromDefinition(aF),this.getIncludesFromDefinition()),aK,this.getTitleFromDefinition());aE.setIcon(this.getIconFromDefinition());var aJ=this.getEventListenersFromDefinition();for(var aH in aJ){if(aJ.hasOwnProperty(aH)){aE.addEventListener(aH,aJ[aH])}}return aE};aA.prototype.getTitleFromDefinition=function(){return jQuery(this.definition).children().filter(z(ae,"head")).find("*").filter(z(ae,"title")).contents().map(function(){return this.xml||new XMLSerializer().serializeToString(this)}).get().join("")};aA.prototype.getIconFromDefinition=function(){var aE=jQuery(this.definition).children().filter(z(ae,"head")).find("*").filter(function(){return this.namespaceURI==ae&&(this.localName||this.baseName)=="link"&&this.getAttribute("rel")=="icon"});return aE.length?X.resolve(aE.attr("href")||"",this.src):null};aA.prototype.createEventHandlerFromString=function(aE){return new Function("event",aE.replace(/__GADGET__/gm,"this"))};aA.prototype.getEventListenersFromDefinition=function(){var aG=jQuery(this.definition).children().filter(z(ae,"body")).get()[0],aF={},aJ=false;if(!aG){aG=jQuery(this.definition).get(0);aJ=true}if(aG){for(var aH=0,aI,aE;aI=aG.attributes[aH];aH++){aE=aI.localName||aI.baseName;if(aI.namespaceURI=="http://www.backbase.com/2008/gadget"&&aE.substr(0,2)=="on"){try{aF[aE.substr(2)]=this.createEventHandlerFromString(aI.nodeValue)}catch(aK){}}else{if(aJ&&aE.substr(0,4)=="g:on"){try{aF[aE.substr(4)]=this.createEventHandlerFromString(aI.nodeValue)}catch(aK){}}}}}else{}return aF};aA.prototype.getPreferencesFromDefinition=function(){var aE=this,aF=jQuery(this.definition),aH=z(Y,"preference"),aG=aF.children().filter(z(ae,"head")).find("*").filter(z(Y,"preferences"));return new A(aG.children().map(function(){if(!aH.apply(this,arguments)){}var aO=this.getAttribute("type"),aJ=this.getAttribute("default"),aN=this.getAttribute("name"),aM=this.getAttribute("label")||aN,aI=this.getAttribute("onchange")||"",aK=ak[aO],aL=null;if(!aK){}if(aO=="range"){aL=new aK(Number(this.getAttribute("min")),Number(this.getAttribute("max")),Number(this.getAttribute("step"))||undefined)}else{if(aO=="select-one"||aO=="select-multiple"||aO=="checkbox-multiple"||aO=="radio"){aL=new aK(jQuery(this).children().filter(z(Y,"enumeration")).map(function(){var aP=this.getAttribute("value")||this.textContent||this.text;return new al(aP,this.getAttribute("label")||aP)}).get())}else{aL=new aK()}}return new M(aN,aM,aJ?aL.parseFromString(aJ):aL.getCanonicalValue(),aL,aO,aI?aE.createEventHandlerFromString(aI):undefined)}).get(),aG.attr("requireSubmit")=="true")};aA.prototype.getResourcesFromDefinition=function(){if(!this.resources){var aE=jQuery(this.definition).children().filter(z(ae,"head")).find("*"),aF=jQuery(this.definition).children().filter(z(ae,"body")).find("*"),aH=new h(),aG=this.src;aE.filter(z(ae,"link")).each(function(){var aK=this.getAttribute("href"),aI=this.getAttribute("rel"),aJ=this.getAttribute("type")||"text/css";if(aI=="stylesheet"&&aJ=="text/css"&&!/standalone\.css$/.test(aK)){aH.add(new aD("external",aJ,X.resolve(aK,aG)))}});aE.filter(z(ae,"script")).each(function(){var aI=this.getAttribute("src"),aK=this.textContent||this.text,aJ=this.getAttribute("type")||"text/javascript";if(aI&&!/standalone\.js$/.test(aI)){aH.add(new ai("external",aJ,X.resolve(aI,aG)))}else{if(!aI&&aK){aH.add(new ai("inline",aJ,aK))}}});aE.filter(z(ae,"style")).each(function(){var aI=this.textContent||this.text;if(aI){aH.add(new aD("inline",this.getAttribute("type")||"text/css",aA.resolveUrlsInCSS(aI,aG)))}});aF.filter(z(o,"tdl")).each(function(){var aJ=jQuery(this),aI=aJ.parents().filter(z(ae,"script")).attr("type")||"text/javascript",aK=new XMLSerializer();if(B.test(aI)){aH.add(new ai("inline",aI,this.xml||aK.serializeToString(this)))}});this.resources=aH}return this.resources};aA.prototype.getIncludesFromDefinition=function(){var aG=jQuery(this.definition).children().filter(z(ae,"body")).find("*").filter(z(Y,"include"));var aE=this;function aF(aJ){var aH=aE.getPreferencesFromDefinition();var aI=aJ.match(/\$\{(.*?)\}/g)||[];aI.forEach(function(aK){var aN=aK.replace("${","").replace("}","");var aL=aH.getByName(aN);var aM="";if(aL){aM=aL.getDataType().serializeToString(aL.getValue())}aJ=aJ.replace(aK,aM)});return aJ}return new F(aG.map(function(){return new au(this.getAttribute("src")?aF(this.getAttribute("src")):"",(this.getAttribute("method")||"GET").toUpperCase(),(this.getAttribute("proxy")||"").toLowerCase()=="true",new I(jQuery(this).children().filter(function(){return this.namespaceURI==Y&&/^(http-(proxy-|preference-)?)param$/.test(this.localName||this.baseName)}).map(function(){var aH=this.localName||this.baseName;if(aH=="http-preference-param"){return new af(this.getAttribute("name"),"target",(this.getAttribute("method")||"GET").toUpperCase())}else{return new n(this.getAttribute("name"),this.getAttribute("value"),aH=="http-proxy-param"?"proxy":"target",(this.getAttribute("method")||"GET").toUpperCase())}}).get()))}).get())};aA.prototype.getHTMLBodyFromDefinition=function(aI){var aJ=jQuery(this.definition.cloneNode(true)),aH=aJ.children().filter(z(ae,"body")),aL=new XMLSerializer(),aN=this.src,aE=false;if(aH.length==0){aH=jQuery(this.definition).parents("body").find("#"+aI+" .bd-widgetBody");aE=true}if(aH.length==0){aH=jQuery(this.definition).find(".bd-widgetBody").clone().removeAttr("id")}aH.find("*").each(function(){var aT=this.localName||this.baseName,aR=this.namespaceURI,aU="",aQ="";if(aR==ae&&/^(a|area|img|input|iframe|form)$/.test(aT)){aU=/^(a|area)$/.test(aT)?"href":(/^(img|input|iframe)$/.test(aT)?"src":"action");aQ=this.getAttribute(aU);if(aQ){if(aT=="iframe"&&jQuery.browser.mozilla){var aS=this.ownerDocument.createElement("dummy");this.parentNode.replaceChild(aS,this);this.setAttribute(aU,X.resolve(aQ,aN));aS.parentNode.replaceChild(this,aS)}else{this.setAttribute(aU,X.resolve(aQ,aN))}}}else{if(aR==ae&&aT=="script"){var aV=this.getAttribute("type");if(e.test(aV)){this.setAttribute("xml:base",aN);this.setAttribute("type",aV.replace("backbase","backbase+gadget"));new aa(this).flatten();jQuery(this).find("*").filter(z(o,"tdl")).remove()}else{}}else{if(aR==Y&&aT=="include"){var aP=this.ownerDocument.createElement("div");aP.setAttribute("class","portal-include");jQuery(this).replaceWith(aP)}}}});var aF=document.createElement("div"),aM=aJ.attr("style")||"",aO=aH.attr("style")||"",aK=aJ.attr("class")||"",aG=aH.attr("class")||"";aF.innerHTML=("x<div"+((aM||aO)?' style="'+(aM&&aM+"; ")+aO+'"':"")+((aK||aG)?' class="'+(aK&&aK+" ")+aG+'"':"")+">"+aH.contents().map(function(){return(this.xml||aL.serializeToString(this)).replace(/<([\w:]+)([^>]*)\/>/gi,"<$1$2></$1>")}).get().join("")+"</div>");return aE?aH.get(0)||aF.lastChild:aF.lastChild};this.EnumerationOption=al;this.EnumerationDataType=K;this.EnumerationOptionalDataType=av;this.RangeDataType=t;this.DataType=aB;this.Preference=M;this.Preferences=A;this.WidgetIncludeContextProvider=T;this.WidgetBody=am;this.Widget=i;this.UserPreferenceField=c;this.CheckboxField=az;this.ReadonlyField=U;this.PasswordField=ab;this.TextField=L;this.TextareaField=ah;this.EnumerationField=R;this.MultipleSelectField=g;this.MultipleSelectDropdownField=aj;this.MultipleSelectCheckboxField=v;this.SingleSelectDropdownField=S;this.SingleSelectRadioField=at;this.UserPreferencesForm=q;this.WidgetFactory=aA});b$.module("packages.portal4gadgets.views.include",function(){var b=b$.require("b$.testArguments");var d=b$.require("b$.mvc.View");var c=b$.require("packages.portal4gadgets.include.Include");var a=d.extend(function(f,e){b(arguments,[c]);d.call(this,f,e)});a.prototype.createHTML=function(f){var g=jQuery('<div class="portal-include"></div>',f);var e=this.model.getContentIterator();while(e.hasNext()){g.append(e.next())}return g.get()[0]};this.Include=a});b$.module("packages.portal4gadgets.views.widget",function(){var b=b$.require("b$.testArguments");var x=b$.require("b$.mvc.View");var w=b$.require("b$.mvc.ViewCache");var t=b$.require("b$.mvc.SimpleViewFactory");var r=b$.require("packages.portal4gadgets.include.Include");var G=b$.require("packages.portal4gadgets.widget.WidgetIncludeContextProvider");var a=b$.require("packages.portal4gadgets.widget.WidgetBody");var i=b$.require("packages.portal4gadgets.widget.Widget");var g=b$.require("packages.portal4gadgets.widget.CheckboxField");var l=b$.require("packages.portal4gadgets.widget.ReadonlyField");var o=b$.require("packages.portal4gadgets.widget.PasswordField");var v=b$.require("packages.portal4gadgets.widget.TextField");var F=b$.require("packages.portal4gadgets.widget.TextareaField");var c=b$.require("packages.portal4gadgets.widget.MultipleSelectDropdownField");var u=b$.require("packages.portal4gadgets.widget.MultipleSelectCheckboxField");var n=b$.require("packages.portal4gadgets.widget.SingleSelectDropdownField");var h=b$.require("packages.portal4gadgets.widget.SingleSelectRadioField");var k=b$.require("packages.portal4gadgets.views.include.Include");var s=b$.require("portal.views.widget.UserPreferenceField");var y=b$.require("portal.views.widget.WidgetTitle");var q=b$.require("portal.views.widget.Widget");var B=s.extend(function(I,H){b(arguments,[g]);s.call(this,I,H)});B.prototype.createFieldHTML=function(H){var I=this.model,K=I.getPreference().getName(),M=I.getTrueValue(),L=I.containsTrueValue(),J=this.createUserInputElement(H);return J.addClass("portal-userPreferenceField-field").attr("id",this.id).attr("name",K).val(M).attr("checked",L).click(function(){if(I.containsTrueValue()&&!this.checked){I.setValue("")}else{if(!I.containsTrueValue()&&this.checked){I.setValue(this.value)}}})};B.prototype.createUserInputElement=function(H){return jQuery('<input type="checkbox" />',H)};B.prototype.update=function(H,I){if(I==this.model&&H=="value"){jQuery(this.html).find(".portal-userPreferenceField-field").get()[0].checked=I.containsTrueValue()}else{s.prototype.update.call(this,H,I)}};var j=s.extend(function(I,H){b(arguments,[l]);s.call(this,I,H)});j.prototype.createUserInputElement=function(H){return jQuery(s.prototype.createUserInputElement.call(this,H)).attr("disabled","disabled")};var A=s.extend(function(I,H){b(arguments,[o]);s.call(this,I,H)});A.prototype.createUserInputElement=function(H){return jQuery('<input type="password" />',H)};var E=s.extend(function(I,H){b(arguments,[v]);s.call(this,I,H)});var C=s.extend(function(I,H){b(arguments,[F]);s.call(this,I,H)});C.prototype.createUserInputElement=function(H){return jQuery("<textarea></textarea>",H)};var m=s.extend(function(I,H){b(arguments,[n]);s.call(this,I,H)});m.prototype.createFieldHTML=function(I){var J=this.model,K=J.getPreference().getName(),H=this.createUserInputElement(I).addClass("portal-userPreferenceField-field").attr("id",this.id).attr("name",K);H.find("option").each(function(){this.selected=J.getValue()==this.value});H.change(function(){J.setValue(jQuery(this).find("option").filter(function(){return this.selected}).map(function(){return this.value}).get()[0]||"")});return H};m.prototype.createUserInputElement=function(H){var I=jQuery("<select></select>",H);this.model.getPreference().getDataType().getOptions().forEach(function(J){I.append(jQuery("<option></option>").attr("value",J.getValue()).text(J.getLabel()))});return I};m.prototype.update=function(H,J){var I=this.model;if(J==this.model&&H=="value"){jQuery(this.html).find(".portal-userPreferenceField-field > option").each(function(){this.selected=I.getValue()==this.value})}else{s.prototype.update.call(this,H,J)}};var f=s.extend(function(I,H){b(arguments,[h]);s.call(this,I,H)});f.prototype.createHTML=function(H){var I=s.prototype.createHTML.call(this,H);jQuery(I).find(".portal-userPreferenceField-label").click(function(){jQuery(I).find(".portal-userPreferenceField-field input").first().focus()});return I};f.prototype.createFieldHTML=function(I){var J=this.model,H=this.createUserInputElement(I).addClass("portal-userPreferenceField-field");H.find("input").each(function(){this.setAttribute("name",J.getPreference().getName());this.checked=J.getValue()==this.value}).click(function(){J.setValue(H.find("input").filter(function(){return this.checked}).map(function(){return this.value}).get()[0]||"")});return H};f.prototype.createUserInputElement=function(I){var J=jQuery("<div></div>",I),H=this.id;this.model.getPreference().getDataType().getOptions().forEach(function(L){var K=jQuery('<div><input type="radio"><label></label></div>');K.find("input").attr("value",L.getValue()).attr("id",H+"-"+L.getValue());K.find("label").text(L.getLabel()).attr("for",H+"-"+L.getValue());J.append(K)});return J};f.prototype.update=function(H,J){var I=this.model;if(J==this.model&&H=="value"){jQuery(this.html).find(".portal-userPreferenceField-field input").each(function(){this.checked=I.getValue()==this.value})}else{s.prototype.update.call(this,H,J)}};var e=s.extend(function(I,H){b(arguments,[c]);s.call(this,I,H)});e.prototype.createFieldHTML=function(J){var K=this.model,H=K.getValues(),L=K.getPreference().getName(),I=this.createUserInputElement(J).addClass("portal-userPreferenceField-field").attr("name",L).attr("id",this.id);I.find("option").each(function(){this.selected=H.indexOf(this.value)!=-1});I.change(function(){K.setValues(jQuery(this).find("option").filter(function(){return this.selected}).map(function(){return this.value}).get())});return I};e.prototype.createUserInputElement=function(H){var I=jQuery('<select multiple="multiple"></select>',H);this.model.getPreference().getDataType().getOptions().forEach(function(J){I.append(jQuery("<option></option>").attr("value",J.getValue()).text(J.getLabel()))});return I};e.prototype.update=function(I,K){var J=this.model;if(K==this.model&&I=="value"){var H=J.getValues();jQuery(this.html).find(".portal-userPreferenceField-field > option").each(function(){this.selected=H.indexOf(this.value)!=-1})}else{s.prototype.update.call(this,I,K)}};var D=s.extend(function(I,H){b(arguments,[u]);s.call(this,I,H)});D.prototype.createHTML=function(H){var I=s.prototype.createHTML.call(this,H);jQuery(I).find(".portal-userPreferenceField-label").click(function(){jQuery(I).find(".portal-userPreferenceField-field input").first().focus()});return I};D.prototype.createFieldHTML=function(J){var K=this.model,H=K.getValues(),I=this.createUserInputElement(J).addClass("portal-userPreferenceField-field");I.find("input").each(function(){this.setAttribute("name",K.getPreference().getName());this.checked=H.indexOf(this.value)!=-1}).click(function(){K.setValues(I.find("input").filter(function(){return this.checked}).map(function(){return this.value}).get())});return I};D.prototype.createUserInputElement=function(I){var J=jQuery("<div></div>",I),H=this.id;this.model.getPreference().getDataType().getOptions().forEach(function(L){var K=jQuery('<div><input type="checkbox"><label></label></div>');K.find("input").attr("value",L.getValue()).attr("id",H+"-"+L.getValue());K.find("label").text(L.getLabel()).attr("for",H+"-"+L.getValue());J.append(K)});return J};D.prototype.update=function(I,K){var J=this.model;if(K==this.model&&I=="value"){var H=J.getValues();jQuery(this.html).find(".portal-userPreferenceField-field input").each(function(){this.checked=H.indexOf(this.value)!=-1})}else{s.prototype.update.call(this,I,K)}};var z=y.extend(function(I,H){b(arguments,[i]);y.call(this,I,H)});z.prototype.createHTML=function(I){var J=jQuery(y.prototype.createHTML.call(this,I));var H=jQuery('<div class="portal-widget-title-icon"></div>',I);if(this.model.getIcon()!==null){H.css("background-image","url("+this.model.getIcon()+")")}else{H.css("display","none")}J.prepend(H);return J.get()[0]};var p=x.extend(function(I,H){b(arguments,[a]);x.call(this,I,H);this.includes=new w(new t(r,k))});p.prototype.createHTML=function(I){var L=this.model.getHTML();this.includes.updateViews(this.model.getIncludes().getIterator());var K=this.includes.getViews();var M=jQuery(L).find(".portal-include");var N=0;while(K.hasNext()){var H=K.next();var J=H.createHTML(I);M.eq(N++).replaceWith(J);H.model.addObserver("*",this.update,this)}return L};p.prototype.update=function(H,I){if(H=="content"){x.prototype.update.call(this,H,I)}};var d=q.extend(function(J,H,I){q.call(this,J,H,I);this.body=new p(J.getBody(),I)});d.prototype.createTitleView=function(){return new z(this.model)};d.prototype.createItemHTML=function(H){var I=q.prototype.createItemHTML.call(this,H);I.appendChild(this.body.getHTML(H));I.className+=" perspective-"+this.perspectiveProvider.getCurrentPerspective().getType().getName();this.model.getBody().refresh(new G(this.model,this.perspectiveProvider.getCurrentPerspective()));return I};d.prototype.update=function(I,H){var J=this.perspectiveProvider.getCurrentPerspective();if(H==this.perspectiveProvider&&I=="PropertyModified"){this.html.className=this.html.className.replace(/perspective-[\w\d]+(?:\.[\w\d]+)?/,"perspective-"+J.getType().getName());this.model.getBody().refresh(new G(this.model,J))}};this.CheckboxField=B;this.ReadonlyField=j;this.PasswordField=A;this.TextField=E;this.TextareaField=C;this.MultipleSelectDropdownField=e;this.MultipleSelectCheckboxField=D;this.SingleSelectDropdownField=m;this.SingleSelectRadioField=f;this.WidgetTitle=z;this.Widget=d});b$.module("packages.portal4gadgets",function(){var a=b$.require("b$.Class");var n=b$.require("b$.Interface");var y=b$.require("b$.Exception");var i=b$.require("b$.testArguments");var c=b$.require("b$.types.FUNCTION");var p=b$.require("b$.mvc.ViewRegistry");var B=b$.require("b$.uri.URI");var h=b$.require("packages.portal4gadgets.widget.Widget");var k=b$.require("packages.portal4gadgets.widget.WidgetFactory");var F=b$.require("portal.mappings.xml.CustomWidgetHandler");var l=b$.require("packages.portal4gadgets.views.widget.Widget");var D=b$.require("portal.WidgetTypePackage");var b=b$.require("portal.widget.UserPreferenceField");var f=b$.require("packages.portal4gadgets.widget.CheckboxField");var z=b$.require("packages.portal4gadgets.widget.ReadonlyField");var E=b$.require("packages.portal4gadgets.widget.PasswordField");var H=b$.require("packages.portal4gadgets.widget.TextField");var q=b$.require("packages.portal4gadgets.widget.TextareaField");var A=b$.require("packages.portal4gadgets.widget.MultipleSelectDropdownField");var x=b$.require("packages.portal4gadgets.widget.MultipleSelectCheckboxField");var d=b$.require("packages.portal4gadgets.widget.SingleSelectDropdownField");var e=b$.require("packages.portal4gadgets.widget.SingleSelectRadioField");var s=b$.require("portal.views.widget.UserPreferenceField");var w=b$.require("packages.portal4gadgets.views.widget.CheckboxField");var L=b$.require("packages.portal4gadgets.views.widget.ReadonlyField");var K=b$.require("packages.portal4gadgets.views.widget.PasswordField");var r=b$.require("packages.portal4gadgets.views.widget.TextField");var v=b$.require("packages.portal4gadgets.views.widget.TextareaField");var C=b$.require("packages.portal4gadgets.views.widget.MultipleSelectDropdownField");var j=b$.require("packages.portal4gadgets.views.widget.MultipleSelectCheckboxField");var I=b$.require("packages.portal4gadgets.views.widget.SingleSelectDropdownField");var t=b$.require("packages.portal4gadgets.views.widget.SingleSelectRadioField");var g=b$.require("b$.browser");var m=new n({handleDefinitionBuildResult:c});var o=a.extend(function(N,M){a.call(this);this.url=N;this.widgetName=M;this.listeners=[]});o.prototype.addResultListener=function(M){i(arguments,[m]);this.listeners.push(M)};o.prototype.build=function(Q){var M=$("#"+this.widgetName),R=this.listeners,N=this.url,O;if(M.length){O=new k(N,M.get(0));Q.acceptBuildResult(O);R.forEach(function(S){S.handleDefinitionBuildResult(O)})}else{var P=new XMLHttpRequest();P.onreadystatechange=function(){if(this.readyState==4){if(this.status==200){var T=this.responseText,S;if(g.ie&&g.version==9){T=T.replace('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',"");S=new ActiveXObject("Microsoft.XMLDOM");S.async="false";S.loadXML(T)}else{S=new DOMParser().parseFromString(T,"application/xml")}O=new k(N,S.documentElement);Q.acceptBuildResult(O);R.forEach(function(V){V.handleDefinitionBuildResult(O)})}else{if(this.status==404){var U='<html xmlns="http://www.w3.org/1999/xhtml"><body><h2>Cannot load widget</h2></body></html>';S=new DOMParser().parseFromString(U,"application/xml");O=new k(N,S.documentElement);Q.acceptBuildResult(O)}else{Q.acceptBuildError(new y("Can't load data."))}}}};P.open("GET",N);P.send()}};var u=F.extend(function(){F.call(this,"bb4");this.factories={};this.builders={}});u.prototype.createModelBuilder=function(M,T,Q,O,N,S){var R=this.factories;var P=this.builders;return{build:function(X){var V=Q.getByName("src");function U(Y){oWidget=Y.createWidget(N,T,M,S);Q.each(function(Z){if(oWidget.getPreferences().getByName(Z.getName())){oWidget.setPreference(Z.getName(),Z.getValue())}else{oWidget.addPreference(Z.getName(),Z.getLabel(),Z.getValue(),Z.getDataType(),Z.getViewHint())}});X.acceptBuildResult(oWidget)}if(V){var W=new B(V.getValue()).resolve(new B(portal.config.resourceRoot)).toString();if(R[W]){U(R[W])}else{if(P[W]){P[W].addResultListener({handleDefinitionBuildResult:function(Y){U(Y)}})}else{P[W]=new o(W,M);P[W].build({acceptBuildResult:function(Y){delete P[W];R[W]=Y;U(Y)},acceptBuildError:function(Y){delete P[W];X.acceptBuildError(Y)}})}}}else{X.acceptBuildError(new y("No URL property on the gadget instance in data."))}}}};var G=D.extend(function(){D.call(this,new u(),[h,l])});var J=p.extend(function(N){var M=new p(N);M.registerView(f,w);M.registerView(z,L);M.registerView(E,K);M.registerView(H,r);M.registerView(q,v);M.registerView(x,j);M.registerView(A,C);M.registerView(d,I);M.registerView(e,t);M.registerView(b,s);p.call(this,M)});this.Portal4GadgetsViewRegistry=J;this.Portal4GadgetsTypePackage=G;this.Portal4GadgetsWidgetHandler=u;this.WidgetDefinitionBuilder=o});
/*
 Underscore.js 1.2.3
 (c) 2009-2011 Jeremy Ashkenas, DocumentCloud Inc.
 Underscore is freely distributable under the MIT license.
 Portions of Underscore are inspired or borrowed from Prototype,
 Oliver Steele's Functional, and John Resig's Micro-Templating.
 For all details and documentation:
 http://documentcloud.github.com/underscore
 */
(function(){function V(b,n,m){if(b===n){return b!==0||1/b==1/n}if(b==null||n==null){return b===n}if(b._chain){b=b._wrapped}if(n._chain){n=n._wrapped}if(b.isEqual&&ah.isFunction(b.isEqual)){return b.isEqual(n)}if(n.isEqual&&ah.isFunction(n.isEqual)){return n.isEqual(b)}var l=ad.call(b);if(l!=ad.call(n)){return false}switch(l){case"[object String]":return b==String(n);case"[object Number]":return b!=+b?n!=+n:b==0?1/b==1/n:b==+n;case"[object Date]":case"[object Boolean]":return +b==+n;case"[object RegExp]":return b.source==n.source&&b.global==n.global&&b.multiline==n.multiline&&b.ignoreCase==n.ignoreCase}if(typeof b!="object"||typeof n!="object"){return false}for(var k=m.length;k--;){if(m[k]==b){return true}}m.push(b);var k=0,j=true;if(l=="[object Array]"){if(k=b.length,j=k==n.length){for(;k--;){if(!(j=k in b==k in n&&V(b[k],n[k],m))){break}}}}else{if("constructor" in b!="constructor" in n||b.constructor!=n.constructor){return false}for(var i in b){if(ac.call(b,i)&&(k++,!(j=ac.call(n,i)&&V(b[i],n[i],m)))){break}}if(j){for(i in n){if(ac.call(n,i)&&!k--){break}}j=!k}}m.pop();return j}var T=this,P=T._,aa={},ae=Array.prototype,Z=Object.prototype,ag=ae.slice,M=ae.concat,h=ae.unshift,ad=Z.toString,ac=Z.hasOwnProperty,N=ae.forEach,L=ae.map,g=ae.reduce,e=ae.reduceRight,c=ae.filter,Y=ae.every,X=ae.some,W=ae.indexOf,U=ae.lastIndexOf,Z=Array.isArray,f=Object.keys,R=Function.prototype.bind,ah=function(b){return new ab(b)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=ah}exports._=ah}else{typeof define==="function"&&define.amd?define("underscore",function(){return ah}):T._=ah}ah.VERSION="1.2.3";var af=ah.each=ah.forEach=function(j,m,i){if(j!=null){if(N&&j.forEach===N){j.forEach(m,i)}else{if(j.length===+j.length){for(var l=0,k=j.length;l<k;l++){if(l in j&&m.call(i,j[l],l,j)===aa){break}}}else{for(l in j){if(ac.call(j,l)&&m.call(i,j[l],l,j)===aa){break}}}}}};ah.map=function(j,l,i){var k=[];if(j==null){return k}if(L&&j.map===L){return j.map(l,i)}af(j,function(b,n,m){k[k.length]=l.call(i,b,n,m)});return k};ah.reduce=ah.foldl=ah.inject=function(b,l,k,j){var i=arguments.length>2;b==null&&(b=[]);if(g&&b.reduce===g){return j&&(l=ah.bind(l,j)),i?b.reduce(l,k):b.reduce(l)}af(b,function(n,m,o){i?k=l.call(j,k,n,m,o):(k=n,i=true)});if(!i){throw new TypeError("Reduce of empty array with no initial value")}return k};ah.reduceRight=ah.foldr=function(b,m,l,k){var j=arguments.length>2;b==null&&(b=[]);if(e&&b.reduceRight===e){return k&&(m=ah.bind(m,k)),j?b.reduceRight(m,l):b.reduceRight(m)}var i=ah.toArray(b).reverse();k&&!j&&(m=ah.bind(m,k));return j?ah.reduce(i,m,l,k):ah.reduce(i,m)};ah.find=ah.detect=function(j,l,i){var k;S(j,function(b,n,m){if(l.call(i,b,n,m)){return k=b,true}});return k};ah.filter=ah.select=function(j,l,i){var k=[];if(j==null){return k}if(c&&j.filter===c){return j.filter(l,i)}af(j,function(b,n,m){l.call(i,b,n,m)&&(k[k.length]=b)});return k};ah.reject=function(j,l,i){var k=[];if(j==null){return k}af(j,function(b,n,m){l.call(i,b,n,m)||(k[k.length]=b)});return k};ah.every=ah.all=function(j,l,i){var k=true;if(j==null){return k}if(Y&&j.every===Y){return j.every(l,i)}af(j,function(b,n,m){if(!(k=k&&l.call(i,b,n,m))){return aa}});return k};var S=ah.some=ah.any=function(b,k,j){k||(k=ah.identity);var i=false;if(b==null){return i}if(X&&b.some===X){return b.some(k,j)}af(b,function(m,l,n){if(i||(i=k.call(j,m,l,n))){return aa}});return !!i};ah.include=ah.contains=function(j,k){var i=false;if(j==null){return i}return W&&j.indexOf===W?j.indexOf(k)!=-1:i=S(j,function(b){return b===k})};ah.invoke=function(b,j){var i=ag.call(arguments,2);return ah.map(b,function(k){return(j.call?j||k:k[j]).apply(k,i)})};ah.pluck=function(b,i){return ah.map(b,function(j){return j[i]})};ah.max=function(b,k,j){if(!k&&ah.isArray(b)){return Math.max.apply(Math,b)}if(!k&&ah.isEmpty(b)){return -Infinity}var i={computed:-Infinity};af(b,function(m,l,n){l=k?k.call(j,m,l,n):m;l>=i.computed&&(i={value:m,computed:l})});return i.value};ah.min=function(b,k,j){if(!k&&ah.isArray(b)){return Math.min.apply(Math,b)}if(!k&&ah.isEmpty(b)){return Infinity}var i={computed:Infinity};af(b,function(m,l,n){l=k?k.call(j,m,l,n):m;l<i.computed&&(i={value:m,computed:l})});return i.value};ah.shuffle=function(j){var k=[],i;af(j,function(b,l){l==0?k[0]=b:(i=Math.floor(Math.random()*(l+1)),k[l]=k[i],k[i]=b)});return k};ah.sortBy=function(b,j,i){return ah.pluck(ah.map(b,function(l,k,m){return{value:l,criteria:j.call(i,l,k,m)}}).sort(function(l,n){var k=l.criteria,m=n.criteria;return k<m?-1:k>m?1:0}),"value")};ah.groupBy=function(b,k){var j={},i=ah.isFunction(k)?k:function(l){return l[k]};af(b,function(m,l){var n=i(m,l);(j[n]||(j[n]=[])).push(m)});return j};ah.sortedIndex=function(b,m,l){l||(l=ah.identity);for(var k=0,j=b.length;k<j;){var i=k+j>>1;l(b[i])<l(m)?k=i+1:j=i}return k};ah.toArray=function(b){return !b?[]:b.toArray?b.toArray():ah.isArray(b)?ag.call(b):ah.isArguments(b)?ag.call(b):ah.values(b)};ah.size=function(b){return ah.toArray(b).length};ah.first=ah.head=function(j,i,k){return i!=null&&!k?ag.call(j,0,i):j[0]};ah.initial=function(j,i,k){return ag.call(j,0,j.length-(i==null||k?1:i))};ah.last=function(j,i,k){return i!=null&&!k?ag.call(j,Math.max(j.length-i,0)):j[j.length-1]};ah.rest=ah.tail=function(j,i,k){return ag.call(j,i==null||k?1:i)};ah.compact=function(b){return ah.filter(b,function(i){return !!i})};ah.flatten=function(b,i){return ah.reduce(b,function(j,k){if(ah.isArray(k)){return j.concat(i?k:ah.flatten(k))}j[j.length]=k;return j},[])};ah.without=function(b){return ah.difference(b,ag.call(arguments,1))};ah.uniq=ah.unique=function(b,k,j){var j=j?ah.map(b,j):b,i=[];ah.reduce(j,function(n,m,l){if(0==l||(k===true?ah.last(n)!=m:!ah.include(n,m))){n[n.length]=m,i[i.length]=b[l]}return n},[]);return i};ah.union=function(){return ah.uniq(ah.flatten(arguments,true))};ah.intersection=ah.intersect=function(b){var i=ag.call(arguments,1);return ah.filter(ah.uniq(b),function(j){return ah.every(i,function(k){return ah.indexOf(k,j)>=0})})};ah.difference=function(b){var i=ah.flatten(ag.call(arguments,1));return ah.filter(b,function(j){return !ah.include(i,j)})};ah.zip=function(){for(var b=ag.call(arguments),k=ah.max(ah.pluck(b,"length")),j=Array(k),i=0;i<k;i++){j[i]=ah.pluck(b,""+i)}return j};ah.indexOf=function(b,k,j){if(b==null){return -1}var i;if(j){return j=ah.sortedIndex(b,k),b[j]===k?j:-1}if(W&&b.indexOf===W){return b.indexOf(k)}for(j=0,i=b.length;j<i;j++){if(j in b&&b[j]===k){return j}}return -1};ah.lastIndexOf=function(j,i){if(j==null){return -1}if(U&&j.lastIndexOf===U){return j.lastIndexOf(i)}for(var k=j.length;k--;){if(k in j&&j[k]===i){return k}}return -1};ah.range=function(j,i,n){arguments.length<=1&&(i=j||0,j=0);for(var n=arguments[2]||1,m=Math.max(Math.ceil((i-j)/n),0),l=0,k=Array(m);l<m;){k[l++]=j,j+=n}return k};var Q=function(){};ah.bind=function(b,k){var j,i;if(b.bind===R&&R){return R.apply(b,ag.call(arguments,1))}if(!ah.isFunction(b)){throw new TypeError}i=ag.call(arguments,2);return j=function(){if(!(this instanceof j)){return b.apply(k,i.concat(ag.call(arguments)))}Q.prototype=b.prototype;var l=new Q,m=b.apply(l,i.concat(ag.call(arguments)));return Object(m)===m?m:l}};ah.bindAll=function(b){var i=ag.call(arguments,1);i.length==0&&(i=ah.functions(b));af(i,function(j){b[j]=ah.bind(b[j],b)});return b};ah.memoize=function(b,j){var i={};j||(j=ah.identity);return function(){var k=j.apply(this,arguments);return ac.call(i,k)?i[k]:i[k]=b.apply(this,arguments)}};ah.delay=function(j,i){var k=ag.call(arguments,2);return setTimeout(function(){return j.apply(j,k)},i)};ah.defer=function(b){return ah.delay.apply(ah,[b,1].concat(ag.call(arguments,1)))};ah.throttle=function(b,p){var o,n,m,l,k,j=ah.debounce(function(){k=l=false},p);return function(){o=this;n=arguments;var i;m||(m=setTimeout(function(){m=null;k&&b.apply(o,n);j()},p));l?k=true:b.apply(o,n);j();l=true}};ah.debounce=function(j,i){var k;return function(){var l=this,b=arguments;clearTimeout(k);k=setTimeout(function(){k=null;j.apply(l,b)},i)}};ah.once=function(j){var i=false,k;return function(){if(i){return k}i=true;return k=j.apply(this,arguments)}};ah.wrap=function(j,i){return function(){var b=M.apply([j],arguments);return i.apply(this,b)}};ah.compose=function(){var b=arguments;return function(){for(var i=arguments,j=b.length-1;j>=0;j--){i=[b[j].apply(this,i)]}return i[0]}};ah.after=function(j,i){return j<=0?i():function(){if(--j<1){return i.apply(this,arguments)}}};ah.keys=f||function(j){if(j!==Object(j)){throw new TypeError("Invalid object")}var i=[],k;for(k in j){ac.call(j,k)&&(i[i.length]=k)}return i};ah.values=function(b){return ah.map(b,ah.identity)};ah.functions=ah.methods=function(b){var j=[],i;for(i in b){ah.isFunction(b[i])&&j.push(i)}return j.sort()};ah.extend=function(b){af(ag.call(arguments,1),function(i){for(var j in i){i[j]!==void 0&&(b[j]=i[j])}});return b};ah.defaults=function(b){af(ag.call(arguments,1),function(i){for(var j in i){b[j]==null&&(b[j]=i[j])}});return b};ah.clone=function(b){return !ah.isObject(b)?b:ah.isArray(b)?b.slice():ah.extend({},b)};ah.tap=function(j,i){i(j);return j};ah.isEqual=function(j,i){return V(j,i,[])};ah.isEmpty=function(b){if(ah.isArray(b)||ah.isString(b)){return b.length===0}for(var i in b){if(ac.call(b,i)){return false}}return true};ah.isElement=function(b){return !!(b&&b.nodeType==1)};ah.isArray=Z||function(b){return ad.call(b)=="[object Array]"};ah.isObject=function(b){return b===Object(b)};ah.isArguments=function(b){return ad.call(b)=="[object Arguments]"};if(!ah.isArguments(arguments)){ah.isArguments=function(b){return !(!b||!ac.call(b,"callee"))}}ah.isFunction=function(b){return ad.call(b)=="[object Function]"};ah.isString=function(b){return ad.call(b)=="[object String]"};ah.isNumber=function(b){return ad.call(b)=="[object Number]"};ah.isNaN=function(b){return b!==b};ah.isBoolean=function(b){return b===true||b===false||ad.call(b)=="[object Boolean]"};ah.isDate=function(b){return ad.call(b)=="[object Date]"};ah.isRegExp=function(b){return ad.call(b)=="[object RegExp]"};ah.isNull=function(b){return b===null};ah.isUndefined=function(b){return b===void 0};ah.noConflict=function(){T._=P;return this};ah.identity=function(b){return b};ah.times=function(j,i,l){for(var k=0;k<j;k++){i.call(l,k)}};ah.escape=function(b){return(""+b).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};ah.mixin=function(b){af(ah.functions(b),function(i){d(i,ah[i]=b[i])})};var a=0;ah.uniqueId=function(j){var i=a++;return j?j+i:i};ah.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};ah.template=function(b,k){var j=ah.templateSettings,j="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+b.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(j.escape,function(m,l){return"',_.escape("+l.replace(/\\'/g,"'")+"),'"}).replace(j.interpolate,function(m,l){return"',"+l.replace(/\\'/g,"'")+",'"}).replace(j.evaluate||null,function(m,l){return"');"+l.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj","_",j);return k?i(k,ah):function(l){return i.call(this,l,ah)}};var ab=function(b){this._wrapped=b};ah.prototype=ab.prototype;var O=function(b,i){return i?ah(b).chain():b},d=function(b,i){ab.prototype[b]=function(){var j=ag.call(arguments);h.call(j,this._wrapped);return O(i.apply(ah,j),this._chain)}};ah.mixin(ah);af("pop,push,reverse,shift,sort,splice,unshift".split(","),function(j){var i=ae[j];ab.prototype[j]=function(){i.apply(this._wrapped,arguments);return O(this._wrapped,this._chain)}});af(["concat","join","slice"],function(j){var i=ae[j];ab.prototype[j]=function(){return O(i.apply(this._wrapped,arguments),this._chain)}});ab.prototype.chain=function(){this._chain=true;return this};ab.prototype.value=function(){return this._wrapped}}).call(this);b$.module("portal.api",function(){var f=b$.require("b$.mvc.Model");var a=b$.require("portal.widget.Resource");var e=b$.require("b$.types.HTMLELEMENT");var n=b$.require("b$.TypeConstraintOptional");var i=b$.require("b$.types.STRING");var c=new n(i);var j=b$.require("b$.testArguments");var l=b$.require("b$.types.FUNCTION");var o=b$.require("packages.portal4gadgets.event.DOMEvent");var b=b$.require("packages.portal4gadgets.event.DOMCustomEvent");var g=b$.require("b$.mvc.MutationEvent");var m=b$.require("b$.mvc.CustomEvent");var k=b$.require("b$.mvc.Observable");var h=f.extend(function(q,s,p,r){f.call(this);this.widget=q;this.resources=s||new Resources();this.listeners={};this.src=p;this.html=r});h.prototype.getDefinition=function(){return this.html};h.prototype.getSrc=function(){return this.src};h.prototype.getResources=function(){return this.resources};h.prototype.getWidget=function(){return this.widget};h.prototype.setTitle=function(p){j(arguments,[i]);this.title=p};h.prototype.getHtml=function(){return this.html||null};h.prototype.getBubbleParent=function(){return this.getWidget().parent};h.prototype.setIcon=function(p){j(arguments,[c]);this.icon=p};h.prototype.addEventListener=function(r,p){j(arguments,[i,l]);var q=this.listeners[r]||[];q.push(p);this.listeners[r]=q};h.prototype.removeEventListener=function(s,p){j(arguments,[i,l]);var r=this.listeners[s]||[],q=-1;if(r.length){while((q=r.indexOf(p))!=-1){r.splice(q,1)}}};h.prototype.dispatchEvent=function(p){j(arguments,[o]);var q=this;p.target=p.currentTarget=this;p.eventPhase=2;(this.listeners[p.type]||[]).forEach(function(r){try{r.call(q,p)}catch(s){if(console&&console.log){console.log("Error",q,s)}}})};h.prototype.initPerspective=function(q,p){new d(this,q||{},p||null)};h.prototype.setPerspective=function(p){this.perspective=p};h.prototype.getPerspective=function(){return this.perspective||null};var d=function(q,s,p){this.setChrome(q);jQuery.extend(this,s,p);var r=this;portal.getPage().addObserver("PerspectiveModified",function(t){if(r.isTransitionAllowed()){if(t.target!==r.getChrome()){r.performTransition(r.defaultPerspective,true)}else{var u=new b();u.initCustomEvent(t.type,t.bubbles,t.cancelable,t.detail);r.getChrome().getWidget().dispatchEvent(u)}}});this.performTransition(this.defaultPerspective)};d.prototype.defaultPerspective="Dashboard";d.prototype.setChrome=function(p){this.chrome=p};d.prototype.getChrome=function(){return this.chrome||null};d.prototype.performTransition=function(q,p){};d.prototype.perspectiveTransition=null;d.prototype.isTransitionAllowed=function(){return true};this.Chrome=h;this.ChromePerspective=d});b$.module("portal.api",function(){var a=b$.require("packages.portal4gadgets.widget.WidgetFactory");var c=b$.require("portal.api.Chrome");var d=b$.require("b$.mvc.Model");var b=a.extend(function(f,g,e){a.call(this,f,g);this.widget=e});b.prototype.createChrome=function(){var e=new c(this.widget,this.getResourcesFromDefinition(),this.src,this.getHTMLBodyFromDefinition());e.setTitle(this.widget.getTitle?this.widget.getTitle():"");e.setIcon(this.widget.getIcon?this.widget.getIcon():null);var g=this.getEventListenersFromDefinition();for(var f in g){if(g.hasOwnProperty(f)){e.addEventListener(f,g[f])}}return e};b.prototype.createEventHandlerFromString=function(e){return new Function("event",e.replace(/__CHROME__/gm,"this"))};this.ChromeFactory=b});
/*
 * Backbase Portal Client API
 * Copyright  2011 Backbase - All rights reserved.
 */
b$.module("portal.api",function(){var g=b$.require("packages.portal4gadgets.widget.WidgetFactory");var h=b$.require("packages.portal4gadgets.views.widget.Widget");var u=b$.require("packages.portal4gadgets.Portal4GadgetsWidgetHandler");var A=b$.require("portal.mappings.xml.CustomWidgetHandler");var E=b$.require("packages.portal4gadgets.Portal4GadgetsTypePackage");var y=b$.require("portal.WidgetTypePackage");var F=b$.require("packages.portal4gadgets.widget.Widget");var G=b$.require("portal.views.page.Page");var J=b$.require("portal.page.Page");var m=b$.require("portal.views.page.ResourceView");var d=b$.require("portal.widget.Resource");var p=b$.require("portal.models.holder.WidgetHolder");var v=b$.require("portal.views.holder.WidgetHolder");var x=b$.require("portal.api.ChromeFactory");var w=b$.require("portal.Area");var C=b$.require("portal.TestPerspectiveProvider");var e=b$.require("portal.widget.Widget");var b=b$.require("portal.models.holder.PlaceHolder");var f=b$.require("portal.models.holder.ItemHolder");var z=b$.require("portal.widget.Perspective");var M=b$.require("portal.widget.PerspectiveType");var a=b$.require("portal.widget.PerspectiveParameter");var L=b$.require("portal.widget.PerspectiveParameters");var k=b$.require("b$.mvc.MutationEvent");var o=b$.require("packages.portal4gadgets.event.DOMCustomEvent");var c=b$.require("b$.browser");var H=b$.require("portal.views.layouts.StackFlowLayoutView");var q=b$.require("portal.views.layouts.ColumnLayoutView");var n=b$.require("portal.views.layouts.BorderLayoutView");var D=b$.require("portal.views.layouts.WrappedLineFlowLayoutView");w.prototype.createHolder=function(P){var O=null;if(P instanceof e){var N=new C();O=new K(P,N.createPerspective(new M("Dashboard"),new L([new a("perspective","Dashboard")])),"",N,this.userPreferencesFormFactory)}else{if(P instanceof b){O=P}else{O=new f(P)}}return O};d.prototype.equals=function(N){return N instanceof d&&(this.type=="internal"&&N.getType()=="internal"&&N.contentSource==this.contentSource||(this.type=="external"&&N.getType()=="external"&&N.getURI().equals(this.uri)))};var K=p.extend(function(P,R,O,Q,T){p.call(this,P,R,O,Q,T);var S=this;var N=P.getPreference("chrome");if(N){$.ajax({url:N,success:function(W){var V;if(c.ie&&c.version==9){W=W.replace('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',"");V=new ActiveXObject("Microsoft.XMLDOM");V.async="false";V.loadXML(W)}else{V=new DOMParser().parseFromString(W,"application/xml")}var U=new x(N,V,P);S.setChrome(U.createChrome())}})}});K.prototype.setChrome=function(N){this.chrome=N;this.notifyObservers("chrome")};K.prototype.getChrome=function(){return this.chrome};var I=v.extend();I.prototype.createHTML=function(O){var Q=this.model,P=this.itemView;var N=jQuery('<div class="portal-widgetHolder"><div class="portal-widgetHolder-head"><div class="portal-widgetHolder-title"></div><div class="portal-widgetHolder-preferencesButton'+(Q.getPreferencesForm().getFields().getLength()?"":" portal-widgetHolder-preferencesButton-hidden")+'">preferences</div></div><div class="portal-widgetHolder-body"></div></div>',O);this.addControls(N,O);N.find(".portal-widgetHolder-title").append(P.getTitleView().getHTML(O));N.find(".portal-widgetHolder-preferencesButton").click(jQuery.proxy(this.bindPrefButton,this));N.find(".portal-widgetHolder-head").append(this.form.getHTML(O));if(this.model.getChrome&&this.model.getChrome()){this.applyChrome(N.get()[0])}else{N.find(".portal-widgetHolder-body").append(P.getHTML(O))}return N.get()[0]};I.prototype.applyChrome=function(P,N){var O=this;portal.getPage().addChromeResources(this.model.getChrome(),function(){var Q=new o();Q.initCustomEvent("load",false,false,null);this.model.getChrome().dispatchEvent(Q)},this);jQuery(".portal-widgetHolder-head",this.model.getChrome().getDefinition()).html(jQuery(".portal-widgetHolder-head",P)[0].innerHTML);jQuery(".portal-widgetHolder-body",this.model.getChrome().getDefinition()).html(O.getItemView().getHTML(P.ownerDocument));jQuery(P).html(this.model.getChrome().getDefinition())};I.prototype.getElementByHint=function(N){if(N=="draghandle"&&this.isItemDraggable()){return jQuery(this.html).find(".dragHandle, .portal-widgetHolder-title").get()[0]}else{return v.prototype.getElementByHint.call(this,N)}};I.prototype.update=function(O,N){if(O=="chrome"){this.applyChrome(this.html)}else{v.prototype.update.call(this,O,N)}};var j=h.extend(function(P,N,O){h.call(this,P,N,O);this.model.view=this});var B=H.extend(function(O,N){H.call(this,O,N);this.model.container.layout=this});var l=q.extend(function(O,N){q.call(this,O,N);this.model.container.layout=this});var i=n.extend(function(O,N){n.call(this,O,N);this.model.container.layout=this});var r=D.extend(function(O,N){D.call(this,O,N);this.model.container.layout=this});var t=u.extend(function(){A.call(this,"backbase");this.factories={};this.builders={}});var s=E.extend(function(){y.call(this,new t(),[F,j])});J.prototype.addChromeResources=function(P,U,Q){var S=this.uniqueResources;var N=P.getResources();var R=N.items.length;var O=function(){if(--R===0){U.call(Q)}};var T=this;N.each(function(W){var V=S.uniqueResources.indexOf(W);if(V===-1){W.addObserver("ready",O,T);S.add(W);T.notifyObservers("ResourceAdded")}else{if(S.uniqueResources.item(V).ready){O()}else{S.uniqueResources.item(V).addObserver("ready",O,T)}}})};this.WidgetHolder=K;this.WidgetHolderView=I;this.WidgetView=j;this.StackFlowLayoutView=B;this.ColumnLayoutView=l;this.BorderLayoutView=i;this.WrappedLineFlowLayoutView=r;this.PortalWidgetsTypePackage=s});b$.module("portal.api",function(){var k=b$.require("packages.portal4gadgets.widget.Widget");var m=b$.require("b$.mvc.Model");var t=b$.require("portal.widget.PerspectiveType");var f=b$.require("portal.widget.PerspectiveParameter");var g=b$.require("portal.widget.PerspectiveParameters");var d=b$.require("b$.mvc.MutationEvent");var y=b$.require("packages.portal4gadgets.widget.WidgetIncludeContextProvider");var a=b$.require("portal.models.item.Portal");var u=b$.require("b$.mixin");var x=b$.require("portal.config");var l=b$.require("portal.com.PortalsDataSource");var e=b$.require("portal.PortalClient");var h=b$.require("portal.views.dnd.DragManager");var j=b$.require("portal.views.dnd.CatalogDropManager");var i=b$.require("portal.com.PortalCatalogDataSource");var o=b$.require("portal.com.PortalClientDataRetrieveRequest");var p=b$.require("portal.page.Page");var s=b$.require("portal.models.item.Container");var c=b$.require("portal.views.Area");var r=b$.require("packages.portal4gadgets.include.Include");var w=b$.require("portal.api.PortalWidgetsTypePackage");var b=d.extend(function(A,B){d.call(this);this.initMutationEvent("PerspectiveModified",true,false,null,B,A,null,null)});var z=function(A){var B=[A];A.children&&A.children.forEach(function(C){B=B.concat(z(C))});return B};var n={portal:a,page:p,container:s,widget:k,area:c,include:r,item:m};var v=function(A){return _.find(_.keys(n),function(B){return A instanceof n[B]})};var q=function(E,B){var D=v(E);var C=[{scope:{widget:true,container:true,page:true,portal:true},id:E.id},{scope:{area:true},id:E.model&&E.model.name},{scope:{widget:true,container:true,page:true,portal:true},type:v(E)},{scope:{container:true,page:true},getChildren:function(){return E.children.map(function(F){return q(F)})}},{scope:{container:true,page:true},getAreas:function(){return E.layout.areas.views.map(function(F){return q(F)})}},{scope:{area:true},getHTML:function(){return E.html}},{scope:{area:true},getChildren:function(){return E.model.holders.map(function(F){return q(F.item)})}},{scope:{widget:true,container:true,page:true,portal:true},getPreferences:function(){return E.preferences.items.map(function(F){return F.name})}},{scope:{widget:true,container:true,page:true,portal:true},getPreference:function(F){return E.getPreference(F)}},{scope:{widget:true,container:true,page:true,portal:true},setPreference:function(F,G){E.setPreference(F,G);return this}},{scope:{widget:true,container:true,page:true,portal:true},isPreference:function(F){return E.isPreference(F)}},{scope:{widget:true,container:true,page:true,portal:true},getTitle:function(){return E.title}},{scope:{widget:true,container:true,page:true,portal:true},setTitle:function(F){E.setTitle(F);return this}},{scope:{widget:true,container:true,page:true,portal:true,include:true},addObserver:function(F,G){E.addObserver(F,function(H,I){if(I instanceof n.item){G(H,q(I))}else{G(H)}});return this}},{scope:{portal:true},fetchPages:function(F){$.get(x.resourceRoot+"portals/"+E.portal.getId()+"/pages.xml?pc=false",function(G){F($(G).find("page > name").map(function(H,I){return $(I).text()}))},"xml");return this}},{scope:{portal:true},fetchPage:function(G,F,H){F=F||"body";if(E.activePortalClient){E.activePortalClient.portalsDataSource=new l(x.resourceRoot,G,E.getId())}else{portal.initPortalClient(G,H)}E.activePortalClient.start({synchronize:true,container:F});return this}},{scope:{portal:true},initPortalClient:function(H,I,G,F){E.activePortalClient=new e(document,F||E.activePortal.viewRegistry,H,E,x.resourceRoot);E.activePortalClient.addObserver("PropertyModified",function(K){if(G){I.call(this,K)}else{if(K.attrName=="pageView"){var J=new h(this.pageView,this.document);J.start(this.document);new j(J,this.getSynchronizationManager()).start()}I&&I.call(this)}E.activePage=this.pageView},E.activePortalClient);E.activePortalClient.registerWidgetTypePackage(new w())}},{scope:{portal:true},registerWidgetTypePackage:function(F){E.activePortalClient&&E.activePortalClient.registerWidgetTypePackage(F)}},{scope:{portal:true},fetchCatalog:function(H){var F=new i(x.resourceRoot,E.portal.getId());var G=new o(E.portal,function(){H(this.responseObject.items.map(function(I){return q(I)}))},function(){H([])});F.retrieve(G);return this}},{scope:{portal:true},getPage:function(){return E.activePage&&q(E.activePage.model)}},{scope:{widget:true,container:true,page:true},getHTML:function(){return E.body}},{scope:{widget:true,container:true,page:true},refresh:function(){E.refresh();return this}},{scope:{widget:true,container:true,page:true},getPortal:function(){return q(E.portal)}},{scope:{page:true},getContainers:function(){return z(E).filter(function(F){return F instanceof n.container}).map(function(F){return q(F)})}},{scope:{page:true},getWidgets:function(){return z(E).filter(function(F){return F instanceof n.widget}).map(function(F){return q(F)})}},{scope:{page:true},addChromeResources:function(F,H,G){E.addChromeResources(F,H,G)}},{scope:{widget:true,container:true},getParent:function(){return q(E.parent)}},{scope:{widget:true,container:true},getPage:function(){var F=E.parent;while(F.parent){F=F.parent}return q(F)}},{scope:{widget:true},getIncludes:function(){var F=E.view;return E.getBody().includes.items.map(function(G){return q(G,F)})}},{scope:{widget:true},getPerspective:function(){var F={};E.view.perspectiveProvider.perspective.parameters.items.forEach(function(G){F[G.name]=G.value});return F}},{scope:{widget:true},setPerspective:function(I,H){var K=[new f("perspective",I)];for(var F in H){if(H.hasOwnProperty(F)){K.push(new f(F,H[F]))}}var J=this.getPerspective();var G=E.view.perspectiveProvider.createPerspective(new t(I),new g(K));E.view.perspectiveProvider.setCurrentPerspective(G);E.notifyObservers(new b(G,J));return this}},{scope:{include:true},getUrl:function(){return E.uri.template}},{scope:{include:true},refresh:function(){E.refresh(new y(B.model,B.perspectiveProvider.getCurrentPerspective()))}}];var A=_.filter(C,function(F){return D in F.scope}).reduce(function(F,G){u(F,G);return F},{});delete A.scope;return A};this.api=q});
/*
 * Backbase Portal Client API
 * Copyright  2011 Backbase - All rights reserved.
 */
(function(){var ae=b$.require("packages.portal4gadgets.widget.Widget");var J=b$.require("portal.models.item.Portal");var ar=b$.require("b$.mixin");var aa=b$.require("portal.config");var a=b$.require("b$.Class");var v=b$.require("b$.mvc.ViewRegistry");var G=b$.require("portal.views.item.ItemViewRegistry");var x=b$.require("packages.portal4gadgets.widget.UserPreferencesForm");var p=b$.require("portal.widget.UserPreferencesForm");var U=b$.require("portal.models.item.Preferences");var W=b$.require("portal.models.item.Preference");var T=b$.require("portal.models.item.StringDataType");var c=b$.require("portal.widget.UserPreferenceField");var D=b$.require("portal.views.widget.UserPreferenceField");var n=b$.require("portal.models.holder.ItemHolder");var B=b$.require("portal.views.holder.ItemHolder");var ao=b$.require("portal.api.WidgetHolder");var aj=b$.require("portal.api.WidgetHolderView");var f=b$.require("portal.models.holder.PlaceHolder");var aq=b$.require("portal.views.holder.PlaceHolder");var L=b$.require("portal.Area");var al=b$.require("portal.views.Area");var k=b$.require("portal.Layout");var H=b$.require("portal.views.Layout");var F=b$.require("portal.models.item.Item");var u=b$.require("portal.views.item.Item");var b=b$.require("portal.models.item.Container");var Q=b$.require("portal.views.item.Container");var m=b$.require("portal.widget.Widget");var an=b$.require("portal.page.Page");var ap=b$.require("portal.views.page.Page");var d=b$.require("portal.models.layout-examples.WrappedLineArea");var e=b$.require("portal.views.layouts.WrappedLineArea");var h=b$.require("portal.models.layout-examples.StackFlowLayoutModel");var ac=b$.require("portal.models.layout-examples.ColumnLayoutModel");var S=b$.require("portal.models.layout-examples.BorderLayoutModel");var af=b$.require("portal.models.layout-examples.WrappedLineFlowLayoutModel");var K=b$.require("portal.models.Catalog");var ab=b$.require("portal.views.Catalog");var z=b$.require("portal.CatalogArea");var y=b$.require("portal.views.CatalogArea");var t=b$.require("portal.models.Composer");var ad=b$.require("portal.views.Composer");var q=b$.require("packages.portal4gadgets.widget.UserPreferenceField");var N=b$.require("portal.views.widget.UserPreferenceField");var j=b$.require("packages.portal4gadgets.widget.CheckboxField");var O=b$.require("packages.portal4gadgets.views.widget.CheckboxField");var R=b$.require("packages.portal4gadgets.widget.ReadonlyField");var am=b$.require("packages.portal4gadgets.views.widget.ReadonlyField");var Y=b$.require("packages.portal4gadgets.widget.PasswordField");var ak=b$.require("packages.portal4gadgets.views.widget.PasswordField");var ah=b$.require("packages.portal4gadgets.widget.TextField");var C=b$.require("packages.portal4gadgets.views.widget.TextField");var A=b$.require("packages.portal4gadgets.widget.TextareaField");var M=b$.require("packages.portal4gadgets.views.widget.TextareaField");var V=b$.require("packages.portal4gadgets.widget.MultipleSelectDropdownField");var o=b$.require("packages.portal4gadgets.views.widget.MultipleSelectCheckboxField");var g=b$.require("packages.portal4gadgets.widget.SingleSelectDropdownField");var ag=b$.require("packages.portal4gadgets.views.widget.SingleSelectDropdownField");var P=b$.require("packages.portal4gadgets.widget.MultipleSelectCheckboxField");var X=b$.require("packages.portal4gadgets.views.widget.MultipleSelectDropdownField");var i=b$.require("packages.portal4gadgets.widget.SingleSelectRadioField");var I=b$.require("packages.portal4gadgets.views.widget.SingleSelectRadioField");var s=b$.require("portal.api.WidgetView");var Z=b$.require("portal.api.StackFlowLayoutView");var w=b$.require("portal.api.ColumnLayoutView");var r=b$.require("portal.api.BorderLayoutView");var E=b$.require("portal.api.WrappedLineFlowLayoutView");var l=b$.require("portal.api.api");var ai=a.extend(function(au){a.call(this);var at=new v();at.registerView(c,D);at.registerView(n,B);at.registerView(f,aq);at.registerView(ao,aj);at.registerView(L,al);at.registerView(k,H);at.registerView(F,u);at.registerView(b,Q);at.registerView(m,s);at.registerView(an,ap);at.registerView(S,r);at.registerView(ac,w);at.registerView(h,Z);at.registerView(af,E);at.registerView(d,e);at.registerView(z,y);at.registerView(K,ab);at.registerView(t,ad);at.registerView(j,O);at.registerView(R,am);at.registerView(Y,ak);at.registerView(ah,C);at.registerView(A,M);at.registerView(P,o);at.registerView(V,X);at.registerView(g,ag);at.registerView(i,I);at.registerView(q,N);this.viewRegistry=new G(at);this.viewRegistry.setUserPreferencesFormFactory({createUserPreferencesFormForWidget:function(av){if(av instanceof ae){return new x(av)}else{return new p(av)}}});this.viewRegistry.registerLayout("page",h);this.viewRegistry.registerLayout("borderLayout-container",S);this.viewRegistry.registerLayout("column-container",ac);this.viewRegistry.registerLayout("wrapped-line-flow-container",af);this.portal=new J(null,null,au,new U([new W("DefaultLandingPage","Default Landing Page","dummypage",new T())]),[],false)});window.portal.init=function(at,av){if(av){aa.serverRoot=av;aa.resourceRoot=av}var au=new ai(at);au.portal.activePortal=au;ar(window.portal,l(au.portal));window.portal.api=l;window.portal.config=aa;return window.portal}})();