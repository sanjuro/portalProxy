window.bd.pm=window.bd.pm||{};be.utils.define("bd.pm.msg",function(){var a={MSG_ITEM_LOCKED:"You cannot change the hierarchy in this section because it is (partly) locked for publication",TTL_MOVE_PUB_ITEMS:"MOVE PUBLISHED ITEM(S)",MSG_MOVE_PUB_ITEMS:"Are you sure you want to move the selected published item(s)?",MSG_SELECT_PARENT:"Select the parent of the items to show",ERR_LOCK_LINK_ADD:"Unable to add, because parent node is locked",ERR_LOCK_LINK_EDIT:"Unable to modify, because parent node is locked",ERR_LOCK_LINK_DELETE:"Unable to delete, because parent node is locked",ERR_PUB_LINK_DELETE:"Unable to delete, because there are one or more published nested items",BTN_CANCEL_TXT:"Cancel",BTN_MOVE_TXT:"Move",ERR_LINK_UPDATE:"Unable to update the link, Please try again.",ERR_AJAX_REFRESH:"Ajax Error: Could not load refreshed page data!",MSG_NO_DUPLICATE:"You do not have permission to duplicate",MSG_NO_REMOVE:"You do not have permission to remove",MSG_NO_PROTOCOL:"The Url doesn't contain a protocol. <br/> Are you sure you want to save it?",ACCESS_DENIDED_TITLE:"Access denied",ACCESS_DENIDED_MSG:"The requested page requires authorization. Please login with a valid Username and Password.",ACCESS_DENIDED_WARNING:"You do not have permission to access this page.",SERVER_ERROR:"The page is not rendered correctly.",MSG_NO_MASTER_PAGE:"You can not edit the settings of this page because you do not have permissions on the used master page.",MSG_NO_PERMISSION_ON_MASTER_PAGE:"You do not have permissions to view the selected master page",TITLE_DELETE:"Delete",TITLE_ACTION:"Action",TITLE_DETAILS:"View details",TITLE_DETAILS_CLOSE:"Close details",TITLE_PUBLISH:"Publish",TITLE_PUB_PROGRESS:"Currently in a publication",ERR_SET_DEFAULT_LANDING_PAGE:"Item is in publication process"};return a});window.bd.pm=window.bd.pm||{};be.utils.define("bd.pm.shortcuts",["jQuery","bd.hotkeys","bd.observer","be.utils"],function(e,b,n,d){var i,h,m,p,r;var j=true;var f=function f(w){j=false;var v={39:{"char":"&#8594;",id:"right",hint:"arrow right",desc:"Open tree folder"},37:{"char":"&#8592",id:"left",hint:"arrow left",desc:"Close tree folder"},38:{"char":"&#8593;",id:"up",hint:"arrow up",desc:"Move to previous item in tree"},40:{"char":"&#8595;",id:"down",hint:"arrow down",desc:"Move to next item in tree"},65:{"char":"a",id:"permissions",hint:"",desc:"Open permissions tab"},70:{"char":"f",id:"find",hint:"",desc:"Show search box"},73:{"char":"i",id:"info",hint:"",desc:"Show info tab"},77:{"char":"m",id:"m",hint:"",desc:"Create master page"},78:{"char":"n",id:"n",hint:"new page",desc:"Create page"},80:{"char":"p",id:"publish",hint:"",desc:"Publish/ unpublish page"},81:{"char":"q",id:"toggle",hint:"",desc:"Switch between pages and content view in tree"},83:{"char":"s",id:"settings",hint:"",desc:"Open settings tab"},84:{"char":"t",id:"targeting",hint:"",desc:"Open targeting tab"},86:{"char":"v",id:"versions",hint:"",desc:"Open versions tab"},87:{"char":"w",id:"close",hint:"",desc:"Close settings"},191:{"char":"?",id:"help",hint:"",desc:"Open shortcuts panel"},alt:{8:{"char":"alt+&#8656;",id:"delete",hint:"Alt+backspace",desc:"Delete currently selected item"},71:{"char":"alt+g",id:"togglegridview",hint:"Alt+G",desc:"Toggle an exploded grid view for easier drag and drop for arranging layouts"},},shift:{78:{"char":"N",id:"N",hint:"Shift+n",desc:"Create new item (any item)"},80:{"char":"P",id:"publishpackage",hint:"Shift+p",desc:"Publish workpackage"}}};var u=be.contextRoot+"/static/dashboard/templates/html/shortcuts.html";var y=[],t;var x=function(A){A=e.extend({},A);A.hint=A.hint&&(A.hint!==""?" ("+A.hint+")":"");y.push(A)};for(t in v){x(v[t])}for(t in v.alt){x(v.alt[t])}for(t in v.shift){x(v.shift[t])}var z=d.processHTMLTemplateByUrl(u,{keys:y});bc.component.modalform({width:"650px",ok:false,title:"Keyboard shortcuts for pages",uid:"keyboard-shortcuts for pages",content:z,cancelCallback:function(){j=true}})};var g=function(A){var t=A.parents("ul")[0];var y=A.parents("li")[0];var z=e(y).height();var w=e(y).offset().top;var u=w+z;var x=e(t).offset().top;var v=x+e(t).height();return{container:t,heightPage:z,topPage:e(y).offset().top,bottomPage:u,topContainer:x,bottomContainer:v}};var k=function(w){var v=g(w);var u=v.heightPage;var t=v.container;if((v.topPage-u)<v.topContainer){t.scrollTop-=u}};var s=function(w){var v=g(w);var u=v.heightPage;var t=v.container;if((v.topPage+u)>v.bottomContainer){t.scrollTop+=u}};var a={f:function(){e(".bc-search-button",i).trigger("click")},q:function(){m.toggleView()},esc:function(){},"shift+?":f,"alt+g":function(){e(".bd-show-grid-wrapper").find("div:not(.bc-view-active)").trigger("click")}};var c={"alt+backspace":function(){if(m.state.currentView==="page"){m.deleteLink()}},m:function(){if(m.state.currentView==="page"){m.toggleSettingsAdd("page",{isMasterPage:true})}},n:function(){if(m.state.currentView==="page"){m.toggleSettingsAdd("page")}},"shift+n":function(){if(m.state.currentView==="page"){e(".bc-action-select",e(".bd-addPageButtons",i)).trigger("click")}},up:function(){k(h)},down:function(){s(h)},right:function(){s(h)},left:function(){k(h)},p:function(){if(m.state.currentView==="page"){m.togglePublish(h)}},u:function(){if(m.state.currentView==="page"){m.toggleUnPublish(h)}},"shift+p":function(){if(m.state.currentView==="page"){var t=e(".bd-pageMntPublishBtn:visible");if(t.length>0){t.trigger("click")}}},"shift+t":function(){}};var l={w:function(){if(p.isOpen!==false){m.closeSettingsContainer()}if(e(".bd-AP-itemInfo").length){e(".jstree-clicked",".bd-assetsPicker-viewport").find(".bd-ap-preview").trigger("click")}},s:function(){if(p.isOpen===false||p.currentTabName!=="settings"){m.toggleSettingsEdit(false,"settings")}},a:function(){if(p.isOpen===false||p.currentTabName!=="permissions"){m.toggleSettingsEdit(false,"permissions")}},i:function(){if(p.isOpen===false||p.currentTabName!=="info"){m.toggleSettingsEdit(false,"info")}},v:function(){if(p.isOpen===false||p.currentTabName!=="versions"){m.toggleSettingsEdit(false,"versions")}},t:function(){if(p.isOpen===false||p.currentTabName!=="targeting"){m.toggleSettingsEdit(false,"targeting")}}};r=e.extend(c,l,a);function o(t,u){i=e(t);m=u;b.start(r);n.subscribe("hotkey",function(w,v){var x=e(".jstree-hovered",i);h=e(".bd-tree-pageCurrent",i);h=(x.length>0)?x:h;m.restorePageList(true);p=m.SettingsState})}function q(){b.stop()}return{attach:o,bindings:r,detach:q}});window.bd.pm=window.bd.pm||{};be.utils.define("bd.pm.controller",["be.promise"],function(e){var j=50,z=j+1;var p=function(D,B){var C=be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/xml/";return be.utils.processHTMLTemplateByUrl(C+D,B)};var i=function(E,D){var B=new jQuery.Deferred();var F=bd.pm.model.links[E];if(!F){var C="<linkRequest><uuids><uuid>{{linkId}}</uuid></uuids></linkRequest>";var G=Mustache.to_html(C,{linkId:E});e.linkRequest(G).then(function(I){var H=(I.links&&I.links.link)?I.links:{link:[]};bd.pm.pService.updateLinkObj(H.link,D);F=H.link;B.resolve(F)}).fail(function(H){B.reject(H)})}else{B.resolve(F)}return B.promise()};var u=function(D,C,E){var B={depth:C};e.link(D,B).then(function(F){if($.isFunction(E)){E(F.link)}}).fail(function(G){var F="Ajax Error: Could not load refreshed link data!";bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:F})})};var y=function(F){var B=F.uuid;var I=F.customEvent;var K=F.of;var H=F.selectedLinkId;var J=F.link;var D=bd.selectedPortalName,E=1,C=K?K:0;if(B){D=J?J.name:D}var G={f:"parentItemName(eq)"+D,ps:z,depth:E,of:C};e.pagemanagementLinks(G).then(function(L){var M={openTarget:B,selectedLinkId:H,event:I,depth:E,skipCount:C,maxItem:j,parentItemName:D};bd.pm.pService.createLinksModel(L.links,M)}).fail(function(L){})};var b=function(C,F,B,E){var D={uuid:C,selectedLinkId:F,customEvent:B,of:E};if(C){i(C).done(function(G){D.link=G;y(D)})}else{y(D)}};var k=function(B){e.linkTree(B).then(function(C){var D={selectedLinkId:B,isSelectedTree:true};bd.pm.pService.createLinksModel(C.links,D)}).fail(function(C){bd.observer.notifyObserver(bd.pm.observer.initFirstLevel)})};var r=function(B,D){var C={f:"uuid(eq)"+B};return e.pages(C).then(function(E){if($.isFunction(D)){D(E.pages.page)}return E&&E.pages&&E.pages.page}).fail(function(F){var E="Ajax Error: Could not load refreshed page data!";if(F.errorMessage.indexOf("DefaultLandingPage_page_not_found")>-1){E="DefaultLandingPage_page_not_found"}bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:E})})};var n=function(B){i(B).done(function(C){if(C){if(C.properties.ItemRef&&C.properties.itemType.value!=="state"){r(C.properties.ItemRef.value,function(D){bd.pm.pService.mPageDataTransfer(C,D)})}else{bd.pm.pService.mLinkDataTransfer(C)}}})};var s=function(){e.link("masterpage_root",{ps:1,depth:1}).then(function(B){bd.pm.pService.setMasterPageFeature(true)}).fail(function(B){if(B.errorMessage.indexOf("not found")===-1){bd.pm.pService.setMasterPageFeature(true)}})};var h=function(){e.templates("f=name(not)page-default&f=type(eq)PAGE").then(bd.pm.pService.setPageTemplates)};var o=function(C){var F,B=C.hasOwnProperty("order"),E=1,D=bd.pm.observer.updateLinkDetail;if(B){D=bd.pm.observer.updateOrder}F=p(B?"links/updateLinkTree.xml":"links/createLink.html",C);e.editPagemanagementLink(C.linkName,F).then(function(G){u(C.linkName,E,function(H){H.isMasterPage=C.isMasterPage;i(H.uuid).done(function(I){if(H.finalUrl!==I.generatedUrl){bd.observer.notifyObserver(bd.pm.observer.updateVisibleLink)}bd.pm.pService.updateLinkObj(H,D)})})}).fail(function(G){if(B){bd.observer.notifyObserver(bd.pm.observer.revertTree,{message:G.errorMessage})}else{G.formId=C.formId;bd.observer.notifyObserver(bd.pm.observer.validator,G)}})};var m=function(C){var D=p("pages/updatePage.html",C);var B=C.isMasterPage?"updateMasterPage":"updatePage";return e[B](C.pageName,D).then(function(E){if(C.updatePageOnly){if(C.ev){bd.observer.notifyObserver(C.ev)}return}o(C)}).fail(function(E){E.formId=C.formId;bd.observer.notifyObserver(bd.pm.observer.validator,E)})};var A=function(B){e.deletePage(B).fail(function(D){var C="Ajax Error: Could not load refreshed page data!";bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:C})})};var g=function(B){var C=p("links/createLink.html",B);e.addLink(C).then(function(D){u(B.linkName,1,function(E){bd.pm.pService.addLinkObj(E,B.isMasterPage,B.isTargetingPage,B.pageName,bd.pm.observer.addLink)})}).fail(function(D){D.formId=B.formId;D.isNew=true;bd.observer.notifyObserver(bd.pm.observer.validator,D)})};var d=function(C){var D=p("pages/createPage.html",C);var B=C.isMasterPage?"addMasterPage":"addPage";return e[B](D).then(function(E){if(C.isMasterPage){var F=E&&E.link;if(F){e.link(F.name).then(function(G){bd.pm.pService.addLinkObj(G.link,C.isMasterPage,C.isTargetingPage,C.pageName,bd.pm.observer.addLink)})}}else{C.itemRef=E.page.uuid;g(C)}}).fail(function(E){E.formId=C.formId;bd.observer.notifyObserver(bd.pm.observer.validator,E)})};var x=function(B,D){var C={depth:1,f:"uuid(eq)"+B};e.pagemanagementLinks(C).then(function(E){if($.isFunction(D)){D(E.links.link)}}).fail(function(F){var E="Ajax Error: Could not load refreshed link data!";bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:E})})};var w=function(C,B){i(C).done(function(D){e.duplicateLink(D.name).then(function(F){var E=F.link;x(E.uuid,function(H){var G=H.properties.isTargetingPage?true:false;H.isDuplicatedLink=true;bd.pm.pService.addLinkObj(H,B,G,E.pageName,bd.pm.observer.addLink)})}).fail(function(F){var E="Unable to duplicate the link.";bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:E})})})};var a=function(B){i(B).done(function(E){function D(){bd.pm.pService.removeLinkObj(E);if(E.isMasterPage){bd.observer.notifyObserver(bd.pm.observer.masterPageDeleted)}}var C=E.itemRef||E.properties.ItemRef&&E.properties.ItemRef.value;if(E.isMasterPage){r(C).then(function(F){e.deleteMasterPage(F.name,bd.selectedPortalName).then(D).fail(function(G){bd.masterpage.swapAndDelete({errorMessage:G.errorMessage,portalName:bd.selectedPortalName,linkName:E.name,pageName:F.name,uuid:E.referencedItem.uuid,callback:D})})})}else{e.deletePagemanagementLink(E.name).then(D).fail(function(F){bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:F.errorMessage})})}})};var q=function(B){if(B.length>1){var C={query:B,ps:50,of:0};e.pagemanagementSearchLinks(C).then(function(D){if(bd.pm.controller.searchCanceled){delete bd.pm.controller.searchCanceled;return}bd.pm.pService.searchLinksModel(D.links)},function(D){bd.observer.addObserver(bd.pm.observer.errorMsg,{message:D.errorMessage})})}else{bd.observer.notifyObserver(bd.pm.observer.searchResult,null)}};var c=function(B,F,C){var D=[];var E={depth:1,f:B+"(eq)"+F};e.pagemanagementLinks(E).then(function(G){var I=G.links.link;var H=function(J){u(J,1,function(K){D.push(K.name);if(bd.pm.model.links[K.uuid]||K.parentItemName===bd.selectedPortalName){b(K.uuid,D,C)}else{H(K.parentItemName)}})};D.push(I.name);H(I.parentItemName)}).fail(function(H){var G="Ajax Error: Could not load refreshed link data!";bd.observer.notifyObserver(bd.pm.observer.errorMsg,{message:G})})};var l=function(C,E,B,D){i(C).done(function(F){u(F.name,E,function(G){bd.pm.pService.updateLinkObj(G,B,false,D)})})};var f=function(D,C,F){if(D&&D.length){var B="<linkRequest><uuids>{{#links}}<uuid>{{.}}</uuid>{{/links}}</uuids></linkRequest>";var E=Mustache.to_html(B,{links:D});e.linkRequest(E).then(function(H){var G=H.links||{link:[]};bd.pm.pService.updateLinkObj(G.link,C,true,F)})}};var t=function(B,D){if(B!=null&&typeof B.name==="string"){var C={f:"parentItemName(eq)"+B.name,ps:1,depth:1,of:0};e.links(C).then(function(F){var E=F.links||{link:[]};if($.isFunction(D)){D(E.link)}}).fail(function(E){throw new Error(E)})}else{throw new Error("Unable to find linkData.name ")}};var v=function(B,C){if(B!==null){e.deletionCheck(B).then(function(D){if($.isFunction(C)){C(D)}}).fail(function(D){throw new Error(D)})}else{throw new Error("Unable to find link uuid")}};return{addLink:g,addPage:d,checkMPFeature:s,deleteLink:a,deletetionCheck:v,duplicateLink:w,getDetails:n,getLinkParents:c,getPageByUuid:r,getPageTemplates:h,getSelectedLinkTree:k,hasChildren:t,onLinkByUUID:i,refreshLink:l,refreshLinks:f,renderJSTree:b,searchLinks:q,updateLink:o,updatePage:m}});window.bd.pm=window.bd.pm||{};be.utils.define("bd.pm.settingPanel",["jQuery"],function(E){var a,F,J,c={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4,NONE:-5},g={actionName:"",params:{}},l=false,i=null,u=null,D,P={isOpen:false,currentTabIndex:null,currentTabName:null,set:function(Q){Object.keys(Q).forEach(function(R){if(typeof this[R]!=="function"&&this.hasOwnProperty(R)){this[R]=Q[R]}}.bind(this))},reset:function(){this.isOpen=false;this.currentTabIndex=null},mode:"read"},O=function(R,Q){return be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/"+R,Q)},G=function(S){var T=P&&P.currentTabIndex||0;var R=F.find(".bd-tabLabel"),Q;if(!isNaN(S)){Q=(isNaN(parseInt(S,10))===false)?S:T}else{if(typeof S!=="undefined"){Q=R.parent().find('[data-tab-name="'+S+'"]').index()}else{Q=0}}if(R.eq(Q).length>0){T=Q}return R.eq(T)},n=function(Q){var R=G(Q);if(R.length<=0||R.hasClass("bd-hiddenTabLabel")){R=R.parent().find(".bd-tabLabel:first")}R.trigger("click");return{$tab:R,tab:Q}},M=function(){var U,V,T,W=bd.PageMgmtTree.selectedLink;var S=jQuery("#"+W.uuid).parents("li"),X="",Q=bd.contextRoot+"/"+bd.selectedPortalName+"/";if(Q.length>25){Q=Q.substr(0,21)+".../"}X=Q;for(U=S.length-2;U>=0;U--){V=S[U];var R=bd.pm.model.links[V.getAttribute("id")];T=bd.pm.view.getDataProperty(R,"sectionName");X=X+T+"/"}if(X.length>25){X=Q+".../"}return X},w=function(Q){jQuery(Q).find("input.field:first").focus()},r=function(Q){be.utils.confirm({title:"Invalid URL",okBtnText:"Continue",message:bd.pm.msg.MSG_NO_PROTOCOL,yesCallback:Q})},p=function(U,X,S){var Q={"301":"Moved Permanently (301)","303":"See Other (303)","307":"Temporary Redirect (307)"};if(S){return Q}var Z=[],Y,T,V="301",W=Q[V],R=bd.pm.view.getDataProperty(X,"redirectionMethod");for(Y in Q){T=Q[Y];Z.push({name:T,value:Y});if(Y===R){V=Y;W=T}}bc.component.dropdown({target:jQuery(".bd-redirectDropDown",U),forlabel:"redirectionMethod",uid:"987512",label:W,selected:V,options:Z,minWidth:"170px"})},j={externalLink:{extraProperties:function(Q){return[{propertyName:"itemType",propertyValue:"externalLink"},{propertyName:"menuAccessibilityTitle",propertyValue:Q.menuAccessibilityTitle}]},itemType:"externalLink",templateCallback:function(Q,R){}},menuHeader:{extraProperties:function(Q){return[{propertyName:"itemType",propertyValue:"menuHeader"},{propertyName:"menuAccessibilityTitle",propertyValue:Q.menuAccessibilityTitle}]},itemType:"menuHeader",validationRules:{},templateCallback:function(Q,R){}},divider:{extraProperties:function(){return[{propertyName:"itemType",propertyValue:"divider"},{propertyName:"className",propertyValue:"bd-divider"}]}},redirect:{extraProperties:function(Q){return[{propertyName:"itemType",propertyValue:"redirect"},{propertyName:"redirectionMethod",propertyValue:Q.redirectionMethod},{propertyName:"targetPage",propertyValue:Q.targetPage,propertyType:"uuidRef"}]},itemType:"redirect",validationRules:{},templateDataCallback:function(U,S,W){var V,T,X,R,Q;if(W==="createMode"){V=S;T="";X="(empty)";if(V&&!V.isMasterPage){T=V.uuid;X=bd.pm.view.getDataProperty(V,"title")}U.targetPage=T;U.targetPageTitle=X}else{if(W==="viewMode"){R=p(null,null,true);Q=bd.pm.view.getDataProperty(S.linkData,"redirectionMethod");X="";U.redirectionMethodLabel=R[Q];U.redirectionMethod=Q;U.targetPage=bd.pm.view.getDataProperty(S.linkData,"targetPage");if(S.targetPage){X=bd.pm.view.getDataProperty(S.targetPage,"title");S.linkData.targetPageTitle=X}else{if(S.linkData.targetPageTitle){X=S.linkData.targetPageTitle}}U.targetPageTitle=X}}return U},templateCallback:function(R,Q,S){if(S==="createMode"){p(R)}else{if(S==="editMode"){p(R,Q)}}}}},e=function(V,W){var T,U,X,Q=W?W:bd.PageMgmtTree.selectedLink,Z=function(ab){var aa=be.utils.serializeJSON(ab),ac={linkName:aa.name?aa.name:"link_"+new Date().getTime(),linkTitle:aa.linkTitle,sectionName:aa.sectionName,parentItemName:aa.linkParentName,formId:ab.id,Url:aa.Url?aa.Url:null,extraProperties:V.extraProperties(aa)};if(!Q.isMasterPage){ac.order=bd.pm.view.getOrderNew(Q.uuid)}else{ac.order=bd.pm.view.getOrderNew()}if(V.itemType==="externalLink"){if(ac.Url.indexOf("://")<0){r(function(){bd.pm.controller.addLink(ac)})}else{bd.pm.controller.addLink(ac)}}else{ac.Url=be.utils.formatAllowedFriendlyUrl(aa.Url);bd.pm.controller.addLink(ac)}return false},Y=function(){n();if(V.templateCallback){V.templateCallback(T,Q,"createMode")}F.find(".bd-buttons").hide();be.utils.addCustomMethodToValidator(["friendlyUrlSpecialChar"]);T.find("form").validate({rules:V.validationRules,submitHandler:Z})},S=function(){F.find(".bd-buttons").show().removeAttr("style");P.set({mode:"add"});w(T.find("form"))};if(Q.isMasterPage){var R=J.children("ul").children("li.bd-pageMgmt-accordion-active:first").attr("id");X=bd.pm.view.getData(R).name}else{X=Q.isRoot?Q.name:Q.parentItemName}if(V.itemType){U=V.templateData||{linkParentName:X};if(V.hierarchicalUrl){U.hierarchicalUrl=V.hierarchicalUrl}U.path=M();if(V&&V.templateDataCallback){U=V.templateDataCallback(U,Q,"createMode")}T=jQuery(O("html/links/"+V.itemType+"/Create.html",U));bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:T,before:Y,after:S})}else{bd.pm.controller.addLink({isNew:true,linkName:"link_"+new Date().getTime(),parentItemName:X,extraProperties:V.extraProperties(),order:bd.pm.view.getOrderNew(Q.uuid)})}},h=function(Q){g={actionName:"getPageDataForAddPageAlias",params:{}};bd.pm.controller.getDetails(Q.uuid)},m=function(U){var R=bd.PageMgmtTree.selectedLink,T=bd.pm.view.getDataProperty(R,"ItemRef"),Q=(bd.pm.view.getDataProperty(R,"isTargetingPage")==="true"),S={extraProperties:function(V){var W=[{propertyName:"ItemRef",propertyValue:T,propertyType:"uuidRef"},{propertyName:"itemType",propertyValue:"alias"},{propertyName:"linkTitle",propertyValue:V.linkTitle},{propertyName:"menuAccessibilityTitle",propertyValue:V.menuAccessibilityTitle},{propertyName:"parentPageRef",propertyValue:T}];if(Q){W.push({propertyName:"isTargetingPage",propertyType:"boolean",propertyValue:"true"})}return W},itemType:"alias",hasMasterPageFeature:l,templateCallback:function(V){},templateData:U};e(S);return},q=function(){g={actionName:"getPageDataForAddPageState",params:{}};bd.pm.controller.getDetails(bd.PageMgmtTree.selectedLink.uuid)},x=function(U){var S=bd.PageMgmtTree.selectedLink,T=bd.pm.view.getDataProperty(S,"ItemRef"),R=(bd.pm.view.getDataProperty(S,"isTargetingPage")==="true"),Q={extraProperties:function(V){var W=[{propertyName:"ItemRef",propertyValue:T,propertyType:"uuidRef"},{propertyName:"itemType",propertyValue:"stateLink"},{propertyName:"linkTitle",propertyValue:V.linkTitle},{propertyName:"menuAccessibilityTitle",propertyValue:V.menuAccessibilityTitle},{propertyName:"parentPageRef",propertyValue:T},{propertyName:"sectionName",propertyValue:S.sectionName+"//"+bd.pm.settingPanel.stateUrl}];if(R){W.push({propertyName:"isTargetingPage",propertyType:"boolean",propertyValue:"true"})}return W},itemType:"stateLink",hasMasterPageFeature:l,templateCallback:function(V){},templateData:U,hierarchicalUrl:S.generatedUrl+"//"+bd.pm.settingPanel.stateUrl};e(Q);return},L=function(R){var Q=[];if(R.length>0){jQuery.each(R,function(U,X){var T=jQuery(X).attr("name"),S=jQuery("#"+T+"Input"),W=S.data("manageable"),V=S.attr("viewHint");if(W){Q.push({name:T,value:S.val(),label:S.attr("label"),manageable:W,viewHint:V})}})}return Q},A=function(V,T,U,W){var Q=new E.Deferred();var S=typeof W!=="undefined"?W.isMasterPage===true:false;var R=bd.contextRoot+(V?"/portals/"+V:"")+(U!==false?"/pages/"+U:"/catalog/"+T)+".xml";var W=["ps=100","f=type(eq)PAGE","f=name(not)RootPage"].join("&");if(S&&T&&U===false){R=bd.contextRoot+"/catalog/"+T+".xml"}else{if(S&&!T&&U===false){R=bd.contextRoot+"/catalog.xml"}}be.utils.ajax({url:R,data:W,success:function(Z){var Y=bd.xmlToJson({xml:jQuery.parseXML(Z)});var aa=bd.pm.model.pageTemplates,ab,X;if(S&&U===false){X=Y.catalog.page.length?Y.catalog.page[0]:Y.catalog.page;ab=X.properties.TemplateName.value}else{X=Y.page.length?Y.page[0]:Y.page;ab=X.properties.TemplateName.value}E.each(aa,function(ad,ac){if(typeof ab!=="undefined"&&ab===ac.name){Q.resolve(ac)}})},cache:false,type:"GET"});return Q.promise()},I=function(W,S,Q,ab,V){var Y=[],R="",Z="",af=bd.pm.model.pageTemplates,ae;if(af&&af.length){for(var X=0;X<af.length;X++){var U=af[X],ad=bd.selectedPortalOptimizedFor!=="mixed"&&U.tagArray&&U.tagArray.length&&jQuery.inArray(bd.selectedPortalOptimizedFor,U.tagArray)===-1;if(ad||!U.properties.title){continue}var aa=U.properties.title.value;var T=U.properties.thumbnailUrl?U.properties.thumbnailUrl.value:null;if(T&&T!==""){T=T.replace(/\$\(contextRoot\)/gi,be.contextRoot)}var ac=jQuery.inArray("cxpManager",U.tagArray)>-1;if(bd.selectedPortalName!=="dashboard"&&ac){continue}if(W&&aa===W){Y.push({image:T,value:U.name,name:aa,sel:true})}else{Y.push({value:U.name,image:T,name:aa})}}}A(bd.selectedPortalName,Q,ab,V).then(function(ag){E(".templatesList ul").remove();bc.component.dropdown({target:S,type:"image-select",label:ag.properties.title.value,selected:ag.name,forlabel:"pageTemplate",uid:"3125",options:Y,minWidth:"170px"})});return Y},k=function(U){var V=bd.selectedPortalName,ab=U&&U.isMasterPage,Y=U&&U.isTargetingPage,Q=bd.PageMgmtTree.selectedLink,Z={contextRoot:bd.contextRoot,hasMasterPageFeature:l,path:M(),portalName:V};var W=function(ak){try{var ao=be.utils.serializeJSON(ak),aj=be.utils.trimString(be.utils.formatAllowedTitle(ak.pageTitle.value)).substring(0,150),ai="page_"+new Date().getTime(),af,an,al=ak.pageTags.length?ak.pageTags:[ak.pageTags],ah=(function(aq){var ar=[];for(var at=0,ap=aq.length;at<ap;at++){ar=bd.getTagsDeltaModel(aq[at],ar)}return ar})(al),ac=jQuery(ak).find('input[type="hidden"].bd-exposedPageProperty'),am=ah.length>0;if(!ak.pageTemplate||!ak.pageTemplate.value){bc.component.notify({uid:"no-templates",icon:"error",message:"No templates were found."});return}var ag=ao.name?ao.name:"link_"+new Date().getTime();af={pageName:ai,pageTitle:aj,pageTemplate:ak.pageTemplate.value,portalName:V,formId:ak.id,exposedPageProperties:L(ac),tags:ah,hasTags:am,createdBy:bd.loggedInUserId,isMasterPage:ab,isTargetingPage:Y,linkName:ag,linkTitle:ab?aj:ao.linkTitle,sectionName:ab?ai:ao.sectionName,Url:ao.Url?be.utils.formatAllowedFriendlyUrl(ao.Url):"",extraProperties:[{propertyName:"itemType",propertyValue:Y?"targeting":"page"}]};if(Y){af.extraProperties.push({propertyName:"isTargetingPage",propertyType:"boolean",propertyValue:"true"})}if(ak.masterPage&&ak.masterPage.value!==""){af.extendedPage=ak.masterPage.value}if(ab){af.parentItemName="masterpage_root";if(!Q.isMasterPage){af.order=bd.pm.view.getOrderNew(J.find(".bd-tree-masterpage:first").attr("id"))}else{af.order=bd.pm.view.getOrderNew(Q.uuid)}if(ao.seoCheckBox){var ad=ao.seoCheckBox==="yes";af.exposedPageProperties.push({name:"enableSEO",value:ad});if(ad){bd.pm.settingPanel.addDefaultSEO(af)}}}else{af.parentItemName=!Q.name?"navroot_mainmenu":Q.parentItemName?(Q.isRoot?Q.name:Q.parentItemName):Q.name;if(!Q.isMasterPage){af.order=bd.pm.view.getOrderNew(Q.uuid)}else{an=J.children("ul").children("li.bd-pageMgmt-accordion-active:first").attr("id");af.parentItemName=bd.pm.view.getData(an).name;af.order=bd.pm.view.getOrderNew()}}bd.pm.controller.addPage(af)}catch(ae){console.log(ae)}};var aa=function(){n();F.find(".bd-buttons").hide();if(bd.masterpage&&l){bd.masterpage.getMasterPageHtml({portalName:V,isMasterPage:ab,isTargetingPage:Y,defaultMasterPageName:D})}bd.initTags(".pageTagsInput");be.utils.addCustomMethodToValidator(["friendlyUrlSpecialChar"]);jQuery("#newPageForm").validate({rules:{sectionName:{friendlyUrlSpecialChar:true}},submitHandler:W})};var R=function(){F.find(".bd-buttons").show().removeAttr("style");P.set({mode:"add"});w(jQuery("#newPageForm"));var ac=E("#masterPage").val()||D;E(".templatesList ul").remove();if(ac){I(Z.template,S.find(".templatesList"),ac,false,{isMasterPage:ab})}var ad=function(){var ae=E(this).val();E(".templatesList ul").remove();E(".bd-inheried-Property").html("");I(Z.template,S.find(".templatesList"),ae,false,{isMasterPage:ab})};F.off("change","#masterPage").on("change","#masterPage",ad);if(ab){jQuery(".templateWrapper").removeClass("hidden")}else{jQuery(".templateWrapper").addClass("hidden")}};if(bd.typeOfTags&&bd.typeOfTags.length&&bd.typeOfTags.length>0){Z.typeOfTags=bd.typeOfTags;Z.removeSpace=function(){return function(ad,ac){return ac(ad).replace(/\s/gi,"-")}}}if(ab){Z.isMasterPage=ab}Z.itemType=Y?"targeting":"page";Z.isTargetingPage=Y;var S=jQuery(O("html/links/page/Create.html",Z));if(ab){var T=I(Z.template,S.find(".templatesList"),null,false,{isMasterPage:ab});var X=S.find(".bd-seo-toggle");bc.component.toggleSwitch({target:X,uid:"12288",name:"seoCheckBox",checked:false})}bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:S,before:aa,after:R})},o=function(Q,R,T,S){g={actionName:"getPageDataForOpenPageDetail",params:{li:Q,tab:S,selectPanel:true,linkData:R,refresh:T}};bd.pm.controller.getDetails(R.uuid)},f=function(Q,V){var U,S=Q.find("*[viewHint]"),W=function(X){var aa=X.parent(),ac=X.attr("id"),Z=V,ab=X.val()?X.val():X.text();var Y=bc.component.toggleSwitch({target:aa,uid:"1014",name:ac,wrapped:true,checked:ab==="true"?true:false,callback:function(ad,ae){if(ae.prop("checked")){ae.val("true")}else{ae.val("false")}}});if(!Z&&X.prop("tagName")!=="INPUT"){Z=true}if(Z){Y.disable("input");Y.disable(".toggle-mask")}else{Y.view.find("input").attr({id:X.attr("id"),value:X.val(),"data-for":X.attr("data-for"),"class":"bd-exposedPropertyInput",viewHint:X.attr("viewHint"),manageable:X.attr("manageable"),label:X.attr("label")})}X.remove()};if(S.length>0){for(var T=0,R=S.length;T<R;T++){U=jQuery(S[T]);if(U.attr("viewHint").indexOf("checkbox")>-1){W(U)}}}return Q},C=function(T,V){var ab=V.linkData,Y=bd.pm.view.getDataProperty(ab,"ItemRef"),Z=bd.pm.view.getDataProperty(ab,"itemType"),X,U,W,aa=function(){F.find(".bd-buttons").hide();X=n(V.tab);var ac=new E.Deferred();var ad=X.$tab.length===false||X.$tab.hasClass("bd-hiddenTabLabel");if(ad){ac.reject()}else{ac.resolve()}return ac.promise()},R=function(){F.find(".bd-buttons").show().removeAttr("style")};T.showPublishButton=ab.showPublishButton;T.showUnpublishButton=ab.showUnpublishButton;T.showCancelPublishButton=ab.showCancelPublishButton;T.showCancelUnpublishButton=ab.showCancelUnpublishButton;if(Y){T=bd.PageMgmtTree.publishing?bd.PageMgmtTree.publishing.enhanceParamsWithPendingPublishData(ab,T):T;T.openSettingPanelCallback=function(){F.find(".bd-buttons").hide();F.show()};var S=Z;if(S==="targeting"){S="page"}U=jQuery(O("html/links/"+S+"/Setting.html",T));jQuery(".bc-form-title",U).removeClass("b-1 b-2 b-3 b-4").addClass("b-"+jQuery(".bd-buttons",U).children().length);if(T.exposedLinkProperties.regularPro.length>0||T.exposedPageProperties.regularPro.length>0||T.exposedPageProperties.inheritedPro.length>0){U=f(U,true)}var Q=jQuery(".editPageTabs_Permissions .bc-form-title .bd-page-icon");if(Q.length){Q[0].nextSibling.data=T.linkTitle}W=O("html/links/"+S+"/Info.html",T);jQuery("#editPageTabs_Info").html(W);jQuery(".bc-form-title",jQuery("#editPageTabs_Info")).removeClass("b-1 b-2 b-3 b-4").addClass("b-1");i=T;u=U;F.off("click",".bd-tab4").on("click",".bd-tab4",function(){var ac={domParent:"#editPageTabs_Versions",linkUUID:ab.uuid,templateData:{pagename:bd.pm.view.getDataProperty(ab,"title"),itemType:Z}};bd.Versions.loadVersions(ac)});bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:U,before:aa,after:R,action:V.action});bd.observer.notifyObserver(bd.notifications.pageMgmt.PAGE_SETTINGS_REFRESH,{targetingTab:jQuery("#editPageTabs_Targeting")});bd.pm.settingPanel.initSEOPanel({page:T,container:F})}else{bd.pm.view.closeSettingsContainer()}},t=function(Q,R){R=E.extend({linkData:Q},R);g={actionName:"getLinkDataForOpenLinkDetailPanel",params:R};bd.pm.controller.getDetails(Q.uuid)},b=function(S,T){var U,R,aa=T.linkData,V=aa.name,W=bd.pm.view.getDataProperty(aa,"ItemRef"),Y=bd.pm.view.getDataProperty(aa,"itemType"),X=j[Y]?j[Y]:false,Z=function(){if(X&&X.templateCallback){X.templateCallback(R,T,"viewMode")}n(T.tab);F.find(".bd-buttons").hide()},Q=function(){F.find(".bd-buttons").show().removeAttr("style")};S.showPublishButton=aa.showPublishButton;S.showUnpublishButton=aa.showUnpublishButton;S.showCancelPublishButton=aa.showCancelPublishButton;S.showCancelUnpublishButton=aa.showCancelUnpublishButton;S.linkName=V;if(S.Url){S.hasFriUrl=true}S.hideEditButtons=S.linkLockState==="LOCKED";if(X&&X.templateDataCallback){S=X.templateDataCallback(S,T,"viewMode")}R=jQuery(O("html/links/"+Y+"/Setting.html",S));if(S.exposedLinkProperties.regularPro.length>0||(S.exposedPageProperties&&S.exposedPageProperties.regularPro.length>0)||(S.exposedPageProperties&&S.exposedPageProperties.inheritedPro.length>0)){R=f(R,true)}if(W&&Y!=="state"){if(S.pageName){S.parentPageName=S.pageName}U=O("html/links/"+Y+"/Info.html",S);jQuery("#editPageTabs_Info").html(U)}i=S;u=R;F.undelegate(".bd-tab4","click").delegate(".bd-tab4","click",function(){var ab={domParent:"#editPageTabs_Versions",linkUUID:aa.uuid,templateData:{pagename:bd.pm.view.getDataProperty(aa,"title"),itemType:Y}};bd.Versions.loadVersions(ab)});if(T.action&&T.action==="edit"){bd.observer.notifyObserver("notifyTabContainer",{action:"rename",linkItem:{name:V}})}bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:R,before:Z,after:Q});bd.observer.notifyObserver(bd.notifications.pageMgmt.PAGE_SETTINGS_REFRESH,{targetingTab:jQuery("#editPageTabs_Targeting")})},s=function(Q){var U=i,W=bd.pm.view.getDataProperty(bd.PageMgmtTree.selectedLink,"isTargetingPage")==="true";var T=function(){var ac=E(this),aa=E(this).hasClass("bd-man-on")?true:false,ae=aa?"false":"true",ab=aa?"bd-man-off":"bd-man-on",ad=aa?"Not editable on regular pages":"Editable on regular pages",af=ac.data("id"),Z=af==="pageTitle"?af:af+"Input";E("#"+Z).data("manageable",ae);E(this).data("taglock",ae);ac.removeClass("bd-man-off bd-man-on").addClass(ab+" bd-dm-mo-disabled").attr("title",ad).on("mouseout",function(){ac.removeClass("bd-dm-mo-disabled")})};F.off("click.bd-man").on("click.bd-man",".bd-man",T);var Y=function(aj,ab){var ai=be.utils.trimString(be.utils.formatAllowedTitle(aj.pageTitle.value)).substring(0,150),an=aj.pageName.value,ae=aj.pageTemplate?aj.pageTemplate.value:null,aa=aj.Url?be.utils.formatAllowedFriendlyUrl(aj.Url.value):"",ao=Q.isMasterPage?ai:aj.linkTitle.value,ad=Q.isMasterPage?Q.sectionName:aj.sectionName.value,ak=aj.pageTags.length?aj.pageTags:[aj.pageTags],ag=(function(aq){var ar=[];for(var at=0,ap=aq.length;at<ap;at++){ar=bd.getTagsDeltaModel(aq[at],ar)}return ar})(ak),al=ag.length>0,Z=jQuery(aj).find('input[type="hidden"].bd-exposedPageProperty'),am=jQuery(aj).find('input[type="hidden"].bd-exposedLinkProperty');var ac={pageName:an,pageTitle:ai,pageTemplate:ae,modifiedBy:bd.loggedInUserId,formId:aj.id,tags:ag,hasTags:al,exposedPageProperties:L(Z),Url:aa,linkName:Q.name,linkTitle:ao,sectionName:ad,isMasterPage:Q.isMasterPage,itemType:Q.itemtype,exposedLinkProperties:L(am)};if(aj.masterPage&&aj.masterPage.value!==""){if(!U.masterPageApproved&&U.extendedMasterPage&&U.extendedMasterPage!==aj.masterPage.value.replace("[","").replace("]","")){be.utils.confirm({title:"Swap master page",message:"You are about to swap to another Master Page.<br/>This could result in incorrect display or loss of page elements.<br/>Are you sure you want to continue?",okBtnText:"Ok",cancelBtnText:"Cancel",yesCallback:function(){U.masterPageApproved=true;Y(aj,true)},closeIcon:false});return false}ac.extendedPage=aj.masterPage.value}if(ac.Url===""){ac.resetUrl=true}if(U.pageTemplateValue!==ae){ab=true}if(aj.seoCheckBox){var af=jQuery(aj.seoCheckBox).prop("checked");var ah=U.enableSEO==="true"?true:false;if(af!==ah){ac.exposedPageProperties.push({name:"enableSEO",value:af,manageable:"true"});if(af){bd.pm.settingPanel.addDefaultSEO(ac)}else{bd.pm.settingPanel.removeSEOProperties(ac)}}}bd.pm.controller.updatePage(ac).then(function(){if(ab){bd.pm.view.refreshIframe()}});return false};var S;var X=function(){if(bd.masterpage&&l){bd.masterpage.getMasterPageHtml({portalName:U.portalName,extendedMasterPage:U.extendedMasterPage?U.extendedMasterPage:"",isMasterPage:U.isMasterPage,isTargetingPage:W,defaultMasterPageName:D})}bd.initTags(".pageTagsInput");be.utils.addCustomMethodToValidator(["friendlyUrlSpecialChar"]);jQuery("#updatePageForm").validate({rules:{sectionName:{friendlyUrlSpecialChar:true}},submitHandler:Y});var ab=E(".bd-revert",F);var aa=F.find("form");var Z=aa.find("#pageName").val();if(!U.masterPage||U.masterPage==="None"){ab.parent().hide()}ab.on("click",function(ad){var ac=bd.contextRoot+"/portals/"+bd.selectedPortalName+"/pages/"+Z+"/reset";be.utils.confirm({title:"Reapply Master Page",message:"Are you sure you want to reset widgets and containers inherited from the master page to their original state? Any customizations will be removed. Other containers and widgets will not change.",okBtnText:"Ok",cancelBtnText:"Cancel",yesCallback:function(){E.ajax({type:"PUT",headers:{bbCSRF:be.utils.getCookie("bbCSRF")},url:ac}).done(function(ae){Y(aa.get(0))})},closeIcon:false});return false});w(jQuery("#updatePageForm"))};var R=function(){F.find("form").find('select[name="masterPage"]').on("change",function(ab){var aa=E(this);if(!E(this).val()||aa.val()!==U.extendedMasterPage){E(".bd-revert",F).parent().hide()}else{E(".bd-revert",F).parent().show()}});var Z=function(){var aa=E(this).val();E(".templatesList ul").remove();E(".bd-inheried-Property").html("");A(bd.selectedPortalName,aa,U.pageName||false,{isMasterPage:U.isMasterPage}).then(function(ab){bc.component.dropdown({target:S.find(".templatesList"),type:"image-select",label:ab.properties.title.value,selected:ab.name,forlabel:"pageTemplate",uid:"3125",options:I(U.pageTemplate,S.find(".templatesList"),aa,false,{isMasterPage:U.isMasterPage}),minWidth:"170px"})})};F.off("change","#masterPage").on("change","#masterPage",Z)};U.path=M();U.removeSpace=function(){return function(aa,Z){return Z(aa).replace(/\s/gi,"-")}};U.isTargetingPage=bd.pm.view.getDataProperty(Q,"isTargetingPage")==="true";S=jQuery(O("html/links/page/Edit.html",U));if(U.exposedLinkProperties.regularPro.length>0||U.exposedPageProperties.regularPro.length>0){f(S)}jQuery(".bc-form-title",S).width(F.width()-180);jQuery(".bc-form-title",S).removeClass("b-1 b-2 b-3 b-4").addClass("b-2");I(U.pageTemplate,S.find(".templatesList"),U.extendedMasterPage,U.pageName,{isMasterPage:U.isMasterPage});if(U.isMasterPage){var V=S.find(".bd-seo-toggle");bc.component.toggleSwitch({target:V,uid:"12288",name:"seoCheckBox",checked:U.enableSEO==="true"?true:false})}g={actionName:"getPageDataForOpenPageDetail",params:{li:null,linkData:bd.PageMgmtTree.selectedLink,refresh:true,action:"edit"}};u.detach();P.set({mode:"edit"});bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:S,before:X,after:R,isMasterPage:U.isMasterPage});return false},H=function(Q){var U=i,V=bd.pm.view.getDataProperty(Q,"itemType"),S=V==="targeting"?"page":V,T,W=j[V]?j[V]:false,Y=function(ab){var aa=be.utils.serializeJSON(ab),Z=jQuery(ab).find('input[type="hidden"].bd-exposedLinkProperty'),ac={linkName:aa.name,sectionName:aa.sectionName,linkTitle:aa.linkTitle,Url:V==="externalLink"?aa.Url:be.utils.formatAllowedFriendlyUrl(aa.Url),formId:ab.id,exposedLinkProperties:L(Z),extraProperties:W&&W.extraProperties?W.extraProperties(aa):[{propertyName:"menuAccessibilityTitle",propertyValue:aa.menuAccessibilityTitle}]};if(ac.Url===""){ac.resetUrl=true}if(V==="externalLink"&&ac.Url.indexOf("://")<0){r(function(){bd.pm.controller.updateLink(ac)})}else{bd.pm.controller.updateLink(ac)}return false},X=function(){if(W&&W.templateCallback){W.templateCallback(T,Q,"editMode")}be.utils.addCustomMethodToValidator(["friendlyUrlSpecialChar"]);T.find("form").validate({rules:{},submitHandler:Y});w(T.find("form"))},R=function(){};U.path=M();U.itemIcon=V;if(W&&W.templateDataCallback){U=W.templateDataCallback(U,Q,"editMode")}T=jQuery(O("html/links/"+S+"/Edit.html",U));if(U.exposedLinkProperties.regularPro.length>0||(U.exposedPageProperties&&U.exposedPageProperties.regularPro.length>0)||(U.exposedPageProperties&&U.exposedPageProperties.inheritedPro.length>0)){f(T)}g={actionName:"getLinkDataForOpenLinkDetailPanel",params:{linkData:bd.PageMgmtTree.selectedLink,action:"edit"}};u.detach();bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:T,before:X,after:R});return false},d=function(V){var S=bd.PageMgmtTree.selectedLink,Q=bd.pm.view.getDataProperty(S,"itemType"),R=bd.contextRoot+"/portals/"+bd.selectedPortalName+"/links/"+V.itemName,U="links",T=null;if(Q==="page"||Q===""){U="page"}if(Q==="externalLink"){T="extlink"}V=jQuery.extend({},{portalName:bd.selectedPortalName,itemType:U,context:R,domParent:".editPageTabs_Permissions",itemIcon:T||Q.toLowerCase(),linkTitle:bd.pm.view.getDataProperty(S,"title"),hideCloseButtons:true,closeCallback:function(){bd.pm.view.closeSettingsContainer()},savedCallback:function(W){if(Q==="state"&&bd.pm.view.getDataProperty(S,"State")){bd.observer.notifyObserver("notifyTabContainer",{action:"updateTabPanelPermission",linkItem:{name:S.name,rightXml:W}})}bd.observer.notifyObserver(bd.pm.observer.updatePermissions,S)}},V);if(c[S.securityProfile]<c.ADMIN){V.hideEditButtons=true}if(l){V.isMasterPage=S.isMasterPage;if(i&&i.pageName&&i.linkTitle===S.linkTitle){V.pageName=i.pageName}else{V.pageName=bd.pm.view.getDataProperty(S,"sectionName")}}bd.Permission.loadPermissionsAndGroups(V)},v=function(){if(!jQuery(".editPageTabs_Permissions .bd-permissionForm").length){if(bd.PageMgmtTree.selectedLink){d({itemName:bd.PageMgmtTree.selectedLink.name,isMasterPage:bd.PageMgmtTree.selectedLink.isMasterPage})}else{console.log("selectedLink undefined")}}},y=function(S){var Q=jQuery("#"+S.formId).validate(),R;R=E.trim(S.errorMessage);if(R){if(R.indexOf("is locked")!==-1){if(S.isNew){R=bd.pm.msg.ERR_LOCK_LINK_ADD}else{R=bd.pm.msg.ERR_LOCK_LINK_EDIT}}else{if(R.indexOf("not unique")!==-1){Q.showErrors({Url:"This URL is already in use"})}else{if(R.indexOf("exist")!==-1){Q.showErrors({sectionName:"This URL is already in use"})}else{if(R.search(/is already assigned/)!==-1){Q.showErrors({linkTitle:"This is already assigned to other link"})}else{bc.component.notify({uid:"6725",icon:"error",message:R})}}}}}},z=function(){bd.observer.addObserver(bd.pm.observer.pageDetails,function(Q){switch(g.actionName){case"getPageDataForAddPageAlias":m(Q);break;case"getPageDataForAddPageState":x(Q);break;case"getPageDataForOpenPageDetail":C(Q,g.params);break;case"getLinkDataForOpenLinkDetailPanel":b(Q,g.params);break;default:break}});bd.observer.addObserver(bd.pm.observer.linkDetails,function(Q){switch(g.actionName){case"getLinkDataForOpenLinkDetailPanel":b(Q,g.params);break;default:break}});bd.observer.addObserver(bd.pm.observer.checkMPFeature,function(Q){l=Q});bd.observer.addObserver(bd.pm.observer.validator,function(Q){y(Q)})},B=function(){a.delegate("input.autoCorrect","keyup",function(Q){var R=this;be.utils.delay(function(){var S=be.utils.formatAllowedFriendlyUrl(jQuery(R).val());if(S!==jQuery(R).val()){jQuery(R).val(S)}},1000)});a.delegate(".bd-titleInput","keyup blur",function(){var R=this;var U=this.value;var T=jQuery(".bd-titleEditable",this.form);var Q=jQuery(this).attr("oldTitleValue");if(Q===jQuery(T).val()){jQuery(T).val(U);if(R.form.newPageTitle){R.form.newPageTitle.value=U}else{if(R.form.pageTitle){R.form.pageTitle.value=U}}}jQuery(this).attr("oldTitleValue",U);U=be.utils.formatAllowedName(U);var S=jQuery(".bd-urlEditable",this.form);var V=be.utils.formatAllowedName(jQuery(this).attr("oldURLValue"));if(V===S.text()){jQuery(S).text(U);if(R.form.sectionName){R.form.sectionName.value=U}}jQuery(this).attr("oldURLValue",U)});a.delegate(".bd-pageSettingsTemplate, .bd-cancelEdit","click",function(Q){Q.preventDefault();bd.observer.notifyObserver(bd.pm.observer.panelToView,{$htmlContent:u})});a.delegate(".bd-tabLabel","click",function(Q){P.set({currentTabIndex:E(this).index(),currentTabName:E(this).data("tab-name"),mode:"read"})})};var K=function(){bd.masterpage.getMasterPageCatalog(bd.selectedPortalName,{isMasterPage:false},function(Q){if(Q.page&&Q.page.length){D=Q.page[0].name}else{console.log("No master pages found");D=undefined;return}})};var N=function(Q){a=Q.$pageContainer;F=Q.$pageSettingsContainer;J=Q.$portalPagesListViewport;K();bd.observer.addObserver(bd.pm.observer.masterPageDeleted,K);B();z()};return{init:N,customLinkParams:j,addCustomLink:e,getPageDataForAddPageAlias:h,addPageAlias:m,getPageDataForAddPageState:q,addPageState:x,loadTemplateListHtml:I,addNewPage:k,getPageDataForOpenPageDetail:o,getLinkDataForOpenLinkDetailPanel:t,triggerPermissionTab:v,editPageSettings:s,editLinkSettings:H,createCusProperties:f,state:P,getTab:G,activeTab:n}});window.bd.pm=window.bd.pm||{};be.utils.define("bd.pm.model",["jQuery"],function(b){var c=function(){var d=document.getElementsByTagName("iframe"),e;for(var f=d.length;f--;){e=d[f]?(d[f].contentWindow||d[f].window):window;if(e.b$&&e.b$.portal){return e.b$.portal.portalModel.getElementsByTagName("Page")[0]}}return null};var a=function(){bd.pm.model.storage=new bd.Storage({driver:"LocalStorage",options:{namespace:bd.selectedPortalName}})};return{init:function(){this.reset();bd.pm.model.getCurrentPageModel=c;a()},reset:function(){bd.pm.model.links={};bd.pm.model.rootLinks={};bd.pm.model.pageTemplates=[];bd.pm.model.cachedTemplateData={};bd.pm.model.storage=null},getLink:function(f){var e=new b.Deferred();var d=3;if(bd.pm.model.links[f]){e.resolve(bd.pm.model.links[f])}else{var g=setInterval(function(){d--;if(bd.pm.model.links[f]){clearInterval(g);e.resolve(bd.pm.model.links[f])}if(d===0){clearInterval(g);e.reject("Link "+f+" not found")}},100)}return e.promise()}}});be.utils.define("bd.pm.pService",["bd.pm.model"],function(f){var d=false,k,q;var e=function(t,u){if(t.documentElement){k=bd.xmlToJson({xml:t}).links||{link:[]}}else{k=t}if(!k.link){bd.observer.notifyObserver(bd.pm.observer.updateJstree,u);return}if(k.link.length){if(k.link.length>u.maxItem){u.loadmore=true;u.skipCount+=u.maxItem;k.link.pop()}else{u.loadmore=false}}if(u.isSelectedTree){u.openTarget=k.link.uuid;k=k.link.children}if(u.openTarget){q=a(k,false,u.isSelectedTree,u.depth||1);u.data=q;bd.observer.notifyObserver(bd.pm.observer.updateJstree,u)}else{if(k.link.constructor===Array){k.link.sort(function(w,v){if(w.name==="masterpage_root"){return 1}else{if(v.name==="masterpage_root"){return -1}else{return parseFloat(c(w,"order"))-parseFloat(c(v,"order"))}}})}q=a(k,true);bd.observer.notifyObserver(!u.event?bd.pm.observer.init:u.event,{jsonData:q,xmlData:t,params:u})}};var c=function(u,w,t){var v;if(u&&u.properties&&!u.properties.type&&u.properties[w]){v=u.properties[w].value}return v?v:t};var s=function(){};var a=function(w,z,v,y){if(y===undefined){y=0}if(!w.link){w=[]}else{if(!w.link.length){w=[w.link]}else{w=w.link}}for(var t=w.length-1;t>-1;t--){var u=w[t];if(z){u.isRoot=z}if(u.isRoot){bd.pm.model.rootLinks[u.uuid]=true}if(u.parentItemName=="masterpage_root"||u.name=="masterpage_root"){u.isMasterPage=true;if(u.securityProfile=="None"||u.securityProfile=="CONSUMER"){w.splice(t,1);continue}}var x=c(u,"title","");u.attr={id:u.uuid,"data-uuid":u.uuid};u.linkname=u.name;u.title=x;u.itemRef=c(u,"ItemRef","");u.Url=c(u,"Url");u.linkTitle=c(u,"title","");u.sectionName=c(u,"sectionName","");u.generatedUrl=c(u,"generatedUrl","");u.order=c(u,"order","0");u.depth=y;u.itemtype=c(u,"itemType","");u.parentPageRef=c(u,"parentPageRef","");u.nextPublishAction=u.nextPublishAction?u.nextPublishAction:null;u.refLink=s;u.data={title:x};if(u.children){u.children=a(u.children,false,v,y+1)}if(!v){bd.pm.model.links[u.uuid]=u}}return w};var r=function(C,z){var y=z.properties.TemplateName&&z.properties.TemplateName.value.toString();var B=null;var F=z.tags,t="",D=[],w={},E=[];for(var u=0,v=F.length;u<v;u++){if(F[u].type===""||F[u].type==="regular"){D.push(F[u].value);if(!t||!F[u].manageable){t=F[u].manageable}}else{if(!w[F[u].type]){w[F[u].type]={key:F[u].type,manageable:F[u].manageable,value:F[u].value}}else{w[F[u].type].value+=", "+F[u].value;if(!F[u].manageable){w[F[u].type].manageable=false}}}}D=D.join(", ");if(t===undefined||t===""){t=true}for(var u=0,v=bd.typeOfTags.length;u<v;u++){var A=bd.typeOfTags[u];if(!w[A]){w[A]={key:A,value:"",manageable:true}}}for(u in w){E.push(w[u])}var x={linkTitle:C.properties.title.value,Url:C.properties.Url?C.properties.Url.value:null,uuid:C.uuid,itemType:C.properties.itemType.value,generatedUrl:C.properties.generatedUrl.value,linkParentName:C.parentItemName,sectionName:C.properties.sectionName?C.properties.sectionName.value:null,masterPage:C.isMasterPage?null:"None",isMasterPage:C.isMasterPage,securityProfile:C.securityProfile,exposedLinkProperties:h(C),hasMasterPageFeature:d,contextRoot:bd.contextRoot,portalName:bd.selectedPortalName,urlRoot:be.utils.getURLRoot(),pageName:z.name,createdBy:z.createdBy.toString(),createdDate:bd.date.formatDateTime(z.createdTimestamp.toString()),modifiedBy:z.lastModifiedItem.lastModifiedBy.toString(),modifiedDate:bd.date.formatDateTime(z.lastModifiedItem.lastModifiedTimestamp.toString()),pageTitle:z.properties.title.value.toString(),pageTemplate:B,extendedMasterPage:z.extendedItemName?z.extendedItemName:null,pageTemplateType:bd.selectedPortalOptimizedFor,tagsUnmodified:z.tags,tags:D,tagsManageable:t,cusTags:E,publishState:z.publishState,lockState:z.lockState,linkLockState:C.lockState,nextPublishAction:z.nextPublishAction,exposedPageProperties:h(z),hideEditButtons:false,canEdit:true,enableSEO:z.properties.enableSEO&&z.properties.enableSEO.value?z.properties.enableSEO.value.toString():null,canonicalLink:(function(){var G=z.referencedLinks&&z.referencedLinks.linkEntry,H;if(G){H=$(G).filter(function(){if(this.key==="bd_seo_canonical"){return true}})[0];return H?H.link:null}return null})()};x.linkUrl=x.Url?x.Url:x.uuid;if(x.Url){x.hasFriUrl=true}bd.pm.model.cachedTemplateData=x;x.pageTemplate=g(y)||null;x.pageTemplateValue=y;if(z.extendedItemName&&x.isMasterPage!==true){bd.masterpage.getMasterPageItem(x.portalName,z.extendedItemName,function(G){x.masterPage=G.properties.title.value;bd.observer.notifyObserver(bd.pm.observer.pageDetails,x)})}else{if(x.isMasterPage){x.masterPage=z.extendedItemName;bd.observer.notifyObserver(bd.pm.observer.pageDetails,x)}else{bd.observer.notifyObserver(bd.pm.observer.pageDetails,x)}}};var l=function(u){var t={linkTitle:u.properties.title.value,Url:u.properties.Url?u.properties.Url.value:null,uuid:u.uuid,itemType:u.properties.itemType.value,generatedUrl:u.properties.generatedUrl.value,linkParentName:u.parentItemName,sectionName:u.properties.sectionName?u.properties.sectionName.value:null,isMasterPage:u.isMasterPage,securityProfile:u.securityProfile,hasMasterPageFeature:d,contextRoot:bd.contextRoot,portalName:bd.selectedPortalName,urlRoot:be.utils.getURLRoot(),createdBy:u.createdBy.toString(),createdDate:bd.date.formatDateTime(u.createdTimestamp.toString()),modifiedBy:u.lastModifiedBy.toString(),modifiedDate:bd.date.formatDateTime(u.lastModifiedTimestamp.toString()),publishState:u.publishState,lockState:u.lockState,exposedLinkProperties:h(u),hideEditButtons:false,canEdit:true};t.linkUrl=t.Url?t.Url:t.uuid;if(t.Url){t.hasFriUrl=true}if(u.properties.menuAccessibilityTitle&&u.properties.menuAccessibilityTitle.value&&!u.properties.menuAccessibilityTitle.value.type){t.menuAccessibilityTitle=u.properties.menuAccessibilityTitle.value}bd.pm.model.cachedTemplateData=t;bd.observer.notifyObserver(bd.pm.observer.linkDetails,t)};var h=function(u){var v=["sys2sys","admin","manager","user","anonymous"];var x,w={inheritedPro:[],regularPro:[],seoPro:[]},t=u.propertiesArray.concat([]);for(i=0;i<t.length;i++){x=t[i];if(x.name.indexOf("bd_seo")>-1){w.seoPro.push(x)}if(x.viewHint!==undefined&&$.inArray(x.viewHint,v)!==-1&&v.indexOf(b$.portal.loggedInUserRole)<=v.indexOf(x.viewHint)){x.manageable=(x.manageable!=="false");if(x.itemName!==u.name){w.inheritedPro.push(x)}else{w.regularPro.push(x)}}}return w};var p=function(v,w,u,t,x){v.isMasterPage=w;v.isTargetingPage=u;v.pageName=t;v.depth=1;v.itemRef=v.referencedItem?v.referencedItem.uuid:null;v.linkname=v.name;v.generatedUrl=c(v,"generatedUrl","");v.linkTitle=c(v,"title","");v.sectionName=c(v,"sectionName","");v.customEvent=x;bd.pm.model.links[v.uuid]=v;bd.observer.notifyObserver(bd.notifications.pageMgmt.LINK_ADDED,v);if(v.customEvent){bd.observer.notifyObserver(v.customEvent,v)}};var m=function(t){delete bd.pm.model.links[t.uuid];bd.observer.notifyObserver(bd.pm.observer.deleteLink,t)};var n=function(x,w,v,z){var u={};var y=[];var t=function(C){if(bd.pm.model.links[C.uuid]){if(!v||z){delete bd.pm.model.links[C.uuid].nextPublishAction;delete bd.pm.model.links[C.uuid].pageLockState;delete bd.pm.model.links[C.uuid].referencedItem;if(!v){delete bd.pm.model.links[C.uuid].extendedItemName}}bd.pm.model.links[C.uuid]=be.utils.mergeJsonObj(bd.pm.model.links[C.uuid],C);if(!c(C,"Url")&&c(bd.pm.model.links[C.uuid],"Url")){delete bd.pm.model.links[C.uuid].properties.Url}}else{a({link:C},false,false,C.depth!==undefined?C.depth:1)}if(v){u[C.uuid]=bd.pm.model.links[C.uuid]}var B=C.children?C.children.link:null;if(B){if(B.length===undefined){B=[B]}for(var A=0;A<B.length;A++){t(B[A])}}y.push(C.uuid)};if(x instanceof Array){for(i=0;i<x.length;i++){t(x[i])}}else{t(x)}if(v&&!bd.pm.view.start_drag){for(i in bd.pm.model.rootLinks){if(bd.pm.model.rootLinks.hasOwnProperty(i)){u[i]=bd.pm.model.links[i]}}bd.pm.model.links=u}if(w===bd.pm.observer.updateLinkDetail){bd.pm.controller.getDetails(y);bd.observer.notifyObserver(w,x)}else{if(w){bd.observer.notifyObserver(w,{data:x,linkId:y})}}};var o=function(t){d=t;bd.observer.notifyObserver(bd.pm.observer.checkMPFeature,t)};var j=function(u){var t=u.templates;if(t&&parseInt(t.totalSize,10)>0){bd.pm.model.pageTemplates=t.template}else{bd.pm.model.pageTemplates=[]}};var g=function(t){var v="Page Template Not Found";for(var u=0;u<bd.pm.model.pageTemplates.length;u++){if(t===bd.pm.model.pageTemplates[u].name){v=bd.pm.model.pageTemplates[u].properties.title.value;break}}return v};var b=function(u){var v={attr:{},children:[],data:{title:"Search Results"},isRoot:true,name:"Search Results",uuid:""};var t=a(u,false,false,1);v.children=t;bd.observer.notifyObserver(bd.pm.observer.searchResult,v)};return{createLinksModel:e,setMasterPageFeature:o,setPageTemplates:j,getProperty:c,mLinkDataTransfer:l,mPageDataTransfer:r,addLinkObj:p,removeLinkObj:m,updateLinkObj:n,getExpProperties:h,searchLinksModel:b}});window.bd.pm=window.bd.pm||{};be.utils.define("bd.PageMgmtTree",function(){return{selectedLink:{}}});be.utils.define("bd.pm.view",["jQuery","bd.pm.msg","bd.PageMgmtTree","bd.pm.controller","bd.pm.pService","bd.pm.model","bd.pm.shortcuts","bd.pm.settingPanel","bd.observer","be.utils"],function(bz,bQ,ad,U,bu,bN,a3,bq,br,aS){var aT,Q,bW,w=false,aR,q,aB=bq.state,v,a1,a4,aF,bi,f,t,L,ao,K,bf,aY,ai,aJ=[],aH,ay,aG,av,bB,bp,aI,p,bH=false,h=null,ac=false,R=null,a2=null,aN=false,an=false,s="",am=false,aD=false,bn=null,T=false,z=null,aj={},ax=false,o="",I="",aa=false,bs,O=296,b=820,aq=be.utils.cookie("savedPageListWidth")||O,bA,by=false,Y=[],a0='<span class="bd-tree-breaker" ondragstart="return false;"></span>',bP='<button class="bd-plusAddMasterPage bc-button bc-roundcorner-3"><span class="bi bi-s bi-pm-plus"></span></button>',bC='<span class="bd-tree-pageIcon bd-tree-pageTraffic"></span>',P='<span class="bd-tree-pageIcon bd-tree-publishingIcon" title="'+bQ.TITLE_PUBLISH+'"></span>',bl='<span class="bd-tree-pageIcon bd-tree-actionIcon" title="'+bQ.TITLE_ACTION+'"></span>',bb='<span class="bd-tree-pageIcon bd-tree-pageDetailsLink bi bi-s bi-pm-arrow-right" title="'+bQ.TITLE_DETAILS+'"></span>',j="bd-buttonGradientGreyDisabled",ap='<span class="bc-icn bc-pub-in-progress" title="Item is in publication process"></span><div class="bd-pub-button-container" style="display:none;"><div class="bd-pub-button-container-inner"><span class="bc-icn bc-pub-publish bc-pub-publish-inactive"></span><span class="bc-icn bc-pub-unpublish bc-pub-unpublish-inactive"></span></div></div>',bU={page:{icon:"bc-page",friendlyName:"Page"},landingPage:{icon:"bc-page bc-home",friendlyName:"Default Landing Page"},alias:{icon:"bc-alias",friendlyName:"Alias"},state:{icon:"bc-state",friendlyName:"State"},divider:{icon:"bc-divider",friendlyName:"Divider"},externalLink:{icon:"bc-external",friendlyName:"External Link"},menuHeader:{icon:"bc-header",friendlyName:"Header"},masterpage:{icon:"bc-masterpage",friendlyName:"Master Page"},stateLink:{icon:"bc-state",friendlyName:"State Alias"},redirect:{icon:"bc-redirect",friendlyName:"Redirect"}},aU={currentView:"page",set:function(bX){Object.keys(bX).forEach(function(bY){if(typeof this[bY]!=="function"&&this.hasOwnProperty(bY)){this[bY]=bX[bY]}}.bind(this))},reset:function(){this.currentView="page"}},aX=function(bX){var bY="page";if(bX){bY=aW(bX,"itemType");if(aW(bX,"isDefaultLandingPage")==="true"){bY="landingPage"}if(bY==="page"&&bX.isMasterPage){bY="masterpage"}}return bY},e=function(bX){var bY=aX(bX);return bU[bY]},bF=function(bX){if(typeof bX==="string"&&bX!==""){return'<span class="bd-tree-itemtype bc-icn '+bU[bX].icon+'" title="'+bU[bX].friendlyName+'"></span>'}else{return'<span class="bd-tree-itemtype bc-icn "></span>'}},az={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4,NONE:-5},aC=be.utils.cookie(bd.selectedPortalName+"-rootLink"),r=false,A={assetPickerSearchTree:0,assetPickerTree:0,pageMgmtTree:0,pageMgmtSearchTree:0},bE=function(bX){aR=bX.oGadgetBody;q=bz(aR);bd.observer.addObserver(bd.pm.observer.init,function(bY){aO(bY.jsonData,bY.xmlData)});bN.init();U.renderJSTree();U.getPageTemplates();a3.attach(aR,Z);aN=false;window.bd.pm.oSettings={};a1=bz(".bd-pageFilter",aR);a4=bz(".bd-buttonOptionsSlide",aR);aF=bz(".bd-pageContainer",aR);aH=bz(".bd-tdIframeContainer");bi=bz(".bd-iframeContainer");f=bz(".bd-tdPagesContainer .spacer",aR);L=bz(".bd-buttonOptionsSlideOpen",aR);ay=bz(".bd-addPageButtons",aR);bf=bz(".bd-pageSettingsContainer",aR);aY=bz(".bd-portalPagesListViewport",aR);t=bz("#bd-iframeOverlay");aG=bz(".bd-pm-view-toggle",aR);av=bz(".bd-assetsPicker-viewport",aR);aI=bz(".bd-pagesListContainer",aR);bz(".bd-titleContainer .bd-pageTitle",aR).text(bd.selectedPortalTitle);bd.PageMgmtTree.publishing=null;bd.PageMgmtTree.searchActive=false;if(bd.pubMode){aT=b$.require("bd.publishing.Publishing");Q=aT&&portal.config.isPublishAppAvailable}aF.addClass("bd-pub-disabled");if(Q){bd.PageMgmtTree.publishing=new aT(true);bd.PageMgmtTree.publishing.addObserver(bd.PageMgmtTree.publishing.EVENT_READY,i)}bc.component.button({target:bz(".bd-pm-action-publish",aR),type:"primary",cls:"bd-pageMntPublishBtn",label:"Publish",uid:"1212"});bz(".bd-pm-action-publish a",aR).attr("data-ng-click","openWizard()");require(["zenith/widgets/PublishWizard/scripts/app","css!zenith/widgets/PublishWizard/styles/base"],function(bY){angular.bootstrap(bz(".bd-pm-action-publish")[0],[bY.name])});bp=bc.component.toggleButton({target:bz(".bd-pm-view-toggle",aR),mainCls:"bd-pm-view-toggle",buttons:[{label:"Pages",cls:"bd-pm-pageview",active:true,uid:"1215",handler:function(){aU.set({currentView:"page"});aQ("pageMgmt");bz(".bd-addPageButtons").show();aF.removeClass("bd-assetPicker-on");bI();if(bd.pm.view.resizePageMgmt){bz(window).trigger("resize.accordion");bd.pm.view.resizePageMgmt=false}}},{label:"Content",cls:"bd-pm-contentview",uid:"1216",handler:function(){if(bz(".bd-pub-messagesContainer").is(":visible")){var bY=bz(".bd-ap-accordion-active > a"),bZ=bz("#ROOT > a");if(bY){if(bZ){setTimeout(function(){bZ.click()},50)}}}if(bz(".bd-pub-messagesContainer").height()!==0&&bz(".bd-pub-messagesContainer").is(":visible")){bz("#ROOT").css({bottom:"40px"})}if(bd.assetsPicker){aU.set({currentView:"assets"});var b0={id:"bd-pageMgmt-ap-jstree",target:av,before:function(){aQ("assetPicker");bz(".bd-addPageButtons").hide();bI()},hidePagesList:bS,errorCall:function(){bp.find(".bd-pm-pageview").click()}};aF.addClass("bd-assetPicker-on");bd.assetsPicker.init(null,b0)}}}]});at();if(!aC){aC="navroot_mainmenu"}V();bd.observer.addObserver(bd.pm.observer.initFirstLevel,function(b0){var b1=aY.children("ul").children("li:first"),bZ=b1.attr("id"),bY=bd.pm.observer.selectFirstPage;bd.PageMgmtTree.selectedLink=a5(bZ);if(!b0){if(h){bd.pm.controller.renderJSTree(h.attr("id"))}bd.pm.controller.renderJSTree(bZ,null,bY)}else{if(b0.isSelectNode===false){bd.pm.controller.renderJSTree(bZ)}}});bd.observer.addObserver(bd.pm.observer.getSelectedLinkTree,function(b0){if(aF.hasClass("bd-assetPicker-on")){bp.find(".bd-pm-pageview").click()}if(!b0){b0=m()}if(!b0.uuid){b0.uuid=m().uuid}var bZ=a().find("#"+b0.uuid);if(!bZ.length||b0.forceRefresh){if(b0.cookieMenuHeader==="masterpage_root"){var bY={isSelectNode:false};if(!h){bd.observer.notifyObserver(bd.pm.observer.initFirstLevel);return}bd.observer.notifyObserver(bd.pm.observer.initFirstLevel,{isSelectNode:false})}else{if(h&&b0.cookiePortal){bd.pm.controller.renderJSTree(h.attr("id"))}}bd.pm.controller.getSelectedLinkTree(b0.uuid);aa=b0.uuid}else{var b1=bZ.closest("li.bd-root-link").children("ul");c(b1,b0.uuid)}});bd.observer.addObserver(bd.pm.observer.selectFirstPage,function(bY){ae(bY)});bd.observer.addObserver(bd.pm.observer.updateJstree,function(b1){var bY=a();bY.find(".jstree-loading").removeClass("jstree-loading");if(b1.data){if(b1.openTarget){y(b1)}if(aa&&b1.linkId){var bZ=a5(aa);if(bZ){aa=false;bY.jstree("select_node","#"+bZ.uuid,true)}}if(!bd.pm.view.updateView){bt()}var b2=a5(o);if(o&&b2&&b2.isRoot){var b0=bY.find("#"+o).find(".bd-tree-pageCurrent").parent("li");if(b0.length){if(a5(b0.attr("id"))){bY.jstree("select_node","#"+b0.attr("id"),true)}}}}else{if(!b1.data&&ax){ax=false;if(z){z()}}if(b1.parentItemName==bd.selectedPortalName){bw()}}if(b1&&b1.event&&!b1.openTarget){bd.observer.notifyObserver(b1.event,b1)}});bd.observer.addObserver(bd.pm.observer.panelToView,function(bY){if(bY.action==="edit"){bd.PageMgmtTree.selectedLink=bd.pm.model.links[bd.PageMgmtTree.selectedLink.uuid];aw(bd.PageMgmtTree.selectedLink,true)}bh(bY);bt()});bd.observer.addObserver(bd.pm.observer.addLink,function(bZ){if(bZ.isMasterPage&&!bZ.isDuplicatedLink){var bY=bd.contextRoot+"/portals/"+bd.selectedPortalName+"/links/"+bZ.linkname;bd.masterpage.setMPLinkPermissionInheritedOnCreation(bY,bd.selectedPortalName)}B(bZ,null,true);bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_UPDATED,{uuid:bZ.uuid});if(bd.masterpage&&bd.masterpage.model){delete bd.masterpage.model}});bd.observer.addObserver(bd.pm.observer.deleteLink,function(bY){if(aN){H(bY.uuid)}else{a8(bY)}bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_UPDATED,{uuid:bY.uuid});if(bd.masterpage&&bd.masterpage.model){delete bd.masterpage.model}});bd.observer.addObserver(bd.pm.observer.updateLinkDetail,function(bY){var bZ=aW(bY,"title");bo(bY.uuid,bZ);G(bY.uuid,bZ);bv(bY.uuid,true);bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_UPDATED,{uuid:bY.uuid,title:bZ});if(bd.masterpage&&bd.masterpage.model){delete bd.masterpage.model}});bd.observer.addObserver(bd.pm.observer.revertTree,function(bY){if(bY.message==="Another user may have changed the hierarchy."){bd.pm.controller.renderJSTree()}C(bn);aL(bY)});bd.observer.addObserver(bd.pm.observer.searchResult,function(b1){if(aF.hasClass("bd-assetPicker-on")){return}bz(".bd-addPageButtons").hide();bI();if(b1){d(b1);var bY=[];for(var b0=0,bZ=b1.children.length;b0<bZ;b0++){bY.push(b1.children[b0].uuid)}if(!bY.length){bJ()}bd.pm.controller.refreshLinks(bY,bd.pm.observer.updateJstree)}});bd.observer.addObserver(bd.pm.observer.cancelSearch,function(bZ){if(!aF.hasClass("bd-assetPicker-on")){bz(".bd-addPageButtons").show()}aN=false;aJ=bz("#pageMgmtSearchResultJstree");if(aJ.length){aJ.remove();bI();aY.show();bd.PageMgmtTree.activeView=aY;D();if(I){aD=true;bd.observer.notifyObserver(bd.pm.observer.getSelectedLinkTree,{uuid:I})}else{var bY=aY.find("a.bd-tree-pageCurrent");if(bY.length){bY.parent("li").trigger("click")}else{aY.find("li.bd-pageMgmt-accordion-active a").trigger("click")}}}});bd.observer.addObserver(bd.pm.observer.errorMsg,function(bY){aL(bY)});bd.observer.addObserver(bd.pm.observer.updateOrder,function(b0){var bY=b0.data,bZ;if(bd.PageMgmtTree.selectedLink.uuid===bY.uuid){bd.PageMgmtTree.selectedLink=bY}if(bz("#editPageTabs_Settings",bf).length){N(true)}bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_UPDATED,{uuid:bY.uuid,title:bY.properties.title.value});bZ=bd.PageMgmtTree.selectedLink;if(!bZ.Url&&aW(bZ,"ItemRef")){if(bY.uuid===bZ.uuid||aY.find("#"+bY.uuid).find("#"+bZ.uuid).length){am=true;aa=bZ.uuid}}});bd.observer.addObserver(bd.pm.observer.updateVisibleLink,function(bY){D()});bd.observer.addObserver(bd.pm.observer.openCurrentLinkSettings,function(bY){N();setTimeout(function(){bd.pm.settingPanel.editPageSettings(bd.PageMgmtTree.selectedLink)},200)});bd.observer.addObserver(bd.pm.observer.updatePermissions,function(bY){bd.pm.controller.refreshLink(bY.uuid,-1,bd.pm.observer.updateJstree,false)});bd.observer.addObserver(bd.pm.observer.navPrefShow,function(bZ){var b0=null,bY;an=bZ.isNav;bk()});bd.observer.addObserver(bd.pm.observer.refreshTab,function(bZ){if(bZ.eventType&&bZ.eventType==="click"){var bY=aY.find("#"+bZ.uuid);if(bY.length&&bY.is(":visible")){aD=true;aY.jstree("select_node","#"+bZ.uuid,true);if(bZ.hideSettingsPanel){bI()}return}}aD=true;if(bZ.forceRefresh){bv(null,true)}bd.observer.notifyObserver(bd.pm.observer.getSelectedLinkTree,bZ)});bd.observer.addObserver("slidingInfoPanel.assetsPicket",function(bY){if(bY==="closeSettingPanel"){bf.hide();bI()}else{bh({isAssetPicker:true,$htmlContent:bY.htmlContent,isRefreshInfoPanel:bY.isRefreshInfoPanel})}});bd.observer.addObserver("nicEditOpenAssetPicker.assetPicker",function(bY){if(aF.hasClass("bd-pageContainerClosed")){bO(true);bp.find(".bd-pm-contentview").click()}else{if(aF.hasClass("bd-assetPicker-on")){av.hide().fadeIn()}else{bp.find(".bd-pm-contentview").click()}}});bd.observer.addObserver(bd.pm.observer.contentLocked,function(){bc.component.dialog({title:"Error updating content",message:"Content might be locked for publishing. It's recommended to reload page management",buttons:[{title:"OK",type:"white",callback:function(){}}]})});bd.pm.settingPanel.init({$pageContainer:aF,$pageSettingsContainer:bf,$portalPagesListViewport:aY});U.checkMPFeature()},aA={themes:{url:bd.contextRoot+"/static/dashboard/js/lib/jstree/themes/default/style.css",dots:false,icons:false},ui:{select_limit:1},dnd:{drop_check:function(bX){bX.result=[];bd.observer.notifyObserver(bd.pm.observer.jsTreeDropCheck,bX);return(bz.inArray(true,bX.result)>-1)},drop_finish:function(bX){bd.observer.notifyObserver(bd.pm.observer.jsTreeDropFinish,bX)}}},bR=function(bY){var bX=bd.pm.view.$currentRootLink.attr("id"),bZ;if(bY.uuid===bX){return}else{if(bY.parentItemName==="masterpage_root"){bZ=bY.parentItemName}else{if(typeof bX!=="undefined"){bZ=a5(bX).name}}if(typeof bZ!=="undefined"){bd.pm.model.storage.set("jstree_select",{cookiePortal:bd.selectedPortalName,cookieMenuHeader:bZ,uuid:bY.uuid})}}},m=function(){return bd.pm.model.storage.get("jstree_select")||{}},bJ=function(){bd.pm.model.storage.unset("jstree_select")},al=function(bY){var bZ=bz("#"+bY),bX=bZ.parents("li").last();return(bX.length?bX:bZ)},bK=function(b1,b0){if(document.activeElement){document.activeElement.blur()}var b4=b0.rslt.obj,b5=b4.attr("id"),b3=a5(b5),b6=b4.children("a:first"),bY=bd.PageMgmtTree.selectedLink?bd.PageMgmtTree.selectedLink.uuid:null;var bZ=b0.rslt.e&&b0.rslt.e.target;if(bz(bZ).hasClass("bc-pub-publish")||bz(bZ).hasClass("bc-pub-unpublish")){return}if(!b3){if(x(b4[0])){D()}else{bx(b5,function(){aa=b5})}return}var b2=al(b3.uuid);if(b2&&b2.length){bd.pm.view.$currentRootLink=b2;bR(b3)}if(an){bd.observer.notifyObserver("changeNavPref",{path:aY.jstree("get_path","#"+b3.uuid),uuid:b3.uuid,title:b3.title});M(b4,b6);return}if(b0.rslt.e==="noRefreshIframe"){am=false}if(bd.PageMgmtTree.selectedLink&&bd.PageMgmtTree.selectedLink.uuid){if(aW(bd.PageMgmtTree.selectedLink,"ItemRef")){R=JSON.parse(JSON.stringify(bd.PageMgmtTree.selectedLink))}}else{R=JSON.parse(JSON.stringify(b3))}if(aW(b3,"ItemRef")){bd.currentLinkUuid=b5}bd.PageMgmtTree.selectedLink=b3;o="";if(!b3.isRoot){M(b4,b6);if(bz("#editPageTabs_Settings",bf).length){if(bY!==b3.uuid){N(true)}}}else{bI();var bX=b4.find(".bd-tree-pageCurrent").parent("li");if(!bX.length){}else{if(a5(bX.attr("id"))){aY.jstree("select_node","#"+bX.attr("id"),true);return}else{o=b3.uuid}}}if(!aD){aw(b3,am);am=false}else{aw(b3,am);aD=false;if(Q){bd.PageMgmtTree.publishing.showHideBlocker(b3)}aE(b3)}bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_SELECT,{linkData:b3})},aO=function(bX,bY){aY.hide();aY.jstree(bz.extend({},aA,{plugins:["themes","json_data","ui","crrm","dnd","hotkeys","unique"],hotkeys:{del:function(){}},json_data:{data:bX},core:{animation:150},crrm:{move:{default_position:"first",check_move:function(bZ){bW=false;var b0=bZ.o.attr("id"),b2=a5(b0),b1=bZ.np.attr("id"),b4=a5(b1),b3;if(!b2){return false}if(bd.PageMgmtTree.publishing){if(b2.lockState===bd.PageMgmtTree.publishing.STATE_LOCKED){bW=bd.pm.msg.MSG_ITEM_LOCKED;return false}if(b4&&b4.lockState===bd.PageMgmtTree.publishing.STATE_LOCKED){bW=bd.pm.msg.MSG_ITEM_LOCKED;return false}}if(!b4){return false}if(az[b2.securityProfile]<az.CONTRIBUTOR){return false}if(az[b4.securityProfile]<az.CONTRIBUTOR){return false}b3=this._get_parent(bZ.o);if(b3===-1){return false}if(aW(b4,"itemType")==="divider"){return false}if(b2.isMasterPage===true){if(aW(b4,"parentItemName")==="masterpage_root"){return false}if(b4.name!=="masterpage_root"){return false}}else{if(b4.name==="masterpage_root"){return false}if(b4.isMasterPage===true){return false}}if(b2.itemtype==="state"&&b2.parentItemName!==b4.linkname){return false}if(bZ.op[0].isRoot){s=bZ.op.children("ul").attr("style")}if(bZ.p!=="after"&&bZ.r.hasClass("bd_dropOnPanel_last")){return false}return true}}}})).bind("load_node.jstree",function(b9,b3){var b2=bz(this).find("a"),b4,b6,ca,cc,b5,cb,b8,b7,b1,b0,bZ=m();if(bZ&&bZ.cookiePortal===bd.selectedPortalName){b7=bd.pm.observer.getSelectedLinkTree}else{b7=bd.pm.observer.initFirstLevel}for(b4=0,b6=b2.length;b4<b6;b4++){ca=bz(b2[b4]);cc=ca.closest("li");b5=cc.attr("id");cb=a5(b5)||{};cc[0].isRoot=true;if(cb.name==="masterpage_root"){h=cc;cc.addClass("bd-tree-masterpage").removeClass("jstree-closed");cc.prepend(a0);if(az[cb.securityProfile]>=az.CREATOR){cc.append(bP)}cc.children("ul").addClass("bd-tree-scrollbar");bd.observer.notifyObserver(b7)}else{cc.removeClass("jstree-closed");cc[0].isLoaded=false}cc.addClass("bd-root-link");ca.addClass("bd-tree-root");ca.addClass("bd-bdDrag")}if(!h){bd.observer.notifyObserver(b7)}if(!aF.hasClass("bd-assetPicker-on")){aY.show()}bd.observer.notifyObserver(bd.pm.observer.jsTreeLoadNode,{event:b9,data:b3,masterPageRoot:h,container:aY});ay.append(bV)}).bind("select_node.jstree",bK).bind("open_node.jstree",function(b2,b1){var b4=b1.rslt.obj,b3=b4.attr("id");if(!b4[0].isLoaded||b4.children("ul").length===0){bz(b4).addClass("jstree-loading");ax=true;bd.pm.controller.renderJSTree(b3);b4[0].isLoaded=true}else{var b0=b4.data("loadmore");var bZ=b4.children("ul:first");if(b0===true){bZ.append('<li class="bd-pageMgmt-loadMoreTrigger"></li>')}bZ.promise().done(function(){if(bz(".bd-pageMgmt-accordion-active ul",aY).length>0){D()}})}}).bind("close_node.jstree",function(b1,b0){var bZ=b0.rslt.obj;bZ.children("ul").children(".bd-pageMgmt-loadMoreTrigger").remove();bZ.children("ul").promise().done(function(){D()})}).bind("move_node.jstree",function(b0,bZ){a6();aj=bZ;if(ax){z=l}else{l()}}).bind("refresh.jstree",function(b0,bZ){ay.css({top:bd.pm.view.$currentRootLink.position().top})}).undelegate("a","mouseenter.jstree").undelegate("a","mouseleave.jstree").delegate("a","click",function(bZ){var b0=bz.jstree._reference(aY);b0.hover_node(bZ.target);bz(bZ.delegateTarget).find(".jstree-hovered").removeClass("jstree-hovered")});if(Q&&bd.PageMgmtTree.publishing){bd.PageMgmtTree.publishing.handlersUpdated=false;bd.PageMgmtTree.publishing.update({xml:bY,jsonData:bX,pageContainer:aF,pageList:aY})}},a6=function(){var bX=bz.jstree._reference(aY);if(bd.pm.view.$currentRootLink&&bd.PageMgmtTree.selectedLink&&bd.pm.view.$currentRootLink.find("#"+bd.PageMgmtTree.selectedLink.uuid).length===0){bX.deselect_all();bX.select_node("#"+bd.pm.view.$currentRootLink.attr("id"),true)}},l=function(){var b0=aj;var b2=bd.PageMgmtTree.selectedLink.uuid,bX=b0.rslt.o,b1=bX.attr("id"),bY=a5(b1),b5=b0.rslt.np,b4=b5.attr("id"),b3=a5(b4),b6=function(){var b9=b0.rslt.op,b7=a5(b9.attr("id")),b8;if(b7&&b7.isRoot&&b9.children("ul").length===0){b9.append('<ul class="bd-tree-scrollbar" style="'+s+'"></ul>')}if(bY.name){b8={linkName:bY.name,order:aV(bX),parentItemName:b3.name?b3.name:"navroot_mainmenu",hasTags:bY.tags.length>0?true:false,isMasterPage:bY.isMasterPage,tags:bY.tags};bd.pm.controller.updateLink(b8)}},bZ=function(){bz.jstree.rollback(b0.rlbk);b0.inst.deselect_all();b0.inst.select_node("#"+b2,true)};bn=b0;bn.selectedNodeUUID=b2;if(!bY.isRoot){if(bX.find(".bd-tree-publishingIcon").hasClass("bd-pub-selected")){be.utils.confirm({title:bd.pm.msg.TTL_MOVE_PUB_ITEMS,message:bd.pm.msg.MSG_MOVE_PUB_ITEMS,yesCallback:updateLinkFinish,noCallback:bZ,cancelBtnText:bd.pm.msg.BTN_CANCEL_TXT,okBtnText:bd.pm.msg.BTN_MOVE_TXT})}else{b6()}}else{bZ()}aj={};z=null},aP=function(bX,bY){var bZ=aX(bX);if(az[bX.securityProfile]<az.CONTRIBUTOR){bY.addClass("bd-tree-viewOnly")}bY.addClass("bd-tree-page-pub-state-none");bY.prepend(bC).append(bl);if(az[bX.securityProfile]>=az.CREATOR){bY.append(ap)}if(bZ==="divider"){bY.addClass("bd-divider")}bY.prepend(bF(bZ)).append(bb)},u=function(b3,b1,b5,bX,b6){var b2=aW(b5,"title")||"",b0=[],bY=aM(b5.uuid,b2,bX,b5);b0.push(bY);var bZ=be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/views/PageMgmt.jstreeTemplate.html",{jsTreeNodes:b0});var b4=aY.find("#"+b3);if(!b4.length){b4=aY.find("li").first();b1="inside"}if(b1=="after"){b4.after(bZ)}if(b1=="last"){if(b4.children("a.bd-tree-root").length>0){b4.children("ul").append(bZ)}else{b4.parent("ul").append(bZ)}}if(b1=="inside"){b4.attr("class","jstree-open");if(!b4.children("ul").length){b4.append("<ul></ul>")}b4.children("ul").prepend(bZ)}b6()},aM=function(bZ,bX,b3,bY){var b2=bX?bX:"",b1=aX(bY),b0={id:bZ,state:b3===""?"jstree-leaf":b3==="open"?"jstree-open":"jstree-closed",title:b2,"class":"bd-tree-page",viewOnly:false,hasPublishing:true,isDivider:false,itemTypeIcon:bF(b1),titleAciton:bd.pm.msg.TITLE_ACTION,titleDetails:bd.pm.msg.TITLE_DETAILS,titlePubProgress:bd.pm.msg.TITLE_PUB_PROGRESS};if(az[bY.securityProfile]<az.CONTRIBUTOR){b0.viewOnly=true}if(b1==="divider"){b0.isDivider=true}return b0},B=function(b4,bY,b3){var bX="after",b1=bY&&a5(bY)||bd.PageMgmtTree.selectedLink,b0=aY.children("ul:first"),bZ,b2="";if(b1.isRoot){bX="last"}if(b1.isMasterPage&&!b4.isMasterPage){bZ=b0.children("li.bd-pageMgmt-accordion-active").attr("id");bX="last"}else{if(!b1.isMasterPage&&b4.isMasterPage){bZ=b0.children(".bd-tree-masterpage").attr("id");bX="last"}else{bZ=b1.uuid}}if(b4.isTabStateLink){bX="inside"}if(b4.isDuplicatedLink&&aW(b4,"hasChildren")==="true"){b2="closed"}u(bZ,bX,b4,b2,function(){var b6=aY.find("#"+b4.uuid),b5=b6.children("a");b6[0].isLoaded=true;bI();bd.observer.notifyObserver(bd.pm.observer.initActionDropdown,b6);if(!aN){if(b3!==false){b5.trigger("click")}if(bX=="last"){b6.after(b6.siblings("li.bd-pageMgmt-loadMoreTrigger"))}D(b3)}bd.observer.notifyObserver(bd.pm.observer.addJstreeNode,{linkUUID:b4.uuid,node:b6})})},bm=function(bZ){if(bZ&&bZ.uuid){var bX=aY.find("#"+bZ.uuid).children("a:first"),bY=bX.find(".bd-tree-itemtype"),b1="",b0=aW(bZ,"itemType"),b2=b0?bU[b0].icon:null;if(b2){bz.each(bU,function(b3,b4){b1+=bU[b3].icon+" "});bY.removeClass(b1).addClass(b2);bY.attr("title",bU[b0].friendlyName)}}},bo=function(b2,b3){var b0=aY.find("#"+b2).children("a:first"),bZ,bX,b1,bY;if(b0&&b0[0]&&b0[0].childNodes){bY=b0[0].childNodes;if(b3!==undefined){for(bZ=0,bX=bY.length;bZ<bX;bZ++){b1=bY[bZ];if(b1.nodeType===3){b1.nodeValue=b3;break}}}b0.attr("title",b3);if(b0.is(":visible")){bz.jstree._reference(b0).select_node(b0,true,"noRefreshIframe")}}},a8=function(bZ){var bX=aY.find("#"+bZ.uuid);var bY;if(bX.prev().length){bY=bX.prev()}else{if(bX.next().length){bY=bX.next()}else{bY=bX.parent("ul:first").parent("li:first")}}bY.children("a").trigger("click");if(bY.get(0).isRoot){bi.attr("src","");bd.PageMgmtTree.selectedLink={}}bX.remove()},y=function(b0){var b1=b0.data||b0.jsonData,b5=b0.openTarget?b0.openTarget:bd.PageMgmtTree.selectedLink.uuid,ca=aY.find("#"+b5),bY="",bZ;if(b0.selectedLinkId){aY.find("#"+b0.openTarget).children("ul").html("")}else{if(b1&&document.getElementById(b1[0].uuid)){if(b0.event){bd.observer.notifyObserver(b0.event,b0)}return}}ca[0].isLoaded=true;ca.children("ul").children(".bd-pageMgmt-loadMoreTrigger").remove();if(b0.loadmore!==undefined&&b0.skipCount!==undefined){ca.data({loadmore:b0.loadmore,skipCount:b0.skipCount})}var bX=function(ch){var ci=[],cg;for(var cf=0,cd=ch.length;cf<cd;cf++){bZ=ch[cf];bY="";if(b0.openPath){for(var ce=0;ce<b0.openPath.length;ce++){if(bZ.name==b0.openPath[ce]&&bZ.children.length>0){bY="open"}}}if(b0.isSelectedTree&&bZ.children.length>0){bY="open"}if(!bY&&aW(bZ,"hasChildren")==="true"){bY="closed"}cg=aM(bZ.uuid,aW(bZ,"title"),bY,bZ);cg.children={};if(bZ.children&&bZ.children.length>0){cg.children.jsTreeNodes=bX(bZ.children);cg.isRenderChildren=true}else{cg.isRenderChildren=false}ci.push(cg)}return ci};var cb=bX(b1),b9={jsTreeNodes:cb},b4=be.utils.loadTemplateByUrl(be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/views/PageMgmt.jstreeTemplate.html"),b6={partialTemp:b4};var b3=Mustache.to_html(b4,b9,b6);if(!ca.children("ul").length){ca.append("<ul></ul>")}var b8=ca.children("ul");if(!ca[0].isRoot){b8.hide().append(b3).slideDown(150,function(){bd.observer.notifyObserver(bd.pm.observer.updateVisibleLink)})}else{b8.append(b3)}bd.observer.notifyObserver(bd.pm.observer.initActionDropdown,b8);var cc=b8.find("li.jstree-open");for(var b2=0,b7=cc.length;b2<b7;b2++){cc[b2].isLoaded=true}if(b0.loadmore===true){ca.children("ul:first").append('<li class="bd-pageMgmt-loadMoreTrigger"></li>');T=false}if(bd.PageMgmtTree.publishing&&!bd.PageMgmtTree.publishing.firstCall){bd.PageMgmtTree.publishing.updatePageIcons()}if(b0.event){bd.observer.notifyObserver(b0.event,b0)}ax=false;if(z){z()}if(b0.selectedLinkId){c(ca,b0.selectedLinkId)}else{D()}b0.openNode=ca;bd.observer.notifyObserver(bd.pm.observer.openJstreeNode,b0)},c=function(bZ,b0){var bY=bZ.find("#"+b0+" a");if(bY.length){if(x(bY[0],bZ[0])){var bX=a();bX.jstree("select_node","#"+b0,true)}else{bx(b0,function(){aa=b0})}}},bw=function(){aY.append(bz('<div class="no-links">No navigation link(s).</div>'))},C=function(bX){if(!bX||!bX.rlbk){return}bz.jstree.rollback(bX.rlbk);bX.inst.deselect_all();bX.inst.select_node("#"+bX.selectedNodeUUID,true)},bj=function(){aY.jstree("refresh");setTimeout(function(){aw(bd.PageMgmtTree.selectedLink,true)},500)},D=function(bY){Y=[];var bX=a().find(".bd-pageMgmt-accordion-active ul");if(bX.length>0){Y=au(bX)}if(h){Y=Y.concat(au(h.children("ul")))}if(!bY){bd.pm.controller.refreshLinks(Y,bd.pm.observer.updateJstree)}},au=function(bZ){var bY=[];var bX=bZ.find("li");if(bX.length){bX.each(function(b1,b0){var b2=bz(b0).children("a")[0];if(x(b2,bZ[0])){bY.push(b0.id)}})}return bY},x=function(bY,bX){var bZ=bY.getBoundingClientRect(),b0=bX?bX.getBoundingClientRect():bz(bY).closest(".bd-root-link")[0].getBoundingClientRect();return(b0.top-bZ.top<20&&bZ.bottom-b0.bottom<20)},bV,bM,at=function(){bV=bc.component.dropdown({type:"action-select",uid:"9873",noSelect:"true",cssClass:"bd-pageMgmt-add",maxHeight:225,options:[{name:"Page",classname:"bd-addPageButton"},{name:"External Link",classname:"bd-addExternalLinkButton"},{name:"Divider",classname:"bd-addDividerButton"},{name:"Header",classname:"bd-addHeaderButton"}]});bM=bV[0].dropdownOptions},a5=function(bX){try{var bY=bd.pm.model.links[bX];return bY}catch(bZ){D();return null}},aW=function(b1,b0){var bZ,bY,bX,b4,b3;if(!b1){return null}try{if(!b0){b4=b1.propertiesArray;bZ={};for(bY=0,bX=b4.length;bY<bX;bY++){b3=b4[bY];bZ[b3.name]=b3.value}}else{bZ=b1.properties[b0]&&b1.properties[b0].value}}catch(b2){bZ=null}return bZ},aV=function(bY){if(bY&&bY.length===1){var b2=bY.prev().attr("id"),b1=bY.next().attr("id"),b0=parseFloat(aW(a5(b2),"order")),bZ=parseFloat(aW(a5(b1),"order")),bX;b0=isNaN(b0)?(!isNaN(bZ)&&bZ<-1000?bZ-10:-1000):b0;bZ=isNaN(bZ)?(!isNaN(b0)&&b0>1000?b0+10:1000):bZ;bX=(b0+bZ)/2;if(bX==bZ){bX+=1}return bX}else{return 1}},a9=function(b4){var bY,b3,b0,bX=0,b2,b1,bZ;if(b4){bY=aY.find("#"+b4)}else{bZ=aY.find(".bd-pageMgmt-accordion-active");bY=bZ.find("> ul > li:first")}if(bY){b3=bY.attr("id");b0=a5(b3);b2=parseFloat(aW(b0,"order"));b1=parseFloat(aW(a5(bY.next().attr("id")),"order"));b2=isNaN(b2)?10:b2;b1=isNaN(b1)?1000:b1;bX=(b2+b1)/2}return String(bX)},bT=function(b0,b2,bZ){var bX=(b0==="wide"),bY=aF.hasClass("bd-pagesLayoutWide"),b1=(bY&&!bX||!bY&&bX);if(bz.isFunction(bZ)){bZ()}setTimeout(function(){var b3=bf.find(".bd-tabLabel").eq(aB.currentTabIndex).hasClass("bd-hiddenTabLabel");if(b3){return}aF.toggleClass("bd-pagesLayoutWide",bX);bf.animate({right:(bX?-500:0)},{duration:100,easing:"linear",complete:b2});if(bX){a4.addClass("bd-sliderOpen")}else{if(!bY&&bz.isFunction(b2)){b2()}}},25)},bI=function(){if(!aF.hasClass("bd-pageContainerClosed")){a4.removeClass("bd-sliderOpen");bf.empty();bT()}bz(document.body).trigger("click.dropDown");ac=false;aB.set({isOpen:false})},ba=function(b1,bZ){var bY,bX={pageName:false},b0=function(b2){bY=bz(be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/html/pages/editPageTabs.html",b2));bf.hide().html(bY)};switch(b1){case"externalLink":b0(bX);bd.pm.settingPanel.addCustomLink(bd.pm.settingPanel.customLinkParams[b1]);break;case"divider":bd.pm.settingPanel.addCustomLink(bd.pm.settingPanel.customLinkParams[b1]);break;case"menuHeader":b0(bX);bd.pm.settingPanel.addCustomLink(bd.pm.settingPanel.customLinkParams[b1]);break;case"alias":b0(bX);bd.pm.settingPanel.getPageDataForAddPageAlias(bZ);break;case"state":bY=null;break;case"stateLink":b0(bX);bd.pm.settingPanel.getPageDataForAddPageState();break;case"page":b0(bX);bd.pm.settingPanel.addNewPage(bZ);break;case"redirect":b0(bX);bd.pm.settingPanel.addCustomLink(bd.pm.settingPanel.customLinkParams[b1],bZ);break;default:break}},ah=function(){bz(".bc-button:not(.bc-view-active)",bz(".bd-pm-view-toggle",aR)).click()},J=function(bY){var bZ=bY.parent().prop("id"),bX=bd.pm.model.links[bZ];if(bd.PageMgmtTree.publishing&&bX){if(bX.showPublishButton||bX.showCancelPublishButton){bY.find('[class*="bc-pub-publish"]').click()}}},E=function(bY){var bZ=bY.parent().prop("id"),bX=bd.pm.model.links[bZ];if(bd.PageMgmtTree.publishing&&bX){if(bX.showUnpublishLinkButton||bX.showCancelUnPublishButton){bY.find('[class*="bc-pub-unpublish"]').click()}}},W=function(bY,bX){r=false;ba(bY,bX)},aZ=function(b1,b5,b3,bY){if((parseInt(bY,10)===0||bY==="info")&&aF.hasClass("bd-assetPicker-on")){bz(".jstree-clicked",".bd-assetsPicker-viewport").find(".bd-ap-preview").trigger("click");return}else{if(bY&&aF.hasClass("bd-assetPicker-on")){return}}if(aB.isOpen){var b4=bq.getTab(bY);if(!b4.length||b4.hasClass("bd-hiddenTabLabel")){return}}var bZ,b2,b0=function(b6){bZ=bz(be.utils.processHTMLTemplateByUrl(be.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/html/pages/editPageTabs.html",b6));bf.hide().html(bZ)};switch(b1){case"externalLink":b0({pageName:true,info:false,showVersionTab:true});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY});break;case"divider":b0({pageName:false,info:false});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY});break;case"menuHeader":b0({pageName:true,info:false,showVersionTab:true});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY});break;case"alias":b0({info:true,pageName:true,showVersionTab:b3.isMasterPage?false:true});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY});break;case"state":b0({pageName:true,info:false});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY});break;case"targeting":case"page":b2={portalName:bd.selectedPortalName,pageName:b3.properties.ItemRef.value,pageTitle:aW(b3,"title"),info:true,showVersionTab:b3.isMasterPage?false:true};b0(b2);bd.pm.settingPanel.getPageDataForOpenPageDetail(b5,b3,false,bY);break;case"stateLink":b0({info:true,pageName:true,showVersionTab:b3.isMasterPage?false:true});bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3);break;case"redirect":b0({pageName:true,info:false,showVersionTab:true});var bX=aW(b3,"targetPage");U.onLinkByUUID(bX).done(function(b6){bd.pm.settingPanel.getLinkDataForOpenLinkDetailPanel(b3,{tab:bY,targetPage:b6})});break;default:break}},N=function(b2,b3){if(bd.PageMgmtTree.selectedLink.isRoot){return false}var bY=null,bZ=bd.PageMgmtTree.selectedLink,b1=aW(bZ,"itemType");r=b2?true:false;if(r&&!ac){}else{var bX=(typeof b3!=="undefined")?b3-1:null;var b0=isNaN(bX)?b3:bX;aZ(b1,bY,bZ,b0)}bt()},bt=function(){var bX=bd.PageMgmtTree.selectedLink;bf.find(".bd-publish-button").toggle(bX.showPublishButton);bf.find(".bd-unpublish-button").toggle(bX.showUnpublishButton);bf.find(".bd-cancelUnpublish-button").toggle(bX.showCancelUnpublishButton);bf.find(".bd-cancelPublish-button").toggle(bX.showCancelPublishButton)},bh=function(bX){if(bX.isAssetPicker||aF.hasClass("bd-assetPicker-on")){if(bX.isRefreshInfoPanel){bf.hide().empty().append(bX.$htmlContent);if(bX.before){bX.before()}bf.show();if(bX.after){bX.after()}}else{bT("wide",function(){bf.hide().empty().append(bX.$htmlContent);if(bX.before){bX.before()}bf.show();if(bX.after){bX.after()}})}}else{if(r){if(ac){bz("#editPageTabs_Settings",bf).html(bX.$htmlContent);if(bX.before){bX.before()}bf.show();if(bX.after){bX.after()}}}else{bz("#editPageTabs_Settings",bf).html(bX.$htmlContent);bf.show();bT("wide",function(){ac=true;aB.set({isOpen:true});if(bX.after){bX.after();var bY=aB.mode=="read"?{selectedIndex:-1}:null;bc.component.addKeyboardAccess(bz(".bd-tab.bd-activeTab",bf),bY)}},bX.before)}}if(bX.isMasterPage){jQuery(".templateWrapper").removeClass("hidden")}},n=function(){bI();a4.removeClass("bd-sliderOpen")},S=function(){U.duplicateLink(ad.selectedLink.uuid,ad.selectedLink.isMasterPage)},g=function(b1,bZ,bX){bZ=bZ?be.utils.xmlEscape(bZ):"";var bY=bU[b1]?bU[b1].friendlyName.toLowerCase():"page";var b0={title:"REMOVE "+bZ.toUpperCase(),message:"Are you sure you want to remove "+bZ+"? <br/>",status:3};if(bX.children){b0.title+=" AND NESTED ITEM(S)";b0.message+=" This will also remove all nested item(s). <br/>";b0.status=0;if(bX.references){b0.message+="This could break content links and redirects referencing these pages.";b0.referencesMsg={title:"REMOVE "+bY.toUpperCase()+" WITH REFERENCES",message:"There are multiple pages that still have references that will break if you continue"};b0.status=1}}else{b0.status=3;if(bX.references){b0.message+=" There are still references to the "+bY+" you are about to delete.";b0.status=2}}return b0},aK=function(bZ,bX,bY){be.utils.confirm({title:bZ.title,message:bZ.message,cssClass:bZ.status===2?"bd-deletelink-showreferences":"",secondaryBtnText:bZ.status===2?"Show References":"",secondaryCallback:function(){if(bZ.status===2){setTimeout(function(){var b1={label:"ref:"+bX,query:"refuuid:"+bY},b0={clearInput:true};bz(".bd-pm-search-container",aR).find(".bc-search-container").trigger("onSearch",[b1,b0])},200)}},yesCallback:function(){if(bZ.referencesMsg){be.utils.confirm({title:bZ.referencesMsg.title,message:bZ.referencesMsg.message,okBtnText:"Continue",yesCallback:function(){bd.pm.controller.deleteLink(bY)}})}else{bd.pm.controller.deleteLink(bY)}}})},X=function(b1){var bY=b1||bd.PageMgmtTree.selectedLink,b3=aW(bY,"itemType").toUpperCase(),bX=aW(bY,"title"),bZ=bY.isMasterPage,b2=bY.uuid;if(az[bY.securityProfile]<az.CREATOR){be.utils.alert({message:bd.pm.msg.MSG_NO_REMOVE+" "+bX});return}if(b3===""){b3="PAGE"}try{bd.pm.controller.deletetionCheck(bY.uuid,function(b5){var b4={},b6;if(b5["delete-check"]){b4={children:b5["delete-check"]["has-children"]==="true",references:b5["delete-check"]["has-references"]==="true"}}b6=g(b3,bX,b4);aK(b6,bX,b2)})}catch(b0){console.error(b0.message)}},M=function(b1,bX,b0){var bZ=a5(b1.attr("id")),bY=a();if(bX&&bX.length===1&&!bX.hasClass("bd-tree-pageCurrent")&&bz.contains(bY[0],b1[0])){bY.find("a.bd-tree-pageCurrent").removeClass("bd-tree-pageCurrent");bX.addClass("bd-tree-pageCurrent");if(b0){b0()}}},bx=function(bZ,b1){var bX=0,b0=null,bY=bZ?bz("#"+bZ):bz(".bd-tree-pageCurrent");bY.parents("li").each(function(b5,b6){var b4=bz(b6),b3,b2=a();if(b4[0].isRoot){b0=b4.children("ul");b0.scrollTop(0);bX=bY.offset().top-b0.offset().top;return false}else{b3=b4.children("ul");if(b3.is(":hidden")){b2.jstree("open_node",b4)}}});if(b0!==null){if(b0.height()<2){bd.observer.notifyObserver(bd.pm.observer.openCorrectAccordion,{linkUUID:bZ,forceOpen:true})}b0.animate({scrollTop:bX},600,function(){if(b1){b1()}})}},bg=function(bZ){var bX={},bY=bd.PageMgmtTree.selectedLink,b0=aW(bY,"itemType");if(bY){bX={divider:"DIVIDER (NO PREVIEW)",menuHeader:"HEADER (NO PREVIEW)",externalLink:'GO TO <a class="bg-iframeOverlayGo">EXTERNAL LINK</a>',redirect:'SHOW <a class="bg-iframeOverlayGo">REDIRECT TARGET</a>'}}if(!bZ){t.children(".bd-overlay-icon").removeClass().addClass("bd-overlay-icon bd-overlay-icon-"+b0);t.children(".bd-overlay-text").html("<p>"+(bX[b0]||"")+"</p>");t.show()}else{t.hide()}},k=function(){if(bd.mobileDrawer){if(!bd.framespinner&&!bi.hasClass("bd-version-previewing")){bd.framespinner=true;var bX=bz('<div class="bd-framespinner" style="left:50%"/>');aH.append(bX)}bi.hide()}},aE=function(bX){if(az[bX.securityProfile]<az.CONTRIBUTOR){bf.addClass("bd-permission-read-only");aH.addClass("bd-permission-read-only");bz(".bd-tree-viewOnly-blocker").bind("mousewheel DOMMouseScroll",function(b0){b0=b0.originalEvent;var bZ=bi.contents().find("body")[0].scrollTop?bi.contents().find("body")[0].scrollTop:bi.contents().find("html, body").scrollTop();var b1=b0.wheelDelta>0||b0.detail<0?120:-120,bY=(b1*-1)+bZ;bi.contents().find("html, body").scrollTop(bY)})}else{bf.removeClass("bd-permission-read-only");aH.removeClass("bd-permission-read-only")}},aw=function(bZ,b4){var b3,bY,b0,b2,b1,bX;if(bZ.isRoot){return}b3=aW(bZ,"ItemRef")?true:false,bY=bi.attr("src"),b0=bd.contextRoot+"/"+bZ.finalUrl+"?designmode=true",b2=window.location.href,b1;bg(b3);if(!b3){return}if(b2.indexOf("devmode")>0){b1=(new RegExp("devmode=(.+?)(&|$)").exec(location.search)||[undefined,false])[1];b0=b0+"&devmode="+b1}bX=be.utils.getCookie(bd.selectedPortalName+"_deviceUseragent");b0=b0+"&useragent="+bX;if(!(b0.indexOf("pagemanagement")>-1&&window!=top)&&(b4||bi.attr("src")!==b0)&&b0!==bY){bi.attr("src",b0);k();if(Q){bd.PageMgmtTree.publishing.showHideBlocker(bZ)}}aE(bZ)},af=function(){bi.attr("src",bi.attr("src"))},ak=function(b1){var bY=bz(b1),bX=bY.closest("li").first(),b0=bX.attr("id"),bZ=a5(b0);if(bd.PageMgmtTree.selectedLink.uuid===bZ.uuid&&bz("#editPageTabs_Settings",bf).length){bI()}else{bd.PageMgmtTree.selectedLink=bZ;N()}setTimeout(function(){var b2=aF.hasClass("bd-pagesLayoutWide")?bd.pm.msg.TITLE_DETAILS_CLOSE:bd.pm.msg.TITLE_DETAILS;bY.attr("title",b2)},300)},a=function(){return aN?aJ:aY},d=function(bX){var bY=null;aJ=bz("#pageMgmtSearchResultJstree");if(!aJ.length){aJ=bz('<div id="pageMgmtSearchResultJstree" class="bd-pageMgmtSearchResultJstree bd-portalPagesListViewport"></div>')}a2=bd.PageMgmtTree.selectedLink;aN=true;aY.hide();aJ.jstree(bz.extend({},aA,{plugins:["themes","json_data","ui","crrm","hotkeys"],json_data:{data:bX}})).bind("load_node.jstree",function(b8,b2){var cb=bd.PageMgmtTree.selectedLink.uuid,bZ=cb?bz(cb):[],cd=[],b0,b1=bz(this).find("a"),b3,b6,b9,cc,b5,ca,b7;I=cb;for(b3=0,b6=b1.length;b3<b6;b3++){b9=bz(b1[b3]);cc=b9.closest("li");b5=cc.attr("id");ca=a5(b5)||null;if(ca&&!ca.isRoot){b9.addClass("bd-tree-page");aP(ca,b9);if(ca.isMasterPage){b9.find(".bd-page-icon").addClass("bd-masterpage-icon")}if(a2.uuid===b5){b9.addClass("jstree-clicked bd-tree-pageCurrent")}}else{cc.removeClass("jstree-closed");cc.addClass("bd-pageMgmt-accordion-active");b9.addClass("bd-tree-root");cc.children("ul").addClass("bd-tree-scrollbar");cc[0].isLoaded=true;if(b1.length===1){var b4='<li class="jstree-leaf"><ins class="jstree-icon">&nbsp;</ins><a title="No results were found" class="bd-tree-page bd-search-no-result bd-tree-page-pub-state-none" href="#"><span class="bd-tree-pageIcon bd-tree-pageTraffic" title=""></span><ins class="jstree-icon">&nbsp;</ins>No results were found&nbsp;(<span class="bd-nosearch-showall">Show all</span>)</a></li>';if(!cc.children("ul").length){cc.append("<ul/>")}cc.children("ul").append(b4);I=null}}b9.attr("title",b9.text())}bd.observer.notifyObserver(bd.pm.observer.initActionDropdown,aJ);aY.before(aJ);aJ.show().find("ul.bd-tree-scrollbar").css({height:aJ.parent().height()-110});ay.css({top:0});D();bd.observer.notifyObserver(bd.pm.observer.jsTreeLoadNode,{event:b8,data:b2,container:aJ,isSearchResult:true})}).bind("select_node.jstree",function(b5,b3){var bZ=b3.rslt.obj,b2=bZ.attr("id"),b1=a5(b2),b6=bZ.children("a:first"),b4=bd.PageMgmtTree.selectedLink.uuid,b0=aW(b1,"ItemRef");if(!b1){return}if(an){bd.observer.notifyObserver("changeNavPref",{uuid:b1.uuid,title:b1.title});M(bZ,b6);return}if(b3.rslt.e==="noRefreshIframe"){am=false}bd.PageMgmtTree.selectedLink=b1;bd.currentLinkUuid=b2;I=b2;if(!b1.isRoot){M(bZ,b6);if(bz("#editPageTabs_Settings",bf).length){if(b4!==b1.uuid){N(true)}}}else{bI()}aw(b1,am);am=false;bd.observer.notifyObserver(bd.notifications.pageMgmt.JSTREE_SELECT,{linkData:b1})});aJ.undelegate(".bd-tree-pageDetailsLink","click").delegate(".bd-tree-pageDetailsLink","click",function(bZ){ak(this)});bd.PageMgmtTree.activeView=aJ},G=function(b3,b4){if(aN===false){return}if(!b3){var b2=bz("#token-input-pagemgnt-search",aR).val();bd.pm.controller.searchLinks(b2)}else{var b0=aJ.find("#"+b3).children("a:first"),bZ,bX,b1,bY;if(b0&&b0[0]&&b0[0].childNodes){bY=b0[0].childNodes;for(bZ=0,bX=bY.length;bZ<bX;bZ++){b1=bY[bZ];if(b1.nodeType===3){b1.nodeValue=b4;break}}}}},H=function(b0){var bX=aJ.find("#"+b0),bZ=aY.find("#"+b0);if(bX.length){if(bX.siblings().length<1){aJ.jstree("remove",bX);I=null;bi.attr("src","")}else{aJ.jstree("remove",bX)}var bY=bz("#token-input-pagemgnt-search",aR).val();bd.pm.controller.searchLinks(bY)}if(bZ.length){aY.jstree("remove",bZ)}},aL=function(bY){var bX=bY.message.toLowerCase();switch(bX){case"access is denied":bX="You do not have sufficient permissions to do this";break;default:break}bc.component.notify({uid:"6725",icon:"error",message:bX,delay:5000})},bD=function(bY,bX){bd.observer.notifyObserver(bd.pm.observer.openCorrectAccordion,{linkUUID:bY,forceOpen:bX})},ag=function(b0){var bY=aY.find("#"+b0.uuid),b1=bz(".bd-pageMgmtTree",aR),bX=bY.children("a");if(an){bI();aF.addClass("bd-initSelectNavParent");bD(b0.uuid,true);var bZ=b1.children(".bd-float-balloon");if(bZ.length>0){if(bY.hasClass("bd-pageMgmt-accordion-active")){setTimeout(function(){bZ.animate({top:(bX.offset().top-68)},400)},350)}else{bZ.animate({top:(bX.offset().top-68)},400)}}else{bZ=bz('<div class="bd-float-balloon"><div class="bd-float-balloon-arrow"></div>'+bd.pm.msg.MSG_SELECT_PARENT+"</div>");setTimeout(function(){b1.append(bZ);var b3=bX.offset().top-68;bZ.css("top",b3+"px");bZ.fadeIn("slow")},400)}}else{var b2=bY.children("a:first");M(bY,b2);aF.removeClass("bd-initSelectNavParent");b1.children(".bd-float-balloon").remove();bD(bd.PageMgmtTree.selectedLink.uuid,true)}},bk=function(){var b0=bz(".bd-pageMgmtTree",aR),bZ=bz("#pageMgmtSearchResultJstree"),b3=bZ.length?bZ:aY,bX=b3.children("ul"),b2=bX.children("li:first");if(an){A.isAssetPickerOpened=aF.hasClass("bd-assetPicker-on");bI();bp.find(".bd-pm-pageview").click();bp.find(".bd-pm-contentview").addClass("bd-gradient-grey-disabled");aF.addClass("bd-initSelectNavParent");if(!bZ.length){bd.observer.notifyObserver(bd.pm.observer.restoreMenu,{rootLinkNode:b2.children("a"),$PagesListViewport:null,forceOpen:true})}var bY=b0.children(".bd-float-balloon");if(bY.length===0){bY=bz('<div class="bd-float-balloon"><div class="bd-float-balloon-arrow"></div>'+bd.pm.msg.MSG_SELECT_PARENT+"</div>");setTimeout(function(){b0.append(bY);var b4=b3.children("ul").offset().top-68;bY.css("top",b4+"px");bY.fadeIn("slow")},400)}bd.observer.notifyObserver("changeNavPref",{title:""})}else{b2=b3.find("#"+bd.PageMgmtTree.selectedLink.uuid);var b1=b2.children("a:first");if(!bd.PageMgmtTree.selectedLink.isRoot){M(b2,b1)}aF.removeClass("bd-initSelectNavParent");b0.children(".bd-float-balloon").remove();if(!bZ.length){bD(bd.PageMgmtTree.selectedLink.uuid,true)}bp.find(".bd-pm-contentview").removeClass("bd-gradient-grey-disabled");if(A.isAssetPickerOpened){bp.find(".bd-pm-contentview").click()}}},i=function(){bd.PageMgmtTree.publishing.removeObserver(bd.PageMgmtTree.publishing.EVENT_READY,i);aF.toggleClass("bd-publish-button-active",!!bd.PageMgmtTree.publishing.publishAction);if(!bd.PageMgmtTree.publishing.inPublishGroups()){}else{aF.removeClass("bd-pub-disabled");bd.observer.addObserver(bd.notifications.publishing.CHANGE,bL);bd.PageMgmtTree.publishing.addObserver(bd.PageMgmtTree.publishing.EVENT_MARKED,function(bX){bv(bX,true)});bd.PageMgmtTree.publishing.addObserver(bd.PageMgmtTree.publishing.EVENT_PUBLISH_START,function(){n();bz(".bd-pageMntPublishBtn").hide()});bd.PageMgmtTree.publishing.addObserver(bd.PageMgmtTree.publishing.EVENT_PUBLISH_FAILED,function(){bz(".bd-pageMntPublishBtn").css("display","inline-block")})}},bL=function(){aF.toggleClass("bd-publish-button-active",bd.PageMgmtTree.publishing.publishAction!==false);bd.pm.controller.refreshLinks(Y,bd.pm.observer.updateJstree,true)},bv=function(bZ,b0){var bY;bd.pm.view.updateView=true;if(typeof bZ==="string"&&bd.pm.model.links[bZ]){bY=bd.pm.model.links[bZ];bd.pm.controller.refreshLink(bY.uuid,1,bd.pm.observer.updateJstree,b0)}else{if(bZ&&bZ.attr&&bZ.attr("id")&&bd.pm.model.links[bZ.attr("id")]){var bX=bZ[0]["isLoaded"];bY=bd.pm.model.links[bZ.attr("id")];bd.pm.controller.refreshLink(bY.uuid,!bX?1:null,bd.pm.observer.updateJstree,b0)}else{bd.pm.controller.refreshLinks(Y,bd.pm.observer.updateJstree,b0)}}},ae=function(bY){var bX=bY.data,bZ,b2,b3,b5,b1,b4,b0;for(bZ=0,b2=bX.length;bZ<b2;bZ++){b4=bX[bZ];b0=aW(b4,"ItemRef");if(b0){bd.currentLinkUuid=b4.uuid;bd.PageMgmtTree.selectedLink=b4;aY.jstree("select_node","#"+b4.uuid,true);break}}},ar=function(b1){var b0=bz(b1),bZ=b0.parent("ul").parent("li"),bX=bZ.attr("id"),bY=bZ.data();if(bY.loadmore){bd.pm.controller.renderJSTree(bX,null,null,bY.skipCount)}},bG=function(){r=false;ac=false;aB.reset();bz(".token-input-dropdown-filter").remove();A={pageMgmtTree:0,assetPickerTree:0,assetPickerSearchTree:0,pageMgmtSearchTree:0};bN.reset();a3.detach()},bO=function(bX){if(a4.hasClass("bd-sliderClosed")){bI();aF.removeClass("bd-pageContainerClosed").css({height:"100%"});aH.removeClass("bd-pageContainerIsClosed");if(bX){aF.addClass("bd-opening").animate({width:aq},"normal","swing",function(){a4.removeClass("bd-sliderClosed bd-opening")})}else{aF.css({width:aq});a4.removeClass("bd-sliderClosed")}f[bX?"animate":"css"]({width:aq})}},a7=function(){if(aF.hasClass("bd-assetPicker-on")){bp.find(".bd-pm-pageview").click()}},ab=function(bZ){var bY=bZ[0],b1,b0;if(!bY||!bZ.attr("src")||!bZ.contents().find("body").children().length){return}if(!bY.contentWindow||!bY.contentWindow.bd){var b2=bZ.contents().find("title").text().indexOf("403")>-1?true:false;var bX=bZ.contents().find("title").text().indexOf("Error report")>-1?true:false;if(b2||bX){b1=b2?bd.pm.msg.ACCESS_DENIDED_TITLE:"Server Error";b0=b2?bd.pm.msg.ACCESS_DENIDED_WARNING:bd.pm.msg.SERVER_ERROR;be.utils.alert({title:b1,message:b0,wrapper:document.body,okBtnText:"CONTINUE",yesCallback:function(){},closeIcon:false})}}},V=function(){a4.click(function(){if(a4.hasClass("bd-sliderOpen")){bI();a4.removeClass("bd-sliderOpen")}else{aF.animate({width:"0"},"normal","swing",function(){aF.addClass("bd-pageContainerClosed");aF.css({overflow:"visible"})});aH.addClass("bd-pageContainerIsClosed");a4.addClass("bd-sliderClosed");f.animate({width:"1px"})}});L.click(function(){if(a4.hasClass("bd-sliderClosed")){bO(true)}else{if(aF.hasClass("bd-assetPicker-on")){bd.observer.notifyObserver("openInfoPanel.assetsPicket",null)}else{N()}}});var bX=function(bZ,bY){var b0=bZ.data&&bZ.data.itemtype||"page";if(bz(this).hasClass("bd-gradient-grey-disabled")){bZ.stopImmediatePropagation();return}W(b0,bZ.data)};bM.on("click",".bd-addPageButton",function(bY){W("page")});bz(".bd-addPageButtons",aF).on("click","button",function(bY){W("page")});aF.delegate(".bd-plusAddMasterPage","click",function(bY){W("page",{isMasterPage:true})});bM.on("click",".bd-addExternalLinkButton",function(bY){W("externalLink")});bM.on("click",".bd-addHeaderButton",function(bY){W("menuHeader")});bM.on("click",".bd-addDividerButton",function(){W("divider")});bz(document).bind("drag_start.vakata",function(bZ,bY){bd.observer.notifyObserver(bd.pm.observer.jsTreeStartDrag,bY)});bz(document).bind("drag_stop.vakata",function(bZ,bY){bd.observer.notifyObserver(bd.pm.observer.jsTreeStopDrag,bY);if(bW){be.utils.alert({message:bW});bW=false}});bz(document).off(".forvard_event").on("mouseup.forvard_event","#jstree-marker-line",function(bZ){this.style.display="none";var bY=document.elementFromPoint(bZ.pageX,bZ.pageY);bz(bY).trigger("mouseup")});bz(document).on("click",".jstree-last",function(bY){bz(bY.target).parent().css({bottom:"0px"})});aY.delegate("a.bd-tree-page","click",function(bY){if(bY.target===this){am=true}});aY.delegate(".bd-tree-pageDetailsLink","click",function(bY){ak(this)});aF.delegate(".bd-cancelAndClose","click",function(bY){bY.preventDefault();bI();a4.removeClass("bd-sliderOpen");return false});aF.delegate(".bd-editPageSettings","click",function(bZ){bZ.preventDefault();var bY=bd.PageMgmtTree.selectedLink,b0=aW(bY,"itemType");if(bY.lockState!=="LOCKED"){if(bz(this).hasClass("bd-editSEOSettings")){bd.pm.settingPanel.editSEOSettings(bY)}else{if(b0==="page"||b0==="targeting"||b0===""){bd.pm.settingPanel.editPageSettings(bY)}else{bd.pm.settingPanel.editLinkSettings(bY)}}}});aF.undelegate(".bd-tab2","click").delegate(".bd-tab2","click",function(){bd.pm.settingPanel.triggerPermissionTab()});t.delegate(".bg-iframeOverlayGo","click",function(bZ){var bY=bd.PageMgmtTree.selectedLink,b0=aW(bY,"itemType");if(b0==="redirect"){bd.observer.notifyObserver(bd.pm.observer.getSelectedLinkTree,{uuid:aW(bY,"targetPage")})}else{window.open(bY.finalUrl)}});bi.load(function(){bz(document).trigger("iframeloaded");if(!bz(this).attr("src")){bd.framespinner=false;aH.children(".bd-framespinner").remove()}if(bz.isFunction(bd.injectIframe)){try{bd.injectIframe(bi)}catch(bZ){return false}}ab(bi);F(bi);var bY=jQuery(".bd-framespinner");if(bd.framespinner){bd.framespinner=false;bY.remove()}bi.fadeIn()});aF.delegate(".bd-editable","click",function(bY){bd.editable(this,aF,be.utils.formatAllowedName);return false});aF.delegate(".bd-permission-savePermission","click",function(bY){bY.preventDefault()});aF.delegate(".bd-nosearch-showall","click",function(bY){bd.observer.notifyObserver(bd.pm.observer.cancelSearch)});aF.delegate(".bd-buttonEditable","click",function(bY){bY.preventDefault();bd.editable(bz(this).prev(".bd-editable"),bf,be.utils.formatAllowedName)});aF.delegate("input.autoCorrect","keyup",function(bY){var bZ=this;be.utils.delay(function(){var b0=be.utils.formatAllowedFriendlyUrl(bz(bZ).val());if(b0!=bz(bZ).val()){bz(bZ).val(b0)}},1000)});aF.delegate(".bd-titleInput","keyup blur",function(){var bZ=this;var b2=this.value;var b1=bz(".bd-titleEditable",this.form);var bY=bz(this).attr("oldTitleValue");if(bY==bz(b1).val()){bz(b1).val(b2);if(bZ.form.newPageTitle){bZ.form.newPageTitle.value=b2}else{if(bZ.form.pageTitle){bZ.form.pageTitle.value=b2}}}bz(this).attr("oldTitleValue",b2);b2=be.utils.formatAllowedName(b2);var b0=bz(".bd-urlEditable",this.form);var b3=be.utils.formatAllowedName(bz(this).attr("oldURLValue"));if(b3==b0.text()){bz(b0).text(b2);if(bZ.form.sectionName){bZ.form.sectionName.value=b2}}bz(this).attr("oldURLValue",b2)});aY.delegate(".bd-pageMgmt-loadMoreTrigger","click",function(bY){if(!T){T=true;ar(this)}});bf.delegate(".bd-close-settings-panel-arrow","click",function(bY){bI()})},bS=function(){var bX=bz("#pageMgmtSearchResultJstree");if(bX.length){bX.hide()}aY.hide()},aQ=function(b0){var bY,bX,bZ=bz("#pageMgmtSearchResultJstree");if(b0==="assetPicker"){if(bZ.length){A.pageMgmtSearchTree=bZ.find("> ul > li > ul").scrollTop();bZ.hide()}else{A.pageMgmtTree=aY.find("> ul > li.bd-pageMgmt-accordion-active > ul").scrollTop();A.pageMgmtSearchTree=0}aY.hide();av.show();if(A.isAssetPickerOn){bY=av.find("> .bd-asserts-picker-body > .bd-ap-search"),bX=A.assetPickerSearchTree;if(!bY.length||bY.is(":hidden")){bY=av.find("> .bd-asserts-picker-body > .bd-ap-tree");bX=A.assetPickerTree}bY.find("> ul > li > ul").scrollTop(bX)}else{A.isAssetPickerOn=true}}else{if(b0==="pageMgmt"){if(A.isAssetPickerOn){bY=av.find("> .bd-asserts-picker-body > .bd-ap-search");if(!bY.length||bY.is(":hidden")){bY=av.find("> .bd-asserts-picker-body > .bd-ap-tree");A.assetPickerTree=bY.find("> ul > li > ul").scrollTop()}else{A.assetPickerSearchTree=bY.find("> ul > li > ul").scrollTop()}}av.hide();if(bZ.length){bZ.show().find("> ul > li > ul").scrollTop(A.pageMgmtSearchTree)}else{aY.show().find("> ul > li.bd-pageMgmt-accordion-active > ul").scrollTop(A.pageMgmtTree)}}}},F=function(bX){var bZ=bX[0].contentWindow,bY=decodeURIComponent(bd.PageMgmtTree.selectedLink.finalUrl),b0=decodeURIComponent(bZ.location.pathname.replace(bd.contextRoot+"/",""));if(window.location.host===bZ.location.host&&bd.PageMgmtTree.selectedLink&&bY!==b0){if(bZ&&bZ.b$){aD=true;bd.observer.notifyObserver(bd.pm.observer.getSelectedLinkTree,{uuid:bZ.b$.portal.linkUUID})}else{aD=false;aH.children(".bd-framespinner").remove();bd.framespinner=false;bX.show()}}if(bz("html").hasClass("ie")){bZ.onunload=function(){k()}}else{bZ.onbeforeunload=function(){k()}}};aS.serverStatus.solr.checkStatus().then(function(){bd.pm.view.solrRunning=true},function(){bd.pm.view.solrRunning=false});bd.observer.addObserver(bd.notifications.pageMgmt.START,bE);bd.observer.addObserver(bd.notifications.pageMgmt.STOP,bG);var Z={init:bE,getData:a5,getDataProperty:aW,updateItemTypeIcon:bm,closeSettingsContainer:bI,restorePageList:bO,toggleSettingsEdit:N,getOrderNew:a9,getOrder:aV,cleanUp:bG,getLink:function(){return bd.PageMgmtTree.selectedLink},refreshIframe:af,refreshLinksAndDetails:bv,visibleStack:Y,updateView:w,openSettingPanel:bh,refreshPageTree:bj,selectCurrentRoot:a6,getItemTypeObj:e,deleteLink:X,duplicateLink:S,toggleSettingsAdd:W,getItemType:aX,toggleView:ah,togglePublish:J,toggleUnPublish:E,showPageList:a7,state:aU,SettingsState:bq.state,solrRunning:by};return Z});(function(j,m){var k=j.jQuery,e=j.bd||{},d=j.be||{},s=false,i,r,n,h;var o=function(t){p(t.rootLinkNode,t.$PagesListViewport,t.forceOpen)};var p=function(E,v,w){if(s===true){return false}s=true;var u=v||h,y=u.find("ul.jstree-no-dots"),D=y.children('li:not(".bd-tree-masterpage")'),t=y.find("ul:animated").stop(true,true),F=y.children("li.bd-tree-masterpage"),B=F.length?F.height():0,C=k(E),x=40,z,A;m.$currentRootLink=C.parent("li");z=m.getData(m.$currentRootLink.attr("id"));if(z&&z.name==="masterpage_root"){s=false;return false}if(w||!m.$currentRootLink.hasClass("bd-pageMgmt-accordion-active")){if(k("div.token-input-dropdown-filter").is(":visible")){k("div.token-input-dropdown-filter").hide()}A=y.height()-F.height()-(x*D.length);D.removeClass("bd-pageMgmt-accordion-active").children("ul").removeClass("bd-active").stop().animate({height:0,padding:0},300,function(){k(this).css({"overflow-y":"hidden"})});n.hide();m.$currentRootLink.addClass("bd-pageMgmt-accordion-active").children("ul").addClass("bd-active bd-tree-scrollbar").stop().animate({height:A},300,function(){s=false;k(this).css({"overflow-y":"auto"});var G=m.$currentRootLink;if(G.hasClass("bd-tree-masterpage")){G=G.siblings().first()}n.css({top:G.position().top});if(!r.hasClass("bd-assetPicker-on")){n.show()}if(!m.$currentRootLink[0].isLoaded){if(z&&m.getDataProperty(z,"hasChildren")==="true"){e.pm.controller.renderJSTree(m.$currentRootLink.attr("id"))}m.$currentRootLink[0].isLoaded=true}m.$currentRootLink.children("ul:first").promise().done(function(){a()});$(this).trigger("mouseover")})}else{s=false}return true};var a=function(t){e.observer.notifyObserver(e.pm.observer.updateVisibleLink)};var q=function(y){var x=y.container,A=y.searchResult,u=y.masterPageRoot,B=x.find("ul.jstree-no-dots"),v=B.children("li"),F=B.children('li:not(".bd-tree-masterpage")'),H=B.children("li.bd-tree-masterpage"),C=0,t=0,z=0,E,G=40,D=0,w=function(){var J=B.children(".bd-pageMgmt-accordion-active").children("ul"),I;if(J.is(":visible")){if(A||!u){I=B.height()-G*v.length-z}else{I=B.height()-G*F.length-H.height()-z}J.addClass("bd-tree-scrollbar").css({height:I})}else{m.resizePageMgmt=true}};if(u){t=parseInt(e.pm.model.storage.get("masterPageHeight"),10);t=isNaN(t)?147:t;E=u.children(".bd-tree-breaker")}v.each(function(M,N){var I=k(this);if(!I.find("> ul").length){I.append("<ul/>")}var L=I.children("ul"),O=m.getData(I.attr("id"));if(O&&O.name==="masterpage_root"){L.css({height:t,"overflow-x":"hidden","overflow-y":"auto"})}else{if(M===0){I.removeClass("jstree-leaf").addClass("jstree-open bd-pageMgmt-accordion-active");m.$currentRootLink=I;D=B.height()-H.height()-t-(G*F.length)}else{D=0}L.css({height:D,"overflow-x":"hidden","overflow-y":"auto"})}var J,K;K=I.children("ul");K.data("scrollTop",K.scrollTop());K.bind("scroll.restoreMenu",function(P){var Q=$(this);if(Q.data("scrollTop")!==Q.scrollTop()){Q.data("scrollTop",Q.scrollTop());var R=this;j.clearTimeout(J);J=j.setTimeout(function(){e.observer.notifyObserver(e.pm.observer.closeActionDropdown,R);a();f(R)},300)}})});k(j).unbind("resize.accordion").bind("resize.accordion",w);v.children("a").click(function(){m.$currentRootLink=k(this).closest("li");return p(this,x)});if(u&&!A){E.bind("mousedown",function(I){I.preventDefault();I.returnValue=false;var K=I.pageY,J=B.height()-G*v.length-E.height()-10;r.bind("mousemove",function(L){var N=L.pageY,M=K-N;K=N;t=t+M;t=t>J?J:t;t=t<0?0:t;u.children("ul").css({height:t});w()});r.bind("mouseleave",function(L){e.pm.model.storage.set("masterPageHeight",t);r.unbind("mousemove").unbind("mouseleave")})});E.bind("mouseup",a);r.bind("mouseup",function(I){e.pm.model.storage.set("masterPageHeight",t);r.unbind("mousemove").unbind("mouseleave")})}};var l=function(v){var B=v.linkUUID,u=v.forceOpen,x=h.children("ul"),y=x.children("li"),w,t,z,A;for(w=0,t=y.length;w<t;w++){z=k(y[w]);A=z.attr("id")===B?z:z.find("#"+B);if(A.length){if(z.hasClass("bd-tree-masterpage")){z=x.children("li:first");z.removeClass("jstree-closed bd-pageMgmt-accordion-active");p(z.children("a"))}else{if(u||!z.hasClass("bd-pageMgmt-accordion-active")){p(z.children("a"),null,u)}}break}}};var f=function(w){var x=k(w);var t=x.find(".bd-pageMgmt-loadMoreTrigger:first");if(t.length){t.scrollTop();var u=x.offset().top+x[0].offsetHeight;var v=t.offset().top;if(v<=u){t.trigger("click")}}return};var b=function(v){var u,t=function(){k(this).unbind(".bd_accordion");j.clearTimeout(u)};h.bind("mouseover.bd_accordion",function(y){var x=y.target,w;if(x.className.indexOf("bd-tree-root")>-1){w=e.pm.model.links[x.parentNode.id];if(w&&w.name!="masterpage_root"&&x.parentNode.className.indexOf("bd-pageMgmt-accordion-active")==-1){k(x).bind("mouseout.bd_accordion",t);u=j.setTimeout(function(){t();m.$currentRootLink=k(x).closest("li");m.selectCurrentRoot();l({linkUUID:w.uuid})},1000)}}})};var g=function(){h.unbind(".bd_accordion")};var c=function(t){i=t.oGadgetBody;r=k(".bd-pageContainer",i);n=k(".bd-addPageButtons",i);h=k(".bd-portalPagesListViewport",i);if(e&&e.pm&&e.pm.observer){e.observer.addObserver(e.pm.observer.jsTreeLoadNode,q);e.observer.addObserver(e.pm.observer.openCorrectAccordion,l);e.observer.addObserver(e.pm.observer.restoreMenu,o);e.observer.addObserver(e.pm.observer.jsTreeStartDrag,b);e.observer.addObserver(e.pm.observer.jsTreeStopDrag,g)}b(h);j.restoreMenu=p};e.observer.addObserver(e.notifications.pageMgmt.START,c)})(this,bd.pm.view);(function(p){var r=p.jQuery,e=p.bd||{},d=p.be||{},g,j,f,c,w=false,A=function(G){var E=r(G.openNode),F=E.find(">ul>li");o(F);o(G.openNode)},D=function(E){o(E.node)},b=function(F){if(F&&F.isSearchResult&&F.container){var E=F.container.find("li li");o(E,{jstreeSupport:false});o(F.container,{jstreeSupport:false})}},i=function(E){return(e.pm.model.links[E]||{})},o=function(F,H){var G=j.find(">ul>li>ul"),E=r.extend({iframe:".bd-iframeContainer",helper:function(O){var L=r(O.target),J=L.closest("li"),K=i(J.attr("id")),I=L.children(".bc-icn").attr("class"),N=d.utils.HTMLEncode(d.utils.trimString(L.text()))+"&nbsp;",M=m(K)?"":'<ins class="jstree-invalid"><i class="bc-icn"></i></ins>';return'<div class="bc-dnd-helper">'+M+'<span class="'+I+'-white"></span>'+N+"</div>"},delay:200,cursorAt:[5,10],jstreeSupport:true,start:function(L,K){var I=r(L.target).closest("li"),J=i(I.attr("id"));e.pm.view.start_drag=true;K.helper.bdDragData={link:J};d.utils.autoScroll.start(G)},stop:function(){e.pm.view.start_drag=false;d.utils.autoScroll.stop();p.setTimeout(v,10)}},H);r(F).children("a").bdDrag(E)},t=function(){if(j){var E=j.find(".bd-bdDrag");E.bdDrag("clearIframeList")}},v=function(){j.trigger("mouseup")},m=function(F){var H=B(F,"itemType"),G=["divider"],E=F&&(!F.isMasterPage&&G.indexOf(H)==-1);return E},n=function(I,H){var G=I.originalEvent.target,F=G.tagName.toLowerCase(),E=H.helper.bdDragData.link;if(F=="a"&&E&&m(E)&&r(G).closest('[contenteditable="true"]').length){return true}return false},y=function(E,F,I,H){var G=r(I.originalEvent.target);if(n(I,H)&&!G.hasClass("bd-ice-link-target")){w=true;G.addClass("bd-ice-link-target")}},h=function(E){w=false;r(".bd-ice-link-target",E).removeClass("bd-ice-link-target")},x=function(E,F,H,G){if(w){h(E.body)}},l=function(M,E,I,F){var J=I.originalEvent.target,H=r(this),K=F&&F.helper&&F.helper.bdDragData,L=K&&K.link,G=H.attr("contenteditable")=="true"?H:H.find('[contenteditable="true"]');h(M.body);if(L&&!L.isMasterPage){if(n(I,F)){if(E=="field"||E&&E.indexOf("cursor")>-1){M.dispatchCustomEvent("iceUpdateLink",true,true,{$editArea:G,link:J,linkData:K.link})}}else{if(q(this)){M.dispatchCustomEvent("iceUpdateLink",true,true,{$editArea:G,linkData:K.link})}else{}}}},q=function(F){var E=r(F);return E.hasClass("bd-contentEditor-container")||E.hasClass("bd-textContent-dropArea")},B=function(E,F){var G=E&&E.properties;if(G&&G[F]){return G[F].value}},s=function(F){var E=F.frameB$&&F.frameB$.portal&&F.frameB$.portal.portalView;c=F.frame.contentWindow;if(E&&c){E.addEventListener("bdDrop.over",function(H){var G=H.detail;y.call(G.dropArea,G.viewController,G.dropType,G.evt,G.info)});E.addEventListener("bdDrop.out",function(H){var G=H.detail;x.call(G.dropArea,G.viewController,G.dropType,G.evt,G.info)});E.addEventListener("bdDrop.drop",function(H){var G=H.detail;l.call(G.dropArea,G.viewController,G.dropType,G.evt,G.info)});E.addEventListener("bdDrop.deactivate",function(H){var G=H.detail;if(w&&G.viewController&&G.viewController.body){h(G.viewController.body)}})}},z=function(K){var I=K.data.obj,G=I.children("a"),E=G.children(".bd-tree-itemtype").attr("class"),J=$.vakata.dnd.helper,F=J.find("ins"),H=J.find("span.bc-icn");J.contents().last()[0].nodeValue=d.utils.trimString(G.text());if(G.hasClass("bd-tree-root")){J.hide()}else{if(H.length){H.attr("class",E+"-white")}else{J.prepend('<span class="'+E+'-white"></span>')}if(!F.find("i.bc-icn").length){F.append('<i class="bc-icn"></i>')}}},k=function(E){r(E).find(".bd_dropOnPanel_last").removeClass("bd_dropOnPanel_last")},u=function(E){var F=r.jstree._reference(j);j.on("mouseover.bd_dropOnPanel",">ul>li>ul",function(I){var H=I.currentTarget,G=H.lastElementChild;if(I.target.nodeName=="UL"){if(G){G.className+=" bd_dropOnPanel_last";F.dnd_enter(G)}else{F.dnd_enter(H)}}else{k(H)}});j.on("mouseleave.bd_dropOnPanel",">ul>li>ul",function(H){var G=H.currentTarget;k(G)})},C=function(J){var K=r.jstree._reference(j),H=J&&J.event&&J.event.target,E=H&&H.parentNode,I=J&&J.data&&J.data.obj,G=H&&H.lastElementChild,F=J.event[K._get_settings().dnd.copy_modifier+"Key"];if(I&&E&&H.nodeName=="UL"&&E.parentNode&&E.parentNode.parentNode&&E.parentNode.parentNode.className.indexOf("bd-portalPagesListViewport")>-1){if(G){K.move_node(I,G,"after",F)}else{K.move_node(I,E,"inside",F)}}j.off(".bd_dropOnPanel");k(H)},a=function(E){g=E.oGadgetBody;j=r(".bd-portalPagesListViewport",g);f=r(".bd-iframeContainer",g);if(e&&e.pm&&e.pm.observer){e.observer.addObserver(e.pm.observer.addJstreeNode,D);e.observer.addObserver(e.pm.observer.openJstreeNode,A);e.observer.addObserver(e.pm.observer.jsTreeLoadNode,b);e.observer.addObserver(e.pm.observer.jsTreeStartDrag,z);e.observer.addObserver(e.pm.observer.jsTreeStartDrag,u);e.observer.addObserver(e.pm.observer.jsTreeStopDrag,C)}};e.observer.addObserver(e.notifications.pageMgmt.START,a);e.observer.addObserver(e.notifications.pageMgmt.STOP,t);e.observer.addObserver(e.notifications.pageMgmt.IFRAME_READY,s)})(this);(function(){var f=window.jQuery,c=window.bd||{},a=window.be||{},b=null;var h=function(n){var l,i;if(!n){l=b.page;i=b.container}else{var m=[],k=[];l=n.page;i=n.container;if(l.exposedPageProperties.seoPro.length>0){m=d(l)}l.seoArray=m;b=n}var j=f(a.utils.processHTMLTemplateByUrl(a.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/html/links/page/Seo.html",l));f("#editPageTabs_SEO",i).html(j)};var e=function(i){f(".bd-canclePageSEO",i).click(function(j){j.preventDefault();h()});f(i).validate({submitHandler:g})};var g=function(m){try{var p=a.utils.serializeJSON(m);var n=b.page.seoArray;var o=[],q;for(var r in p){if(p.hasOwnProperty(r)){if(r.indexOf("bd_seo")>-1){for(var l=0;l<n.length;l++){if(n[l].name==r){if(n[l].value===null){n[l].value=""}if(n[l].value!=p[r]){q=o.push(n[l]);o[q-1].value=p[r]}n[l].value=p[r]}}}}}var k={updatePageOnly:true,pageName:p.pageName,portalName:p.portalName,itemType:"page",modifiedBy:c.loggedInUserId,exposedPageProperties:o,ev:c.pm.observer.renderSEO};if(o.length){c.pm.controller.updatePage(k)}else{h()}}catch(j){console.log(j)}};var d=function(r){var p=r.exposedPageProperties.seoPro,l=[],n,q,o,m,k;for(o=0;o<p.length;o++){k=p[o];if(/bd_seo/.test(k.name)){if(c.uiEditingOptions.defaultSEOConf&&c.uiEditingOptions.defaultSEOConf.defaultSEO){n=c.uiEditingOptions.defaultSEOConf.defaultSEO;for(m=n.length-1;m>=0;m--){q=n[m];if(q.name===k.name){k.tooltip=q.tooltip;k.docLink=q.docLink;if(q.type){k.type=q.type;if(k.type=="linkRef"){k.linkRef=true;k.value=r.canonicalLink?r.canonicalLink.uuid:"";k.uxName=r.canonicalLink&&r.canonicalLink.properties&&r.canonicalLink.properties.title?r.canonicalLink.properties.title.value.toString():""}}break}}}if(c.uiEditingOptions.defaultSEOConf&&c.uiEditingOptions.defaultSEOConf[k.name]){n=c.uiEditingOptions.defaultSEOConf[k.name];for(m=n.length-1;m>=0;m--){if(n[m].value===k.value){k.uxName=n[m].name;break}}}else{k.uxName=k.uxName||k.value}if(!(r.isMasterPage===true&&k.type==="linkRef")){l.push(k)}}}return l};c.observer.addObserver(c.notifications.pageMgmt.START,function(){c.observer.addObserver(c.pm.observer.renderSEO,function(){c.pm.settingPanel.getPageDataForOpenPageDetail(null,c.PageMgmtTree.selectedLink,true);c.pm.view.refreshLinksAndDetails(c.PageMgmtTree.selectedLink.uuid,true);c.pm.view.refreshIframe()})});this.initSEOPanel=function(k){var j=k.page;var i=k.container;if(j.enableSEO==="true"){f(i).find(".bd-seo").removeClass("bd-hiddenTabLabel");h(k)}else{f(i).find(".bd-seo").addClass("bd-hiddenTabLabel")}};this.addDefaultSEO=function(l){if(!c.uiEditingOptions.defaultSEOConf){return null}var k=c.uiEditingOptions.defaultSEOConf.defaultSEO;for(var j=k.length-1;j>=0;j--){var m=k[j];if(!l.exposedPageProperties){l.exposedPageProperties=[]}l.exposedPageProperties.push({name:m.name,label:m.label,value:m.value,manageable:"true"})}return l};this.removeSEOProperties=function(l){if(!b.page){return null}var k=b.page.seoArray;for(var j=k.length-1;j>=0;j--){var m=k[j];if(!l.exposedPageProperties){l.exposedPageProperties=[]}l.exposedPageProperties.push({name:m.name,value:m.value,markedForDeletion:true,manageable:"true"})}return l};this.editSEOSettings=function(){var p=b.page;var m=f(a.utils.processHTMLTemplateByUrl(a.contextRoot+"/static/backbase.com.2012.nexus/widgets/PageMgmtMVC/html/links/page/SeoEdit.html",p));var t=$(".bd_seo_canonical",m);var k=t.val();for(var r=0;r<p.seoArray.length;r++){var s=p.seoArray[r],o;if(c.uiEditingOptions.defaultSEOConf&&c.uiEditingOptions.defaultSEOConf[s.name]){var u=c.uiEditingOptions.defaultSEOConf[s.name];s.value=!s.value?"":s.value;for(var n=u.length-1;n>=0;n--){if(u[n].value===s.value){o=u[n];break}}var q=bc.component.dropdown({uid:"55689"+r,label:o.name,forlabel:s.name,selected:o.value,options:u,minWidth:"170px"});f("."+s.name,m).parent().html(q)}}var l=bc.component.tokenize({field:t});if(p.canonicalLink){l.addItem(p.canonicalLink)}f("#editPageTabs_SEO",b.container).html(m);f(".token-input-input-token input",m).val(k).focus();e(m)}}).apply(bd.pm.settingPanel);(function(j){var q=j.jQuery,h=j.bd||{},g=j.be||{},p=this,b={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4,NONE:-5},e={DUPLICATE:".bd-copyPage",DELETE:".bd-deletePage",SHOW_REFERENCE:".bd-showReference",ALIAS:".bd-addAliasButton",STATE_ALIAS:".bd-addStateLinkButton",REDIRECT:".bd-addRedirectButton"},o,a=function(r){return r.replace(".","")},n=function(u,s){var t={label:"ref:"+u,query:"refuuid:"+(s?s:u)},r={clearInput:true};q(".bd-pm-search-container",o).find(".bc-search-container").trigger("onSearch",[t,r])},k=function(r){r.on("click",e.DELETE,function(){var s=p.getData(q(r[0].getOptsParent()).closest("li").attr("id"));p.deleteLink(s)});r.on("click",e.DUPLICATE,function(){var s=p.getData(q(r[0].getOptsParent()).closest("li").attr("id"));h.pm.controller.duplicateLink(s.uuid,s.isMasterPage)});r.on("click",e.SHOW_REFERENCE,function(){var s=p.getData(q(r[0].getOptsParent()).closest("li").attr("id")),t=p.getDataProperty(s,"title");n(t,s.uuid)});r.on("click",e.ALIAS,function(){var s=p.getData(q(r[0].getOptsParent()).closest("li").attr("id"));p.toggleSettingsAdd("alias",s)});r.on("click",e.STATE_ALIAS,function(){p.toggleSettingsAdd("stateLink")});r.on("click",e.REDIRECT,function(){var s=p.getData(q(r[0].getOptsParent()).closest("li").attr("id"));p.toggleSettingsAdd("redirect",s)})},l=function(s,r){if(r==="open"){s.addClass("bd-tree-actionIcon-opened")}else{s.removeClass("bd-tree-actionIcon-opened")}},d=function(s){var r=s?q(".bc-selectbox.bc-open",s):[];if(r.length){r.click()}else{q("body").click()}},i=function(){var s=q(this.getOptsParent()).closest("a"),r=q(".bd-pageSettingsContainer",o);if(q("#editPageTabs_Settings",r).length){r.off("click.actionDropDown",".bd-tabLabel").on("click.actionDropDown",".bd-tabLabel",function(t){if(t.isTrigger){t.stopPropagation();var u=q.Event("click",{target:t.target});q(document).trigger(u)}})}l(s,"close")},f=function(w){var s=w.view[0].dropdownOptions,A=q(this.getOptsParent()).closest("li");var r=p.getData(A.attr("id"));if(!r){return}l(A.children("a"),"open");var C=p.getData(r.uuid),y=p.getDataProperty(C,"itemType"),x=["page","alias","targeting"],v=x.indexOf(y),u=true,z,D;if(v>-1){w.show(e.DUPLICATE)}else{w.hide(e.DUPLICATE)}if(h.pm.view.solrRunning&&(C.isMasterPage===true||["page","alias","targeting","state","externalLink"].indexOf(y)>-1)){w.show(e.SHOW_REFERENCE)}else{w.hide(e.SHOW_REFERENCE)}h.observer.notifyObserver(h.pm.observer.actionBtnBeforeOpen,{itemType:y,selectedLink:r,pageActionOptions:s,pageActionDropdown:w});if(y==="state"||r.lockState==="LOCKED"||r.isPublished===true||b[r.securityProfile]<=b.CONSUMER){u=false}w.toggleEnabled(e.DELETE,u);if(C===null||C.isMasterPage||v<0){w.hide(e.ALIAS)}else{if(y===""||v>-1){w.show(e.ALIAS);D=q(".bd-iframeContainer")[0].contentDocument.location.href.replace(/^http:\/\//,"").split(/\/\//);z=D.length>1?D[1]:null}else{w.hide(e.ALIAS)}}if(C&&!C.isMasterPage&&y&&["page","alias","targeting","state","externalLink"].indexOf(y)>-1){w.show(e.REDIRECT)}else{w.hide(e.REDIRECT)}if(!z){w.hide(e.STATE_ALIAS);h.pm.settingPanel.stateUrl=null}else{h.pm.settingPanel.stateUrl=z.replace(/\?.*$/,"");w.show(e.STATE_ALIAS)}var t=s.find("a:not(.bc-component-hidden)");if(t.length){var B=q(t[0]);if(B.hasClass("bc-dd-divider")){B.addClass("bc-component-hidden")}B=q(t[t.length-1]);if(B.hasClass("bc-dd-divider")){B.addClass("bc-component-hidden")}}},m=function(y){var s,r,x,v,t=q(".bd-tree-actionIcon",y),u={isDivider:true},w={pageActionOptionsData:[{name:"Add alias",classname:a(e.ALIAS)},{name:"Add alias to current state",classname:a(e.STATE_ALIAS)},{name:"Add redirect",classname:a(e.REDIRECT)},u,{name:"Remove",classname:a(e.DELETE)},{name:"Duplicate",classname:a(e.DUPLICATE)},{name:"Show reference",classname:a(e.SHOW_REFERENCE)}]};h.observer.notifyObserver(h.pm.observer.actionBtnOptionsData,w);for(s=w.pageActionOptionsData.length-1;s>=0;s--){x=w.pageActionOptionsData[s];if(x.name==="Republish all"){x=w.pageActionOptionsData.splice(s,1);w.pageActionOptionsData.push(u,x[0]);break}}for(s=0,r=t.length;s<r;s++){x=bc.component.dropdown({target:t[s],type:"action-icon-div",cssClass:"bd-pageMgmt-actionDD",staticLabel:true,options:w.pageActionOptionsData,wrapped:true,openLeft:true,beforeOpen:f,beforeClose:i,minWidth:110,maxHeight:260,addTitle:true});v=x.view[0].dropdownOptions;k(v);h.observer.notifyObserver(h.pm.observer.actionBtnReady,v)}};var c=function(r){o=r.oGadgetBody;if(h&&h.pm&&h.pm.observer){h.observer.addObserver(h.pm.observer.closeActionDropdown,d);h.observer.addObserver(h.pm.observer.initActionDropdown,m);h.observer.addObserver(h.pm.observer.cancelSearch,function(){d()});h.observer.addObserver(h.pm.observer.jsTreeStartDrag,function(s){d(s.data.obj)})}};h.observer.addObserver(h.notifications.pageMgmt.START,c)}).call(bd.pm.view,window);(function(l){var p=l.jQuery,j=l.bd||{},k=l.bc||{},o,a,g,h,b,i,f=function(){g=p(".bd-pm-search-container",o);var r={tokenInputParams:{idPrefix:"token-input-pagemgnt-search",urlFn:function(s,w,v){if(v&&v.cmd==="uses"){var u=w.replace(v.cmd+":",""),t=p(".bd-ap-tree",o).children("ul").children("li.bd-ap-accordion-active").data("repository");s=j.contextRoot+"/content/atom/"+(t?t:"contentRepository")+"/query?q=SELECT * FROM cmis:document WHERE cmis:name LIKE '%"+encodeURIComponent(u)+"%' ORDER BY cmis:name ASC&&searchAllVersions=false&includeAllowableActions=false&includeRelationships=none&maxItems=10&skipCount=0"}return s},resultData:function(t,w,v){var s=false;if(v&&v.cmd==="uses"){s=[];var u=p(t),x=function(y,A){var z=p(A);s.push({title:m(z,"cmis:propertyString","cmis:name"),uuid:m(z,"cmis:propertyId","cmis:objectId")})};u.find("atom\\:entry, entry").each(x)}return s}},dropdownParams:{uid:"56562",cssClass:"bd-pageMgmt-searchCmdDD",beforeOpen:function(){if(p(".bd-pageContainer",o).hasClass("bd-search-active")){return true}else{return false}}},cmd:["ref","uses","pub","@"],target:g,onSearch:function(s){j.observer.notifyObserver(j.pm.observer.search,s)},onCancel:function(s){j.observer.notifyObserver(j.pm.observer.cancelSearch,s)}},q=k.component.searchTokenInput(r);i=q.$template;a=p(".bc-search-button",g);b=p(".bc-search-input",g);h=i.find(".token-input-input-token").find("input");j.observer.notifyObserver("show-search",{body:o,$tokenizedInput:h})},c=function(){j.observer.addObserver(j.pm.observer.search,function(q){if(!j.PageMgmtTree.searchActive){a.click()}j.PageMgmtTree.searchActive=true;if(!p(".bd-pageContainer",o).hasClass("bd-assetPicker-on")){j.pm.controller.searchLinks(q.query)}});j.observer.addObserver(j.pm.observer.searchResult,function(q){i.trigger("onResult",q)});j.observer.addObserver(j.pm.observer.cancelSearch,function(){if(p(".bc-icn-spinner",a).length){j.pm.controller.searchCanceled=true}})},n=function(q){return[q.replace(":","\\:"),q.split(":")[1]]},d=function(s,q){var t=n(s),r=n(q);return t[0]+"[propertyDefinitionId='"+r[0]+"'] , "+t[1]+"[propertyDefinitionId='"+r[1]+"']"},m=function(q,s,r){return q.find(d(s,r)).text()};var e=function(q){o=q.oGadgetBody;f();if(j&&j.pm&&j.pm.observer){c()}};j.observer.addObserver(j.notifications.pageMgmt.START,e)}).call(bd.pm.view,window);